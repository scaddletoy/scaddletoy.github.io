import{r as c,j as _,T as ds,C as Dt,u as it,P as ot,a as Rt,b as It,c as dn,d as ue,e as Bn,R as zn,I as tt,U as Vn,D as Z,O as oe,f as At,g as vr,h as Ti,i as mn,k as ps,K as Jn,l as hs,m as Ft,n as Ri,o as gs,p as ms,Z as jt,q as Ge,s as Ii,t as Sr,v as Oi,w as ys,x as Ci,y as Mi,E as Pi,_ as Tr,z as Ai,A as Ni,M as Rr,B as _i}from"../index.js";import{A as br,t as vs,s as bs,f as ir,a as Fi,m as Ir,g as ji,h as Li}from"./utils-DRB1n_X_.js";import{SupabaseService as Zt}from"./SupabaseService-BE7KA2gQ.js";import{M as xs,j as Xn,T as ki,w as Zn,e as gt,r as Qn,s as Or,m as Cr,u as Mr,a as $i,f as Di,b as er,c as yn,d as Ui}from"./tree.esm-X961ss2W.js";import{D as Pr,I as Ar,O as Es}from"./dropdown.esm-CoEZyfAG.js";import{P as ws}from"./index.esm-BEZXvJxF.js";import{B as nn}from"./button.esm-iOg5UvVS.js";import{z as Bi}from"./index.esm-CgPSL6hs.js";import{C as zi,S as Vi}from"./index.esm-BHvanpNW.js";import{M as Hi,a as Ki}from"./ModelCard-VbN0lOo1.js";import{D as Gi}from"./dialog.esm-C7tcdkgY.js";function Ss(t,e){let n;t.id="WORKER."+t.taskName+"."+Math.random().toString(36).substring(2)+" |";function s(){n&&(n.terminate(),n=null)}return br((r,i)=>(n=new Worker(new URL("/assets/openscad-worker-BZel_KBF.js",import.meta.url),{type:"module"}),n.onmessage=a=>{"result"in a.data?(r(a.data.result),s()):e(a.data)},n.postMessage(t),()=>{s()}))}const Wi=new Set(["Could not initialize localization."]),Ts=(t,e)=>({logText:qi(t),markers:Yi(t,e)});function qi(t,e){const n=[];for(const{stderr:s,stdout:r,error:i}of t){const a=s??r??`EXCEPTION: ${i}`;Wi.has(a)||n.push(a)}return n.join(`
`)}function Yi(t,e){let n=[];const s=[];let r=0,i=0;const a=(p,h,d)=>{s.push({startLineNumber:Number(d),startColumn:1,endLineNumber:Number(d),endColumn:1e3,message:p,severity:8})},o=e.shiftSourceLines&&e.shiftSourceLines.sourcePath,f=(p,h)=>{const d=Number(h);return o&&p.endsWith(o)?d-e.shiftSourceLines.skipLines:d};for(const{stderr:p,stdout:h,error:d}of t){if(p){p.startsWith("ERROR:")&&i++,p.startsWith("WARNING:")&&r++;let S=/^ERROR: Parser error in file "([^"]+)", line (\d+): (.*)$/.exec(p);if(S){const[O,L,M,T]=S;a(T,L,f(L,M));continue}if(S=/^ERROR: Parser error: (.*?) in file ([^",]+), line (\d+)$/.exec(p),S){const[O,L,M,T]=S;a(L,M,f(M,T));continue}if(S=/^WARNING: (.*?),? in file ([^,]+), line (\d+)\.?/.exec(p),S){const[O,L,M,T]=S;s.push({startLineNumber:f(M,T),startColumn:1,endLineNumber:f(M,T),endColumn:1e3,message:L,severity:4});continue}}n.push(p??h??`EXCEPTION: ${d}`)}return(i||r)&&(n=[`${i} errors, ${r} warnings!`,"",...n]),s}const Ji=300,Xi=vs(Ji,t=>{const{activePath:e,sources:n}=t;""+n[0].content;const s="out.json",r=Ss({taskName:"checkSyntax",mountArchives:!0,files:n,args:[e,"-o",s,"--export-format=param"],outputPaths:[s]},i=>{});return br((i,a)=>((async()=>{try{const o=await r;let f;if(o.outputs&&o.outputs.length==1){const[[,p]]=o.outputs;try{f=JSON.parse(p)}catch(h){console.error(`Error while parsing parameter set: ${h}
${p}`)}}else console.error("No output from runner!");i({...Ts(o.mergedOutputs,{}),parameterSet:f})}catch(o){console.error(o),a(o)}})(),()=>r.kill()))}),Zi=1e3;function Rs(t){return typeof t=="string"?`"${t}"`:t instanceof Array?`[${t.map(Rs).join(", ")}]`:`${t}`}const Qi=vs(Zi,t=>{const{scadPath:e,sources:n,isPreview:s,mountArchives:r,vars:i,features:a,extraArgs:o,renderFormat:f,streamsCallback:p}=t,h=[];if(s&&h.push("$preview=true;"),!e.endsWith(".scad"))throw new Error("First source must be a .scad file, got "+n[0].path+" instead");const d=n.filter(w=>w.path===e)[0];if(!d)throw new Error("Active path not found in sources!");if(d.content==null)throw new Error("Source content is null!");const S=[...h,d.content].join(`
`),O=f=="glb"||f=="3mf"?"off":f,M=`${e.replace(/\.scad$/,"").split("/").pop()}.${O}`,T=[e,"-o",M,"--backend=manifold","--export-format="+(O=="stl"?"binstl":O),...Object.entries(i??{}).flatMap(([w,g])=>[`-D${w}=${Rs(g)}`]),...(a??[]).map(w=>`--enable=${w}`),...o??[]],u=Ss({taskName:s?"preview":"render",mountArchives:r,files:n.map(w=>w.path===e?{path:w.path,content:S}:w),args:T,outputPaths:[M]},p);return br((w,g)=>((async()=>{try{const x=await u,{logText:v,markers:E}=Ts(x.mergedOutputs,{shiftSourceLines:{sourcePath:d.path,skipLines:h.length}});x.error&&g(x.error);const[l]=x.outputs??[];if(!l){g(new Error("No output from runner!"));return}const[m,y]=l,b=m.split("/"),P=b[b.length-1],F=m.endsWith(".svg")?"image/svg+xml":"application/octet-stream",j=new Blob([y]),$=new File([j],P,{type:F});w({outFile:$,logText:v,markers:E,elapsedMillis:x.elapsedMillis})}catch(x){console.error(x),g(x)}})(),()=>u.kill()))});var Is=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Jt=t=>{let e=0;for(let n=0;n<t.length;n++){let s=t[n],r=Is.indexOf(s);e=e*83+r}return e},Kt=(t,e)=>{var n="";for(let s=1;s<=e;s++){let r=Math.floor(t)/Math.pow(83,e-s)%83;n+=Is[Math.floor(r)]}return n},Lt=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},kt=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},eo=t=>t<0?-1:1,$t=(t,e)=>eo(t)*Math.pow(Math.abs(t),e),_n=class extends Error{constructor(t){super(t),this.name="ValidationError",this.message=t}},to=t=>{if(!t||t.length<6)throw new _n("The blurhash string must be at least 6 characters");let e=Jt(t[0]),n=Math.floor(e/9)+1,s=e%9+1;if(t.length!==4+2*s*n)throw new _n(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*s*n}`)},no=t=>{let e=t>>16,n=t>>8&255,s=t&255;return[Lt(e),Lt(n),Lt(s)]},ro=(t,e)=>{let n=Math.floor(t/361),s=Math.floor(t/19)%19,r=t%19;return[$t((n-9)/9,2)*e,$t((s-9)/9,2)*e,$t((r-9)/9,2)*e]},so=(t,e,n,s)=>{to(t),s=s|1;let r=Jt(t[0]),i=Math.floor(r/9)+1,a=r%9+1,o=(Jt(t[1])+1)/166,f=new Array(a*i);for(let d=0;d<f.length;d++)if(d===0){let S=Jt(t.substring(2,6));f[d]=no(S)}else{let S=Jt(t.substring(4+d*2,6+d*2));f[d]=ro(S,o*s)}let p=e*4,h=new Uint8ClampedArray(p*n);for(let d=0;d<n;d++)for(let S=0;S<e;S++){let O=0,L=0,M=0;for(let g=0;g<i;g++)for(let x=0;x<a;x++){let v=Math.cos(Math.PI*S*x/e)*Math.cos(Math.PI*d*g/n),E=f[x+g*a];O+=E[0]*v,L+=E[1]*v,M+=E[2]*v}let T=kt(O),u=kt(L),w=kt(M);h[4*S+0+d*p]=T,h[4*S+1+d*p]=u,h[4*S+2+d*p]=w,h[4*S+3+d*p]=255}return h},io=so,Nr=4,oo=(t,e,n,s)=>{let r=0,i=0,a=0,o=e*Nr;for(let p=0;p<e;p++){let h=Nr*p;for(let d=0;d<n;d++){let S=h+d*o,O=s(p,d);r+=O*Lt(t[S]),i+=O*Lt(t[S+1]),a+=O*Lt(t[S+2])}}let f=1/(e*n);return[r*f,i*f,a*f]},ao=t=>{let e=kt(t[0]),n=kt(t[1]),s=kt(t[2]);return(e<<16)+(n<<8)+s},lo=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor($t(t[0]/e,.5)*9+9.5)))),s=Math.floor(Math.max(0,Math.min(18,Math.floor($t(t[1]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor($t(t[2]/e,.5)*9+9.5))));return n*19*19+s*19+r},co=(t,e,n,s,r)=>{if(s<1||s>9||r<1||r>9)throw new _n("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new _n("Width and height must match the pixels array");let i=[];for(let d=0;d<r;d++)for(let S=0;S<s;S++){let O=S==0&&d==0?1:2,L=oo(t,e,n,(M,T)=>O*Math.cos(Math.PI*S*M/e)*Math.cos(Math.PI*d*T/n));i.push(L)}let a=i[0],o=i.slice(1),f="",p=s-1+(r-1)*9;f+=Kt(p,1);let h;if(o.length>0){let d=Math.max(...o.map(O=>Math.max(...O))),S=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));h=(S+1)/166,f+=Kt(S,1)}else h=1,f+=Kt(0,1);return f+=Kt(ao(a),4),o.forEach(d=>{f+=Kt(lo(d,h),2)}),f},uo=co;async function fo(t){return new Promise((e,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=(...r)=>n(r),s.src=t})}async function po(t){const{rgba:e,w:n,h:s}=await go(t,{maxSize:100,opaque:!0}),r=9;return uo(new Uint8ClampedArray(e),n,s,r,r)}function ho(t,e,n){const s=io(t,e,n),r=document.createElement("canvas");r.width=e,r.height=n;const i=r.getContext("2d"),a=i.createImageData(e,n);return a.data.set(s),i.putImageData(a,0,0),r.toDataURL("image/png")}async function go(t,{maxSize:e,opaque:n}){const s=await fo(t),r=s.width,i=s.height,a=Math.min(e/r,e/i),o=Math.floor(r*a),f=Math.floor(i*a),p=document.createElement("canvas");p.width=o,p.height=f;const h=p.getContext("2d");if(!h)throw new Error("Could not get canvas context");h.fillStyle="white",h.fillRect(0,0,o,f),h.drawImage(s,0,0,o,f);const d=h.getImageData(0,0,o,f);return{rgba:new Uint8Array(d.data.buffer),w:o,h:f}}const rn=[["Diagonal",Math.PI/4,Math.PI/4],["Front",0,Math.PI/2],["Right",Math.PI/2,Math.PI/2],["Back",Math.PI,Math.PI/2],["Left",-Math.PI/2,Math.PI/2],["Top",0,0],["Bottom",0,Math.PI]];function or(t,e){return[Math.cos(t)*Math.sin(e),Math.sin(t)*Math.sin(e),Math.cos(e)]}function Os(t,e){const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+s*s+r*r)}const _r=(t,e)=>Math.min(Math.abs(t-e),Math.abs(t-e+2*Math.PI),Math.abs(t-e-2*Math.PI));function mo(t,e){const n=or(t,e),r=rn.map(([f,p,h])=>or(p,h)).map(f=>Os(n,f)),i=rn.map(([f,p,h])=>Math.max(_r(t,p),_r(e,h))),[a,o]=r.reduce((f,p,h)=>p<f[1]?[h,p]:f,[0,1/0]);return[a,o,i[a]]}const vn=(([t,e,n])=>`${e}rad ${n}rad auto`)(rn[0]),yo=c.forwardRef(function(e,n){const[s,r]=c.useState("none"),i=c.useRef(null),a=c.useRef(null),o=c.useRef(null),[f,p]=c.useState(),[h,d]=c.useState(void 0),S=f===e.modelUri;if(e?.preview){let{hash:T,uri:u}=h??{hash:""};e.preview.blurhash&&T!==e.preview.blurhash&&(T=e.preview.blurhash,u=ho(T,100,100),d({hash:T,uri:u}))}else h&&d(void 0);const O=c.useCallback(async T=>{if(p(e.modelUri),!i.current)return;const u=await i.current.toDataURL("image/png",.5);await po(u)},[e.modelUri,p,i.current]);c.useEffect(()=>{if(!i.current)return;const T=i.current;return T.addEventListener("load",O),()=>T.removeEventListener("load",O)},[i.current,O]);for(const T of[i,a]){const u=T===i?a:i;c.useEffect(()=>{if(!T.current)return;function w(x){if(u.current&&x.detail.source==="user-interaction"){const v=T.current.getCameraOrbit();v.radius=u.current.getCameraOrbit().radius,u.current.cameraOrbit=v.toString()}}const g=T.current;return g.addEventListener("camera-change",w),()=>g.removeEventListener("camera-change",w)},[T.current,u.current])}c.useEffect(()=>{let T;function u(){const v=a.current.getCameraOrbit();return or(v.theta,v.phi)}function w(v){v.target===a.current&&(T=u())}function g(v){if(v.target===a.current){const m=u();if((T?Os(m,T):1/0)>.01)return;const b=a.current.getCameraOrbit(),P=i.current.getCameraOrbit(),[F,j,$]=mo(b.theta,b.phi),N=v.button==2?0:j<.01&&$<.1?(F+1)%rn.length:F,[D,R,A]=rn[N];Object.assign(P,{theta:R,phi:A}),i.current.cameraOrbit=a.current.cameraOrbit=P.toString(),r("none"),v.stopPropagation(),v.preventDefault()}}function x(v){v.target===a.current&&v.preventDefault()}return window.addEventListener("mousedown",w),window.addEventListener("mouseup",g),window.addEventListener("contextmenu",x),()=>{window.removeEventListener("mousedown",w),window.removeEventListener("mouseup",g),window.removeEventListener("contextmenu",x)}});async function L(){if(!i.current)return null;const T=await i.current.toDataURL("image/png",1),u=new window.Image;u.src=T,await new Promise(x=>{u.onload=x});const w=document.createElement("canvas");w.width=500,w.height=500;const g=w.getContext("2d");return g?(g.drawImage(u,0,0,500,500),w.toDataURL("image/webp",.9)):null}function M(){!i.current||!a.current||(i.current.cameraOrbit=vn,a.current.cameraOrbit=vn)}return c.useImperativeHandle(n,()=>({getWebpScreenshot:L,resetView:M}),[L,M]),_.jsxs("div",{className:e.className,style:{display:"flex",flexDirection:"column",position:"relative",flex:1,width:"100%",background:e.lightMode?"#eee":"#111",...e.style??{}},children:[_.jsx(ds,{ref:o,position:"top-right"}),_.jsx("style",{children:`
          @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 0.7; }
            100% { opacity: 0.4; }
          }
        `}),S?_.jsx(_.Fragment,{}):h?_.jsx("img",{src:h.uri,style:{animation:"pulse 1.5s ease-in-out infinite",position:"absolute",pointerEvents:"none",width:"100%",height:"100%"}}):_.jsx(Dt,{text:"Loading model"}),_.jsx("model-viewer",{orientation:"0deg -90deg 0deg",class:"main-viewer",src:e.modelUri,style:{transition:"opacity 0.5s",position:"absolute",width:"100%",height:"100%"},"camera-orbit":vn,"interaction-prompt":s,"environment-image":"./skybox-lights.jpg",exposure:2,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","camera-controls":!0,ar:!0,ref:i,children:_.jsx("span",{slot:"progress-bar"})}),_.jsx("model-viewer",{orientation:"0deg -90deg 0deg",src:"./axes.glb",style:{position:"absolute",bottom:0,left:0,zIndex:10,height:"100px",width:"100px"},loading:"eager","camera-orbit":vn,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","orbit-sensitivity":"5","interaction-prompt":"none","camera-controls":"false","disable-zoom":!0,"disable-tap":!0,"disable-pan":!0,ref:a,children:_.jsx("span",{slot:"progress-bar"})})]})});function Fn(){return Fn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Fn.apply(null,arguments)}function vo(t){if(Array.isArray(t))return t}function bo(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Fr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function xo(t,e){if(t){if(typeof t=="string")return Fr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fr(t,e):void 0}}function Eo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jr(t,e){return vo(t)||bo(t,e)||xo(t,e)||Eo()}var bn=Rt.extend({defaultProps:{__TYPE:"Fieldset",id:null,legend:null,className:null,style:null,toggleable:null,collapsed:null,collapseIcon:null,transitionOptions:null,expandIcon:null,onExpand:null,onCollapse:null,onToggle:null,onClick:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return ue("p-fieldset p-component",{"p-fieldset-toggleable":n.toggleable})},toggleableContent:"p-toggleable-content",togglericon:"p-fieldset-toggler",legendTitle:"p-fieldset-legend-text",legend:"p-fieldset-legend p-unselectable-text",content:"p-fieldset-content",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-fieldset-legend > a,
            .p-fieldset-legend > span {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .p-fieldset-toggleable .p-fieldset-legend a {
                cursor: pointer;
                user-select: none;
                overflow: hidden;
                position: relative;
                text-decoration: none;
            }
            
            .p-fieldset-legend-text {
                line-height: 1;
            }
        }
        `}}),Cs=c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=bn.getProps(t,s),i=c.useState(r.id),a=jr(i,2),o=a[0],f=a[1],p=c.useState(r.collapsed),h=jr(p,2),d=h[0],S=h[1],O=r.toggleable?r.onToggle?r.collapsed:d:!1,L=c.useRef(null),M=c.useRef(null),T=o+"_header",u=o+"_content",w=bn.setMetaData({props:r,state:{id:o,collapsed:O}}),g=w.ptm,x=w.cx,v=w.isUnstyled;It(bn.css.styles,v,{name:"fieldset"});var E=function(A){r.toggleable&&(O?l(A):m(A),r.onToggle&&r.onToggle({originalEvent:A,value:!O})),A.preventDefault()},l=function(A){r.onToggle||S(!1),r.onExpand&&r.onExpand(A)},m=function(A){r.onToggle||S(!0),r.onCollapse&&r.onCollapse(A)};dn(function(){r.id||f(Vn())});var y=function(A){(A.code==="Enter"||A.code==="NumpadEnter"||A.code==="Space")&&(E(A),A.preventDefault())},b=function(){var A=n({className:x("content")},g("content")),z=n({ref:M,id:u,role:"region","aria-labelledby":T,className:x("toggleableContent")},g("toggleableContent")),q=n({classNames:x("transition"),timeout:{enter:1e3,exit:450},in:!O,unmountOnExit:!0,options:r.transitionOptions},g("transition"));return c.createElement(Bn,Fn({nodeRef:M},q),c.createElement("div",z,c.createElement("div",A,r.children)))},P=function(){if(r.toggleable){var A=n({className:x("togglericon")},g("togglericon")),z=O?r.expandIcon||c.createElement(ws,A):r.collapseIcon||c.createElement(xs,A),q=tt.getJSXIcon(z,A,{props:r});return q}return null},F=function(){var A=n({className:x("legendTitle")},g("legendTitle")),z=n({id:T,role:"button","aria-expanded":!O,"aria-controls":u,onKeyDown:y,onClick:E,"aria-label":r.legend,tabIndex:0},g("toggler"));if(r.toggleable){var q=P();return c.createElement("a",z,q,c.createElement("span",A,r.legend),c.createElement(zn,null))}return c.createElement("span",Fn({},A,{id:T}),r.legend)},j=function(){var A=n({className:x("legend")},g("legend"));if(r.legend!=null||r.toggleable){var z=F();return c.createElement("legend",A,z)}};c.useImperativeHandle(e,function(){return{props:r,getElement:function(){return L.current},getContent:function(){return M.current}}});var $=n({id:o,ref:L,style:r.style,className:ue(r.className,x("root")),onClick:r.onClick},bn.getOtherProps(r),g("root")),N=j(),D=b();return c.createElement("fieldset",$,N,D)});Cs.displayName="Fieldset";function Qt(){return Qt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Qt.apply(null,arguments)}function sn(t){"@babel/helpers - typeof";return sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sn(t)}function wo(t,e){if(sn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(sn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function So(t){var e=wo(t,"string");return sn(e)=="symbol"?e:e+""}function To(t,e,n){return(e=So(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ro(t){if(Array.isArray(t))return t}function Io(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Lr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Oo(t,e){if(t){if(typeof t=="string")return Lr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lr(t,e):void 0}}function Co(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mo(t,e){return Ro(t)||Io(t,e)||Oo(t,e)||Co()}var Po={box:"p-checkbox-box",input:"p-checkbox-input",icon:"p-checkbox-icon",root:function(e){var n=e.props,s=e.checked,r=e.context;return ue("p-checkbox p-component",{"p-highlight":s,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled"})}},xn=Rt.extend({defaultProps:{__TYPE:"Checkbox",autoFocus:!1,checked:!1,className:null,disabled:!1,falseValue:!1,icon:null,id:null,inputId:null,inputRef:null,invalid:!1,variant:null,name:null,onChange:null,onContextMenu:null,onMouseDown:null,readOnly:!1,required:!1,style:null,tabIndex:null,tooltip:null,tooltipOptions:null,trueValue:!0,value:null,children:void 0},css:{classes:Po}});function kr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function $r(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kr(Object(n),!0).forEach(function(s){To(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Ms=c.memo(c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=xn.getProps(t,s),i=c.useState(!1),a=Mo(i,2),o=a[0],f=a[1],p=xn.setMetaData({props:r,state:{focused:o},context:{checked:r.checked===r.trueValue,disabled:r.disabled}}),h=p.ptm,d=p.cx,S=p.isUnstyled;It(xn.css.styles,S,{name:"checkbox"});var O=c.useRef(null),L=c.useRef(r.inputRef),M=function(){return r.checked===r.trueValue},T=function(b){if(!(r.disabled||r.readOnly)&&r.onChange){var P,F=M(),j=F?r.falseValue:r.trueValue,$={originalEvent:b,value:r.value,checked:j,stopPropagation:function(){b?.stopPropagation()},preventDefault:function(){b?.preventDefault()},target:{type:"checkbox",name:r.name,id:r.id,value:r.value,checked:j}};if(r==null||(P=r.onChange)===null||P===void 0||P.call(r,$),b.defaultPrevented)return;Z.focus(L.current)}},u=function(b){var P;f(!0),r==null||(P=r.onFocus)===null||P===void 0||P.call(r,b)},w=function(b){var P;f(!1),r==null||(P=r.onBlur)===null||P===void 0||P.call(r,b)};c.useImperativeHandle(e,function(){return{props:r,focus:function(){return Z.focus(L.current)},getElement:function(){return O.current},getInput:function(){return L.current}}}),c.useEffect(function(){oe.combinedRefs(L,r.inputRef)},[L,r.inputRef]),At(function(){L.current.checked=M()},[r.checked,r.trueValue]),dn(function(){r.autoFocus&&Z.focus(L.current,r.autoFocus)});var g=M(),x=oe.isNotEmpty(r.tooltip),v=xn.getOtherProps(r),E=n({id:r.id,className:ue(r.className,d("root",{checked:g,context:s})),style:r.style,"data-p-highlight":g,"data-p-disabled":r.disabled,onContextMenu:r.onContextMenu,onMouseDown:r.onMouseDown},v,h("root")),l=function(){var b=oe.reduceKeys(v,Z.ARIA_PROPS),P=n($r({id:r.inputId,type:"checkbox",className:d("input"),name:r.name,tabIndex:r.tabIndex,onFocus:function(j){return u(j)},onBlur:function(j){return w(j)},onChange:function(j){return T(j)},disabled:r.disabled,readOnly:r.readOnly,required:r.required,"aria-invalid":r.invalid,checked:g},b),h("input"));return c.createElement("input",Qt({ref:L},P))},m=function(){var b=n({className:d("icon")},h("icon")),P=n({className:d("box",{checked:g}),"data-p-highlight":g,"data-p-disabled":r.disabled},h("box")),F=g?r.icon||c.createElement(Ti,b):null,j=tt.getJSXIcon(F,$r({},b),{props:r,checked:g});return c.createElement("div",P,j)};return c.createElement(c.Fragment,null,c.createElement("div",Qt({ref:O},E),l(),m()),x&&c.createElement(vr,Qt({target:O,content:r.tooltip,pt:h("tooltip")},r.tooltipOptions)))}));Ms.displayName="Checkbox";function ar(){return ar=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},ar.apply(null,arguments)}function on(t){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(t)}function Ao(t,e){if(on(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(on(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function No(t){var e=Ao(t,"string");return on(e)=="symbol"?e:e+""}function _o(t,e,n){return(e=No(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function lr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Fo(t){if(Array.isArray(t))return lr(t)}function jo(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ps(t,e){if(t){if(typeof t=="string")return lr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lr(t,e):void 0}}function Lo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ko(t){return Fo(t)||jo(t)||Ps(t)||Lo()}function $o(t){if(Array.isArray(t))return t}function Do(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Uo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function En(t,e){return $o(t)||Do(t,e)||Ps(t,e)||Uo()}var Bo={handle:function(e){var n=e.index,s=e.handleIndex;return ue("p-slider-handle",{"p-slider-handle-start":n===0,"p-slider-handle-end":n===1,"p-slider-handle-active":s.current===n})},range:"p-slider-range",root:function(e){var n=e.props,s=e.vertical,r=e.horizontal;return ue("p-slider p-component",{"p-disabled":n.disabled,"p-slider-horizontal":r,"p-slider-vertical":s})}},zo=`
@layer primereact {
    .p-slider {
        position: relative;
    }
    
    .p-slider .p-slider-handle {
        position: absolute;
        cursor: grab;
        touch-action: none;
        display: block;
        z-index: 1;
    }
    
    .p-slider .p-slider-handle.p-slider-handle-active {
        z-index: 2;
    }
    
    .p-slider-range {
        position: absolute;
        display: block;
    }
    
    .p-slider-horizontal .p-slider-range {
        top: 0;
        left: 0;
        height: 100%;
    }
    
    .p-slider-horizontal .p-slider-handle {
        top: 50%;
    }
    
    .p-slider-vertical {
        height: 100px;
    }
    
    .p-slider-vertical .p-slider-handle {
        left: 50%;
    }
    
    .p-slider-vertical .p-slider-range {
        bottom: 0;
        left: 0;
        width: 100%;
    }
}
`,Vo={handle:{position:"absolute"},range:{position:"absolute"}},Gt=Rt.extend({defaultProps:{__TYPE:"Slider",id:null,value:null,min:0,max:100,orientation:"horizontal",step:null,range:!1,style:null,className:null,disabled:!1,tabIndex:0,onChange:null,onSlideEnd:null,children:void 0},css:{classes:Bo,styles:zo,inlineStyles:Vo}});function Dr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Dr(Object(n),!0).forEach(function(s){_o(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var As=c.memo(c.forwardRef(function(t,e){var n,s,r,i=it(),a=c.useContext(ot),o=Gt.getProps(t,a),f=c.useRef(null),p=c.useRef(0),h=c.useRef(!1),d=c.useRef(!1),S=c.useRef(0),O=c.useRef(0),L=c.useRef(0),M=c.useRef(0),T=c.useRef(),u=o.range?(n=o.value)!==null&&n!==void 0?n:[o.min,o.max]:(s=(r=o.value)!==null&&r!==void 0?r:o.min)!==null&&s!==void 0?s:0,w=o.orientation==="horizontal",g=o.orientation==="vertical",x=mn({type:"mousemove",listener:function(k){return Ie(k)}}),v=En(x,2),E=v[0],l=v[1],m=mn({type:"mouseup",listener:function(k){return ze(k)}}),y=En(m,2),b=y[0],P=y[1],F=mn({type:"touchmove",listener:function(k){return Ie(k)}}),j=En(F,2),$=j[0],N=j[1],D=mn({type:"touchend",listener:function(k){return ze(k)}}),R=En(D,2),A=R[0],z=R[1],q=Gt.setMetaData({props:o}),G=q.ptm,ne=q.cx,ve=q.sx,he=q.isUnstyled;It(Gt.css.styles,he,{name:"slider"});var te=function(k,Y){var Q=o.range?u[p.current]:u,fe=(o.step||1)*Y;Ke(k,Q+fe),k.preventDefault()},ie=function(k,Y){o.disabled||(d.current=!0,we(),h.current=!0,o.range&&u[0]===o.max?p.current=0:p.current=Y,k.preventDefault())},Ie=function(k){d.current&&(ye(k),k.preventDefault())},ze=function(k){if(d.current){d.current=!1;var Y=ye(k);o.onSlideEnd&&o.onSlideEnd({originalEvent:k,value:Y}),T.current=void 0,l(),P(),N(),z()}},qe=function(k,Y){E(),b(),ie(k,Y)},Ye=function(k,Y){k.changedTouches&&k.changedTouches[0]&&(T.current=k.changedTouches[0].identifier),$(),A(),ie(k,Y)},at=function(k,Y){if(!o.disabled){p.current=Y;var Q=k.key;switch(Q){case"ArrowRight":case"ArrowUp":te(k,1);break;case"ArrowLeft":case"ArrowDown":te(k,-1);break;case"PageUp":te(k,10),k.preventDefault();break;case"PageDown":te(k,-10),k.preventDefault();break;case"Home":te(k,-u),k.preventDefault();break;case"End":te(k,o.max),k.preventDefault();break}}},Je=function(k){if(!o.disabled){if(!h.current){we();var Y=ye(k);o.onSlideEnd&&o.onSlideEnd({originalEvent:k,value:Y})}h.current=!1}},we=function(){var k=f.current.getBoundingClientRect();S.current=k.left+Z.getWindowScrollLeft(),O.current=k.top+Z.getWindowScrollTop(),L.current=f.current.offsetWidth,M.current=f.current.offsetHeight},$e=function(k){var Y,Q=Array.from((Y=k.changedTouches)!==null&&Y!==void 0?Y:[]).find(function(fe){return fe.identifier===T.current})||k;return{pageX:Q.pageX,pageY:Q.pageY}},ye=function(k){var Y,Q=$e(k),fe=Q.pageX,Se=Q.pageY;if(!(!fe||!Se)){w?Y=(fe-S.current)*100/L.current:Y=(O.current+M.current-Se)*100/M.current;var U=(o.max-o.min)*(Y/100)+o.min;if(o.step){var B=o.range?u[p.current]:u,ae=U-B;ae<0?U=B+Math.ceil(U/o.step-B/o.step)*o.step:ae>0&&(U=B+Math.floor(U/o.step-B/o.step)*o.step)}else U=Math.floor(U);return Ke(k,U)}},Ke=function(k,Y){var Q=parseFloat(Y.toFixed(10)),fe=Q;return o.range?(p.current===0?Q<o.min?Q=o.min:Q>o.max&&(Q=o.max):Q>o.max?Q=o.max:Q<o.min&&(Q=o.min),fe=ko(u),fe[p.current]=Q,o.onChange&&o.onChange({originalEvent:k,value:fe})):(Q<o.min?Q=o.min:Q>o.max&&(Q=o.max),fe=Q,o.onChange&&o.onChange({originalEvent:k,value:fe})),fe},Ee=function(k,Y,Q){k=oe.isEmpty(k)?null:k,Y=oe.isEmpty(Y)?null:Y;var fe={transition:d.current?"none":null,left:k!=null?k+"%":null,bottom:Y!=null?Y+"%":null},Se=i(ht({className:ne("handle",{index:Q,handleIndex:p}),style:ht(ht({},ve("handle",{dragging:d,leftValue:k,bottomValue:Y})),fe),tabIndex:o.tabIndex,role:"slider",onMouseDown:function(B){return qe(B,Q)},onTouchStart:function(B){return Ye(B,Q)},onKeyDown:function(B){return at(B,Q)},"aria-valuemin":o.min,"aria-valuemax":o.max,"aria-valuenow":k||Y||0,"aria-orientation":o.orientation},Ze),G("handle"));return c.createElement("span",Se)},Pe=function(){var k=(u[0]<o.min?o.min:u[0]-o.min)*100/(o.max-o.min),Y=(u[1]>o.max?o.max:u[1]-o.min)*100/(o.max-o.min),Q=w?Ee(k,null,0):Ee(null,k,0),fe=w?Ee(Y,null,1):Ee(null,Y,1),Se=Y>k?Y-k:k-Y,U=Y>k?k:Y,B=w?{left:U+"%",width:Se+"%"}:{bottom:U+"%",height:Se+"%"},ae=i({className:ne("range"),style:ht(ht({},ve("range")),B)},G("range"));return c.createElement(c.Fragment,null,c.createElement("span",ae),Q,fe)},Xe=function(){var k;u<o.min?k=o.min:u>o.max?k=o.max:k=(u-o.min)*100/(o.max-o.min);var Y=w?{width:k+"%"}:{height:k+"%"},Q=w?Ee(k,null,null):Ee(null,k,null),fe=i({className:ne("range"),style:ht(ht({},ve("range")),Y)},G("range"));return c.createElement(c.Fragment,null,c.createElement("span",fe),Q)};c.useImperativeHandle(e,function(){return{props:o,getElement:function(){return f.current}}});var Ve=Gt.getOtherProps(o),Ze=oe.reduceKeys(Ve,Z.ARIA_PROPS),Oe=o.range?Pe():Xe(),lt=i({style:o.style,className:ue(o.className,ne("root",{vertical:g,horizontal:w})),onClick:Je},Gt.getOtherProps(o),G("root"));return c.createElement("div",ar({id:o.id,ref:f},lt),Oe)}));As.displayName="Slider";const Ho="customizerRoot_CustomizerPanel",Ko="customizerFieldset_CustomizerPanel",Go="parameterInput_CustomizerPanel",Wo="parameterInputRow_CustomizerPanel",qo="parameterInputLeft_CustomizerPanel",Yo="parameterInputLabel_CustomizerPanel",Jo="parameterInputReset_CustomizerPanel",Xo="parameterInputResetHidden_CustomizerPanel",Zo="parameterInputResetVisible_CustomizerPanel",Qo="parameterInputCaption_CustomizerPanel",ea="parameterInputRight_CustomizerPanel",ta="parameterInputDropdown_CustomizerPanel",na="parameterInputNumber_CustomizerPanel",ra="parameterInputText_CustomizerPanel",sa="parameterInputArrayRow_CustomizerPanel",ia="parameterInputSlider_CustomizerPanel",xe={customizerRoot:Ho,customizerFieldset:Ko,parameterInput:Go,parameterInputRow:Wo,parameterInputLeft:qo,parameterInputLabel:Yo,parameterInputReset:Jo,parameterInputResetHidden:Xo,parameterInputResetVisible:Zo,parameterInputCaption:Qo,parameterInputRight:ea,parameterInputDropdown:ta,parameterInputNumber:na,parameterInputText:ra,parameterInputArrayRow:sa,parameterInputSlider:ia};function oa(t){const e=(t.parameterSet?.parameters??[]).reduce((r,i)=>(r[i.group]||(r[i.group]=[]),r[i.group].push(i),r),{}),n=Object.entries(e),s=n.length===1;return t.parameterSet?_.jsx("div",{className:xe.customizerRoot+(t.className?" "+t.className:""),style:t.style,children:n.map(([r,i])=>s?_.jsx("div",{children:i.map(a=>_.jsx(Ur,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))},r):_.jsx(Cs,{className:xe.customizerFieldset,legend:r,toggleable:!0,children:i.map(a=>_.jsx(Ur,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))},r))}):_.jsx(Dt,{text:"Waiting for customizer to run"},"spinner")}function Ur({param:t,value:e,style:n,handleChange:s}){const r=e!==void 0&&JSON.stringify(e)!==JSON.stringify(t.initial);return _.jsxs("div",{className:xe.parameterInput,style:n,children:[_.jsxs("div",{className:xe.parameterInputRow,children:[_.jsxs("div",{className:xe.parameterInputLeft,children:[_.jsxs("label",{className:xe.parameterInputLabel,children:[_.jsx("b",{children:t.name}),_.jsx("i",{className:"pi pi-refresh "+xe.parameterInputReset+" "+(r?xe.parameterInputResetVisible:xe.parameterInputResetHidden),onClick:()=>s(t.name,t.initial)})]}),_.jsx("div",{className:xe.parameterInputCaption,children:t.caption})]}),_.jsxs("div",{className:xe.parameterInputRight,children:[t.type==="number"&&"options"in t&&_.jsx(Pr,{className:xe.parameterInputDropdown,value:e??t.initial,options:t.options,onChange:i=>s(t.name,i.value),optionLabel:"name",optionValue:"value"},t.name),t.type==="string"&&t.options&&_.jsx(Pr,{className:xe.parameterInputDropdown,value:e??t.initial,options:t.options,onChange:i=>s(t.name,i.value),optionLabel:"name",optionValue:"value"},t.name),t.type==="boolean"&&_.jsx(Ms,{checked:e??t.initial,onChange:i=>s(t.name,i.checked)},t.name),!Array.isArray(t.initial)&&t.type==="number"&&!("options"in t)&&_.jsx(Ar,{className:xe.parameterInputNumber,value:e??t.initial,showButtons:!0,size:5,onValueChange:i=>s(t.name,i.value)},t.name),t.type==="string"&&!t.options&&_.jsx(ps,{className:xe.parameterInputText,value:e??t.initial,onChange:i=>s(t.name,i.target.value)},t.name),Array.isArray(t.initial)&&"min"in t&&_.jsx("div",{className:xe.parameterInputArrayRow,children:t.initial.map((i,a)=>_.jsx(Ar,{className:xe.parameterInputNumber,value:e?.[a]!==void 0&&e?.[a]!==null?e[a]:t.initial[a],min:t.min,max:t.max,showButtons:!0,size:5,step:t.step,onValueChange:o=>{const f=[...e??t.initial];f[a]=o.value,s(t.name,f)}},a))})]})]}),!Array.isArray(t.initial)&&t.type==="number"&&t.min!==void 0&&_.jsx(As,{className:xe.parameterInputSlider,value:e??t.initial,min:t.min,max:t.max,step:t.step,onChange:i=>s(t.name,i.value)},t.name)]})}function cr(){return cr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},cr.apply(null,arguments)}function an(t){"@babel/helpers - typeof";return an=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(t)}function aa(t,e){if(an(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(an(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function la(t){var e=aa(t,"string");return an(e)=="symbol"?e:e+""}function ca(t,e,n){return(e=la(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ua={root:function(e){var n=e.props,s=e.context,r=e.isFilled;return ue("p-inputtextarea p-inputtext p-component",{"p-disabled":n.disabled,"p-filled":r,"p-inputtextarea-resizable":n.autoResize,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":s&&s.inputStyle==="filled"})}},fa=`
@layer primereact {
    .p-inputtextarea-resizable {
        overflow: hidden;
        resize: none;
    }
    
    .p-fluid .p-inputtextarea {
        width: 100%;
    }
}
`,wn=Rt.extend({defaultProps:{__TYPE:"InputTextarea",__parentMetadata:null,autoResize:!1,invalid:!1,variant:null,keyfilter:null,onBlur:null,onFocus:null,onBeforeInput:null,onInput:null,onKeyDown:null,onKeyUp:null,onPaste:null,tooltip:null,tooltipOptions:null,validateOnly:!1,children:void 0,className:null},css:{classes:ua,styles:fa}});function Br(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function zr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Br(Object(n),!0).forEach(function(s){ca(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var xr=c.memo(c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=wn.getProps(t,s),i=c.useRef(e),a=c.useRef(0),o=wn.setMetaData(zr(zr({props:r},r.__parentMetadata),{},{context:{disabled:r.disabled}})),f=o.ptm,p=o.cx,h=o.isUnstyled;It(wn.css.styles,h,{name:"inputtextarea"});var d=function(m){r.autoResize&&w(),r.onFocus&&r.onFocus(m)},S=function(m){r.autoResize&&w(),r.onBlur&&r.onBlur(m)},O=function(m){r.autoResize&&w(),r.onKeyUp&&r.onKeyUp(m)},L=function(m){r.onKeyDown&&r.onKeyDown(m),r.keyfilter&&Jn.onKeyPress(m,r.keyfilter,r.validateOnly)},M=function(m){r.onBeforeInput&&r.onBeforeInput(m),r.keyfilter&&Jn.onBeforeInput(m,r.keyfilter,r.validateOnly)},T=function(m){r.onPaste&&r.onPaste(m),r.keyfilter&&Jn.onPaste(m,r.keyfilter,r.validateOnly)},u=function(m){var y=m.target;r.autoResize&&w(oe.isEmpty(y.value)),r.onInput&&r.onInput(m),oe.isNotEmpty(y.value)?Z.addClass(y,"p-filled"):Z.removeClass(y,"p-filled")},w=function(m){var y=i.current;y&&g()&&(a.current||(a.current=y.scrollHeight,y.style.overflow="hidden"),(a.current!==y.scrollHeight||m)&&(y.style.height="",y.style.height=y.scrollHeight+"px",parseFloat(y.style.height)>=parseFloat(y.style.maxHeight)?(y.style.overflowY="scroll",y.style.height=y.style.maxHeight):y.style.overflow="hidden",a.current=y.scrollHeight))},g=function(){if(Z.isVisible(i.current)){var m=i.current.getBoundingClientRect();return m.width>0&&m.height>0}return!1};c.useEffect(function(){oe.combinedRefs(i,e)},[i,e]),c.useEffect(function(){r.autoResize&&w(!0)},[r.autoResize,r.value]);var x=c.useMemo(function(){return oe.isNotEmpty(r.value)||oe.isNotEmpty(r.defaultValue)},[r.value,r.defaultValue]),v=oe.isNotEmpty(r.tooltip),E=n({ref:i,className:ue(r.className,p("root",{context:s,isFilled:x})),onFocus:d,onBlur:S,onKeyUp:O,onKeyDown:L,onBeforeInput:M,onInput:u,onPaste:T},wn.getOtherProps(r),f("root"));return c.createElement(c.Fragment,null,c.createElement("textarea",E),v&&c.createElement(vr,cr({target:i,content:r.tooltip,pt:f("tooltip")},r.tooltipOptions)))}));xr.displayName="InputTextarea";function ur(){return ur=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},ur.apply(null,arguments)}function da(t){if(Array.isArray(t))return t}function pa(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Vr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ha(t,e){if(t){if(typeof t=="string")return Vr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vr(t,e):void 0}}function ga(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hr(t,e){return da(t)||pa(t,e)||ha(t,e)||ga()}var Sn=Rt.extend({defaultProps:{__TYPE:"Panel",id:null,header:null,headerTemplate:null,footer:null,footerTemplate:null,toggleable:null,style:null,className:null,collapsed:null,expandIcon:null,collapseIcon:null,icons:null,transitionOptions:null,onExpand:null,onCollapse:null,onToggle:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return ue("p-panel p-component",{"p-panel-toggleable":n.toggleable})},header:"p-panel-header",title:"p-panel-title",icons:"p-panel-icons",toggler:"p-panel-header-icon p-panel-toggler p-link",togglerIcon:"p-panel-header-icon p-panel-toggler p-link",toggleableContent:"p-toggleable-content",content:"p-panel-content",footer:"p-panel-footer",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-panel-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
            }
            
            .p-panel-title {
              line-height: 1;
            }
            
            .p-panel-header-icon {
              display: inline-flex;
              justify-content: center;
              align-items: center;
              cursor: pointer;
              text-decoration: none;
              overflow: hidden;
              position: relative;
            }
        }
        `}}),mt=c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=Sn.getProps(t,s),i=c.useState(r.id),a=Hr(i,2),o=a[0],f=a[1],p=c.useState(r.collapsed),h=Hr(p,2),d=h[0],S=h[1],O=c.useRef(null),L=c.useRef(null),M=r.toggleable?r.onToggle?r.collapsed:d:!1,T=o+"_header",u=o+"_content",w=Sn.setMetaData({props:r,state:{id:o,collapsed:M}}),g=w.ptm,x=w.cx,v=w.isUnstyled;It(Sn.css.styles,v,{name:"panel"});var E=function(A){r.toggleable&&(M?l(A):m(A),A&&(r.onToggle&&r.onToggle({originalEvent:A,value:!M}),A.preventDefault()))},l=function(A){r.onToggle||S(!1),r.onExpand&&A&&r.onExpand(A)},m=function(A){r.onToggle||S(!0),r.onCollapse&&A&&r.onCollapse(A)};c.useImperativeHandle(e,function(){return{props:r,toggle:E,expand:l,collapse:m,getElement:function(){return O.current},getContent:function(){return L.current}}}),dn(function(){o||f(Vn())});var y=function(){if(r.toggleable){var A=o+"_label",z=n({className:x("toggler"),onClick:E,id:A,"aria-controls":u,"aria-expanded":!M,type:"button",role:"button","aria-label":r.header},g("toggler")),q=n(g("togglericon")),G=M?r.expandIcon||c.createElement(ws,q):r.collapseIcon||c.createElement(xs,q),ne=tt.getJSXIcon(G,q,{props:r,collapsed:M});return c.createElement("button",z,ne,c.createElement(zn,null))}return null},b=function(){var A=oe.getJSXElement(r.header,r),z=oe.getJSXElement(r.icons,r),q=y(),G=n({id:T,className:x("title")},g("title")),ne=c.createElement("span",G,A),ve=n({className:x("icons")},g("icons")),he=c.createElement("div",ve,z,q),te=n({className:x("header")},g("header")),ie=c.createElement("div",te,ne,he);if(r.headerTemplate){var Ie={className:"p-panel-header",titleClassName:"p-panel-title",iconsClassName:"p-panel-icons",togglerClassName:"p-panel-header-icon p-panel-toggler p-link",onTogglerClick:E,titleElement:ne,iconsElement:he,togglerElement:q,element:ie,id:o+"_header",props:r,collapsed:M};return oe.getJSXElement(r.headerTemplate,Ie)}else if(r.header||r.toggleable)return ie;return null},P=function(){var A=oe.getJSXElement(r.footer,r),z=n({className:x("footer")},g("footer")),q=c.createElement("div",z,A);if(r.footerTemplate){var G={className:x("footer"),element:q,props:r};return oe.getJSXElement(r.footerTemplate,G)}else if(r.footer)return q;return null},F=function(){var A=n({ref:L,className:x("toggleableContent"),"aria-hidden":M,role:"region",id:u,"aria-labelledby":T},g("toggleablecontent")),z=n({className:x("content")},g("content")),q=n({classNames:x("transition"),timeout:{enter:1e3,exit:450},in:!M,unmountOnExit:!0,options:r.transitionOptions},g("transition"));return c.createElement(Bn,ur({nodeRef:L},q),c.createElement("div",A,c.createElement("div",z,r.children)))},j=n({id:o,ref:O,style:r.style,className:ue(r.className,x("root"))},Sn.getOtherProps(r),g("root")),$=b(),N=F(),D=P();return c.createElement("div",j,$,N,D)});mt.displayName="Panel";const ma=({modelId:t,collapsed:e,onToggle:n})=>{const s=hs(),[r,i]=c.useState([]),[a,o]=c.useState(""),[f,p]=c.useState(!0),[h,d]=c.useState(!1),[S,O]=c.useState(null),L=async()=>{p(!0),O(null);try{const T=await Zt.fetchModelComments(t);i(T)}catch{O("Failed to load comments.")}finally{p(!1)}};c.useEffect(()=>{L()},[t]);const M=async()=>{if(a.trim())try{await Zt.addModelComment(t,a),i(T=>[{id:"temp-"+Fi(),model_id:t,user_id:s.user.id,username:s.username,body:a,created_at:ir(new Date)},...T]),o("")}catch{O("Failed to post comment.")}finally{d(!1)}};return _.jsx(mt,{toggleable:!0,header:"Comments",style:{flex:1},className:"panel-comments",collapsed:e,onToggle:n,children:f?_.jsx(Dt,{text:"Loading comments"}):_.jsxs(_.Fragment,{children:[s.user?_.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8},children:[_.jsx(xr,{style:{flex:1,resize:"vertical"},maxLength:2e3,placeholder:"Add a comment...",value:a,onChange:T=>o(T.target.value),disabled:h}),_.jsx(nn,{label:"Post",icon:"pi pi-send",outlined:!0,onClick:M,loading:h})]}):_.jsx("div",{children:"You need to be logged in to post comments."}),S&&_.jsx("div",{style:{color:"red",marginBottom:8},children:S}),r.length===0?_.jsx("div",{children:"No comments yet."}):r.map(T=>_.jsxs("div",{children:[_.jsxs("b",{children:[_.jsx("a",{href:`#/user/${T.username}`,children:T.username})," - ",T.created_at]}),_.jsx("p",{dangerouslySetInnerHTML:{__html:bs(T.body)}})]},T.id))]})})},fr=t=>t.replaceAll(/\/\*(.|[\s\S])*?\*\/|\/\/.*?$/gm,"");function ya(t,e,n){const s=fr(e),r=[],i={},a={},o=[],f=[];for(const p of s.matchAll(/(use|include)\s*<([^>]+)>/g))(p[1]=="use"?f:o).push(p[2]);for(const p of s.matchAll(/(?:^|[{};])\s*([$\w]+)\s*=/g))r.push(p[1]);for(const p of s.matchAll(/(function|module)\s+([$\w]+)\s*\(([^)]*)\)(?:\s*(?:=\s*)?(\{\}|[^{}]+?;))?/gm)){const h=p[1],d=p[2];if(n&&d.startsWith("_"))continue;const S=p[3],O=p[4],L=[];if(/^(\s*([$\w]+(\s*=[^,()[]+)?(\s*,\s*[$\w]+(\s*=[^,()[]+)?)*)?\s*)$/m.test(S))for(const M of S.split(",")){const T=/^\s*([$\w]+)(?:\s*=([^,()[]+))?\s*$/.exec(M);if(T){const u=T[1],w=T[2];L.push({name:u,defaultValue:w})}}(h=="function"?i:a)[d]={path:t,name:d,signature:`${d}(${S.replaceAll(/[\s]+/gm," ").replaceAll(/\b | \b/g,"")})`,params:L,referencesChildren:O!=null?O.indexOf("children()")>=0:null}}return{vars:r,functions:i,modules:a,includes:o,uses:f}}const va=`
  $fa=undef;
  $fs=undef;
  $fn=undef;
  $t=undef;

  $preview=undef;

  // shows rotation
  $vpr=undef;
  // shows translation (i.e. won't be affected by rotate and zoom)
  $vpt=undef;
  // shows the FOV of the view [Note: Requires version 2021.01]
  $vpf=undef;
  // shows the camera distance [Note: Requires version 2015.03]
  $vpd=undef;

  PI=undef;

  function abs(x) = x;
  function acos(x) = x;
  function asin(x) = x;
  function atan(x) = x;
  function atan2(y, x) = x;
  function ceil(x) = x;
  function chr(x) = 0;
  function len(assignments) = $children;
  function let(x) = x;
  function ln(x) = x;
  function log(x) = x;
  function lookup(key, array) = x;
  function max(values) = x;
  function min(values) = x;
  function sqrt(x) = x;
  function tan(degrees) = x;
  function rands(min_value, max_value, value_count, seed_value=undef) = x;
  function search(match_value, string_or_vector, num_returns_per_match=1, index_col_num=0) = x;
  function ord(x) = x;
  function round(x) = x;
  function sign(x) = x;
  function sin(degrees) = x;
  function str(values) = x;
  function norm(x) = x;
  function pow(base, exponent) = x;
  function concat(values) = x;
  function cos(degrees) = x;
  function cross(a, b) = x;
  function floor(x) = x;
  function exp(x) = x;
  function chr(x) = x;
  function is_undef(x) = x;
  function is_list(x) = x;
  function is_num(x) = x;
  function is_bool(x) = x;
  function is_string(x) = x;
  function is_function(x) = x;

  function version() = '';
  function version_num() = 0;

  $parent_modules=0;
  module parent_module(n) {}

  module children() {}

  module render(convexity=undef) {}
  module surface(file, center=false, invert=false, convexity=undef) {}

  function assert(condition, message=undef) = children();
  module assert(condition, message=undef) children();

  module cube(size, center=false) {}
  module sphere(r, d=undef, $fa, $fs, $fn) {}
  module cylinder(h, r, r1=undef, r2, d, d1, d2, center=false, $fa, $fs, $fn) {}
  module polyhedron(points, faces, convexity=undef) {}

  module square(size, center=false) {}
  module circle(r, d=undef, $fa, $fs, $fn) {}
  module polygon(points, paths, convexity=undef) {}
  module linear_extrude(height, center=false, twist=undef, slices=undef, scale=undef, convexity=undef) children();
  module rotate_extrude(degrees, convexity=undef, $fa, $fs, $fn) children();

  module scale(v) children();
  module resize(newsize, auto=false) children();
  module rotate(a, v=undef) children();
  module translate(v) children();
  module mirror(v) children();
  module multmatrix(m) children();

  module color(c, alpha) children();

  module offset(r, delta=undef, chamfer) children();

  module minkowski() children();
  module union() children();
  module difference() children();
  module intersection() children();
  module hull() children();

  module children() {}

  // module for(i=undef) children();

  module import(file, convexity=undef, $fn, $fa, $fs) {}
`,ba=["abs","acos","asin","atan","atan2","ceil","len","let","ln","log","lookup","max","min","sqrt","tan","rands","search","sign","sin","str","norm","pow","concat","cos","cross","floor","exp","chr"],xa=["children","circle","color","cube","cylinder","diameter","difference","echo","extrude","for","function","hull","if","include","intersection_for","intersection","linear","minkowski","mirror","module","multmatrix","offset","polyhedron","projection","radius","render","resize","rotate","round","scale","sphere","square","surface","translate","union","use","value","version"],Ea=["false","true","PI","undef","$children","$fa","$fn","$fs","$t","$vpd","$vpr","$vpt"],wa=t=>({colorizedBracketPairs:[["{","}"],["(",")"],["[","]"]],wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:t.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:t.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:t.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:t.languages.IndentAction.None,removeText:1}}],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string","comment"]},{open:"/**",close:" */",notIn:["string"]}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}}),Sa={defaultToken:"invalid",tokenPostfix:".js",keywords:[...ba,...xa,...Ea,"each"],typeKeywords:[],operators:["<=",">=","==","!=","=>","+","-","*","/","%","<<",">>",">>>","&","|","^","!","&&","||","?",":","="],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\[abfnrtv\\"']/,digits:/\d+/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},Ns={getConf:wa,language:Sa};function Kr(t,e,n){const s=[],r=[];let i=!0,a=0;for(const f of n.params??[]){if(i)if(f.defaultValue!=null)i=!1;else{s.push(`${f.name.replaceAll("$","\\$")}=${"${"+ ++a+":"+f.name+"}"}`);continue}r.push(f.name)}r.length&&s.push(`${"${"+ ++a+":"+r.join("|")+"=}"}`);let o=`${e.replaceAll("$","\\$")}(${s.join(", ")})`;return n.referencesChildren!==null&&(o+=n.referencesChildren?" ${"+ ++a+":children}":";"),{label:n.signature,kind:t.languages.CompletionItemKind.Function,insertText:o,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}}const Ta=t=>[...[!0,!1].map(e=>({label:`${e}`,kind:t.languages.CompletionItemKind.Value,insertText:`${e}`,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...Ns.language.keywords.map(e=>({label:e,kind:t.languages.CompletionItemKind.Function,insertText:e,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))],Ra=["for(${1:variable}=[${2:start}:${3:end}) ${4:body}","for(${1:variable}=[${2:start}:${3:increment}:${4:end}) ${5:body}",`if (\${1:condition}) {
	$0
} else {
	
}`];function Ia(t){return t.replaceAll(/\$\{\d+:([$\w]+)\}/g,"$1").replaceAll(/\$\d+/g,"").replaceAll(/\s+/g," ").trim()}async function Oa(t,e,n,s){const r={},i=d=>d.startsWith("/")?d:`${n}/${d}`,a={};for(const[d,{deployed:S,symlinks:O}]of Object.entries(s))if(d!="fonts"&&S!==!1)for(const L in O)a[L]=`${d}/${O[L]}`;async function o(d){d in a&&(d=a[d]),d=i(d);try{const S=e.readFileSync(d);return new TextDecoder("utf-8").decode(S)}catch(S){throw S}}const f="<builtins>";let p;function h(d,S,{skipPrivates:O,addBuiltins:L}){return r[d]??=new Promise(async(M,T)=>{S==null&&(S=await o(d));const u={functions:{},modules:{},vars:[],includes:[],uses:[]},w=(E,l)=>{u.functions={...u.functions,...l.functions},u.modules={...u.modules,...l.modules},E||(u.vars=[...u.vars,...l.vars])},g=(d.split("/").slice(0,-1).join("/")||".")+"/",x=async(E,l)=>{let m=!1;for(const y of[`/libraries/${l}`,`${g}/${l}`,l])try{const b=await o(y),P=await h(l,b,{skipPrivates:!0,addBuiltins:!1});w(E,P),m=!0;break}catch(b){console.warn(`Failed to read file option ${y} for ${l} ${E?"used":"included"} by ${d}`,b)}m||console.error("Failed to find ",l,"(context imported in ",d,")")};L&&d!=f&&w(!1,p);const v=ya(d,S,O);await Promise.all([...(v.uses??[]).map(E=>[E,!0]),...(v.includes??[]).map(E=>[E,!1])].map(([E,l])=>x(l,E))),w(!1,v),M(u)})}return p=await h(f,va,{skipPrivates:!1,addBuiltins:!1}),{triggerCharacters:["<","/"],provideCompletionItems:(async(d,S,O,L)=>{try{const{word:M}=d.getWordUntilPosition(S),T=d.getOffsetAt(S),u=d.getValue();let w=u.substring(0,T);const g=w.lastIndexOf(`
`);w=w.substring(g+1);const x=/\b(include|use)\s*<([^<>\n"]*)$/.exec(w);if(x){const F=x[2];let j,$,N;const D=F.lastIndexOf("/");D<0?(N="",$=F):(N=F.substring(0,D),$=F.substring(D+1));const R=N==""?"":"/"+N;let A=null;for(const q of[Xn("/libraries",R),Xn(n,R)]){A=N==""?[...Object.keys(a)]:[];try{A=[...e.readdirSync(q)??[],...A];break}catch{}}const z=[];if(!A)console.warn("Failed to find folder named "+R);else for(const q of A){if($!=""&&!q.startsWith($)||/^(LICENSE.*|fonts)$/.test(q)||N==""&&q in s&&s[q].symlinks)continue;const G=!q.endsWith(".scad"),ne=q+(G?"":`>
`);z.push({label:q,kind:G?t.languages.CompletionItemKind.Folder:t.languages.CompletionItemKind.File,insertText:ne})}return z.sort(),{suggestions:z}}const v=Xn(n,"foo.scad");delete r[v];const E=await h(v,u,{skipPrivates:!1,addBuiltins:!0}),l=fr(w),m=/(^|.*?[{});]|>\s*\n)\s*([$\w]*)$/m.exec(l);if(m){const F=m[1],j=[...Ta(t),...Ir(E.modules??{},($,N)=>Kr(t,$,N),$=>$.indexOf(M)>=0),...(E.vars??[]).filter($=>$.indexOf(M)>=0).map($=>({label:$,kind:t.languages.CompletionItemKind.Variable,insertText:$.replaceAll("$","\\$"),insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...Ra.map($=>({label:Ia($).replaceAll(/ body/g,""),kind:t.languages.CompletionItemKind.Keyword,insertText:$,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))];return j.sort(($,N)=>$.insertText.indexOf(F)-N.insertText.indexOf(F)),{suggestions:j}}const y=fr(u),b=[...Ir(E.functions??{},(F,j)=>[F,Kr(t,F,j)],F=>F.indexOf(M)>=0)];return b.sort(([F],[j])=>F.indexOf(M)-j.indexOf(M)),{suggestions:b.map(([F,j])=>j)}}catch(M){return console.error(M),{suggestions:[]}}})}}async function Ca(t,e,n,s){t.languages.register({id:"openscad",extensions:[".scad"],mimetypes:["text/openscad"]});const{getConf:r,language:i}=Ns;t.languages.setLanguageConfiguration("openscad",r(t)),t.languages.setMonarchTokensProvider("openscad",i),t.languages.registerCompletionItemProvider("openscad",await Oa(t,e,n,s))}function Gr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Ma(t){if(Array.isArray(t))return t}function Pa(t,e,n){return(e=ka(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Aa(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Na(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function qr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Wr(Object(n),!0).forEach(function(s){Pa(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function _a(t,e){if(t==null)return{};var n,s,r=Fa(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)n=i[s],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Fa(t,e){if(t==null)return{};var n={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(e.indexOf(s)!==-1)continue;n[s]=t[s]}return n}function ja(t,e){return Ma(t)||Aa(t,e)||$a(t,e)||Na()}function La(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ka(t){var e=La(t,"string");return typeof e=="symbol"?e:e+""}function $a(t,e){if(t){if(typeof t=="string")return Gr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gr(t,e):void 0}}function Da(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Yr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Jr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Yr(Object(n),!0).forEach(function(s){Da(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Ua(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(s){return e.reduceRight(function(r,i){return i(r)},s)}}function Xt(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,o=new Array(a),f=0;f<a;f++)o[f]=arguments[f];return e.apply(n,[].concat(r,o))}}}function jn(t){return{}.toString.call(t).includes("Object")}function Ba(t){return!Object.keys(t).length}function ln(t){return typeof t=="function"}function za(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Va(t,e){return jn(e)||rt("changeType"),Object.keys(e).some(function(n){return!za(t,n)})&&rt("changeField"),e}function Ha(t){ln(t)||rt("selectorType")}function Ka(t){ln(t)||jn(t)||rt("handlerType"),jn(t)&&Object.values(t).some(function(e){return!ln(e)})&&rt("handlersType")}function Ga(t){t||rt("initialIsRequired"),jn(t)||rt("initialType"),Ba(t)&&rt("initialContent")}function Wa(t,e){throw new Error(t[e]||t.default)}var qa={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},rt=Xt(Wa)(qa),Tn={changes:Va,selector:Ha,handler:Ka,initial:Ga};function Ya(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tn.initial(t),Tn.handler(e);var n={current:t},s=Xt(Za)(n,e),r=Xt(Xa)(n),i=Xt(Tn.changes)(t),a=Xt(Ja)(n);function o(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(h){return h};return Tn.selector(p),p(n.current)}function f(p){Ua(s,r,i,a)(p)}return[o,f]}function Ja(t,e){return ln(e)?e(t.current):e}function Xa(t,e){return t.current=Jr(Jr({},t.current),e),e}function Za(t,e,n){return ln(e)?e(t.current):Object.keys(n).forEach(function(s){var r;return(r=e[s])===null||r===void 0?void 0:r.call(e,t.current[s])}),n}var Qa={create:Ya},el={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function tl(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,o=new Array(a),f=0;f<a;f++)o[f]=arguments[f];return e.apply(n,[].concat(r,o))}}}function nl(t){return{}.toString.call(t).includes("Object")}function rl(t){return t||Xr("configIsRequired"),nl(t)||Xr("configType"),t.urls?(sl(),{paths:{vs:t.urls.monacoBase}}):t}function sl(){console.warn(_s.deprecation)}function il(t,e){throw new Error(t[e]||t.default)}var _s={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Xr=tl(il)(_s),ol={config:rl},al=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return function(r){return n.reduceRight(function(i,a){return a(i)},r)}};function Fs(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],Fs(t[n],e[n]))}),qr(qr({},t),e)}var ll={type:"cancelation",msg:"operation is manually canceled"};function tr(t){var e=!1,n=new Promise(function(s,r){t.then(function(i){return e?r(ll):s(i)}),t.catch(r)});return n.cancel=function(){return e=!0},n}var cl=["monaco"],ul=Qa.create({config:el,isInitialized:!1,resolve:null,reject:null,monaco:null}),js=ja(ul,2),pn=js[0],Hn=js[1];function fl(t){var e=ol.config(t),n=e.monaco,s=_a(e,cl);Hn(function(r){return{config:Fs(r.config,s),monaco:n}})}function dl(){var t=pn(function(e){var n=e.monaco,s=e.isInitialized,r=e.resolve;return{monaco:n,isInitialized:s,resolve:r}});if(!t.isInitialized){if(Hn({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),tr(nr);if(window.monaco&&window.monaco.editor)return Ls(window.monaco),t.resolve(window.monaco),tr(nr);al(pl,gl)(ml)}return tr(nr)}function pl(t){return document.body.appendChild(t)}function hl(t){var e=document.createElement("script");return t&&(e.src=t),e}function gl(t){var e=pn(function(s){var r=s.config,i=s.reject;return{config:r,reject:i}}),n=hl("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function ml(){var t=pn(function(n){var s=n.config,r=n.resolve,i=n.reject;return{config:s,resolve:r,reject:i}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){var s=n.m||n;Ls(s),t.resolve(s)},function(n){t.reject(n)})}function Ls(t){pn().monaco||Hn({monaco:t})}function yl(){return pn(function(t){var e=t.monaco;return e})}var nr=new Promise(function(t,e){return Hn({resolve:t,reject:e})}),ks={config:fl,init:dl,__getMonacoInstance:yl},vl={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},rr=vl,bl={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},xl=bl;function El({children:t}){return Ft.createElement("div",{style:xl.container},t)}var wl=El,Sl=wl;function Tl({width:t,height:e,isEditorReady:n,loading:s,_ref:r,className:i,wrapperProps:a}){return Ft.createElement("section",{style:{...rr.wrapper,width:t,height:e},...a},!n&&Ft.createElement(Sl,null,s),Ft.createElement("div",{ref:r,style:{...rr.fullWidth,...!n&&rr.hide},className:i}))}var Rl=Tl,$s=c.memo(Rl);function Il(t){c.useEffect(t,[])}var Ds=Il;function Ol(t,e,n=!0){let s=c.useRef(!0);c.useEffect(s.current||!n?()=>{s.current=!1}:t,e)}var Ne=Ol;function en(){}function Nt(t,e,n,s){return Cl(t,s)||Ml(t,e,n,s)}function Cl(t,e){return t.editor.getModel(Us(t,e))}function Ml(t,e,n,s){return t.editor.createModel(e,n,s?Us(t,s):void 0)}function Us(t,e){return t.Uri.parse(e)}function Pl({original:t,modified:e,language:n,originalLanguage:s,modifiedLanguage:r,originalModelPath:i,modifiedModelPath:a,keepCurrentOriginalModel:o=!1,keepCurrentModifiedModel:f=!1,theme:p="light",loading:h="Loading...",options:d={},height:S="100%",width:O="100%",className:L,wrapperProps:M={},beforeMount:T=en,onMount:u=en}){let[w,g]=c.useState(!1),[x,v]=c.useState(!0),E=c.useRef(null),l=c.useRef(null),m=c.useRef(null),y=c.useRef(u),b=c.useRef(T),P=c.useRef(!1);Ds(()=>{let N=ks.init();return N.then(D=>(l.current=D)&&v(!1)).catch(D=>D?.type!=="cancelation"&&console.error("Monaco initialization: error:",D)),()=>E.current?$():N.cancel()}),Ne(()=>{if(E.current&&l.current){let N=E.current.getOriginalEditor(),D=Nt(l.current,t||"",s||n||"text",i||"");D!==N.getModel()&&N.setModel(D)}},[i],w),Ne(()=>{if(E.current&&l.current){let N=E.current.getModifiedEditor(),D=Nt(l.current,e||"",r||n||"text",a||"");D!==N.getModel()&&N.setModel(D)}},[a],w),Ne(()=>{let N=E.current.getModifiedEditor();N.getOption(l.current.editor.EditorOption.readOnly)?N.setValue(e||""):e!==N.getValue()&&(N.executeEdits("",[{range:N.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),N.pushUndoStop())},[e],w),Ne(()=>{E.current?.getModel()?.original.setValue(t||"")},[t],w),Ne(()=>{let{original:N,modified:D}=E.current.getModel();l.current.editor.setModelLanguage(N,s||n||"text"),l.current.editor.setModelLanguage(D,r||n||"text")},[n,s,r],w),Ne(()=>{l.current?.editor.setTheme(p)},[p],w),Ne(()=>{E.current?.updateOptions(d)},[d],w);let F=c.useCallback(()=>{if(!l.current)return;b.current(l.current);let N=Nt(l.current,t||"",s||n||"text",i||""),D=Nt(l.current,e||"",r||n||"text",a||"");E.current?.setModel({original:N,modified:D})},[n,e,r,t,s,i,a]),j=c.useCallback(()=>{!P.current&&m.current&&(E.current=l.current.editor.createDiffEditor(m.current,{automaticLayout:!0,...d}),F(),l.current?.editor.setTheme(p),g(!0),P.current=!0)},[d,p,F]);c.useEffect(()=>{w&&y.current(E.current,l.current)},[w]),c.useEffect(()=>{!x&&!w&&j()},[x,w,j]);function $(){let N=E.current?.getModel();o||N?.original?.dispose(),f||N?.modified?.dispose(),E.current?.dispose()}return Ft.createElement($s,{width:O,height:S,isEditorReady:w,loading:h,_ref:m,className:L,wrapperProps:M})}var Al=Pl;c.memo(Al);function Nl(t){let e=c.useRef();return c.useEffect(()=>{e.current=t},[t]),e.current}var _l=Nl,Rn=new Map;function Fl({defaultValue:t,defaultLanguage:e,defaultPath:n,value:s,language:r,path:i,theme:a="light",line:o,loading:f="Loading...",options:p={},overrideServices:h={},saveViewState:d=!0,keepCurrentModel:S=!1,width:O="100%",height:L="100%",className:M,wrapperProps:T={},beforeMount:u=en,onMount:w=en,onChange:g,onValidate:x=en}){let[v,E]=c.useState(!1),[l,m]=c.useState(!0),y=c.useRef(null),b=c.useRef(null),P=c.useRef(null),F=c.useRef(w),j=c.useRef(u),$=c.useRef(void 0),N=c.useRef(s),D=_l(i),R=c.useRef(!1),A=c.useRef(!1);Ds(()=>{let G=ks.init();return G.then(ne=>(y.current=ne)&&m(!1)).catch(ne=>ne?.type!=="cancelation"&&console.error("Monaco initialization: error:",ne)),()=>b.current?q():G.cancel()}),Ne(()=>{let G=Nt(y.current,t||s||"",e||r||"",i||n||"");G!==b.current?.getModel()&&(d&&Rn.set(D,b.current?.saveViewState()),b.current?.setModel(G),d&&b.current?.restoreViewState(Rn.get(i)))},[i],v),Ne(()=>{b.current?.updateOptions(p)},[p],v),Ne(()=>{!b.current||s===void 0||(b.current.getOption(y.current.editor.EditorOption.readOnly)?b.current.setValue(s):s!==b.current.getValue()&&(A.current=!0,b.current.executeEdits("",[{range:b.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),b.current.pushUndoStop(),A.current=!1))},[s],v),Ne(()=>{let G=b.current?.getModel();v&&G&&r&&y.current?.editor.setModelLanguage(G,r)},[r,v],v),Ne(()=>{o!==void 0&&b.current?.revealLine(o)},[o],v),Ne(()=>{y.current?.editor.setTheme(a)},[a],v);let z=c.useCallback(()=>{if(!(!P.current||!y.current)&&!R.current){j.current(y.current);let G=i||n,ne=Nt(y.current,s||t||"",e||r||"",G||"");b.current=y.current?.editor.create(P.current,{model:ne,automaticLayout:!0,...p},h),d&&b.current.restoreViewState(Rn.get(G)),y.current.editor.setTheme(a),o!==void 0&&b.current.revealLine(o),E(!0),R.current=!0}},[t,e,n,s,r,i,p,h,d,a,o]);c.useEffect(()=>{v&&F.current(b.current,y.current)},[v]),c.useEffect(()=>{!l&&!v&&z()},[l,v,z]),N.current=s,c.useEffect(()=>{v&&g&&($.current?.dispose(),$.current=b.current?.onDidChangeModelContent(G=>{A.current||g(b.current.getValue(),G)}))},[v,g]),c.useEffect(()=>{if(v){let G=y.current.editor.onDidChangeMarkers(ne=>{let ve=b.current.getModel()?.uri;if(ve&&ne.find(he=>he.path===ve.path)){let he=y.current.editor.getModelMarkers({resource:ve});x?.(he)}});return()=>{G?.dispose()}}return()=>{}},[v,x]);function q(){$.current?.dispose(),S?d&&Rn.set(i,b.current.saveViewState()):b.current.getModel()?.dispose(),b.current.dispose(),b.current=null,R.current=!1,E(!1)}return Ft.createElement($s,{width:O,height:L,isEditorReady:v,loading:f,_ref:P,className:M,wrapperProps:T})}var jl=Fl,Ll=c.memo(jl),kl=Ll;function xt(){return xt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},xt.apply(null,arguments)}function dr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function $l(t){if(Array.isArray(t))return dr(t)}function Dl(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Bs(t,e){if(t){if(typeof t=="string")return dr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dr(t,e):void 0}}function Ul(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bl(t){return $l(t)||Dl(t)||Bs(t)||Ul()}function cn(t){"@babel/helpers - typeof";return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}function zl(t,e){if(cn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(cn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Vl(t){var e=zl(t,"string");return cn(e)=="symbol"?e:e+""}function Ln(t,e,n){return(e=Vl(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Hl(t){if(Array.isArray(t))return t}function Kl(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Gl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wt(t,e){return Hl(t)||Kl(t,e)||Bs(t,e)||Gl()}var Wl={root:function(e){var n=e.props,s=e.focusedState,r=e.context,i=e.overlayVisibleState,a=e.isValueEmpty;return ue("p-treeselect p-component p-inputwrapper",{"p-treeselect-chip":n.display==="chip","p-treeselect-clearable":n.showClear&&!n.disabled,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-focus":s,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled","p-inputwrapper-filled":!a,"p-inputwrapper-focus":s||i})},label:function(e){var n=e.props,s=e.isValueEmpty,r=e.getLabel;return ue("p-treeselect-label",{"p-placeholder":r()===n.placeholder,"p-treeselect-label-empty":!n.placeholder&&s})},panel:function(e){var n=e.panelProps,s=e.context;return ue("p-treeselect-panel p-component",n.panelClassName,{"p-input-filled":s&&s.inputStyle==="filled"||Ge.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||Ge.ripple===!1})},labelContainer:"p-treeselect-label-container",tokenLabel:"p-treeselect-token-label",token:"p-treeselect-token",trigger:"p-treeselect-trigger",triggerIcon:"p-treeselect-trigger-icon p-clickable",emptyMessage:"p-treeselect-empty-message",filterContainer:"p-treeselect-filter-container",filter:"p-treeselect-filter p-inputtext p-component",filterIcon:"p-treeselect-filter-icon",closeIcon:"p-treeselect-close-icon",clearIcon:"p-treeselect-clear-icon p-clickable",closeButton:"p-treeselect-close p-link",header:"p-treeselect-header",wrapper:"p-treeselect-items-wrapper",transition:"p-connected-overlay"},ql=`
@layer primereact {
    .p-treeselect {
        display: inline-flex;
        cursor: pointer;
        position: relative;
        user-select: none;
    }

    .p-treeselect-trigger {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .p-treeselect-label-container {
        overflow: hidden;
        flex: 1 1 auto;
        cursor: pointer;
    }

    .p-treeselect-label  {
        display: block;
        white-space: nowrap;
        cursor: pointer;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .p-treeselect-label-empty {
        overflow: hidden;
        visibility: hidden;
    }

    .p-treeselect-token {
        cursor: default;
        display: inline-flex;
        align-items: center;
        flex: 0 0 auto;
    }

    .p-treeselect .p-treeselect-panel {
        min-width: 100%;
    }

    .p-treeselect-items-wrapper {
        overflow: auto;
    }

    .p-treeselect-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .p-treeselect-filter-container {
        position: relative;
        flex: 1 1 auto;
    }

    .p-treeselect-filter-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-treeselect-filter-container .p-inputtext {
        width: 100%;
    }

    .p-treeselect-close {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
        position: relative;
        margin-left: auto;
    }

    .p-treeselect-clear-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-fluid .p-treeselect {
        display: flex;
}
}
`,qt=Rt.extend({defaultProps:{__TYPE:"TreeSelect",appendTo:null,ariaLabel:null,ariaLabelledBy:null,className:null,closeIcon:null,clearIcon:null,disabled:!1,display:"comma",dropdownIcon:null,emptyMessage:null,expandedKeys:null,filter:!1,filterBy:"label",filterDelay:300,filterIcon:null,filterInputAutoFocus:!0,filterLocale:void 0,filterMode:"lenient",filterPlaceholder:null,filterTemplate:null,filterValue:null,inputId:null,inputRef:null,invalid:!1,variant:null,metaKeySelection:!1,name:null,nodeTemplate:null,onChange:null,onFocus:null,onBlur:null,onFilterValueChange:null,onHide:null,onNodeClick:null,onNodeCollapse:null,onNodeDoubleClick:null,onNodeExpand:null,onNodeSelect:null,onNodeUnselect:null,onShow:null,options:null,panelClassName:null,panelFooterTemplate:null,panelHeaderTemplate:null,panelStyle:null,placeholder:null,resetFilterOnHide:!1,scrollHeight:"400px",selectionMode:"single",showClear:!1,style:null,tabIndex:null,togglerTemplate:null,transitionOptions:null,value:null,valueTemplate:null,children:void 0},css:{classes:Wl,styles:ql}});function Zr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Yl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Zr(Object(n),!0).forEach(function(s){Ln(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var zs=c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=t.ptm,i=t.cx,a=function(d,S){return r(d,Yl({hostName:t.hostName},S))},o=function(d){d.key==="Escape"&&(d.preventDefault(),t.hide())},f=function(){var d={maxHeight:t.scrollHeight||"auto"},S=n({className:i("panel",{panelProps:t,context:s}),style:t.panelStyle,onKeyDown:o,onClick:t.onClick},a("panel")),O=n({className:i("wrapper"),style:d},a("wrapper")),L=n({classNames:i("transition"),in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},a("transition"));return c.createElement(Bn,xt({nodeRef:e},L),c.createElement("div",xt({ref:e},S),t.firstHiddenFocusableElementOnOverlay,t.header,c.createElement("div",O,t.children),t.footer,t.lastHiddenFocusableElementOnOverlay))},p=f();return c.createElement(ys,{element:p,appendTo:t.appendTo})});zs.displayName="TreeSelectPanel";function Qr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Qe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Qr(Object(n),!0).forEach(function(s){Ln(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Yt(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Jl(t))||e){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(p){throw p},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var p=n.next();return a=p.done,p},e:function(p){o=!0,i=p},f:function(){try{a||n.return==null||n.return()}finally{if(o)throw i}}}}function Jl(t,e){if(t){if(typeof t=="string")return es(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?es(t,e):void 0}}function es(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}var Vs=c.memo(c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=qt.getProps(t,s),i=c.useState(!1),a=Wt(i,2),o=a[0],f=a[1],p=c.useState(!1),h=Wt(p,2),d=h[0],S=h[1],O=c.useState(r.expandedKeys),L=Wt(O,2),M=L[0],T=L[1],u=Ri("",r.filterDelay||0),w=Wt(u,3),g=w[0],x=w[1],v=w[2],E=c.useRef(null),l=c.useRef(null),m=c.useRef(null),y=c.useRef(r.inputRef),b=c.useRef(null),P=c.useRef(null),F=c.useRef(null),j=c.useRef(null),$=c.useRef(null),N=c.useRef(!1),D=c.useRef(""),R=r.onToggle?r.expandedKeys:M,A=r.onFilterValueChange?r.filterValue:x,z=oe.isEmpty(r.value),q=r.selectionMode==="single",G=r.selectionMode==="checkbox",ne=oe.isNotEmpty(r.tooltip),ve={props:r,state:{focused:o,overlayVisible:d,expandedKeys:R,filterValue:A}},he=qt.setMetaData(ve),te=he.ptm,ie=he.cx,Ie=he.isUnstyled;It(qt.css.styles,Ie,{name:"treeselect"});var ze={filter:function(I){return H(I)},reset:function(){return X()}},qe=gs({target:E,overlay:l,listener:function(I,K){var ce=K.valid,pe=K.type;ce&&(pe==="outside"||s.hideOverlaysOnDocumentScrolling?ye():Z.isDocument(I.target)||ut())},when:d}),Ye=Wt(qe,2),at=Ye[0],Je=Ye[1],we=function(){return Ht.length?Ht.map(function(I){return I.label}).join(", "):r.placeholder},$e=function(){S(!0)},ye=function(){S(!1),y.current&&Z.focus(y.current)},Ke=function(){f(!0),r.onFocus&&r.onFocus()},Ee=function(){f(!1),r.onBlur&&r.onBlur()},Pe=function(I){!r.disabled&&(!l.current||!l.current.contains(I.target))&&!Z.isAttributeEquals(I.target,"data-pc-section","closebutton")&&(Z.focus(y.current),d?ye():$e())},Xe=function(I){r.onChange&&(P.current=!0,r.onChange({originalEvent:I.originalEvent,value:I.value,stopPropagation:function(){I.originalEvent.stopPropagation()},preventDefault:function(){I.originalEvent.preventDefault()},target:{name:r.name,id:r.id,value:I.value}}))},Ve=function(I){r.onChange&&(P.current=!0,r.onChange({originalEvent:I,value:void 0,stopPropagation:function(){I?.stopPropagation()},preventDefault:function(){I?.preventDefault()},target:{name:r.name,id:r.id,value:void 0}}))},Ze=function(I){(I.key==="Enter"||I.code==="Space")&&(Ve(I),I.preventDefault())},Oe=function(I){r.onNodeSelect&&r.onNodeSelect(I),q&&ye()},lt=function(I){r.onNodeUnselect&&r.onNodeUnselect(I),G&&I.originalEvent.stopPropagation()},le=function(I){r.onToggle?r.onToggle(I):T(I.value)},k=function(I){v(I.value)},Y=function(I){Es.emit("overlay-click",{originalEvent:I,target:E.current})},Q=function(I){var K=I.relatedTarget===y.current?Z.getFirstFocusableElement(l.current,':not([data-p-hidden-focusable="true"])'):y.current;Z.focus(K)},fe=function(I){var K=I.relatedTarget===y.current?Z.getLastFocusableElement(l.current,':not([data-p-hidden-focusable="true"])'):y.current;Z.focus(K)},Se=function(I,K){switch(I.code){case"ArrowDown":I.preventDefault(),Mt();break;case"ArrowUp":I.preventDefault(),y.current&&Z.focus(y.current);break;case"Enter":case"NumpadEnter":I.preventDefault(),K&&ye();break;case"Escape":Te(I);break}},U=function(I){switch(I.code){case"ArrowDown":B(I);break;case"Space":case"Enter":case"NumpadEnter":ae(I);break;case"Escape":Te(I);break;case"Tab":d&&(I.preventDefault(),I.shiftKey?Mt():ee(I));break}},B=function(I){d||(N.current=!0,$e(),I.preventDefault())},ae=function(I){d?ye():B(I),I.preventDefault()},Te=function(I){d&&(ye(),I.preventDefault())},ee=function(I){var K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;K||d&&C()&&(Z.focus(j.current),I.preventDefault())},C=function(){return Z.getFocusableElements(l.current,':not([data-p-hidden-focusable="true"])').length>0},H=function(I){var K=I.target.value;r.onFilterValueChange?r.onFilterValueChange({originalEvent:I,value:K}):v(K)},X=function(){v("")},de=function(){jt.set("overlay",l.current,s&&s.autoZIndex||Ge.autoZIndex,s&&s.zIndex.overlay||Ge.zIndex.overlay),Z.addStyles(l.current,{position:"absolute",top:"0",left:"0"}),Mt(),ut(),Wn()},Ct=function(){at(),r.filter&&r.filterInputAutoFocus&&Z.focus(m.current,r.filterInputAutoFocus),r.onShow&&r.onShow()},ct=function(){Je()},Bt=function(){r.filter&&r.resetFilterOnHide&&X(),jt.clear(l.current),r.onHide&&r.onHide()},ut=function(){Z.alignOverlay(l.current,b.current.parentElement,r.appendTo||s&&s.appendTo||Ge.appendTo)},Wn=function(){var I=Z.findSingle(l.current,'[data-pc-section="content"][data-p-highlight="true"]');I&&I.scrollIntoView&&I.scrollIntoView({block:"nearest",inline:"start"})},zt=function(I,K,ce){if(I){if(Fe(I,K)&&(ce.push(I),delete K[I.key]),Object.keys(K).length&&I.children){var pe=Yt(I.children),Re;try{for(pe.s();!(Re=pe.n()).done;){var je=Re.value;zt(je,K,ce)}}catch(Le){pe.e(Le)}finally{pe.f()}}}else{var be=Yt(r.options),De;try{for(be.s();!(De=be.n()).done;){var pt=De.value;zt(pt,K,ce)}}catch(Le){be.e(Le)}finally{be.f()}}},Fe=function(I,K){return G?K[I.key]&&K[I.key].checked:K[I.key]},Vt=function(){var I=q?Ln({},"".concat(r.value),!0):Qe({},r.value);T({}),I&&r.options&&ft(null,null,I)},Mt=function(){var I,K=Z.find((I=F.current)===null||I===void 0?void 0:I.getElement(),'[data-pc-section="node"]'),ce=Bl(K).find(function(pe){return pe.getAttribute("tabindex")==="0"});Z.focus(ce)},ft=function(I,K,ce){if(I){if(Fe(I,ce)&&(qn(K),delete ce[I.key]),Object.keys(ce).length&&I.children){var pe=Yt(I.children),Re;try{for(pe.s();!(Re=pe.n()).done;){var je=Re.value;K.push(I.key),ft(je,K,ce)}}catch(Le){pe.e(Le)}finally{pe.f()}}}else{var be=Yt(r.options),De;try{for(be.s();!(De=be.n()).done;){var pt=De.value;ft(pt,[],ce)}}catch(Le){be.e(Le)}finally{be.f()}}},qn=function(I){if(I.length>0){var K=Qe({},M||{}),ce=Yt(I),pe;try{for(ce.s();!(pe=ce.n()).done;){var Re=pe.value;K[Re]=!0}}catch(je){ce.e(je)}finally{ce.f()}T(K)}},Yn=function(){var I=[];if(oe.isNotEmpty(r.value)&&r.options){var K=q?Ln({},"".concat(r.value),!0):Qe({},r.value);zt(null,K,I)}return I};c.useImperativeHandle(e,function(){return{props:r,clear:Ve,show:$e,hide:ye,focus:function(){return Z.focus(y.current)},getElement:function(){return E.current}}}),c.useEffect(function(){oe.combinedRefs(y,r.inputRef)},[y,r.inputRef]),dn(function(){Vt(),D.current=Vn()+"_list",r.autoFocus&&Z.focus(y.current,r.autoFocus),ut()}),At(function(){d&&r.filter&&ut()}),At(function(){Vt()},[r.options]),At(function(){N.current&&d&&(N.current=!1,Mt())},[d]),At(function(){d&&M&&ut()},[M]),At(function(){d&&(P.current||Vt(),P.current=!1)},[r.value]),ms(function(){jt.clear(l.current)});var dt=function(){var I=n({className:"p-hidden-accessible"},te("hiddenInputWrapper")),K=n(Qe({ref:y,role:"listbox",id:r.inputId,type:"text","aria-expanded":d,"aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-haspopup":"tree","aria-controls":D.current,onFocus:Ke,onBlur:Ee,onKeyDown:U,disabled:r.disabled,tabIndex:r.tabIndex},di),te("hiddenInput"));return c.createElement("div",I,c.createElement("input",xt({},K,{readOnly:!0})))},Ae=function(){var I=n({className:ie("token")},te("token")),K=n({className:ie("tokenLabel")},te("tokenLabel")),ce=n({className:ie("labelContainer")},te("labelContainer")),pe=n({className:ie("label",{isValueEmpty:z,getLabel:we})},te("label")),Re=null;return r.valueTemplate?Re=oe.getJSXElement(r.valueTemplate,Ht,r):r.display==="comma"?Re=we()||"empty":r.display==="chip"&&(Re=c.createElement(c.Fragment,null,Ht&&Ht.map(function(je,be){return c.createElement("div",xt({},I,{key:"".concat(je.key,"_").concat(be)}),c.createElement("span",K,je.label))}),z&&(r.placeholder||"empty"))),c.createElement("div",ce,c.createElement("div",pe,Re))},ii=function(){var I=n({ref:b,className:ie("trigger"),role:"button","aria-haspopup":"tree","aria-expanded":d},te("trigger")),K=n({className:ie("triggerIcon")},te("triggerIcon")),ce=r.dropdownIcon||c.createElement(zi,K),pe=tt.getJSXIcon(ce,Qe({},K),{props:r});return c.createElement("div",I,pe)},oi=function(){if(r.value!=null&&r.showClear&&!r.disabled){var I=n({className:ie("clearIcon"),onPointerUp:Ve,tabIndex:r.tabIndex||"0",onKeyDown:Ze,"aria-label":Ii("clear")},te("clearIcon")),K=r.clearIcon||c.createElement(Sr,I);return tt.getJSXIcon(K,Qe({},I),{props:r})}return null},ai=function(){return c.createElement(ki,{ref:F,id:D.current,emptyMessage:r.emptyMessage,expandedKeys:R,filter:r.filter,filterBy:r.filterBy,filterDelay:r.filterDelay,filterLocale:r.filterLocale,filterMode:r.filterMode,filterPlaceholder:r.filterPlaceholder,filterValue:A,metaKeySelection:r.metaKeySelection,nodeTemplate:r.nodeTemplate,onCollapse:r.onNodeCollapse,onExpand:r.onNodeExpand,onFilterValueChange:k,onNodeClick:r.onNodeClick,onNodeDoubleClick:r.onNodeDoubleClick,onSelect:Oe,onSelectionChange:Xe,onToggle:le,onUnselect:lt,selectionKeys:r.value,selectionMode:r.selectionMode,showHeader:!1,togglerTemplate:r.togglerTemplate,value:r.options,pt:te("tree"),__parentMetadata:{parent:ve}})},li=function(){if(r.filter){var I=r.onFilterValueChange?r.filterValue:g;I=oe.isNotEmpty(I)?I:"";var K=n({className:ie("filterContainer")},te("filterContainer")),ce=n({ref:m,type:"text",value:I,autoComplete:"off",className:ie("filter"),placeholder:r.filterPlaceholder,onKeyDown:function(Le){return Se(Le,!1)},onChange:H,disabled:r.disabled},te("filter")),pe=n({className:ie("filterIcon")},te("filterIcon")),Re=r.filterIcon||c.createElement(Vi,pe),je=tt.getJSXIcon(Re,Qe({},pe),{props:r}),be=c.createElement("div",K,c.createElement("input",ce),je);if(r.filterTemplate){var De={className:"p-treeselect-filter-container",element:be,filterOptions:ze,filterInputKeyDown:function(Le){return Se(Le,function(){})},filterInputChange:H,filterIconClassName:"p-dropdown-filter-icon",props:r};be=oe.getJSXElement(r.filterTemplate,De)}return c.createElement(c.Fragment,null,be)}},ci=function(){var I=li(),K=n({className:ie("closeIcon"),"aria-hidden":!0},te("closeIcon")),ce=r.closeIcon||c.createElement(Sr,K),pe=tt.getJSXIcon(ce,Qe({},K),{props:r}),Re=n({type:"button",className:ie("closeButton"),onKeyDown:function(Si){return Se(Si,!0)},onClick:ye,"aria-label":Oi("close")},te("closeButton")),je=n({className:ie("header")},te("header")),be=c.createElement("button",Re,pe,c.createElement(zn,null)),De=c.createElement("div",je,I,be);if(r.panelHeaderTemplate){var pt={className:"p-treeselect-header",filterElement:I,closeElement:be,closeElementClassName:"p-treeselect-close p-link",closeIconClassName:"p-treeselect-close-icon",onCloseClick:ye,element:De,props:r};return c.createElement("div",null,De,oe.getJSXElement(r.panelHeaderTemplate,pt))}return De},ui=function(){return oe.getJSXElement(r.panelFooterTemplate,r)},Ht=Yn(),fi=qt.getOtherProps(r),di=oe.reduceKeys(fi,Z.ARIA_PROPS),pi=n({ref:j,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:Q,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},te("firstHiddenFocusableElementOnOverlay")),hi=n({ref:$,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:fe,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},te("lastHiddenFocusableElementOnOverlay")),gi=n({ref:E,className:ue(r.className,ie("root",{context:s,focusedState:o,overlayVisibleState:d,isValueEmpty:z})),style:r.style,onClick:Pe},qt.getOtherProps(r),te("root")),mi=dt(),yi=Ae(),vi=ii(),bi=oi(),xi=ai(),Ei=ci(),wi=ui();return c.createElement("div",gi,mi,yi,bi,vi,c.createElement(zs,{hostName:"TreeSelect",ref:l,appendTo:r.appendTo,panelStyle:r.panelStyle,panelClassName:r.panelClassName,scrollHeight:r.scrollHeight,onClick:Y,header:Ei,hide:ye,footer:wi,firstHiddenFocusableElementOnOverlay:c.createElement("span",pi),lastHiddenFocusableElementOnOverlay:c.createElement("span",hi),transitionOptions:r.transitionOptions,in:d,onEnter:de,onEntered:Ct,onExit:ct,onExited:Bt,ptm:te,cx:ie},xi),ne&&c.createElement(vr,xt({target:E,content:r.tooltip,pt:te("tooltip")},r.tooltipOptions)))}));Vs.displayName="TreeSelect";function Hs(t,e=500){const n=c.useRef(null);return c.useCallback((...r)=>{n.current&&clearTimeout(n.current),n.current=window.setTimeout(()=>{t(...r)},e)},[t,e])}function un(t){"@babel/helpers - typeof";return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(t)}function Xl(t,e){if(un(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(un(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Zl(t){var e=Xl(t,"string");return un(e)=="symbol"?e:e+""}function Ql(t,e,n){return(e=Zl(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yt(){return yt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},yt.apply(null,arguments)}function pr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ec(t){if(Array.isArray(t))return pr(t)}function tc(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ks(t,e){if(t){if(typeof t=="string")return pr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pr(t,e):void 0}}function nc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ts(t){return ec(t)||tc(t)||Ks(t)||nc()}function rc(t){if(Array.isArray(t))return t}function sc(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function ic(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pt(t,e){return rc(t)||sc(t,e)||Ks(t,e)||ic()}var oc=`
@layer primereact {
    .p-menu-overlay {
        position: absolute;
        /* Github #3122: Prevent animation flickering  */
        top: -9999px;
        left: -9999px;
    }

    .p-menu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-menu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-menu .p-menuitem-text {
        line-height: 1;
    }
}
`,ac={root:function(e){var n=e.props,s=e.context;return ue("p-menu p-component",{"p-menu-overlay":n.popup,"p-input-filled":s&&s.inputStyle==="filled"||Ge.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||Ge.ripple===!1})},menu:"p-menu-list p-reset",content:function(e){var n=e.item;return ue("p-menuitem-content",{"p-disabled":n.disabled})},action:function(e){var n=e.item;return ue("p-menuitem-link",{"p-disabled":n.disabled})},menuitem:function(e){var n=e.focused;return ue("p-menuitem",{"p-focus":n})},submenuHeader:function(e){var n=e.submenu;return ue("p-submenu-header",{"p-disabled":n.disabled})},separator:"p-menu-separator",label:"p-menuitem-text",icon:"p-menuitem-icon",transition:"p-connected-overlay"},lc={submenuHeader:function(e){var n=e.submenu;return n.style},menuitem:function(e){var n=e.item;return n.style}},In=Rt.extend({defaultProps:{__TYPE:"Menu",id:null,ariaLabel:null,ariaLabelledBy:null,tabIndex:0,model:null,popup:!1,popupAlignment:"left",style:null,className:null,autoZIndex:!0,baseZIndex:0,appendTo:null,onFocus:null,onBlur:null,transitionOptions:null,onShow:null,onHide:null,children:void 0,closeOnEscape:!0},css:{classes:ac,styles:oc,inlineStyles:lc}});function ns(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function cc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ns(Object(n),!0).forEach(function(s){Ql(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ns(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Gs=c.memo(c.forwardRef(function(t,e){var n=it(),s=c.useContext(ot),r=In.getProps(t,s),i=c.useState(r.id),a=Pt(i,2),o=a[0],f=a[1],p=c.useState(!r.popup),h=Pt(p,2),d=h[0],S=h[1],O=c.useState(-1),L=Pt(O,2),M=L[0],T=L[1],u=c.useState(-1),w=Pt(u,2),g=w[0],x=w[1],v=c.useState(!1),E=Pt(v,2),l=E[0],m=E[1],y=In.setMetaData({props:r,state:{id:o,visible:d,focused:l}}),b=y.ptm,P=y.cx,F=y.sx,j=y.isUnstyled,$=function(C,H){return b(C,{context:H})};It(In.css.styles,j,{name:"menu"});var N=c.useRef(null),D=c.useRef(null),R=c.useRef(null),A=!!(d&&r.popup&&r.closeOnEscape),z=Ci("menu",A);Mi({callback:function(C){Oe(C)},when:A&&z,priority:[Pi.MENU,z]});var q=gs({target:R,overlay:N,listener:function(C,H){var X=H.valid,de=H.type;X&&(s.hideOverlaysOnDocumentScrolling||de==="outside"?(Oe(C),T(-1)):Z.isDocument(C.target)||Z.absolutePosition(N.current,R.current,r.popupAlignment))},when:d}),G=Pt(q,2),ne=G[0],ve=G[1],he=function(C){r.popup&&Es.emit("overlay-click",{originalEvent:C,target:R.current})},te=function(C,H,X){if(H.disabled){C.preventDefault();return}H.command&&H.command({originalEvent:C,item:H}),r.popup&&Oe(C),!r.popup&&M!==X&&T(X),H.url||(C.preventDefault(),C.stopPropagation())},ie=function(C,H){C&&r.popup&&M!==H&&T(H)},Ie=function(C){m(!0),r.popup||(g!==-1?(Pe(g),x(-1)):Pe(0)),r.onFocus&&r.onFocus(C)},ze=function(C){var H=C.currentTarget,X=C.relatedTarget;X&&H.contains(X)||(m(!1),T(-1),r.onBlur&&r.onBlur(C))},qe=function(C){switch(C.code){case"ArrowDown":Ye(C);break;case"ArrowUp":at(C);break;case"Home":Je(C);break;case"End":we(C);break;case"Enter":case"NumpadEnter":$e(C);break;case"Space":ye(C);break;case"Escape":r.popup&&(Z.focus(R.current),Oe(C));case"Tab":r.popup&&d&&Oe(C);break}},Ye=function(C){var H=Ke(M);Pe(H),C.preventDefault()},at=function(C){if(C.altKey&&r.popup)Z.focus(R.current),Oe(C),C.preventDefault();else{var H=Ee(M);Pe(H),C.preventDefault()}},Je=function(C){Pe(0),C.preventDefault()},we=function(C){Pe(Z.find(N.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]').length-1),C.preventDefault()},$e=function(C){var H=Z.findSingle(N.current,'li[id="'.concat("".concat(M),'"]')),X=H&&Z.findSingle(H,'a[data-pc-section="action"]');r.popup&&Z.focus(R.current),X?X.click():H&&H.click(),C.preventDefault()},ye=function(C){$e(C)},Ke=function(C){var H=Z.find(N.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),X=ts(H).findIndex(function(de){return de.id===C});return X>-1?X+1:0},Ee=function(C){var H=Z.find(N.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),X=ts(H).findIndex(function(de){return de.id===C});return X>-1?X-1:0},Pe=function(C){var H=Z.find(N.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),X=C>=H.length?H.length-1:C<0?0:C;X>-1&&T(H[X].getAttribute("id"))},Xe=function(){return M!==-1?M:null},Ve=function(C){r.popup&&(d?Oe(C):Ze(C))},Ze=function(C){R.current=C.currentTarget,S(!0),r.onShow&&r.onShow(C)},Oe=function(C){R.current=C.currentTarget,S(!1),r.onHide&&r.onHide(C)},lt=function(){Z.addStyles(N.current,{position:"absolute",top:"0",left:"0"}),jt.set("menu",N.current,s&&s.autoZIndex||Ge.autoZIndex,r.baseZIndex||s&&s.zIndex.menu||Ge.zIndex.menu),Z.absolutePosition(N.current,R.current,r.popupAlignment),r.popup&&(Z.focus(D.current),Pe(0))},le=function(){ne()},k=function(){R.current=null,ve()},Y=function(){jt.clear(N.current)};dn(function(){o||f(Vn())}),ms(function(){jt.clear(N.current)}),c.useImperativeHandle(e,function(){return{props:r,toggle:Ve,show:Ze,hide:Oe,getElement:function(){return N.current},getTarget:function(){return R.current}}});var Q=function(C,H){var X=o+"_sub_"+H,de=C.items.map(function(ct,Bt){return Se(ct,Bt,X)}),Ct=n({id:X,role:"none",className:ue(C.className,P("submenuHeader",{submenu:C})),style:F("submenuHeader",{submenu:C}),"data-p-disabled":C.disabled},b("submenuHeader"));return c.createElement(c.Fragment,{key:X},c.createElement("li",yt({},Ct,{key:X}),C.label),de)},fe=function(C,H){if(C.visible===!1)return null;var X=o+"_separator_"+H,de=n({id:X,className:ue(C.className,P("separator")),role:"separator"},b("separator"));return c.createElement("li",yt({},de,{key:X}))},Se=function(C,H){var X=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(C.visible===!1)return null;var de={item:C,index:H,parentId:X},Ct=ue("p-menuitem-link",{"p-disabled":C.disabled}),ct=ue("p-menuitem-icon",C.icon),Bt=n({className:P("icon")},$("icon",de)),ut=tt.getJSXIcon(C.icon,cc({},Bt),{props:r}),Wn=n({className:P("label")},$("label",de)),zt=C.label&&c.createElement("span",Wn,C.label),Fe=C.id||(X||o)+"_"+H,Vt=n({onClick:function(Ae){return te(Ae,C,Fe)},onMouseMove:function(Ae){return ie(Ae,Fe)},className:P("content",{item:C})},$("content",de)),Mt=n({href:C.url||"#",className:P("action",{item:C}),onFocus:function(Ae){return Ae.stopPropagation()},target:C.target,tabIndex:"-1","aria-label":C.label,"aria-disabled":C.disabled,"data-p-disabled":C.disabled},$("action",de)),ft=c.createElement("div",Vt,c.createElement("a",Mt,ut,zt,c.createElement(zn,null)));if(C.template){var qn={onClick:function(Ae){return te(Ae,C,Fe)},onMouseMove:function(Ae){return ie(Ae,Fe)},className:Ct,tabIndex:"-1",labelClassName:"p-menuitem-text",iconClassName:ct,element:ft,props:r};ft=oe.getJSXElement(C.template,C,qn)}var Yn=n({id:Fe,className:ue(C.className,P("menuitem",{focused:M===Fe})),onClick:function(Ae){return te(Ae,C,Fe)},style:F("menuitem",{item:C}),role:"menuitem","aria-label":C.label,"aria-disabled":C.disabled,"data-p-focused":Xe()===Fe,"data-p-disabled":C.disabled||!1},$("menuitem",de));return c.createElement("li",yt({},Yn,{key:Fe}),ft)},U=function(C,H){return C.visible===!1?null:C.separator?fe(C,H):C.items?Q(C,H):Se(C,H)},B=function(){return r.model.map(U)},ae=function(){if(r.model){var C=B(),H=n({className:ue(r.className,P("root",{context:s})),style:r.style,onClick:function(ct){return he(ct)}},In.getOtherProps(r),b("root")),X=n({ref:D,className:P("menu"),id:o+"_list",tabIndex:r.tabIndex||"0",role:"menu","aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-activedescendant":l?Xe():void 0,onFocus:Ie,onKeyDown:qe,onBlur:ze},b("menu")),de=n({classNames:P("transition"),in:d,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:lt,onEntered:le,onExit:k,onExited:Y},b("transition"));return c.createElement(Bn,yt({nodeRef:N},de),c.createElement("div",yt({id:r.id,ref:N},H),c.createElement("ul",X,C)))}return null},Te=ae();return r.popup?c.createElement(ys,{element:Te,appendTo:r.appendTo}):Te}));Gs.displayName="Menu";const uc=function(e){const[n,s]=c.useState(null),[r,i]=c.useState(null),[a,o]=c.useState([]),[f,p]=c.useState(e.path),[h,d]=c.useState(!0),[S,O]=c.useState(""),[L,M]=c.useState({}),[T,u]=c.useState(e.homeFileProp??""),w=c.useRef(null),g=c.useRef(null),[x,v]=c.useState(!1),E=(R,A)=>alert(`${R}: ${A}`);function l(R="/"){const A=[];try{const z=$i(R);z.sort();for(const q of z){const G=R==="/"?`/${q}`:`${R}/${q}`;gt(G)&&Or(G).isDirectory()?A.push({key:G,label:q+"/",data:G,selectable:!1,children:l(G),icon:"pi pi-folder"}):A.push({key:G,label:q,data:G,selectable:!0,icon:"pi pi-file"})}}catch(z){E("Failed to build tree",z)}return A}const m=()=>{if(!e.hideTopBar)try{const R=l("/");o(R),!f&&R.length&&p(T)}catch(R){E("Failed to list files",R)}},y=()=>{const R=prompt("Enter new file name (with extension):","/newfile.scad");if(R&&R.startsWith("/"))try{gt(R)?alert("File already exists!"):(Cr(R.substring(0,R.lastIndexOf("/")),{recursive:!0}),Zn(R,""),p(R),m())}catch(A){E("Failed to create file",A)}},b=()=>{const R=prompt("Enter new name for current file:",f);if(R&&R.startsWith("/"))try{gt(R)?alert("File already exists!"):(Cr(R.substring(0,R.lastIndexOf("/")),{recursive:!0}),Zn(R,Qn(f,"utf-8")),Mr(f),p(R),m())}catch(A){E("Failed to rename file",A)}},P=()=>{if(window.confirm(`Delete ${f}?`))try{Mr(f),m(),p("")}catch(R){E("Failed to delete file",R)}},F=Hs(R=>{if(!(h||!f))try{if(console.debug("ZenMonacoPrime",`Saving ${f}`),Zn(f,R??""),R==S)return;e.onSave?.(R)}catch(A){E("Failed to save file",A)}},1e3),j=c.useCallback(R=>{R&&F(R)},[F]),$=(R,A)=>{A.editor.addEditorAction({id:"openscad-save-do-nothing",label:"Save (disabled)",keybindings:[A.KeyMod.CtrlCmd|A.KeyCode.KeyS],run:()=>{}}),A.editor.addKeybindingRules([{keybinding:A.KeyMod.CtrlCmd|A.KeyCode.KeyD,command:"monaco.editor.action.deleteLines"},{keybinding:A.KeyMod.CtrlCmd|A.KeyMod.Shift|A.KeyCode.KeyD,command:"monaco.editor.action.copyLinesDownAction"},{keybinding:A.KeyMod.CtrlCmd|A.KeyCode.KeyK,command:"monaco.editor.action.quickCommand"},{keybinding:A.KeyCode.F8,command:void 0}]),Ca(A,Di,"/",Bi),s(R),i(A)};c.useEffect(()=>{if(!n||!r)return;const R=n.getModel();R&&r.editor.setModelMarkers(R,"openscad",e.markers??[])},[n,r,e.markers]),c.useEffect(()=>{e.isInitializing||!f||S!=""||(async()=>{try{if(console.debug("ZenMonacoPrime",`Loading ${f}`),gt(f)){const R=Qn(f,"utf-8");R!=S&&O(R)}else O("");m(),d(!1)}catch(R){E("Failed to read file",R),O("")}})()},[e.isInitializing,f,m]),c.useEffect(()=>{if(e.reloadKey!==void 0&&e.reloadKey>0&&(console.debug("ZenMonacoPrime",`Reloading ${f}`),gt(f))){const R=Qn(f,"utf-8");n?.setValue(R),d(!1)}},[e.reloadKey]),c.useEffect(()=>{const R=()=>{g.current&&v(g.current.offsetWidth<600)};return window.addEventListener("resize",R),R(),()=>window.removeEventListener("resize",R)},[]);const N=f||null,D=[{label:"New File",icon:"pi pi-plus",command:y},{label:"Rename",icon:"pi pi-pencil",command:b},{label:"Delete",icon:"pi pi-trash",command:P},{separator:!0},{label:"Set as Home",icon:"pi pi-home",command:()=>u(f)}];return _.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",...e.style},children:[!e.hideTopBar&&_.jsxs("div",{style:{flex:0,display:"flex",alignItems:"center",gap:"8px",padding:"8px",background:"#222"},children:[_.jsxs("div",{style:{position:"relative",flex:0},children:[_.jsx(Gs,{model:D,popup:!0,ref:w}),_.jsx(nn,{"aria-label":"Editor menu",style:{minWidth:48,minHeight:48},title:"Menu",onClick:R=>w.current&&w.current.toggle(R),disabled:h,icon:"pi pi-bars",text:!0})]}),_.jsx("div",{style:{position:"relative",flex:1,display:"flex",alignItems:"center"},children:_.jsx(Vs,{value:N,options:a,expandedKeys:L,onToggle:R=>M(R.value),onChange:R=>{const A=R.value;typeof A=="string"&&gt(A)&&!Or(A).isDirectory()&&p(A)},selectionMode:"single",filter:!0,placeholder:"Select a file",className:"w-full",style:{minWidth:300},disabled:h,panelStyle:{maxHeight:600,overflowY:"auto"}})}),_.jsx("div",{style:{position:"relative",flex:0},children:_.jsx(nn,{"aria-label":"Go to HomePage",title:"Go to HomePage",style:{minWidth:48,minHeight:48,color:T?"#fff":"#888"},disabled:!T,onClick:()=>T&&p(T),icon:"pi pi-home",text:!0})})]}),_.jsx("div",{ref:g,style:{flex:1},children:h?_.jsx(Dt,{text:"Loading filesystem"}):_.jsx(kl,{width:"100%",height:"100%",defaultLanguage:"openscad",value:S,path:f,onChange:j,theme:"vs-dark",onMount:$,options:{automaticLayout:!0,fontSize:16,lineNumbers:x?"off":"on",minimap:{enabled:!x},scrollBeyondLastLine:!1,tabSize:2,insertSpaces:!0,detectIndentation:!0,maxTokenizationLineLength:2e3,lineNumbersMinChars:4},loading:_.jsx(Dt,{text:"Loading monaco editor"})})})]})};class Ws{constructor(){this._listeners={}}addEventListener(e,n){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(n)===-1&&s[e].push(n),this}removeEventListener(e,n){const r=this._listeners[e];if(r!==void 0){const i=r.indexOf(n);i!==-1&&r.splice(i,1)}return this}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){const r=s.slice(0);for(let i=0,a=r.length;i<a;i++)r[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class _t{constructor(e,n,s,r={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=n,this._child=s,this._attributes=r,!n.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class fc extends Ws{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const n=new Set;for(const s of this.listParentEdges(e))n.add(s.getParent());return Array.from(n)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const n=new Set;for(const s of this.listChildEdges(e))n.add(s.getChild());return Array.from(n)}disconnectParents(e,n){for(const s of this.listParentEdges(e))(!n||n(s.getParent()))&&s.dispose();return this}_createEdge(e,n,s,r){const i=new _t(e,n,s,r);this._edges.add(i);const a=i.getParent();this._parentEdges.has(a)||this._parentEdges.set(a,new Set),this._parentEdges.get(a).add(i);const o=i.getChild();return this._childEdges.has(o)||this._childEdges.set(o,new Set),this._childEdges.get(o).add(i),i}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function tn(){return tn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},tn.apply(this,arguments)}class nt{constructor(e){if(this.list=[],e)for(const n of e)this.list.push(n)}add(e){this.list.push(e)}remove(e){const n=this.list.indexOf(e);n>=0&&this.list.splice(n,1)}removeChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);for(const s of n)this.remove(s);return n}listRefsByChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);return n}values(){return this.list}}class ge{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const n of e)this.add(n)}add(e){const n=e.getChild();this.removeChild(n),this.set.add(e),this.map.set(n,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const n=this.map.get(e)||null;return n&&this.remove(n),n}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class He{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,n){this.map[e]=n}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const se=Symbol("attributes"),vt=Symbol("immutableKeys");class Er extends Ws{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[se]=void 0,this[vt]=void 0,this.graph=e,this[vt]=new Set,this[se]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),n={};for(const s in e){const r=e[s];if(r instanceof Er){const i=this.graph._createEdge(s,this,r);this[vt].add(s),n[s]=i}else n[s]=r}return n}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,n){for(const s in this[se]){const r=this[se][s];if(r instanceof _t){const i=r;i.getChild()===e&&this.setRef(s,n,i.getAttributes())}else if(r instanceof nt)for(const i of r.listRefsByChild(e)){const a=i.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}else if(r instanceof ge){const i=r.getRefByChild(e);if(i){const a=i.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}}else if(r instanceof He)for(const i of r.keys()){const a=r.get(i);a.getChild()===e&&this.setRefMap(s,i,n,a.getAttributes())}}return this}get(e){return this[se][e]}set(e,n){return this[se][e]=n,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const n=this[se][e];return n?n.getChild():null}setRef(e,n,s){if(this[vt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[se][e];if(r&&r.dispose(),!n)return this;const i=this.graph._createEdge(e,this,n,s);return this[se][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(s=>s.getChild())}addRef(e,n,s){const r=this.graph._createEdge(e,this,n,s);return this.assertRefList(e).add(r),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,n){const s=this.assertRefList(e);if(s instanceof nt)for(const r of s.listRefsByChild(n))r.dispose();else{const r=s.getRefByChild(n);r&&r.dispose()}return this}assertRefList(e){const n=this[se][e];if(n instanceof nt||n instanceof ge)return n;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(n=>n.getChild())}getRefMap(e,n){const r=this.assertRefMap(e).get(n);return r?r.getChild():null}setRefMap(e,n,s,r){const i=this.assertRefMap(e),a=i.get(n);if(a&&a.dispose(),!s)return this;r=Object.assign(r||{},{key:n});const o=this.graph._createEdge(e,this,s,tn({},r,{key:n}));return i.set(n,o),this.dispatchEvent({type:"change",attribute:e,key:n})}assertRefMap(e){const n=this[se][e];if(n instanceof He)return n;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(tn({},e,{target:this})),this.graph.dispatchEvent(tn({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const n=e.getName();if(this[se][n]===e)this[se][n]=null,this[vt].has(n)&&e.getChild().dispose();else if(this[se][n]instanceof nt)this[se][n].remove(e);else if(this[se][n]instanceof ge)this[se][n].remove(e);else if(this[se][n]instanceof He){const s=this[se][n];for(const r of s.keys())s.get(r)===e&&s.delete(r)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:n})}}const qs="v4.2.1",kn="@glb.bin";var V;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(V||(V={}));var $n;(function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"})($n||($n={}));var _e;(function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"})(_e||(_e={}));var hr;(function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"})(hr||(hr={}));var We;(function(t){t.GLTF="GLTF",t.GLB="GLB"})(We||(We={}));const Kn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class re{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const n=atob(e.split(",")[1]),s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}else{const n=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(n,s?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let n=0;for(const i of e)n+=i.byteLength;const s=new Uint8Array(n);let r=0;for(const i of e)s.set(i,r),r+=i.byteLength;return s}static pad(e,n=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const r=new Uint8Array(s);if(r.set(e),n!==0)for(let i=e.byteLength;i<s;i++)r[i]=n;return r}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,n){if(e===n)return!0;if(e.byteLength!==n.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==n[s])return!1;return!0}static toView(e,n=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+n,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class dc{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let n=new DataView(e.buffer,e.byteOffset+4),s,r;for(;n.byteLength;){if(s=n.getUint16(0,!1),pc(n,s),r=n.getUint8(s+1),r===192||r===193||r===194)return[n.getUint16(s+7,!1),n.getUint16(s+5,!1)];n=new DataView(e.buffer,n.byteOffset+s+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class Gn{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const n=new DataView(e.buffer,e.byteOffset);return re.decodeText(e.slice(12,16))===Gn.PNG_FRIED_CHUNK_NAME?[n.getUint32(32,!1),n.getUint32(36,!1)]:[n.getUint32(16,!1),n.getUint32(20,!1)]}getChannels(e){return 4}}Gn.PNG_FRIED_CHUNK_NAME="CgBI";class Et{static registerFormat(e,n){this.impls[e]=n}static getMimeType(e){for(const n in this.impls)if(this.impls[n].match(e))return n;return null}static getSize(e,n){return this.impls[n]?this.impls[n].getSize(e):null}static getChannels(e,n){return this.impls[n]?this.impls[n].getChannels(e):null}static getVRAMByteLength(e,n){if(!this.impls[n])return null;if(this.impls[n].getVRAMByteLength)return this.impls[n].getVRAMByteLength(e);let s=0;const r=4,i=this.getSize(e,n);if(!i)return null;for(;i[0]>1||i[1]>1;)s+=i[0]*i[1]*r,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return s+=1*r,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Et.impls={"image/jpeg":new dc,"image/png":new Gn};function pc(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}class St{static basename(e){const n=e.split(/[\\/]/).pop();return n.substring(0,n.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const n=e.match(/data:(image\/\w+)/)[1];return Et.mimeTypeToExtension(n)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var gr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function hc(){var t=new gr(3);return gr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function sr(t){var e=t[0],n=t[1],s=t[2];return Math.hypot(e,n,s)}(function(){var t=hc();return function(e,n,s,r,i,a){var o,f;for(n||(n=3),s||(s=0),r?f=Math.min(r*n+s,e.length):f=e.length,o=s;o<f;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();const rs="https://null.example";class Ue{static dirname(e){const n=e.lastIndexOf("/");return n===-1?"./":e.substring(0,n+1)}static basename(e){return St.basename(new URL(e,rs).pathname)}static extension(e){return St.extension(new URL(e,rs).pathname)}static resolve(e,n){if(!this.isRelativePath(n))return n;const s=e.split("/"),r=n.split("/");s.pop();for(let i=0;i<r.length;i++)r[i]!=="."&&(r[i]===".."?s.pop():s.push(r[i]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Ue.DEFAULT_INIT={};Ue.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function ss(t){return Object.prototype.toString.call(t)==="[object Object]"}function bt(t){if(ss(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(ss(n)===!1||Object.hasOwn(n,"isPrototypeOf")===!1)}var mr,yr;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(yr||(yr={}));class ke{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=ke.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=ke.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=ke.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=ke.Verbosity.ERROR&&console.error(e)}}mr=ke;ke.Verbosity=yr;ke.DEFAULT_INSTANCE=new mr(mr.Verbosity.INFO);function gc(t){var e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],a=t[5],o=t[6],f=t[7],p=t[8],h=t[9],d=t[10],S=t[11],O=t[12],L=t[13],M=t[14],T=t[15],u=e*a-n*i,w=e*o-s*i,g=e*f-r*i,x=n*o-s*a,v=n*f-r*a,E=s*f-r*o,l=p*L-h*O,m=p*M-d*O,y=p*T-S*O,b=h*M-d*L,P=h*T-S*L,F=d*T-S*M;return u*F-w*P+g*b+x*y-v*m+E*l}function mc(t,e,n){var s=e[0],r=e[1],i=e[2],a=e[3],o=e[4],f=e[5],p=e[6],h=e[7],d=e[8],S=e[9],O=e[10],L=e[11],M=e[12],T=e[13],u=e[14],w=e[15],g=n[0],x=n[1],v=n[2],E=n[3];return t[0]=g*s+x*o+v*d+E*M,t[1]=g*r+x*f+v*S+E*T,t[2]=g*i+x*p+v*O+E*u,t[3]=g*a+x*h+v*L+E*w,g=n[4],x=n[5],v=n[6],E=n[7],t[4]=g*s+x*o+v*d+E*M,t[5]=g*r+x*f+v*S+E*T,t[6]=g*i+x*p+v*O+E*u,t[7]=g*a+x*h+v*L+E*w,g=n[8],x=n[9],v=n[10],E=n[11],t[8]=g*s+x*o+v*d+E*M,t[9]=g*r+x*f+v*S+E*T,t[10]=g*i+x*p+v*O+E*u,t[11]=g*a+x*h+v*L+E*w,g=n[12],x=n[13],v=n[14],E=n[15],t[12]=g*s+x*o+v*d+E*M,t[13]=g*r+x*f+v*S+E*T,t[14]=g*i+x*p+v*O+E*u,t[15]=g*a+x*h+v*L+E*w,t}function yc(t,e){var n=e[0],s=e[1],r=e[2],i=e[4],a=e[5],o=e[6],f=e[8],p=e[9],h=e[10];return t[0]=Math.hypot(n,s,r),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(f,p,h),t}function vc(t,e){var n=new gr(3);yc(n,e);var s=1/n[0],r=1/n[1],i=1/n[2],a=e[0]*s,o=e[1]*r,f=e[2]*i,p=e[4]*s,h=e[5]*r,d=e[6]*i,S=e[8]*s,O=e[9]*r,L=e[10]*i,M=a+h+L,T=0;return M>0?(T=Math.sqrt(M+1)*2,t[3]=.25*T,t[0]=(d-O)/T,t[1]=(S-f)/T,t[2]=(o-p)/T):a>h&&a>L?(T=Math.sqrt(1+a-h-L)*2,t[3]=(d-O)/T,t[0]=.25*T,t[1]=(o+p)/T,t[2]=(S+f)/T):h>L?(T=Math.sqrt(1+h-a-L)*2,t[3]=(S-f)/T,t[0]=(o+p)/T,t[1]=.25*T,t[2]=(d+O)/T):(T=Math.sqrt(1+L-a-h)*2,t[3]=(o-p)/T,t[0]=(S+f)/T,t[1]=(d+O)/T,t[2]=.25*T),t}class me{static identity(e){return e}static eq(e,n,s=1e-5){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-n[r])>s)return!1;return!0}static clamp(e,n,s){return e<n?n:e>s?s:e}static decodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return Math.round(me.clamp(e,0,1)*65535);case 5121:return Math.round(me.clamp(e,0,1)*255);case 5122:return Math.round(me.clamp(e,-1,1)*32767);case 5120:return Math.round(me.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,n,s,r){let i=sr([e[0],e[1],e[2]]);const a=sr([e[4],e[5],e[6]]),o=sr([e[8],e[9],e[10]]);gc(e)<0&&(i=-i),n[0]=e[12],n[1]=e[13],n[2]=e[14];const p=e.slice(),h=1/i,d=1/a,S=1/o;p[0]*=h,p[1]*=h,p[2]*=h,p[4]*=d,p[5]*=d,p[6]*=d,p[8]*=S,p[9]*=S,p[10]*=S,vc(s,p),r[0]=i,r[1]=a,r[2]=o}static compose(e,n,s,r){const i=r,a=n[0],o=n[1],f=n[2],p=n[3],h=a+a,d=o+o,S=f+f,O=a*h,L=a*d,M=a*S,T=o*d,u=o*S,w=f*S,g=p*h,x=p*d,v=p*S,E=s[0],l=s[1],m=s[2];return i[0]=(1-(T+w))*E,i[1]=(L+v)*E,i[2]=(M-x)*E,i[3]=0,i[4]=(L-v)*l,i[5]=(1-(O+w))*l,i[6]=(u+g)*l,i[7]=0,i[8]=(M+x)*m,i[9]=(u-g)*m,i[10]=(1-(O+T))*m,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function bc(t,e){if(!!t!=!!e)return!1;const n=t.getChild(),s=e.getChild();return n===s||n.equals(s)}function xc(t,e){if(!!t!=!!e)return!1;const n=t.values(),s=e.values();if(n.length!==s.length)return!1;for(let r=0;r<n.length;r++){const i=n[r],a=s[r];if(i.getChild()!==a.getChild()&&!i.getChild().equals(a.getChild()))return!1}return!0}function Ec(t,e){if(!!t!=!!e)return!1;const n=t.keys(),s=e.keys();if(n.length!==s.length)return!1;for(const r of n){const i=t.get(r),a=e.get(r);if(!!i!=!!a)return!1;const o=i.getChild(),f=a.getChild();if(o!==f&&!o.equals(f))return!1}return!0}function Ys(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Js(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!bt(t)||!bt(e))return t===e;const n=t,s=e;let r=0,i=0,a;for(a in n)r++;for(a in s)i++;if(r!==i)return!1;for(a in n){const o=n[a],f=s[a];if(Dn(o)&&Dn(f)){if(!Ys(o,f))return!1}else if(bt(o)&&bt(f)){if(!Js(o,f))return!1}else if(o!==f)return!1}return!0}function Dn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const is="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",wc=999,Sc=6,os=new Set,Tc=function(){let e="";for(let n=0;n<Sc;n++)e+=is.charAt(Math.floor(Math.random()*is.length));return e},Rc=function(){for(let e=0;e<wc;e++){const n=Tc();if(!os.has(n))return os.add(n),n}return""},st=t=>t,Ic=new Set;class wr extends Er{constructor(e,n=""){super(e),this[se].name=n,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,n){return Array.isArray(n)&&(n=n.slice()),super.set(e,n)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,st)}copy(e,n=st){for(const s in this[se]){const r=this[se][s];if(r instanceof _t)this[vt].has(s)||r.dispose();else if(r instanceof nt||r instanceof ge)for(const i of r.values())i.dispose();else if(r instanceof He)for(const i of r.values())i.dispose()}for(const s in e[se]){const r=this[se][s],i=e[se][s];if(i instanceof _t)this[vt].has(s)?r.getChild().copy(n(i.getChild()),n):this.setRef(s,n(i.getChild()),i.getAttributes());else if(i instanceof ge||i instanceof nt)for(const a of i.values())this.addRef(s,n(a.getChild()),a.getAttributes());else if(i instanceof He)for(const a of i.keys()){const o=i.get(a);this.setRefMap(s,a,n(o.getChild()),o.getAttributes())}else bt(i)?this[se][s]=JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?this[se][s]=i.slice():this[se][s]=i}return this}equals(e,n=Ic){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[se]){if(n.has(s))continue;const r=this[se][s],i=e[se][s];if(r instanceof _t||i instanceof _t){if(!bc(r,i))return!1}else if(r instanceof ge||i instanceof ge||r instanceof nt||i instanceof nt){if(!xc(r,i))return!1}else if(r instanceof He||i instanceof He){if(!Ec(r,i))return!1}else if(bt(r)||bt(i)){if(!Js(r,i))return!1}else if(Dn(r)||Dn(i)){if(!Ys(r,i))return!1}else if(r!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Me extends wr{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new He})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,n){return n&&n._validateParent(this),this.setRefMap("extensions",e,n)}listExtensions(){return this.listRefMapValues("extensions")}}class J extends Me{init(){this.propertyType=V.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:J.Type.SCALAR,componentType:J.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case J.Type.SCALAR:return 1;case J.Type.VEC2:return 2;case J.Type.VEC3:return 3;case J.Type.VEC4:return 4;case J.Type.MAT2:return 4;case J.Type.MAT3:return 9;case J.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case J.ComponentType.BYTE:return 1;case J.ComponentType.UNSIGNED_BYTE:return 1;case J.ComponentType.SHORT:return 2;case J.ComponentType.UNSIGNED_SHORT:return 2;case J.ComponentType.UNSIGNED_INT:return 4;case J.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMin(e),n)for(let i=0;i<s;i++)e[i]=me.decodeNormalizedInt(e[i],r);return e}getMin(e){const n=this.getArray(),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)e[i]=1/0;for(let i=0;i<s*r;i+=r)for(let a=0;a<r;a++){const o=n[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMax(e),n)for(let i=0;i<s;i++)e[i]=me.decodeNormalizedInt(e[i],r);return e}getMax(e){const n=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)e[i]=-1/0;for(let i=0;i<s*r;i+=r)for(let a=0;a<r;a++){const o=n[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return J.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const n=this.getElementSize(),s=this.getComponentType(),r=this.getArray();return this.getNormalized()?me.decodeNormalizedInt(r[e*n],s):r[e*n]}setScalar(e,n){const s=this.getElementSize(),r=this.getComponentType(),i=this.getArray();return this.getNormalized()?i[e*s]=me.encodeNormalizedInt(n,r):i[e*s]=n,this}getElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<r;o++)s?n[o]=me.decodeNormalizedInt(a[e*r+o],i):n[o]=a[e*r+o];return n}setElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<r;o++)s?a[e*r+o]=me.encodeNormalizedInt(n[o],i):a[e*r+o]=n[o];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?Oc(e):J.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}J.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};J.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function Oc(t){switch(t.constructor){case Float32Array:return J.ComponentType.FLOAT;case Uint32Array:return J.ComponentType.UNSIGNED_INT;case Uint16Array:return J.ComponentType.UNSIGNED_SHORT;case Uint8Array:return J.ComponentType.UNSIGNED_BYTE;case Int16Array:return J.ComponentType.SHORT;case Int8Array:return J.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class Xs extends Me{init(){this.propertyType=V.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new ge,samplers:new ge})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Zs extends Me{init(){this.propertyType=V.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Zs.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class hn extends Me{init(){this.propertyType=V.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:hn.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:_e.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:_e.OTHER})}}hn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Qs extends Me{init(){this.propertyType=V.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Ot extends Me{init(){this.propertyType=V.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Ot.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Ot.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Cc extends wr{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Cc.EXTENSION_NAME=void 0;class Be extends Me{init(){this.propertyType=V.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Be.WrapMode.REPEAT,wrapT:Be.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Be.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Be.MagFilter={NEAREST:9728,LINEAR:9729};Be.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:On,G:Cn,B:Mn,A:Mc}=hr;class Tt extends Me{init(){this.propertyType=V.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Tt.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Be(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Be(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Be(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Be(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Be(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const n=this.get("baseColorFactor").slice();return n[3]=e,this.set("baseColorFactor",n)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:On|Cn|Mn|Mc,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:On|Cn|Mn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:On|Cn|Mn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:On})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Cn|Mn})}}Tt.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class ei extends Me{init(){this.propertyType=V.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new ge})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class ti extends Me{init(){this.propertyType=V.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new ge})}copy(e,n=st){if(n===st)throw new Error("Node cannot be copied.");return super.copy(e,n)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return me.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const n=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return me.decompose(e,n,s,r),this.set("translation",n).set("rotation",s).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return me.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return me.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return me.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r!=null;r=r.getParentNode())e.push(r);let n;const s=e.pop().getMatrix();for(;n=e.pop();)mc(s,s,n.getMatrix());return s}addChild(e){const n=e.getParentNode();n&&n.removeChild(e);for(const s of e.listParents())s.propertyType===V.SCENE&&s.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===V.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const n of this.listChildren())n.traverse(e);return this}}class gn extends Me{init(){this.propertyType=V.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:gn.Mode.TRIANGLES,material:null,indices:null,attributes:new He,targets:new ge})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:_e.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:_e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}gn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Pc extends wr{init(){this.propertyType=V.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new He})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:_e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Ce(){return Ce=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ce.apply(null,arguments)}class ni extends Me{init(){this.propertyType=V.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new ge})}copy(e,n=st){if(n===st)throw new Error("Scene cannot be copied.");return super.copy(e,n)}addChild(e){const n=e.getParentNode();return n&&n.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const n of this.listChildren())n.traverse(e);return this}}class ri extends Me{init(){this.propertyType=V.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new ge})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:_e.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class si extends Me{init(){this.propertyType=V.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Et.extensionToMimeType(St.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const n=Et.extensionToMimeType(St.extension(e));return n&&this.set("mimeType",n),this}getImage(){return this.get("image")}setImage(e){return this.set("image",re.assertView(e))}getSize(){const e=this.get("image");return e?Et.getSize(e,this.getMimeType()):null}}class Ac extends Me{init(){this.propertyType=V.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${qs}`,version:"2.0"},defaultScene:null,accessors:new ge,animations:new ge,buffers:new ge,cameras:new ge,materials:new ge,meshes:new ge,nodes:new ge,scenes:new ge,skins:new ge,textures:new ge})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",n=>{this._addChildOfRoot(n.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,n=st){if(n===st)throw new Error("Root cannot be copied.");this.set("asset",Ce({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ce({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?n(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const r=e.getExtension(s);this.setExtension(s,n(r))}return this}_addChildOfRoot(e){return e instanceof ni?this.addRef("scenes",e):e instanceof ti?this.addRef("nodes",e):e instanceof Ot?this.addRef("cameras",e):e instanceof ri?this.addRef("skins",e):e instanceof ei?this.addRef("meshes",e):e instanceof Tt?this.addRef("materials",e):e instanceof si?this.addRef("textures",e):e instanceof Xs?this.addRef("animations",e):e instanceof J?this.addRef("accessors",e):e instanceof Qs&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Ut{static fromGraph(e){return Ut._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new fc,this._root=new Ac(this._graph),this._logger=ke.DEFAULT_INSTANCE,Ut._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const n=e.map(s=>s.name);for(const s of e)await s(this,{stack:n});return this}createExtension(e){const n=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(r=>r.extensionName===n)||new e(this)}createScene(e=""){return new ni(this._graph,e)}createNode(e=""){return new ti(this._graph,e)}createCamera(e=""){return new Ot(this._graph,e)}createSkin(e=""){return new ri(this._graph,e)}createMesh(e=""){return new ei(this._graph,e)}createPrimitive(){return new gn(this._graph)}createPrimitiveTarget(e=""){return new Pc(this._graph,e)}createMaterial(e=""){return new Tt(this._graph,e)}createTexture(e=""){return new si(this._graph,e)}createAnimation(e=""){return new Xs(this._graph,e)}createAnimationChannel(e=""){return new Zs(this._graph,e)}createAnimationSampler(e=""){return new hn(this._graph,e)}createAccessor(e="",n=null){return n||(n=this.getRoot().listBuffers()[0]),new J(this._graph,e).setBuffer(n)}createBuffer(e=""){return new Qs(this._graph,e)}}Ut._GRAPH_DOCUMENTS=new WeakMap;class Nc{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,n){this.textureInfos.set(e,n),n.texCoord!==void 0&&e.setTexCoord(n.texCoord),n.extras!==void 0&&e.setExtras(n.extras);const s=this.jsonDoc.json.textures[n.index];if(s.sampler===void 0)return;const r=this.jsonDoc.json.samplers[s.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const as={logger:ke.DEFAULT_INSTANCE,extensions:[],dependencies:{}},_c=new Set([V.BUFFER,V.TEXTURE,V.MATERIAL,V.MESH,V.PRIMITIVE,V.NODE,V.SCENE]);class Fc{static read(e,n=as){const s=Ce({},as,n),{json:r}=e,i=new Ut().setLogger(s.logger);this.validate(e,s);const a=new Nc(e),o=r.asset,f=i.getRoot().getAsset();o.copyright&&(f.copyright=o.copyright),o.extras&&(f.extras=o.extras),r.extras!==void 0&&i.getRoot().setExtras(Ce({},r.extras));const p=r.extensionsUsed||[],h=r.extensionsRequired||[];s.extensions.sort((l,m)=>l.EXTENSION_NAME>m.EXTENSION_NAME?1:-1);for(const l of s.extensions)if(p.includes(l.EXTENSION_NAME)){const m=i.createExtension(l).setRequired(h.includes(l.EXTENSION_NAME)),y=m.prereadTypes.filter(b=>!_c.has(b));y.length&&s.logger.warn(`Preread hooks for some types (${y.join()}), requested by extension ${m.extensionName}, are unsupported. Please file an issue or a PR.`);for(const b of m.readDependencies)m.install(b,s.dependencies[b])}const d=r.buffers||[];i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.BUFFER)).forEach(l=>l.preread(a,V.BUFFER)),a.buffers=d.map(l=>{const m=i.createBuffer(l.name);return l.extras&&m.setExtras(l.extras),l.uri&&l.uri.indexOf("__")!==0&&m.setURI(l.uri),m});const S=r.bufferViews||[];a.bufferViewBuffers=S.map((l,m)=>{if(!a.bufferViews[m]){const y=e.json.buffers[l.buffer],b=y.uri?e.resources[y.uri]:e.resources[kn],P=l.byteOffset||0;a.bufferViews[m]=re.toView(b,P,l.byteLength)}return a.buffers[l.buffer]});const O=r.accessors||[];a.accessors=O.map(l=>{const m=a.bufferViewBuffers[l.bufferView],y=i.createAccessor(l.name,m).setType(l.type);return l.extras&&y.setExtras(l.extras),l.normalized!==void 0&&y.setNormalized(l.normalized),l.bufferView===void 0||y.setArray(Nn(l,a)),y});const L=r.images||[],M=r.textures||[];i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.TEXTURE)).forEach(l=>l.preread(a,V.TEXTURE)),a.textures=L.map(l=>{const m=i.createTexture(l.name);if(l.extras&&m.setExtras(l.extras),l.bufferView!==void 0){const y=r.bufferViews[l.bufferView],b=e.json.buffers[y.buffer],P=b.uri?e.resources[b.uri]:e.resources[kn],F=y.byteOffset||0,j=y.byteLength,$=P.slice(F,F+j);m.setImage($)}else l.uri!==void 0&&(m.setImage(e.resources[l.uri]),l.uri.indexOf("__")!==0&&m.setURI(l.uri));if(l.mimeType!==void 0)m.setMimeType(l.mimeType);else if(l.uri){const y=St.extension(l.uri);m.setMimeType(Et.extensionToMimeType(y))}return m}),i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.MATERIAL)).forEach(l=>l.preread(a,V.MATERIAL));const T=r.materials||[];a.materials=T.map(l=>{const m=i.createMaterial(l.name);l.extras&&m.setExtras(l.extras),l.alphaMode!==void 0&&m.setAlphaMode(l.alphaMode),l.alphaCutoff!==void 0&&m.setAlphaCutoff(l.alphaCutoff),l.doubleSided!==void 0&&m.setDoubleSided(l.doubleSided);const y=l.pbrMetallicRoughness||{};if(y.baseColorFactor!==void 0&&m.setBaseColorFactor(y.baseColorFactor),l.emissiveFactor!==void 0&&m.setEmissiveFactor(l.emissiveFactor),y.metallicFactor!==void 0&&m.setMetallicFactor(y.metallicFactor),y.roughnessFactor!==void 0&&m.setRoughnessFactor(y.roughnessFactor),y.baseColorTexture!==void 0){const b=y.baseColorTexture,P=a.textures[M[b.index].source];m.setBaseColorTexture(P),a.setTextureInfo(m.getBaseColorTextureInfo(),b)}if(l.emissiveTexture!==void 0){const b=l.emissiveTexture,P=a.textures[M[b.index].source];m.setEmissiveTexture(P),a.setTextureInfo(m.getEmissiveTextureInfo(),b)}if(l.normalTexture!==void 0){const b=l.normalTexture,P=a.textures[M[b.index].source];m.setNormalTexture(P),a.setTextureInfo(m.getNormalTextureInfo(),b),l.normalTexture.scale!==void 0&&m.setNormalScale(l.normalTexture.scale)}if(l.occlusionTexture!==void 0){const b=l.occlusionTexture,P=a.textures[M[b.index].source];m.setOcclusionTexture(P),a.setTextureInfo(m.getOcclusionTextureInfo(),b),l.occlusionTexture.strength!==void 0&&m.setOcclusionStrength(l.occlusionTexture.strength)}if(y.metallicRoughnessTexture!==void 0){const b=y.metallicRoughnessTexture,P=a.textures[M[b.index].source];m.setMetallicRoughnessTexture(P),a.setTextureInfo(m.getMetallicRoughnessTextureInfo(),b)}return m}),i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.MESH)).forEach(l=>l.preread(a,V.MESH));const u=r.meshes||[];i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.PRIMITIVE)).forEach(l=>l.preread(a,V.PRIMITIVE)),a.meshes=u.map(l=>{const m=i.createMesh(l.name);return l.extras&&m.setExtras(l.extras),l.weights!==void 0&&m.setWeights(l.weights),(l.primitives||[]).forEach(b=>{const P=i.createPrimitive();b.extras&&P.setExtras(b.extras),b.material!==void 0&&P.setMaterial(a.materials[b.material]),b.mode!==void 0&&P.setMode(b.mode);for(const[$,N]of Object.entries(b.attributes||{}))P.setAttribute($,a.accessors[N]);b.indices!==void 0&&P.setIndices(a.accessors[b.indices]);const F=l.extras&&l.extras.targetNames||[];(b.targets||[]).forEach(($,N)=>{const D=F[N]||N.toString(),R=i.createPrimitiveTarget(D);for(const[A,z]of Object.entries($))R.setAttribute(A,a.accessors[z]);P.addTarget(R)}),m.addPrimitive(P)}),m});const w=r.cameras||[];a.cameras=w.map(l=>{const m=i.createCamera(l.name).setType(l.type);if(l.extras&&m.setExtras(l.extras),l.type===Ot.Type.PERSPECTIVE){const y=l.perspective;m.setYFov(y.yfov),m.setZNear(y.znear),y.zfar!==void 0&&m.setZFar(y.zfar),y.aspectRatio!==void 0&&m.setAspectRatio(y.aspectRatio)}else{const y=l.orthographic;m.setZNear(y.znear).setZFar(y.zfar).setXMag(y.xmag).setYMag(y.ymag)}return m});const g=r.nodes||[];i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.NODE)).forEach(l=>l.preread(a,V.NODE)),a.nodes=g.map(l=>{const m=i.createNode(l.name);if(l.extras&&m.setExtras(l.extras),l.translation!==void 0&&m.setTranslation(l.translation),l.rotation!==void 0&&m.setRotation(l.rotation),l.scale!==void 0&&m.setScale(l.scale),l.matrix!==void 0){const y=[0,0,0],b=[0,0,0,1],P=[1,1,1];me.decompose(l.matrix,y,b,P),m.setTranslation(y),m.setRotation(b),m.setScale(P)}return l.weights!==void 0&&m.setWeights(l.weights),m});const x=r.skins||[];a.skins=x.map(l=>{const m=i.createSkin(l.name);l.extras&&m.setExtras(l.extras),l.inverseBindMatrices!==void 0&&m.setInverseBindMatrices(a.accessors[l.inverseBindMatrices]),l.skeleton!==void 0&&m.setSkeleton(a.nodes[l.skeleton]);for(const y of l.joints)m.addJoint(a.nodes[y]);return m}),g.map((l,m)=>{const y=a.nodes[m];(l.children||[]).forEach(P=>y.addChild(a.nodes[P])),l.mesh!==void 0&&y.setMesh(a.meshes[l.mesh]),l.camera!==void 0&&y.setCamera(a.cameras[l.camera]),l.skin!==void 0&&y.setSkin(a.skins[l.skin])});const v=r.animations||[];a.animations=v.map(l=>{const m=i.createAnimation(l.name);l.extras&&m.setExtras(l.extras);const b=(l.samplers||[]).map(F=>{const j=i.createAnimationSampler().setInput(a.accessors[F.input]).setOutput(a.accessors[F.output]).setInterpolation(F.interpolation||hn.Interpolation.LINEAR);return F.extras&&j.setExtras(F.extras),m.addSampler(j),j});return(l.channels||[]).forEach(F=>{const j=i.createAnimationChannel().setSampler(b[F.sampler]).setTargetPath(F.target.path);F.target.node!==void 0&&j.setTargetNode(a.nodes[F.target.node]),F.extras&&j.setExtras(F.extras),m.addChannel(j)}),m});const E=r.scenes||[];return i.getRoot().listExtensionsUsed().filter(l=>l.prereadTypes.includes(V.SCENE)).forEach(l=>l.preread(a,V.SCENE)),a.scenes=E.map(l=>{const m=i.createScene(l.name);return l.extras&&m.setExtras(l.extras),(l.nodes||[]).map(b=>a.nodes[b]).forEach(b=>m.addChild(b)),m}),r.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[r.scene]),i.getRoot().listExtensionsUsed().forEach(l=>l.read(a)),O.forEach((l,m)=>{const y=a.accessors[m],b=!!l.sparse,P=!l.bufferView&&!y.getArray();(b||P)&&y.setSparse(!0).setArray(Lc(l,a))}),i}static validate(e,n){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const r of s.extensionsRequired)if(!n.extensions.find(i=>i.EXTENSION_NAME===r))throw new Error(`Missing required extension, "${r}".`)}if(s.extensionsUsed)for(const r of s.extensionsUsed)n.extensions.find(i=>i.EXTENSION_NAME===r)||n.logger.warn(`Missing optional extension, "${r}".`)}}function jc(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],i=Kn[t.componentType],a=J.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,f=t.byteOffset||0,p=new i(t.count*a),h=new DataView(s.buffer,s.byteOffset,s.byteLength),d=r.byteStride;for(let S=0;S<t.count;S++)for(let O=0;O<a;O++){const L=f+S*d+O*o;let M;switch(t.componentType){case J.ComponentType.FLOAT:M=h.getFloat32(L,!0);break;case J.ComponentType.UNSIGNED_INT:M=h.getUint32(L,!0);break;case J.ComponentType.UNSIGNED_SHORT:M=h.getUint16(L,!0);break;case J.ComponentType.UNSIGNED_BYTE:M=h.getUint8(L);break;case J.ComponentType.SHORT:M=h.getInt16(L,!0);break;case J.ComponentType.BYTE:M=h.getInt8(L);break;default:throw new Error(`Unexpected componentType "${t.componentType}".`)}p[S*a+O]=M}return p}function Nn(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],i=Kn[t.componentType],a=J.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,f=a*o;if(r.byteStride!==void 0&&r.byteStride!==f)return jc(t,e);const p=s.byteOffset+(t.byteOffset||0),h=t.count*a*o;return new i(s.buffer.slice(p,p+h))}function Lc(t,e){const n=Kn[t.componentType],s=J.getElementSize(t.type);let r;t.bufferView!==void 0?r=Nn(t,e):r=new n(t.count*s);const i=t.sparse;if(!i)return r;const a=i.count,o=Ce({},t,i.indices,{count:a,type:"SCALAR"}),f=Ce({},t,i.values,{count:a}),p=Nn(o,e),h=Nn(f,e);for(let d=0;d<o.count;d++)for(let S=0;S<s;S++)r[p[d]*s+S]=h[d*s+S];return r}var fn;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(fn||(fn={}));class wt{constructor(e,n,s){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=n,this.options=s;const r=e.getRoot(),i=r.listBuffers().length,a=r.listTextures().length;this.bufferURIGenerator=new ls(i>1,()=>s.basename||"buffer"),this.imageURIGenerator=new ls(a>1,o=>kc(e,o)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,n){const s={magFilter:n.getMagFilter()||void 0,minFilter:n.getMinFilter()||void 0,wrapS:n.getWrapS(),wrapT:n.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return n.getTexCoord()!==0&&(o.texCoord=n.getTexCoord()),Object.keys(n.getExtras()).length>0&&(o.extras=n.getExtras()),this.textureInfoDefMap.set(n,o),o}createPropertyDef(e){const n={};return e.getName()&&(n.name=e.getName()),Object.keys(e.getExtras()).length>0&&(n.extras=e.getExtras()),n}createAccessorDef(e){const n=this.createPropertyDef(e);return n.type=e.getType(),n.componentType=e.getComponentType(),n.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(r=>r.getName()==="attributes"&&r.getAttributes().key==="POSITION"||r.getName()==="input")&&(n.max=e.getMax([]).map(Math.fround),n.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(n.normalized=e.getNormalized()),n}createImageData(e,n,s){if(this.options.format===We.GLB)this.imageBufferViews.push(n),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:n.byteLength});else{const r=Et.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.assignResourceURI(e.uri,n,!1)}}assignResourceURI(e,n,s){const r=this.jsonDoc.resources;if(!(e in r)){r[e]=n;return}if(n===r[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const i=`Resource URI "${e}" already assigned to different data.`;if(!s){this.logger.warn(i);return}throw new Error(i)}getAccessorUsage(e){const n=this._accessorUsageMap.get(e);if(n)return n;if(e.getSparse())return _e.SPARSE;for(const s of this._doc.getGraph().listParentEdges(e)){const{usage:r}=s.getAttributes();if(r)return r;s.getParent().propertyType!==V.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return _e.OTHER}addAccessorToUsageGroup(e,n){const s=this._accessorUsageMap.get(e);if(s&&s!==n)throw new Error(`Accessor with usage "${s}" cannot be reused as "${n}".`);return this._accessorUsageMap.set(e,n),this}}wt.BufferViewTarget=fn;wt.BufferViewUsage=_e;wt.USAGE_TO_TARGET={[_e.ARRAY_BUFFER]:fn.ARRAY_BUFFER,[_e.ELEMENT_ARRAY_BUFFER]:fn.ELEMENT_ARRAY_BUFFER};class ls{constructor(e,n){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=n}createURI(e,n){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${n}`}else return`${this.basename(e)}.${n}`}}function kc(t,e){const n=t.getGraph().listParentEdges(e).find(s=>s.getParent()!==t.getRoot());return n?n.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Pn}=wt,{UNSIGNED_INT:$c,UNSIGNED_SHORT:Dc,UNSIGNED_BYTE:Uc}=J.ComponentType,Bc=new Set([V.ACCESSOR,V.BUFFER,V.MATERIAL,V.MESH]);class zc{static write(e,n){const s=e.getGraph(),r=e.getRoot(),i={asset:Ce({generator:`glTF-Transform ${qs}`},r.getAsset()),extras:Ce({},r.getExtras())},a={json:i,resources:{}},o=new wt(e,a,n),f=n.logger||ke.DEFAULT_INSTANCE,p=new Set(n.extensions.map(u=>u.EXTENSION_NAME)),h=e.getRoot().listExtensionsUsed().filter(u=>p.has(u.extensionName)).sort((u,w)=>u.extensionName>w.extensionName?1:-1),d=e.getRoot().listExtensionsRequired().filter(u=>p.has(u.extensionName)).sort((u,w)=>u.extensionName>w.extensionName?1:-1);h.length<e.getRoot().listExtensionsUsed().length&&f.warn("Some extensions were not registered for I/O, and will not be written.");for(const u of h){const w=u.prewriteTypes.filter(g=>!Bc.has(g));w.length&&f.warn(`Prewrite hooks for some types (${w.join()}), requested by extension ${u.extensionName}, are unsupported. Please file an issue or a PR.`);for(const g of u.writeDependencies)u.install(g,n.dependencies[g])}function S(u,w,g,x){const v=[];let E=0;for(const y of u){const b=o.createAccessorDef(y);b.bufferView=i.bufferViews.length;const P=y.getArray(),F=re.pad(re.toView(P));b.byteOffset=E,E+=F.byteLength,v.push(F),o.accessorIndexMap.set(y,i.accessors.length),i.accessors.push(b)}const l=re.concat(v),m={buffer:w,byteOffset:g,byteLength:l.byteLength};return x&&(m.target=x),i.bufferViews.push(m),{buffers:v,byteLength:E}}function O(u,w,g){const x=u[0].getCount();let v=0;for(const b of u){const P=o.createAccessorDef(b);P.bufferView=i.bufferViews.length,P.byteOffset=v;const F=b.getElementSize(),j=b.getComponentSize();v+=re.padNumber(F*j),o.accessorIndexMap.set(b,i.accessors.length),i.accessors.push(P)}const E=x*v,l=new ArrayBuffer(E),m=new DataView(l);for(let b=0;b<x;b++){let P=0;for(const F of u){const j=F.getElementSize(),$=F.getComponentSize(),N=F.getComponentType(),D=F.getArray();for(let R=0;R<j;R++){const A=b*v+P+R*$,z=D[b*j+R];switch(N){case J.ComponentType.FLOAT:m.setFloat32(A,z,!0);break;case J.ComponentType.BYTE:m.setInt8(A,z);break;case J.ComponentType.SHORT:m.setInt16(A,z,!0);break;case J.ComponentType.UNSIGNED_BYTE:m.setUint8(A,z);break;case J.ComponentType.UNSIGNED_SHORT:m.setUint16(A,z,!0);break;case J.ComponentType.UNSIGNED_INT:m.setUint32(A,z,!0);break;default:throw new Error("Unexpected component type: "+N)}}P+=re.padNumber(j*$)}}const y={buffer:w,byteOffset:g,byteLength:E,byteStride:v,target:wt.BufferViewTarget.ARRAY_BUFFER};return i.bufferViews.push(y),{byteLength:E,buffers:[new Uint8Array(l)]}}function L(u,w,g){const x=[];let v=0;const E=new Map;let l=-1/0,m=!1;for(const N of u){const D=o.createAccessorDef(N);i.accessors.push(D),o.accessorIndexMap.set(N,i.accessors.length-1);const R=[],A=[],z=[],q=new Array(N.getElementSize()).fill(0);for(let he=0,te=N.getCount();he<te;he++)if(N.getElement(he,z),!me.eq(z,q,0)){l=Math.max(he,l),R.push(he);for(let ie=0;ie<z.length;ie++)A.push(z[ie])}const G=R.length,ne={accessorDef:D,count:G};if(E.set(N,ne),G===0)continue;G>N.getCount()/2&&(m=!0);const ve=Kn[N.getComponentType()];ne.indices=R,ne.values=new ve(A)}if(!Number.isFinite(l))return{buffers:x,byteLength:v};m&&f.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const y=l<255?Uint8Array:l<65535?Uint16Array:Uint32Array,b=l<255?Uc:l<65535?Dc:$c,P={buffer:w,byteOffset:g+v,byteLength:0};for(const N of u){const D=E.get(N);if(D.count===0)continue;D.indicesByteOffset=P.byteLength;const R=re.pad(re.toView(new y(D.indices)));x.push(R),v+=R.byteLength,P.byteLength+=R.byteLength}i.bufferViews.push(P);const F=i.bufferViews.length-1,j={buffer:w,byteOffset:g+v,byteLength:0};for(const N of u){const D=E.get(N);if(D.count===0)continue;D.valuesByteOffset=j.byteLength;const R=re.pad(re.toView(D.values));x.push(R),v+=R.byteLength,j.byteLength+=R.byteLength}i.bufferViews.push(j);const $=i.bufferViews.length-1;for(const N of u){const D=E.get(N);D.count!==0&&(D.accessorDef.sparse={count:D.count,indices:{bufferView:F,byteOffset:D.indicesByteOffset,componentType:b},values:{bufferView:$,byteOffset:D.valuesByteOffset}})}return{buffers:x,byteLength:v}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=r.listTextures().map((u,w)=>{const g=o.createPropertyDef(u);u.getMimeType()&&(g.mimeType=u.getMimeType());const x=u.getImage();return x&&o.createImageData(g,x,u),o.imageIndexMap.set(u,w),g}),h.filter(u=>u.prewriteTypes.includes(V.ACCESSOR)).forEach(u=>u.prewrite(o,V.ACCESSOR)),r.listAccessors().forEach(u=>{const w=o.accessorUsageGroupedByParent,g=o.accessorParents;if(o.accessorIndexMap.has(u))return;const x=o.getAccessorUsage(u);if(o.addAccessorToUsageGroup(u,x),w.has(x)){const v=s.listParents(u).find(E=>E.propertyType!==V.ROOT);g.set(u,v)}}),h.filter(u=>u.prewriteTypes.includes(V.BUFFER)).forEach(u=>u.prewrite(o,V.BUFFER)),(r.listAccessors().length>0||o.otherBufferViews.size>0||r.listTextures().length>0&&n.format===We.GLB)&&r.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],r.listBuffers().forEach((u,w)=>{const g=o.createPropertyDef(u),x=o.accessorUsageGroupedByParent,v=u.listParents().filter(j=>j instanceof J),E=new Set(v.map(j=>o.accessorParents.get(j))),l=new Map(Array.from(E).map((j,$)=>[j,$])),m={};for(const j of v){var y;if(o.accessorIndexMap.has(j))continue;const $=o.getAccessorUsage(j);let N=$;if(x.has($)){const D=o.accessorParents.get(j);N+=`:${l.get(D)}`}m[y=N]||(m[y]={usage:$,accessors:[]}),m[N].accessors.push(j)}const b=[],P=i.buffers.length;let F=0;for(const{usage:j,accessors:$}of Object.values(m))if(j===Pn.ARRAY_BUFFER&&n.vertexLayout===$n.INTERLEAVED){const N=O($,P,F);F+=N.byteLength;for(const D of N.buffers)b.push(D)}else if(j===Pn.ARRAY_BUFFER)for(const N of $){const D=O([N],P,F);F+=D.byteLength;for(const R of D.buffers)b.push(R)}else if(j===Pn.SPARSE){const N=L($,P,F);F+=N.byteLength;for(const D of N.buffers)b.push(D)}else if(j===Pn.ELEMENT_ARRAY_BUFFER){const N=wt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,D=S($,P,F,N);F+=D.byteLength;for(const R of D.buffers)b.push(R)}else{const N=S($,P,F);F+=N.byteLength;for(const D of N.buffers)b.push(D)}if(o.imageBufferViews.length&&w===0){for(let j=0;j<o.imageBufferViews.length;j++)if(i.bufferViews[i.images[j].bufferView].byteOffset=F,F+=o.imageBufferViews[j].byteLength,b.push(o.imageBufferViews[j]),F%8){const $=8-F%8;F+=$,b.push(new Uint8Array($))}}if(o.otherBufferViews.has(u))for(const j of o.otherBufferViews.get(u))i.bufferViews.push({buffer:P,byteOffset:F,byteLength:j.byteLength}),o.otherBufferViewsIndexMap.set(j,i.bufferViews.length-1),F+=j.byteLength,b.push(j);if(F){let j;n.format===We.GLB?j=kn:(j=o.bufferURIGenerator.createURI(u,"bin"),g.uri=j),g.byteLength=F,o.assignResourceURI(j,re.concat(b),!0)}i.buffers.push(g),o.bufferIndexMap.set(u,w)}),r.listAccessors().find(u=>!u.getBuffer())&&f.warn("Skipped writing one or more Accessors: no Buffer assigned."),h.filter(u=>u.prewriteTypes.includes(V.MATERIAL)).forEach(u=>u.prewrite(o,V.MATERIAL)),i.materials=r.listMaterials().map((u,w)=>{const g=o.createPropertyDef(u);if(u.getAlphaMode()!==Tt.AlphaMode.OPAQUE&&(g.alphaMode=u.getAlphaMode()),u.getAlphaMode()===Tt.AlphaMode.MASK&&(g.alphaCutoff=u.getAlphaCutoff()),u.getDoubleSided()&&(g.doubleSided=!0),g.pbrMetallicRoughness={},me.eq(u.getBaseColorFactor(),[1,1,1,1])||(g.pbrMetallicRoughness.baseColorFactor=u.getBaseColorFactor()),me.eq(u.getEmissiveFactor(),[0,0,0])||(g.emissiveFactor=u.getEmissiveFactor()),u.getRoughnessFactor()!==1&&(g.pbrMetallicRoughness.roughnessFactor=u.getRoughnessFactor()),u.getMetallicFactor()!==1&&(g.pbrMetallicRoughness.metallicFactor=u.getMetallicFactor()),u.getBaseColorTexture()){const x=u.getBaseColorTexture(),v=u.getBaseColorTextureInfo();g.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(x,v)}if(u.getEmissiveTexture()){const x=u.getEmissiveTexture(),v=u.getEmissiveTextureInfo();g.emissiveTexture=o.createTextureInfoDef(x,v)}if(u.getNormalTexture()){const x=u.getNormalTexture(),v=u.getNormalTextureInfo(),E=o.createTextureInfoDef(x,v);u.getNormalScale()!==1&&(E.scale=u.getNormalScale()),g.normalTexture=E}if(u.getOcclusionTexture()){const x=u.getOcclusionTexture(),v=u.getOcclusionTextureInfo(),E=o.createTextureInfoDef(x,v);u.getOcclusionStrength()!==1&&(E.strength=u.getOcclusionStrength()),g.occlusionTexture=E}if(u.getMetallicRoughnessTexture()){const x=u.getMetallicRoughnessTexture(),v=u.getMetallicRoughnessTextureInfo();g.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(x,v)}return o.materialIndexMap.set(u,w),g}),h.filter(u=>u.prewriteTypes.includes(V.MESH)).forEach(u=>u.prewrite(o,V.MESH)),i.meshes=r.listMeshes().map((u,w)=>{const g=o.createPropertyDef(u);let x=null;return g.primitives=u.listPrimitives().map(v=>{const E={attributes:{}};E.mode=v.getMode();const l=v.getMaterial();l&&(E.material=o.materialIndexMap.get(l)),Object.keys(v.getExtras()).length&&(E.extras=v.getExtras());const m=v.getIndices();m&&(E.indices=o.accessorIndexMap.get(m));for(const y of v.listSemantics())E.attributes[y]=o.accessorIndexMap.get(v.getAttribute(y));for(const y of v.listTargets()){const b={};for(const P of y.listSemantics())b[P]=o.accessorIndexMap.get(y.getAttribute(P));E.targets=E.targets||[],E.targets.push(b)}return v.listTargets().length&&!x&&(x=v.listTargets().map(y=>y.getName())),E}),u.getWeights().length&&(g.weights=u.getWeights()),x&&(g.extras=g.extras||{},g.extras.targetNames=x),o.meshIndexMap.set(u,w),g}),i.cameras=r.listCameras().map((u,w)=>{const g=o.createPropertyDef(u);if(g.type=u.getType(),g.type===Ot.Type.PERSPECTIVE){g.perspective={znear:u.getZNear(),zfar:u.getZFar(),yfov:u.getYFov()};const x=u.getAspectRatio();x!==null&&(g.perspective.aspectRatio=x)}else g.orthographic={znear:u.getZNear(),zfar:u.getZFar(),xmag:u.getXMag(),ymag:u.getYMag()};return o.cameraIndexMap.set(u,w),g}),i.nodes=r.listNodes().map((u,w)=>{const g=o.createPropertyDef(u);return me.eq(u.getTranslation(),[0,0,0])||(g.translation=u.getTranslation()),me.eq(u.getRotation(),[0,0,0,1])||(g.rotation=u.getRotation()),me.eq(u.getScale(),[1,1,1])||(g.scale=u.getScale()),u.getWeights().length&&(g.weights=u.getWeights()),o.nodeIndexMap.set(u,w),g}),i.skins=r.listSkins().map((u,w)=>{const g=o.createPropertyDef(u),x=u.getInverseBindMatrices();x&&(g.inverseBindMatrices=o.accessorIndexMap.get(x));const v=u.getSkeleton();return v&&(g.skeleton=o.nodeIndexMap.get(v)),g.joints=u.listJoints().map(E=>o.nodeIndexMap.get(E)),o.skinIndexMap.set(u,w),g}),r.listNodes().forEach((u,w)=>{const g=i.nodes[w],x=u.getMesh();x&&(g.mesh=o.meshIndexMap.get(x));const v=u.getCamera();v&&(g.camera=o.cameraIndexMap.get(v));const E=u.getSkin();E&&(g.skin=o.skinIndexMap.get(E)),u.listChildren().length>0&&(g.children=u.listChildren().map(l=>o.nodeIndexMap.get(l)))}),i.animations=r.listAnimations().map((u,w)=>{const g=o.createPropertyDef(u),x=new Map;return g.samplers=u.listSamplers().map((v,E)=>{const l=o.createPropertyDef(v);return l.input=o.accessorIndexMap.get(v.getInput()),l.output=o.accessorIndexMap.get(v.getOutput()),l.interpolation=v.getInterpolation(),x.set(v,E),l}),g.channels=u.listChannels().map(v=>{const E=o.createPropertyDef(v);return E.sampler=x.get(v.getSampler()),E.target={node:o.nodeIndexMap.get(v.getTargetNode()),path:v.getTargetPath()},E}),o.animationIndexMap.set(u,w),g}),i.scenes=r.listScenes().map((u,w)=>{const g=o.createPropertyDef(u);return g.nodes=u.listChildren().map(x=>o.nodeIndexMap.get(x)),o.sceneIndexMap.set(u,w),g});const T=r.getDefaultScene();return T&&(i.scene=r.listScenes().indexOf(T)),i.extensionsUsed=h.map(u=>u.extensionName),i.extensionsRequired=d.map(u=>u.extensionName),h.forEach(u=>u.write(o)),Vc(i),a}}function Vc(t){const e=[];for(const n in t){const s=t[n];(Array.isArray(s)&&s.length===0||s===null||s===""||s&&typeof s=="object"&&Object.keys(s).length===0)&&e.push(n)}for(const n of e)delete t[n]}var Un;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Un||(Un={}));class Hc{constructor(){this._logger=ke.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=$n.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const n of e)this._extensions.add(n),n.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const n=await this.readURI(e,"view");this.lastReadBytes=n.byteLength;const s=cs(n)?this._binaryToJSON(n):{json:JSON.parse(re.decodeText(n)),resources:{}};return await this._readResourcesExternal(s,this.dirname(e)),this._readResourcesInternal(s),s}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Fc.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const n=this._binaryToJSON(re.assertView(e));this._readResourcesInternal(n);const s=n.json;if(s.buffers&&s.buffers.some(r=>Kc(n,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(r=>Gc(n,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return n}async readBinary(e){return this.readJSON(await this.binaryToJSON(re.assertView(e)))}async writeJSON(e,n={}){if(n.format===We.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return zc.write(e,{format:n.format||We.GLTF,basename:n.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:Ce({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:n,resources:s}=await this.writeJSON(e,{format:We.GLB}),r=new Uint32Array([1179937895,2,12]),i=JSON.stringify(n),a=re.pad(re.encodeText(i),32),o=re.toView(new Uint32Array([a.byteLength,1313821514])),f=re.concat([o,a]);r[r.length-1]+=f.byteLength;const p=Object.values(s)[0];if(!p||!p.byteLength)return re.concat([re.toView(r),f]);const h=re.pad(p,0),d=re.toView(new Uint32Array([h.byteLength,5130562])),S=re.concat([d,h]);return r[r.length-1]+=S.byteLength,re.concat([re.toView(r),f,S])}async _readResourcesExternal(e,n){var s=this;const r=e.json.images||[],i=e.json.buffers||[],a=[...r,...i].map(async function(o){const f=o.uri;if(!f||f.match(/data:/))return Promise.resolve();e.resources[f]=await s.readURI(s.resolve(n,f),"view"),s.lastReadBytes+=e.resources[f].byteLength});await Promise.all(a)}_readResourcesInternal(e){function n(i){if(i.uri){if(i.uri in e.resources){re.assertView(e.resources[i.uri]);return}if(i.uri.match(/data:/)){const a=`__${Rc()}.${St.extension(i.uri)}`;e.resources[a]=re.createBufferFromDataURI(i.uri),i.uri=a}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");n(i)}),(e.json.buffers||[]).forEach(n)}_copyJSON(e){const{images:n,buffers:s}=e.json;return e={json:Ce({},e.json),resources:Ce({},e.resources)},n&&(e.json.images=n.map(r=>Ce({},r))),s&&(e.json.buffers=s.map(r=>Ce({},r))),e}_binaryToJSON(e){if(!cs(e))throw new Error("Invalid glTF 2.0 binary.");const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==Un.JSON)throw new Error("Missing required GLB JSON chunk.");const s=20,r=n[0],i=re.decodeText(re.toView(e,s,r)),a=JSON.parse(i),o=s+r;if(e.byteLength<=o)return{json:a,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+o,2);if(f[1]!==Un.BIN)return{json:a,resources:{}};const p=f[0],h=re.toView(e,o+8,p);return{json:a,resources:{[kn]:h}}}}function Kc(t,e){return e.uri!==void 0&&!(e.uri in t.resources)}function Gc(t,e){return e.uri!==void 0&&!(e.uri in t.resources)&&e.bufferView===void 0}function cs(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Wc extends Hc{constructor(e=null,n=Ue.DEFAULT_INIT){super(),this._fetch=void 0,this._fetchConfig=void 0,this._init=void 0,this._fetchEnabled=!1,this._fetch=e,this._fetchConfig=n,this._init=this.init()}async init(){return this._init?this._init:Promise.all([Tr(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),Tr(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])]).then(([e,n])=>{this._fs=e.promises,this._path=n})}setAllowNetwork(e){if(e&&!this._fetch)throw new Error("NodeIO requires a Fetch API implementation for HTTP requests.");return this._fetchEnabled=e,this}async readURI(e,n){if(await this.init(),Ue.isAbsoluteURL(e)){if(!this._fetchEnabled||!this._fetch)throw new Error("Network request blocked. Allow HTTP requests explicitly, if needed.");const s=await this._fetch(e,this._fetchConfig);switch(n){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}else switch(n){case"view":return this._fs.readFile(e);case"text":return this._fs.readFile(e,"utf8")}}resolve(e,n){return Ue.isAbsoluteURL(e)||Ue.isAbsoluteURL(n)?Ue.resolve(e,n):this._path.resolve(e,decodeURIComponent(n))}dirname(e){return Ue.isAbsoluteURL(e)?Ue.dirname(e):this._path.dirname(e)}async write(e,n){await this.init(),await(!!e.match(/\.glb$/)?this._writeGLB(e,n):this._writeGLTF(e,n))}async _writeGLTF(e,n){var s=this;this.lastWriteBytes=0;const{json:r,resources:i}=await this.writeJSON(n,{format:We.GLTF,basename:St.basename(e)}),{_fs:a,_path:o}=this,f=o.dirname(e),p=JSON.stringify(r,null,2);await a.writeFile(e,p),this.lastWriteBytes+=p.length;for(const h of qc(Object.keys(i),10))await Promise.all(h.map(async function(d){if(Ue.isAbsoluteURL(d)){if(Ue.extension(d)==="bin")throw new Error(`Cannot write buffer to path "${d}".`);return}const S=o.join(f,decodeURIComponent(d));await a.mkdir(o.dirname(S),{recursive:!0}),await a.writeFile(S,i[d]),s.lastWriteBytes+=i[d].byteLength}))}async _writeGLB(e,n){const s=await this.writeBinary(n);await this._fs.writeFile(e,s),this.lastWriteBytes=s.byteLength}}function qc(t,e){const n=[];for(let s=0,r=t.length;s<r;s+=e){const i=[];for(let a=0;a<e&&s+a<r;a++)i.push(t[s+a]);n.push(i)}return n}const Yc=[79/255,209/255,197/255,1];function An(t,e=1){let n=t.replace(/^#/,"");n.length===3?n=n.split("").map(o=>o+o).join(""):n.length===4&&(n=n.split("").map(o=>o+o).join(""));let s=0,r=0,i=0,a=e;if(n.length===6)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255;else if(n.length===8)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255,a=parseInt(n.slice(6,8),16)/255;else throw new Error("Invalid hex color format");return[s,r,i,a]}function Jc(t,e,{positions:n,indices:s,colors:r}){const i=t.createPrimitive().setMode(gn.Mode.TRIANGLES).setMaterial(t.createMaterial().setDoubleSided(!0).setAlphaMode(e[3]<1?"BLEND":"OPAQUE").setMetallicFactor(0).setRoughnessFactor(.8).setBaseColorFactor(e)).setAttribute("POSITION",t.createAccessor().setType(J.Type.VEC3).setArray(n)).setIndices(t.createAccessor().setType(J.Type.SCALAR).setArray(s));return r&&i.setAttribute("COLOR_0",t.createAccessor().setType(J.Type.VEC3).setArray(r)),i}function Xc(t){const e=new Float32Array(t.vertices.length*3),n=new Uint32Array(t.faces.length*3),s=new Map;let r=0;const i=a=>{let o=s.get(a);if(o===void 0){const f=r*3,p=t.vertices[a];e[f]=p.x,e[f+1]=p.y,e[f+2]=p.z,o=r++,s.set(a,o)}return o};return t.faces.forEach((a,o)=>{const{vertices:f}=a;if(f.length<3)throw new Error("Face must have at least 3 vertices");const p=o*3;n[p]=i(f[0]),n[p+1]=i(f[1]),n[p+2]=i(f[2])}),{positions:e.slice(0,r*3),indices:n}}async function Zc(t,e=!1){const n=[[.615686274509804,.796078431372549,.3176470588235294,1],[.9764705882352941,.8431372549019608,.17254901960784313,1]],s=e?[An("#322"),An("#222")]:[An("#efdfdf"),An("#fff")],r=t.colors.map(h=>{for(let d=0;d<n.length;++d)if(h.length===4&&Math.abs(h[0]-n[d][0])<1e-6&&Math.abs(h[1]-n[d][1])<1e-6&&Math.abs(h[2]-n[d][2])<1e-6&&Math.abs(h[3]-n[d][3])<1e-6)return s[d];return h}),i=new Ut;i.createBuffer();const a=i.createScene(),o=i.createMesh(),f=new Map;t.faces.forEach(h=>{let d=f.get(h.colorIndex);d||f.set(h.colorIndex,d=[]),d.push(h)});for(const[h,d]of f.entries()){const S=r[h];o.addPrimitive(Jc(i,S,Xc({vertices:t.vertices,faces:d})))}a.addChild(i.createNode().setMesh(o));const p=await new Wc().writeBinary(i);return new Blob([p],{type:"model/gltf-binary"})}const us=`
/* [Meta] */
title = "OpenSCAD Demo";
show_text = true;
debug = true;

/* [Plate Settings] */
// Plate size (mm)
plate_size = 40;          // [20:1:80]
// Plate thickness
thickness  = 6;           // [2:0.5:20]
// Corner rounding
fillet     = 3;           // [0:0.5:10]

/* [Holes] */
// Number of holes
hole_count   = 6;         // [0:1:12]
// Hole diameter
hole_d       = 4;         // [2:0.5:10]
// Hole pattern
hole_pattern = "circle";  // ["circle", "grid"]

/* [Quality] */
$fs = $preview ? 1   : 0.2;
$fa = $preview ? 15  : 5;


/* ---------- Helpers ---------- */

module label(txt) {
    if (show_text)
        color("pink")
            translate([0, -plate_size/2 - 8, thickness])
                linear_extrude(1)
                    text(txt, size=6, halign="center");
}


/* ---------- Geometry ---------- */

module holes_2d() {
    if (hole_pattern == "circle")
        for (i = [0 : hole_count - 1])
            rotate(360 / hole_count * i)
                translate([plate_size / 3, 0])
                    circle(d = hole_d);
    else
        for (x = [-1, 0, 1], y = [-1, 0, 1])
            translate([x * plate_size / 4, y * plate_size / 4])
                circle(d = hole_d);
}

module plate_2d() {
    difference() {
        offset(r = fillet)
            square(plate_size - 2 * fillet, center = true);
        holes_2d();
    }
}


/* ---------- Output ---------- */

color("steelblue")
difference() {
    linear_extrude(thickness)
        plate_2d();

    // Debug cutaway
    if (debug)
        translate([0, 0, thickness/2])
            cube([plate_size, plate_size/2, thickness+1], center=true);
}

label(title);

`;function fs(t){const e=t.split(`
`).map(h=>h.trim()).filter(h=>h.length>0&&!h.startsWith("#"));if(e.length===0)throw new Error("Empty OFF file");let n,s=0;if(e[0].match(/^OFF(\s|$)/))n=e[0].substring(3).trim(),s=1;else if(e[s]==="OFF"&&e.length>1)n=e[1],s=2;else throw new Error("Invalid OFF file: missing OFF header");const[r,i]=n.split(/\s+/).map(Number);if(isNaN(r)||isNaN(i))throw new Error("Invalid OFF file: invalid vertex or face counts");if(s+r+i>e.length)throw new Error("Invalid OFF file: not enough lines");const a=[];for(let h=0;h<r;h++){const d=e[s+h].split(/\s+/).map(Number);if(d.length<3||d.some(isNaN))throw new Error(`Invalid OFF file: invalid vertex at line ${s+h+1}`);a.push({x:d[0],y:d[1],z:d[2]})}s+=r;const o=[],f=new Map,p=[];for(let h=0;h<i;h++){const d=e[s+h].split(/\s+/).map(Number),S=d[0],O=d.slice(1,S+1),L=d.length>=S+4?d.slice(S+1,S+5).map(u=>u/255):Yc;if(O.length<3)throw new Error(`Invalid OFF file: face at line ${s+h+1} must have at least 3 vertices`);const M=L?L.join(","):"";let T=f.get(M);if(T==null){T=o.length;const[u,w,g,x]=L;o.push([u,w,g,x??1]),f.set(M,T)}if(O.length==3)p.push({vertices:O,colorIndex:T});else for(let u=1;u<O.length-1;u++)p.push({vertices:[O[0],O[u],O[u+1]],colorIndex:T})}return{vertices:a,faces:p,colors:o}}function Qc(t,e,n){const s=e.x-t.x,r=e.y-t.y,i=e.z-t.z,a=n.x-t.x,o=n.y-t.y,f=n.z-t.z;return{x:r*f-i*o,y:i*a-s*f,z:s*o-r*a}}async function eu(t){let e=`solid polyhedron
`;for(const n of t.faces){const[s,r,i]=n.vertices,a=t.vertices[s],o=t.vertices[r],f=t.vertices[i],p=Qc(a,o,f);e+=`  facet normal ${p.x} ${p.y} ${p.z}
`,e+=`    outer loop
`,e+=`      vertex ${a.x} ${a.y} ${a.z}
`,e+=`      vertex ${o.x} ${o.y} ${o.z}
`,e+=`      vertex ${f.x} ${f.y} ${f.z}
`,e+=`    endloop
`,e+=`  endfacet
`}return e+=`endsolid polyhedron
`,new Blob([e],{type:"model/stl"})}const tu="editor-page-container_EditorPage",nu="sidebar_EditorPage",ru="main_EditorPage",su="main-sub_EditorPage",iu="panel-editor_EditorPage",ou="panel-logs_EditorPage",au="model-viewer-container_EditorPage",lu="model-viewer_EditorPage",et={editorPageContainer:tu,sidebar:nu,main:ru,mainSub:su,panelEditor:iu,panelLogs:ou,modelViewerContainer:au,modelViewer:lu};function xu({viewModelId:t}){const{modelId:e}=Ai();e&&(t=e);const[n,s]=Ni(),{user:r}=hs(),i=ji("readonly")!==null,[a,o]=c.useState(void 0),[f,p]=c.useState(void 0),h=t??"new",[d,S]=c.useState(void 0),[O,L]=c.useState(void 0),[M,T]=c.useState(void 0),[u,w]=c.useState(void 0),[g,x]=c.useState(void 0),[v,E]=c.useState(void 0),[l,m]=c.useState(!1),[y,b]=c.useState(!1),[P,F]=c.useState(!0),[j,$]=c.useState(!1),[N,D]=c.useState(void 0),[R,A]=c.useState(void 0),[z,q]=c.useState({}),[G,ne]=c.useState(!1),[ve,he]=c.useState(null),[te,ie]=c.useState(t!==void 0?0:1),Ie=c.useRef(null),ze=c.useRef(null),qe=c.useRef(!1),[Ye,at]=c.useState(0),Je=c.useRef(z);c.useEffect(()=>{Je.current=z},[z]);const we=c.useCallback(()=>`/src/${h}/index.scad`,[h]),$e=c.useCallback(async U=>{try{const B=we();if(h=="new")er(B,us,!1);else if(!gt(B)&&U!==void 0)er(B,U.source_code,!0);else if(U!==void 0){const ae=yn(B);await Li(ae)!=U.source_code_hash&&$(!0)}}catch(B){console.error(B)}},[h,we]),ye=c.useCallback(async()=>{w("Checking Syntax...");try{const U=we(),B=yn(U),Te=await Xi({activePath:U,sources:[{path:U,content:B}]})({now:!0});Te.parameterSet&&D(Te.parameterSet),Te.markers&&A(Te.markers)}catch(U){x(U?.message||String(U))}finally{w(void 0)}},[]),Ke=U=>async()=>{w(U?"Previewing...":"Rendering..."),x(void 0),E(void 0);try{const B=we();let ae=yn(B);const ee={scadPath:B,sources:[{path:B,content:ae}],vars:Je.current,isPreview:U,mountArchives:!0,renderFormat:"off",streamsCallback:X=>{"stderr"in X&&E(de=>(de?de+`
`:"")+X.stderr),"stdout"in X&&E(de=>(de?de+`
`:"")+X.stdout)}},C=await Qi(ee)({now:!0});O&&URL.revokeObjectURL(O),L(URL.createObjectURL(C.outFile));let H;try{const X=fs(await C.outFile.text());H=new File([await Zc(X)],C.outFile.name.replace(".off",".glb"))}catch(X){x("Failed to convert OFF to GLB: "+X),w(void 0);return}d&&URL.revokeObjectURL(d),S(URL.createObjectURL(H))}catch(B){x(B?.message||String(B))}finally{w(void 0)}},Ee=c.useCallback(Ke(!0),[z]),Pe=c.useCallback(Ke(!1),[z]),Xe=Hs(Ee,1e3),Ve=async()=>{if(!ze.current)return;const U=await ze.current.getWebpScreenshot();if(!U){x("Failed to capture screenshot for publish.");return}he(U),ne(!0)},Ze=async()=>{if(!(!r||!ve||!f)){ne(!1),Ie.current?.show({severity:"info",summary:"Uploading...",life:5e3});try{const B=await(await fetch(ve)).blob(),ae=new File([B],`${Date.now()}.webp`,{type:"image/webp"}),Te=yn(we());await Zt.uploadModel(ae,Te,f),Ie.current?.clear(),Ie.current?.show({severity:"success",summary:"Published",detail:"Model published successfully!",life:3e3})}catch(U){Ie.current?.clear(),Ie.current?.show({severity:"error",summary:"Publish Failed",detail:U.message||String(U),life:4e3})}finally{ne(!1),he(null)}}},Oe=()=>{ne(!1),he(null)},lt=async()=>{let U=us;const B=we();if(h!=="new"&&(U=await Zt.fetchModelSource(h),U===void 0))throw new Error("Failed to fetch model source");er(B,U,!0),at(ae=>ae+1)},le=c.useCallback(async()=>{if(console.debug("Fetching model details...",t),t){const U=await Zt.fetchModelById(t);return o(U),p({id:U?.id,title:U?.title??"Untitled Model",description:U?.description??""}),U}else{p({id:void 0,title:"Untitled Model",description:""});return}},[]);c.useEffect(()=>(qe.current||(qe.current=!0,(async()=>{const U=await le();await Ui(!0),await $e(U),await Promise.all([ye(),Ee()]),F(!1)})()),()=>{d&&URL.revokeObjectURL(d),O&&URL.revokeObjectURL(O),M&&URL.revokeObjectURL(M)}),[ye,le,$e,Ee]);function k(U,B){const ae=document.createElement("a");ae.href=U,ae.download=B,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae)}const Y=c.useCallback(async()=>{try{if(M&&URL.revokeObjectURL(M),!O)throw new Error("No OFF file to convert");const U=await(await fetch(O)).text(),B=fs(U),ae=await eu(B),Te=Q()+".stl",ee=URL.createObjectURL(ae);k(ee,Te),setTimeout(()=>URL.revokeObjectURL(ee),1e3),T(void 0)}catch(U){console.error(U)}},[O]);c.useEffect(()=>{const U=B=>{B.key==="F4"?(B.preventDefault(),ye()):B.key==="F5"?(B.preventDefault(),Ee()):B.key==="F6"?(B.preventDefault(),Pe()):B.key==="F7"?(B.preventDefault(),Y()):B.key==="F8"&&(B.preventDefault(),Ve())};return window.addEventListener("keydown",U),()=>{window.removeEventListener("keydown",U)}},[O]);function Q(){return a?.title??f?.title??"Untitled Model"}async function fe(){$(!0),await Promise.all([ye(),n.autoPreview?Ee():Promise.resolve()])}const Se=!i&&(a===void 0||a?.owner_id===r?.id)&&f!==void 0;return _.jsxs(_.Fragment,{children:[_.jsxs("div",{className:et.editorPageContainer,style:{flexDirection:l?"column":void 0},children:[_.jsxs("div",{className:et.sidebar,children:[_.jsxs("div",{className:et.modelViewerContainer,children:[_.jsx("div",{className:et.modelViewer,children:d?_.jsx(yo,{ref:ze,lightMode:y,style:{width:"100%",height:"100%"},modelUri:d}):_.jsx(Dt,{text:"Waiting for model to render"})}),_.jsx(Rr,{model:[l?{label:"Smaller Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-minimize",command:()=>m(!1)}:{label:"Larger Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-maximize",command:()=>m(!0)},y?{label:"Dark Mode",icon:"pi pi-moon",command:()=>b(!1)}:{label:"Light Mode",icon:"pi pi-sun",command:()=>b(!0)},{label:"Download",icon:"pi pi-download",items:[{label:"GLB",icon:"pi pi-download",disabled:!d,command:()=>{d&&k(d,Q()+".glb")}},{label:"OFF",icon:"pi pi-download",disabled:!O,command:()=>{O&&k(O,Q()+".off")}},{label:"STL (F7)",icon:"pi pi-download",disabled:!O,command:Y}]}]})]}),Se?_.jsx(mt,{children:_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"max-content 1fr",gap:12,alignItems:"center",marginBottom:8},children:[_.jsx("label",{htmlFor:"edit-title",style:{whiteSpace:"nowrap"},children:_.jsx("b",{children:"Title"})}),_.jsx(ps,{id:"edit-title",maxLength:100,value:f.title,onChange:U=>p(B=>({...B,title:U.target.value})),placeholder:"Enter model title"}),_.jsx("label",{htmlFor:"edit-description",style:{whiteSpace:"nowrap"},children:_.jsx("b",{children:"Description"})}),_.jsx(xr,{id:"edit-description",maxLength:2e3,value:f.description,onChange:U=>p(B=>({...B,description:U.target.value})),placeholder:"Enter model description",style:{resize:"vertical"}})]})}):a!==void 0?_.jsx(mt,{toggleable:!0,header:a.title,children:_.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[_.jsx("div",{dangerouslySetInnerHTML:{__html:bs(a.description)}}),_.jsxs("span",{children:["by ",_.jsx("a",{href:"#/user/"+a.username,children:a.username})," on"," ",a.created_at]}),_.jsx("span",{children:_.jsx(Hi,{model:a})})]})}):_.jsx(_.Fragment,{}),a?_.jsx(ma,{modelId:a?.id,collapsed:!n.commentsPanelExpanded,onToggle:U=>s({commentsPanelExpanded:!U.value})}):""]}),_.jsxs("div",{className:et.main,children:[_.jsxs("div",{className:et.mainSub,children:[_.jsx(mt,{toggleable:!0,header:"Customizer",children:_.jsx(oa,{parameterSet:N,parameterValues:z,onChange:(U,B)=>{q(ae=>({...ae,[U]:B})),n.autoPreview&&Xe()}})}),_.jsxs(mt,{className:et.panelLogs,toggleable:!0,header:"Logs & Errors",collapsed:!n.logsPanelExpanded,onToggle:U=>s({logsPanelExpanded:!U.value}),children:[g&&_.jsx("pre",{style:{color:"var(--color-danger)"},children:g}),v&&_.jsx("pre",{children:v}),!g&&!v&&_.jsx("pre",{children:"No logs or errors yet."})]})]}),_.jsxs(mt,{className:et.panelEditor,children:[_.jsx(Rr,{style:{width:"100%"},model:[{label:"Preview (F5)",icon:"pi pi-play",command:Ee,disabled:u!==void 0},{label:"Render (F6)",icon:"pi pi-play",command:Pe,disabled:u!==void 0},{label:"Publish (F8)",icon:"pi pi-upload",command:Ve,disabled:u!==void 0||r?.id===void 0,visible:a===void 0||a?.owner_id===r?.id},{label:"Overwrite with remote source",icon:"pi pi-download color-danger",command:lt,disabled:u!==void 0,visible:j},{icon:n.autoPreview?"pi pi-check-square":"pi pi-stop",label:"Auto-Preview",disabled:!1,command:()=>{s({autoPreview:!n.autoPreview})}}],end:_.jsx("div",{style:{display:"flex",gap:8},children:u!==void 0&&_.jsxs(_.Fragment,{children:[_.jsx("div",{style:{flex:1,alignContent:"center"},children:u}),_.jsx(_i,{style:{width:40,height:40},strokeWidth:"8"})]})})}),_.jsx(uc,{isInitializing:P,path:we(),homeFileProp:we(),hideTopBar:!0,markers:R,onSave:U=>fe(),reloadKey:Ye})]})]})]}),_.jsx(Gi,{header:"Publish Model",visible:G,onHide:Oe,footer:_.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[_.jsx(nn,{label:"Cancel",icon:"pi pi-times",onClick:Oe,className:"p-button-text"}),_.jsx(nn,{label:"Publish",icon:"pi pi-upload",onClick:Ze,autoFocus:!0})]}),closable:!1,modal:!0,children:f!==void 0&&_.jsx(Ki,{model:{id:"",title:f.title,preview_url:ve??"",owner_id:r?.id||"",username:r?.user_metadata?.user_name||r?.user_metadata?.name||r?.email||"Unknown User",description:f.description,created_at:ir(new Date),updated_at:ir(new Date),likes:0,comments:0}})}),_.jsx(ds,{ref:Ie,position:"top-right"})]})}export{xu as default};
