{"version":3,"file":"ModelGallery-BlWSKUVo.js","sources":["../../src/pages/ModelGallery.tsx"],"sourcesContent":["import React, { CSSProperties, useEffect, useState } from 'react';\nimport {\n  SupabaseService,\n  ViewModel,\n  ViewModelFilterCriteria,\n} from '../services/SupabaseService.ts';\nimport { ModelCard } from '../components/ModelCard';\nimport { Paginator } from 'primereact/paginator';\nimport { Badge } from 'primereact/badge';\nimport { CenteredSpinner } from '../components/CenteredSpinner.tsx';\nimport { useParams } from 'react-router-dom';\n\nexport interface ModelGalleryProps {\n  filter?: ViewModelFilterCriteria;\n  style?: CSSProperties;\n  pageSize?: number;\n  pagination?: boolean;\n}\n\nexport default function ModelGallery({\n  filter,\n  style,\n  pageSize = 20,\n  pagination = true,\n}: ModelGalleryProps) {\n  const { tag } = useParams();\n  if (tag) filter = { ...filter, tag };\n\n  const [models, setModels] = useState<ViewModel[]>([]);\n  const [total, setTotal] = useState<number>(0);\n  const [first, setFirst] = useState<number>(0);\n  const [loading, setLoading] = useState(true);\n  const [visibleTags, setVisibleTags] = useState<{ tag: string; count: number }[]>([]);\n\n  useEffect(() => {\n    async function loadModels() {\n      const { models, total } = await SupabaseService.fetchModels(filter, first, pageSize);\n      setModels(models);\n      setTotal(total);\n      // Count occurrences of each tag\n      const tagCounts: Record<string, number> = {};\n      models.forEach((model) => {\n        (model.tags || []).forEach((tag) => {\n          tagCounts[tag] = (tagCounts[tag] || 0) + 1;\n        });\n      });\n      // Convert to array and sort by count descending, then alphabetically\n      const sortedTags = Object.entries(tagCounts)\n        .map(([tag, count]) => ({ key: tag, tag, count }))\n        .sort((a, b) => b.count - a.count || a.tag.localeCompare(b.tag));\n      setVisibleTags(sortedTags);\n      setLoading(false);\n    }\n\n    loadModels();\n  }, [first, pageSize, filter]);\n\n  function renderGalleryHeading(filter: ViewModelFilterCriteria | undefined) {\n    if (!filter) return <></>;\n    const wrap = (s: string) => <span style={{ color: 'var(--theme-color)' }}>{s}</span>;\n    const heading: React.ReactNode[] = [<>Models</>];\n    if (filter.tag) heading.push(<> tagged with {wrap(filter.tag)}</>);\n    if (filter.author) heading.push(<> authored by {wrap(filter.author)}</>);\n    if (filter.likedByUsername) heading.push(<> liked by {wrap(filter.likedByUsername)}</>);\n    if (filter.commentedByUsername)\n      heading.push(<> commented by {wrap(filter.commentedByUsername)}</>);\n    if (filter.searchTerm) heading.push(<> containing {wrap(filter.searchTerm)}</>);\n    return (\n      <h1 style={{ flex: 0, marginLeft: 'auto', marginRight: 'auto', marginBottom: 0 }}>\n        {heading}\n      </h1>\n    );\n  }\n\n  return (\n    <div style={{ ...style, display: 'flex', flexDirection: 'column', gap: 16, width: '100%' }}>\n      {renderGalleryHeading(filter)}\n      {loading ?\n        <CenteredSpinner text=\"Loading models\" />\n      : <>\n          <div className=\"model-gallery\">\n            {models.map((model) => (\n              <ModelCard key={model.id} model={model} />\n            ))}\n            {models.length === 0 && <div style={{ gridColumn: '1 / -1' }}>No models found.</div>}\n          </div>\n          {pagination && total > pageSize && (\n            <Paginator\n              first={first}\n              rows={pageSize}\n              totalRecords={total}\n              onPageChange={(e) => setFirst(e.first)}\n              template=\"PrevPageLink PageLinks NextPageLink\"\n              rowsPerPageOptions={[]}\n              style={{ flex: 0, marginLeft: 'auto', marginRight: 'auto' }}\n            />\n          )}\n          {visibleTags && visibleTags.length > 0 && (\n            <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>\n              {visibleTags.map(({ tag, count }) => (\n                <a key={tag} href={`/#/tag/${tag}`} className=\"p-button p-button-outlined\">\n                  #{tag}\n                  <Badge key={tag} value={count} style={{ background: '#333' }}></Badge>\n                </a>\n              ))}\n            </div>\n          )}\n        </>\n      }\n    </div>\n  );\n}\n"],"names":["ModelGallery","filter","style","pageSize","pagination","tag","useParams","models","setModels","useState","total","setTotal","first","setFirst","loading","setLoading","visibleTags","setVisibleTags","useEffect","loadModels","SupabaseService","tagCounts","model","sortedTags","count","a","b","renderGalleryHeading","jsx","Fragment","wrap","s","heading","jsxs","CenteredSpinner","ModelCard","Paginator","e","Badge"],"mappings":"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"}