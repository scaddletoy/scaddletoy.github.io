import{r as l,R as qe,I as Pr,u as Qe,P as ot,C as dt,a as pt,b as Et,Z as Je,c as De,d as Nr,e as Ar,O as oe,f as le,g as Jo,h as Xe,i as As,k as hn,D as X,j as _,l as Bt,m as gn,U as Wn,T as _r,n as En,o as _s,K as er,p as js,q as Xo,s as Fs,t as Zo,v as Qo,w as ei,E as ti,_ as Br,x as ni,y as ri,M as Vr,z as si}from"../index.js";import{A as jr,t as Ls,s as ks,f as ur,a as oi,m as zr,g as ii,h as ai}from"./utils-DRB1n_X_.js";import{SupabaseService as en}from"./SupabaseService-BE7KA2gQ.js";import{M as $s,j as tr,T as li,w as nr,e as xt,r as rr,s as Hr,m as Kr,u as Gr,a as ci,f as ui,b as sr,c as wn,d as fi}from"./tree.esm-DaHbQoQK.js";import{_ as di,a as pi,b as mi,T as Wr,C as yn,c as Ds,d as hi,S as gi}from"./index.esm-Byjr6lLE.js";import{T as fr,D as Yr,I as qr,O as Us}from"./dropdown.esm-Cz3yJgL1.js";import{P as Bs}from"./index.esm-0dnXiuBX.js";import{B as sn}from"./button.esm-CGJeW1c1.js";import{z as yi}from"./index.esm-DyIK9W92.js";import{M as vi,a as bi}from"./ModelCard-CWpoSSPQ.js";import{D as xi}from"./dialog.esm-DJJW7ePG.js";function Ei(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fr(t,e){var n=function(o){return e&&l.isValidElement(o)?e(o):o},s=Object.create(null);return t&&l.Children.map(t,function(r){return r}).forEach(function(r){s[r.key]=n(r)}),s}function wi(t,e){t=t||{},e=e||{};function n(m){return m in e?e[m]:t[m]}var s=Object.create(null),r=[];for(var o in t)o in e?r.length&&(s[o]=r,r=[]):r.push(o);var a,i={};for(var u in e){if(s[u])for(a=0;a<s[u].length;a++){var d=s[u][a];i[s[u][a]]=n(d)}i[u]=n(u)}for(a=0;a<r.length;a++)i[r[a]]=n(r[a]);return i}function Rt(t,e,n){return n[e]!=null?n[e]:t.props[e]}function Si(t,e){return Fr(t.children,function(n){return l.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:Rt(n,"appear",t),enter:Rt(n,"enter",t),exit:Rt(n,"exit",t)})})}function Ti(t,e,n){var s=Fr(t.children),r=wi(e,s);return Object.keys(r).forEach(function(o){var a=r[o];if(l.isValidElement(a)){var i=o in e,u=o in s,d=e[o],m=l.isValidElement(d)&&!d.props.in;u&&(!i||m)?r[o]=l.cloneElement(a,{onExited:n.bind(null,a),in:!0,exit:Rt(a,"exit",t),enter:Rt(a,"enter",t)}):!u&&i&&!m?r[o]=l.cloneElement(a,{in:!1}):u&&i&&l.isValidElement(d)&&(r[o]=l.cloneElement(a,{onExited:n.bind(null,a),in:d.props.in,exit:Rt(a,"exit",t),enter:Rt(a,"enter",t)}))}}),r}var Ri=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},Ii={component:"div",childFactory:function(e){return e}},Lr=(function(t){di(e,t);function e(s,r){var o;o=t.call(this,s,r)||this;var a=o.handleExited.bind(Ei(o));return o.state={contextValue:{isMounting:!0},handleExited:a,firstRender:!0},o}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(r,o){var a=o.children,i=o.handleExited,u=o.firstRender;return{children:u?Si(r,i):Ti(r,a,i),firstRender:!1}},n.handleExited=function(r,o){var a=Fr(this.props.children);r.key in a||(r.props.onExited&&r.props.onExited(o),this.mounted&&this.setState(function(i){var u=pi({},i.children);return delete u[r.key],{children:u}}))},n.render=function(){var r=this.props,o=r.component,a=r.childFactory,i=mi(r,["component","childFactory"]),u=this.state.contextValue,d=Ri(this.state.children).map(a);return delete i.appear,delete i.enter,delete i.exit,o===null?qe.createElement(Wr.Provider,{value:u},d):qe.createElement(Wr.Provider,{value:u},qe.createElement(o,i,d))},e})(qe.Component);Lr.propTypes={};Lr.defaultProps=Ii;function Vs(t,e){let n;t.id="WORKER."+t.taskName+"."+Math.random().toString(36).substring(2)+" |";function s(){n&&(n.terminate(),n=null)}return jr((r,o)=>(n=new Worker(new URL("/assets/openscad-worker-CLMFiw7W.js",import.meta.url),{type:"module"}),n.onmessage=a=>{"result"in a.data?(r(a.data.result),s()):e(a.data)},n.postMessage(t),()=>{s()}))}const Ci=new Set(["Could not initialize localization."]),zs=(t,e)=>({logText:Oi(t),markers:Mi(t,e)});function Oi(t,e){const n=[];for(const{stderr:s,stdout:r,error:o}of t){const a=s??r??`EXCEPTION: ${o}`;Ci.has(a)||n.push(a)}return n.join(`
`)}function Mi(t,e){let n=[];const s=[];let r=0,o=0;const a=(d,m,p)=>{s.push({startLineNumber:Number(p),startColumn:1,endLineNumber:Number(p),endColumn:1e3,message:d,severity:8})},i=e.shiftSourceLines&&e.shiftSourceLines.sourcePath,u=(d,m)=>{const p=Number(m);return i&&d.endsWith(i)?p-e.shiftSourceLines.skipLines:p};for(const{stderr:d,stdout:m,error:p}of t){if(d){d.startsWith("ERROR:")&&o++,d.startsWith("WARNING:")&&r++;let S=/^ERROR: Parser error in file "([^"]+)", line (\d+): (.*)$/.exec(d);if(S){const[I,L,P,T]=S;a(T,L,u(L,P));continue}if(S=/^ERROR: Parser error: (.*?) in file ([^",]+), line (\d+)$/.exec(d),S){const[I,L,P,T]=S;a(L,P,u(P,T));continue}if(S=/^WARNING: (.*?),? in file ([^,]+), line (\d+)\.?/.exec(d),S){const[I,L,P,T]=S;s.push({startLineNumber:u(P,T),startColumn:1,endLineNumber:u(P,T),endColumn:1e3,message:L,severity:4});continue}}n.push(d??m??`EXCEPTION: ${p}`)}return(o||r)&&(n=[`${o} errors, ${r} warnings!`,"",...n]),s}const Pi=300,Ni=Ls(Pi,t=>{const{activePath:e,sources:n}=t;""+n[0].content;const s="out.json",r=Vs({taskName:"checkSyntax",mountArchives:!0,files:n,args:[e,"-o",s,"--export-format=param"],outputPaths:[s]},o=>{});return jr((o,a)=>((async()=>{try{const i=await r;let u;if(i.outputs&&i.outputs.length==1){const[[,d]]=i.outputs;try{u=JSON.parse(d)}catch(m){console.error(`Error while parsing parameter set: ${m}
${d}`)}}else console.error("No output from runner!");o({...zs(i.mergedOutputs,{}),parameterSet:u})}catch(i){console.error(i),a(i)}})(),()=>r.kill()))}),Ai=1e3;function Hs(t){return typeof t=="string"?`"${t}"`:t instanceof Array?`[${t.map(Hs).join(", ")}]`:`${t}`}const _i=Ls(Ai,t=>{const{scadPath:e,sources:n,isPreview:s,mountArchives:r,vars:o,features:a,extraArgs:i,renderFormat:u,streamsCallback:d}=t,m=[];if(s&&m.push("$preview=true;"),!e.endsWith(".scad"))throw new Error("First source must be a .scad file, got "+n[0].path+" instead");const p=n.filter(w=>w.path===e)[0];if(!p)throw new Error("Active path not found in sources!");if(p.content==null)throw new Error("Source content is null!");const S=[...m,p.content].join(`
`),I=u=="glb"||u=="3mf"?"off":u,P=`${e.replace(/\.scad$/,"").split("/").pop()}.${I}`,T=[e,"-o",P,"--backend=manifold","--export-format="+(I=="stl"?"binstl":I),...Object.entries(o??{}).flatMap(([w,g])=>[`-D${w}=${Hs(g)}`]),...(a??[]).map(w=>`--enable=${w}`),...i??[]],f=Vs({taskName:s?"preview":"render",mountArchives:r,files:n.map(w=>w.path===e?{path:w.path,content:S}:w),args:T,outputPaths:[P]},d);return jr((w,g)=>((async()=>{try{const E=await f,{logText:b,markers:x}=zs(E.mergedOutputs,{shiftSourceLines:{sourcePath:p.path,skipLines:m.length}});E.error&&g(E.error);const[c]=E.outputs??[];if(!c){g(new Error("No output from runner!"));return}const[h,y]=c,v=h.split("/"),O=v[v.length-1],j=h.endsWith(".svg")?"image/svg+xml":"application/octet-stream",F=new Blob([y]),$=new File([F],O,{type:j});w({outFile:$,logText:b,markers:x,elapsedMillis:E.elapsedMillis})}catch(E){console.error(E),g(E)}})(),()=>f.kill()))});function dr(){return dr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},dr.apply(null,arguments)}var Ks=l.memo(l.forwardRef(function(t,e){var n=Pr.getPTI(t);return l.createElement("svg",dr({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),l.createElement("path",{d:"M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z",fill:"currentColor"}),l.createElement("path",{d:"M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z",fill:"currentColor"}),l.createElement("path",{d:"M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z",fill:"currentColor"}))}));Ks.displayName="ExclamationTriangleIcon";function pr(){return pr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},pr.apply(null,arguments)}var Gs=l.memo(l.forwardRef(function(t,e){var n=Pr.getPTI(t);return l.createElement("svg",pr({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z",fill:"currentColor"}))}));Gs.displayName="InfoCircleIcon";function mr(){return mr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},mr.apply(null,arguments)}var Ws=l.memo(l.forwardRef(function(t,e){var n=Pr.getPTI(t);return l.createElement("svg",mr({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z",fill:"currentColor"}))}));Ws.displayName="TimesCircleIcon";function hr(){return hr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},hr.apply(null,arguments)}function gr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ji(t){if(Array.isArray(t))return gr(t)}function Fi(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ys(t,e){if(t){if(typeof t=="string")return gr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gr(t,e):void 0}}function Li(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function or(t){return ji(t)||Fi(t)||Ys(t)||Li()}function ki(t){if(Array.isArray(t))return t}function $i(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function Di(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yr(t,e){return ki(t)||$i(t,e)||Ys(t,e)||Di()}function on(t){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(t)}function Ui(t,e){if(on(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(on(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Bi(t){var e=Ui(t,"string");return on(e)=="symbol"?e:e+""}function qs(t,e,n){return(e=Bi(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Vi=`
@layer primereact {
    .p-toast {
        width: calc(100% - var(--toast-indent, 0px));
        max-width: 25rem;
    }
    
    .p-toast-message-icon {
        flex-shrink: 0;
    }
    
    .p-toast-message-content {
        display: flex;
        align-items: flex-start;
    }
    
    .p-toast-message-text {
        flex: 1 1 auto;
    }
    
    .p-toast-summary {
        overflow-wrap: anywhere;
    }
    
    .p-toast-detail {
        overflow-wrap: anywhere;
    }
    
    .p-toast-top-center {
        transform: translateX(-50%);
    }
    
    .p-toast-bottom-center {
        transform: translateX(-50%);
    }
    
    .p-toast-center {
        min-width: 20vw;
        transform: translate(-50%, -50%);
    }
    
    .p-toast-icon-close {
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }
    
    .p-toast-icon-close.p-link {
        cursor: pointer;
    }
    
    /* Animations */
    .p-toast-message-enter {
        opacity: 0;
        transform: translateY(50%);
    }
    
    .p-toast-message-enter-active {
        opacity: 1;
        transform: translateY(0);
        transition: transform 0.3s, opacity 0.3s;
    }
    
    .p-toast-message-enter-done {
        transform: none;
    }
    
    .p-toast-message-exit {
        opacity: 1;
        max-height: 1000px;
    }
    
    .p-toast .p-toast-message.p-toast-message-exit-active {
        opacity: 0;
        max-height: 0;
        margin-bottom: 0;
        overflow: hidden;
        transition: max-height 0.45s cubic-bezier(0, 1, 0, 1), opacity 0.3s, margin-bottom 0.3s;
    }
}
`,zi={root:function(e){var n=e.props,s=e.context;return le("p-toast p-component p-toast-"+n.position,n.className,{"p-input-filled":s&&s.inputStyle==="filled"||De.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||De.ripple===!1})},message:{message:function(e){var n=e.severity;return le("p-toast-message",qs({},"p-toast-message-".concat(n),n))},content:"p-toast-message-content",buttonicon:"p-toast-icon-close-icon",closeButton:"p-toast-icon-close p-link",icon:"p-toast-message-icon",text:"p-toast-message-text",summary:"p-toast-summary",detail:"p-toast-detail"},transition:"p-toast-message"},Hi={root:function(e){var n=e.props;return{position:"fixed",top:n.position==="top-right"||n.position==="top-left"||n.position==="top-center"?"20px":n.position==="center"?"50%":null,right:(n.position==="top-right"||n.position==="bottom-right")&&"20px",bottom:(n.position==="bottom-left"||n.position==="bottom-right"||n.position==="bottom-center")&&"20px",left:n.position==="top-left"||n.position==="bottom-left"?"20px":n.position==="center"||n.position==="top-center"||n.position==="bottom-center"?"50%":null}}},Sn=dt.extend({defaultProps:{__TYPE:"Toast",id:null,className:null,content:null,style:null,baseZIndex:0,position:"top-right",transitionOptions:null,appendTo:"self",onClick:null,onRemove:null,onShow:null,onHide:null,onMouseEnter:null,onMouseLeave:null,children:void 0},css:{classes:zi,styles:Vi,inlineStyles:Hi}});function Jr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function xe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Jr(Object(n),!0).forEach(function(s){qs(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Js=l.memo(l.forwardRef(function(t,e){var n=Qe(),s=t.messageInfo,r=t.metaData,o=t.ptCallbacks,a=o.ptm,i=o.ptmo,u=o.cx,d=t.index,m=s.message,p=m.severity,S=m.content,I=m.summary,L=m.detail,P=m.closable,T=m.life,f=m.sticky,w=m.className,g=m.style,E=m.contentClassName,b=m.contentStyle,x=m.icon,c=m.closeIcon,h=m.pt,y={index:d},v=xe(xe({},r),y),O=l.useState(!1),j=yr(O,2),F=j[0],$=j[1],A=Jo(function(){B()},T||3e3,!f&&!F),D=yr(A,1),R=D[0],M=function(me,Ie){return a(me,xe({hostName:t.hostName},Ie))},B=function(){R(),t.onClose&&t.onClose(s)},K=function(me){t.onClick&&!(X.hasClass(me.target,"p-toast-icon-close")||X.hasClass(me.target,"p-toast-icon-close-icon"))&&t.onClick(s.message)},G=function(me){t.onMouseEnter&&t.onMouseEnter(me),!me.defaultPrevented&&(f||(R(),$(!0)))},re=function(me){t.onMouseLeave&&t.onMouseLeave(me),!me.defaultPrevented&&(f||$(!1))},ye=function(){var me=n({className:u("message.buttonicon")},M("buttonicon",v),i(h,"buttonicon",xe(xe({},y),{},{hostName:t.hostName}))),Ie=c||l.createElement(fr,me),ve=Xe.getJSXIcon(Ie,xe({},me),{props:t}),_e=n({type:"button",className:u("message.closeButton"),onClick:B,"aria-label":t.ariaCloseLabel||As("close")},M("closeButton",v),i(h,"closeButton",xe(xe({},y),{},{hostName:t.hostName})));return P!==!1?l.createElement("div",null,l.createElement("button",_e,ve,l.createElement(hn,null))):null},ue=function(){if(s){var me=oe.getJSXElement(S,{message:s.message,onClick:K,onClose:B}),Ie=n({className:u("message.icon")},M("icon",v),i(h,"icon",xe(xe({},y),{},{hostName:t.hostName}))),ve=x;if(!x)switch(p){case"info":ve=l.createElement(Gs,Ie);break;case"warn":ve=l.createElement(Ks,Ie);break;case"error":ve=l.createElement(Ws,Ie);break;case"success":ve=l.createElement(Ds,Ie);break}var _e=Xe.getJSXIcon(ve,xe({},Ie),{props:t}),Me=n({className:u("message.text")},M("text",v),i(h,"text",xe(xe({},y),{},{hostName:t.hostName}))),be=n({className:u("message.summary")},M("summary",v),i(h,"summary",xe(xe({},y),{},{hostName:t.hostName}))),Pe=n({className:u("message.detail")},M("detail",v),i(h,"detail",xe(xe({},y),{},{hostName:t.hostName})));return me||l.createElement(l.Fragment,null,_e,l.createElement("div",Me,l.createElement("span",be,I),L&&l.createElement("div",Pe,L)))}return null},ee=ue(),ie=ye(),Re=n({ref:e,className:le(w,u("message.message",{severity:p})),style:g,role:"alert","aria-live":"assertive","aria-atomic":"true",onClick:K,onMouseEnter:G,onMouseLeave:re},M("message",v),i(h,"root",xe(xe({},y),{},{hostName:t.hostName}))),Be=n({className:le(E,u("message.content")),style:b},M("content",v),i(h,"content",xe(xe({},y),{},{hostName:t.hostName})));return l.createElement("div",Re,l.createElement("div",Be,ee,ie))}));Js.displayName="ToastMessage";var Xr=0,kr=l.memo(l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=Sn.getProps(t,s),o=l.useState([]),a=yr(o,2),i=a[0],u=a[1],d=l.useRef(null),m={props:r,state:{messages:i}},p=Sn.setMetaData(m);pt(Sn.css.styles,p.isUnstyled,{name:"toast"});var S=function(c){c&&u(function(h){return I(h,c,!0)})},I=function(c,h,y){var v;if(Array.isArray(h)){var O=h.reduce(function(F,$){return F.push({_pId:Xr++,message:$}),F},[]);y?v=c?[].concat(or(c),or(O)):O:v=O}else{var j={_pId:Xr++,message:h};y?v=c?[].concat(or(c),[j]):[j]:v=[j]}return v},L=function(){Je.clear(d.current),u([])},P=function(c){u(function(h){return I(h,c,!1)})},T=function(c){var h=oe.isNotEmpty(c._pId)?c._pId:c.message||c;u(function(y){return y.filter(function(v){return v._pId!==c._pId&&!oe.deepEquals(v.message,h)})}),r.onRemove&&r.onRemove(c.message||h)},f=function(c){T(c)},w=function(){r.onShow&&r.onShow()},g=function(){i.length===1&&Je.clear(d.current),r.onHide&&r.onHide()};Et(function(){Je.set("toast",d.current,s&&s.autoZIndex||De.autoZIndex,r.baseZIndex||s&&s.zIndex.toast||De.zIndex.toast)},[i,r.baseZIndex]),Nr(function(){Je.clear(d.current)}),l.useImperativeHandle(e,function(){return{props:r,show:S,replace:P,remove:T,clear:L,getElement:function(){return d.current}}});var E=function(){var c=n({ref:d,id:r.id,className:p.cx("root",{context:s}),style:p.sx("root")},Sn.getOtherProps(r),p.ptm("root")),h=n({classNames:p.cx("transition"),timeout:{enter:300,exit:300},options:r.transitionOptions,unmountOnExit:!0,onEntered:w,onExited:g},p.ptm("transition"));return l.createElement("div",c,l.createElement(Lr,null,i&&i.map(function(y,v){var O=l.createRef();return l.createElement(yn,hr({nodeRef:O,key:y._pId},h),t.content?oe.getJSXElement(t.content,{message:y.message}):l.createElement(Js,{hostName:"Toast",ref:O,messageInfo:y,index:v,onClick:r.onClick,onClose:f,onMouseEnter:r.onMouseEnter,onMouseLeave:r.onMouseLeave,closeIcon:r.closeIcon,ptCallbacks:p,metaData:m}))})))},b=E();return l.createElement(Ar,{element:b,appendTo:r.appendTo})}));kr.displayName="Toast";var Xs=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Zt=t=>{let e=0;for(let n=0;n<t.length;n++){let s=t[n],r=Xs.indexOf(s);e=e*83+r}return e},Wt=(t,e)=>{var n="";for(let s=1;s<=e;s++){let r=Math.floor(t)/Math.pow(83,e-s)%83;n+=Xs[Math.floor(r)]}return n},$t=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},Dt=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},Ki=t=>t<0?-1:1,Ut=(t,e)=>Ki(t)*Math.pow(Math.abs(t),e),Dn=class extends Error{constructor(t){super(t),this.name="ValidationError",this.message=t}},Gi=t=>{if(!t||t.length<6)throw new Dn("The blurhash string must be at least 6 characters");let e=Zt(t[0]),n=Math.floor(e/9)+1,s=e%9+1;if(t.length!==4+2*s*n)throw new Dn(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*s*n}`)},Wi=t=>{let e=t>>16,n=t>>8&255,s=t&255;return[$t(e),$t(n),$t(s)]},Yi=(t,e)=>{let n=Math.floor(t/361),s=Math.floor(t/19)%19,r=t%19;return[Ut((n-9)/9,2)*e,Ut((s-9)/9,2)*e,Ut((r-9)/9,2)*e]},qi=(t,e,n,s)=>{Gi(t),s=s|1;let r=Zt(t[0]),o=Math.floor(r/9)+1,a=r%9+1,i=(Zt(t[1])+1)/166,u=new Array(a*o);for(let p=0;p<u.length;p++)if(p===0){let S=Zt(t.substring(2,6));u[p]=Wi(S)}else{let S=Zt(t.substring(4+p*2,6+p*2));u[p]=Yi(S,i*s)}let d=e*4,m=new Uint8ClampedArray(d*n);for(let p=0;p<n;p++)for(let S=0;S<e;S++){let I=0,L=0,P=0;for(let g=0;g<o;g++)for(let E=0;E<a;E++){let b=Math.cos(Math.PI*S*E/e)*Math.cos(Math.PI*p*g/n),x=u[E+g*a];I+=x[0]*b,L+=x[1]*b,P+=x[2]*b}let T=Dt(I),f=Dt(L),w=Dt(P);m[4*S+0+p*d]=T,m[4*S+1+p*d]=f,m[4*S+2+p*d]=w,m[4*S+3+p*d]=255}return m},Ji=qi,Zr=4,Xi=(t,e,n,s)=>{let r=0,o=0,a=0,i=e*Zr;for(let d=0;d<e;d++){let m=Zr*d;for(let p=0;p<n;p++){let S=m+p*i,I=s(d,p);r+=I*$t(t[S]),o+=I*$t(t[S+1]),a+=I*$t(t[S+2])}}let u=1/(e*n);return[r*u,o*u,a*u]},Zi=t=>{let e=Dt(t[0]),n=Dt(t[1]),s=Dt(t[2]);return(e<<16)+(n<<8)+s},Qi=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(Ut(t[0]/e,.5)*9+9.5)))),s=Math.floor(Math.max(0,Math.min(18,Math.floor(Ut(t[1]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(Ut(t[2]/e,.5)*9+9.5))));return n*19*19+s*19+r},ea=(t,e,n,s,r)=>{if(s<1||s>9||r<1||r>9)throw new Dn("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new Dn("Width and height must match the pixels array");let o=[];for(let p=0;p<r;p++)for(let S=0;S<s;S++){let I=S==0&&p==0?1:2,L=Xi(t,e,n,(P,T)=>I*Math.cos(Math.PI*S*P/e)*Math.cos(Math.PI*p*T/n));o.push(L)}let a=o[0],i=o.slice(1),u="",d=s-1+(r-1)*9;u+=Wt(d,1);let m;if(i.length>0){let p=Math.max(...i.map(I=>Math.max(...I))),S=Math.floor(Math.max(0,Math.min(82,Math.floor(p*166-.5))));m=(S+1)/166,u+=Wt(S,1)}else m=1,u+=Wt(0,1);return u+=Wt(Zi(a),4),i.forEach(p=>{u+=Wt(Qi(p,m),2)}),u},ta=ea;async function na(t){return new Promise((e,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=(...r)=>n(r),s.src=t})}async function ra(t){const{rgba:e,w:n,h:s}=await oa(t,{maxSize:100,opaque:!0}),r=9;return ta(new Uint8ClampedArray(e),n,s,r,r)}function sa(t,e,n){const s=Ji(t,e,n),r=document.createElement("canvas");r.width=e,r.height=n;const o=r.getContext("2d"),a=o.createImageData(e,n);return a.data.set(s),o.putImageData(a,0,0),r.toDataURL("image/png")}async function oa(t,{maxSize:e,opaque:n}){const s=await na(t),r=s.width,o=s.height,a=Math.min(e/r,e/o),i=Math.floor(r*a),u=Math.floor(o*a),d=document.createElement("canvas");d.width=i,d.height=u;const m=d.getContext("2d");if(!m)throw new Error("Could not get canvas context");m.fillStyle="white",m.fillRect(0,0,i,u),m.drawImage(s,0,0,i,u);const p=m.getImageData(0,0,i,u);return{rgba:new Uint8Array(p.data.buffer),w:i,h:u}}const an=[["Diagonal",Math.PI/4,Math.PI/4],["Front",0,Math.PI/2],["Right",Math.PI/2,Math.PI/2],["Back",Math.PI,Math.PI/2],["Left",-Math.PI/2,Math.PI/2],["Top",0,0],["Bottom",0,Math.PI]];function vr(t,e){return[Math.cos(t)*Math.sin(e),Math.sin(t)*Math.sin(e),Math.cos(e)]}function Zs(t,e){const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+s*s+r*r)}const Qr=(t,e)=>Math.min(Math.abs(t-e),Math.abs(t-e+2*Math.PI),Math.abs(t-e-2*Math.PI));function ia(t,e){const n=vr(t,e),r=an.map(([u,d,m])=>vr(d,m)).map(u=>Zs(n,u)),o=an.map(([u,d,m])=>Math.max(Qr(t,d),Qr(e,m))),[a,i]=r.reduce((u,d,m)=>d<u[1]?[m,d]:u,[0,1/0]);return[a,i,o[a]]}const Tn=(([t,e,n])=>`${e}rad ${n}rad auto`)(an[0]),aa=l.forwardRef(function(e,n){const[s,r]=l.useState("none"),o=l.useRef(null),a=l.useRef(null),i=l.useRef(null),[u,d]=l.useState(),[m,p]=l.useState(void 0),S=u===e.modelUri;if(e?.preview){let{hash:T,uri:f}=m??{hash:""};e.preview.blurhash&&T!==e.preview.blurhash&&(T=e.preview.blurhash,f=sa(T,100,100),p({hash:T,uri:f}))}else m&&p(void 0);const I=l.useCallback(async T=>{if(d(e.modelUri),!o.current)return;const f=await o.current.toDataURL("image/png",.5);await ra(f)},[e.modelUri,d,o.current]);l.useEffect(()=>{if(!o.current)return;const T=o.current;return T.addEventListener("load",I),()=>T.removeEventListener("load",I)},[o.current,I]);for(const T of[o,a]){const f=T===o?a:o;l.useEffect(()=>{if(!T.current)return;function w(E){if(f.current&&E.detail.source==="user-interaction"){const b=T.current.getCameraOrbit();b.radius=f.current.getCameraOrbit().radius,f.current.cameraOrbit=b.toString()}}const g=T.current;return g.addEventListener("camera-change",w),()=>g.removeEventListener("camera-change",w)},[T.current,f.current])}l.useEffect(()=>{let T;function f(){const b=a.current.getCameraOrbit();return vr(b.theta,b.phi)}function w(b){b.target===a.current&&(T=f())}function g(b){if(b.target===a.current){const h=f();if((T?Zs(h,T):1/0)>.01)return;const v=a.current.getCameraOrbit(),O=o.current.getCameraOrbit(),[j,F,$]=ia(v.theta,v.phi),A=b.button==2?0:F<.01&&$<.1?(j+1)%an.length:j,[D,R,M]=an[A];Object.assign(O,{theta:R,phi:M}),o.current.cameraOrbit=a.current.cameraOrbit=O.toString(),r("none"),b.stopPropagation(),b.preventDefault()}}function E(b){b.target===a.current&&b.preventDefault()}return window.addEventListener("mousedown",w),window.addEventListener("mouseup",g),window.addEventListener("contextmenu",E),()=>{window.removeEventListener("mousedown",w),window.removeEventListener("mouseup",g),window.removeEventListener("contextmenu",E)}});async function L(){if(!o.current)return null;const T=await o.current.toDataURL("image/png",1),f=new window.Image;f.src=T,await new Promise(E=>{f.onload=E});const w=document.createElement("canvas");w.width=500,w.height=500;const g=w.getContext("2d");return g?(g.drawImage(f,0,0,500,500),w.toDataURL("image/webp",.9)):null}function P(){!o.current||!a.current||(o.current.cameraOrbit=Tn,a.current.cameraOrbit=Tn)}return l.useImperativeHandle(n,()=>({getWebpScreenshot:L,resetView:P}),[L,P]),_.jsxs("div",{className:e.className,style:{display:"flex",flexDirection:"column",position:"relative",flex:1,width:"100%",background:e.lightMode?"#eee":"#111",...e.style??{}},children:[_.jsx(kr,{ref:i,position:"top-right"}),_.jsx("style",{children:`
          @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 0.7; }
            100% { opacity: 0.4; }
          }
        `}),S?_.jsx(_.Fragment,{}):m?_.jsx("img",{src:m.uri,style:{animation:"pulse 1.5s ease-in-out infinite",position:"absolute",pointerEvents:"none",width:"100%",height:"100%"}}):_.jsx(Bt,{text:"Loading model"}),_.jsx("model-viewer",{orientation:"0deg -90deg 0deg",class:"main-viewer",src:e.modelUri,style:{transition:"opacity 0.5s",position:"absolute",width:"100%",height:"100%"},"camera-orbit":Tn,"interaction-prompt":s,"environment-image":"./skybox-lights.jpg",exposure:2,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","camera-controls":!0,ar:!0,ref:o,children:_.jsx("span",{slot:"progress-bar"})}),_.jsx("model-viewer",{orientation:"0deg -90deg 0deg",src:"./axes.glb",style:{position:"absolute",bottom:0,left:0,zIndex:10,height:"100px",width:"100px"},loading:"eager","camera-orbit":Tn,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","orbit-sensitivity":"5","interaction-prompt":"none","camera-controls":"false","disable-zoom":!0,"disable-tap":!0,"disable-pan":!0,ref:a,children:_.jsx("span",{slot:"progress-bar"})})]})});function Un(){return Un=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Un.apply(null,arguments)}function la(t){if(Array.isArray(t))return t}function ca(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e!==0)for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function es(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ua(t,e){if(t){if(typeof t=="string")return es(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?es(t,e):void 0}}function fa(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ts(t,e){return la(t)||ca(t,e)||ua(t,e)||fa()}var Rn=dt.extend({defaultProps:{__TYPE:"Fieldset",id:null,legend:null,className:null,style:null,toggleable:null,collapsed:null,collapseIcon:null,transitionOptions:null,expandIcon:null,onExpand:null,onCollapse:null,onToggle:null,onClick:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return le("p-fieldset p-component",{"p-fieldset-toggleable":n.toggleable})},toggleableContent:"p-toggleable-content",togglericon:"p-fieldset-toggler",legendTitle:"p-fieldset-legend-text",legend:"p-fieldset-legend p-unselectable-text",content:"p-fieldset-content",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-fieldset-legend > a,
            .p-fieldset-legend > span {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .p-fieldset-toggleable .p-fieldset-legend a {
                cursor: pointer;
                user-select: none;
                overflow: hidden;
                position: relative;
                text-decoration: none;
            }
            
            .p-fieldset-legend-text {
                line-height: 1;
            }
        }
        `}}),Qs=l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=Rn.getProps(t,s),o=l.useState(r.id),a=ts(o,2),i=a[0],u=a[1],d=l.useState(r.collapsed),m=ts(d,2),p=m[0],S=m[1],I=r.toggleable?r.onToggle?r.collapsed:p:!1,L=l.useRef(null),P=l.useRef(null),T=i+"_header",f=i+"_content",w=Rn.setMetaData({props:r,state:{id:i,collapsed:I}}),g=w.ptm,E=w.cx,b=w.isUnstyled;pt(Rn.css.styles,b,{name:"fieldset"});var x=function(M){r.toggleable&&(I?c(M):h(M),r.onToggle&&r.onToggle({originalEvent:M,value:!I})),M.preventDefault()},c=function(M){r.onToggle||S(!1),r.onExpand&&r.onExpand(M)},h=function(M){r.onToggle||S(!0),r.onCollapse&&r.onCollapse(M)};gn(function(){r.id||u(Wn())});var y=function(M){(M.code==="Enter"||M.code==="NumpadEnter"||M.code==="Space")&&(x(M),M.preventDefault())},v=function(){var M=n({className:E("content")},g("content")),B=n({ref:P,id:f,role:"region","aria-labelledby":T,className:E("toggleableContent")},g("toggleableContent")),K=n({classNames:E("transition"),timeout:{enter:1e3,exit:450},in:!I,unmountOnExit:!0,options:r.transitionOptions},g("transition"));return l.createElement(yn,Un({nodeRef:P},K),l.createElement("div",B,l.createElement("div",M,r.children)))},O=function(){if(r.toggleable){var M=n({className:E("togglericon")},g("togglericon")),B=I?r.expandIcon||l.createElement(Bs,M):r.collapseIcon||l.createElement($s,M),K=Xe.getJSXIcon(B,M,{props:r});return K}return null},j=function(){var M=n({className:E("legendTitle")},g("legendTitle")),B=n({id:T,role:"button","aria-expanded":!I,"aria-controls":f,onKeyDown:y,onClick:x,"aria-label":r.legend,tabIndex:0},g("toggler"));if(r.toggleable){var K=O();return l.createElement("a",B,K,l.createElement("span",M,r.legend),l.createElement(hn,null))}return l.createElement("span",Un({},M,{id:T}),r.legend)},F=function(){var M=n({className:E("legend")},g("legend"));if(r.legend!=null||r.toggleable){var B=j();return l.createElement("legend",M,B)}};l.useImperativeHandle(e,function(){return{props:r,getElement:function(){return L.current},getContent:function(){return P.current}}});var $=n({id:i,ref:L,style:r.style,className:le(r.className,E("root")),onClick:r.onClick},Rn.getOtherProps(r),g("root")),A=F(),D=v();return l.createElement("fieldset",$,A,D)});Qs.displayName="Fieldset";function tn(){return tn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},tn.apply(null,arguments)}function ln(t){"@babel/helpers - typeof";return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(t)}function da(t,e){if(ln(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(ln(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function pa(t){var e=da(t,"string");return ln(e)=="symbol"?e:e+""}function ma(t,e,n){return(e=pa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ha(t){if(Array.isArray(t))return t}function ga(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e!==0)for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function ns(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ya(t,e){if(t){if(typeof t=="string")return ns(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ns(t,e):void 0}}function va(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ba(t,e){return ha(t)||ga(t,e)||ya(t,e)||va()}var xa={box:"p-checkbox-box",input:"p-checkbox-input",icon:"p-checkbox-icon",root:function(e){var n=e.props,s=e.checked,r=e.context;return le("p-checkbox p-component",{"p-highlight":s,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled"})}},In=dt.extend({defaultProps:{__TYPE:"Checkbox",autoFocus:!1,checked:!1,className:null,disabled:!1,falseValue:!1,icon:null,id:null,inputId:null,inputRef:null,invalid:!1,variant:null,name:null,onChange:null,onContextMenu:null,onMouseDown:null,readOnly:!1,required:!1,style:null,tabIndex:null,tooltip:null,tooltipOptions:null,trueValue:!0,value:null,children:void 0},css:{classes:xa}});function rs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ss(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rs(Object(n),!0).forEach(function(s){ma(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var eo=l.memo(l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=In.getProps(t,s),o=l.useState(!1),a=ba(o,2),i=a[0],u=a[1],d=In.setMetaData({props:r,state:{focused:i},context:{checked:r.checked===r.trueValue,disabled:r.disabled}}),m=d.ptm,p=d.cx,S=d.isUnstyled;pt(In.css.styles,S,{name:"checkbox"});var I=l.useRef(null),L=l.useRef(r.inputRef),P=function(){return r.checked===r.trueValue},T=function(v){if(!(r.disabled||r.readOnly)&&r.onChange){var O,j=P(),F=j?r.falseValue:r.trueValue,$={originalEvent:v,value:r.value,checked:F,stopPropagation:function(){v?.stopPropagation()},preventDefault:function(){v?.preventDefault()},target:{type:"checkbox",name:r.name,id:r.id,value:r.value,checked:F}};if(r==null||(O=r.onChange)===null||O===void 0||O.call(r,$),v.defaultPrevented)return;X.focus(L.current)}},f=function(v){var O;u(!0),r==null||(O=r.onFocus)===null||O===void 0||O.call(r,v)},w=function(v){var O;u(!1),r==null||(O=r.onBlur)===null||O===void 0||O.call(r,v)};l.useImperativeHandle(e,function(){return{props:r,focus:function(){return X.focus(L.current)},getElement:function(){return I.current},getInput:function(){return L.current}}}),l.useEffect(function(){oe.combinedRefs(L,r.inputRef)},[L,r.inputRef]),Et(function(){L.current.checked=P()},[r.checked,r.trueValue]),gn(function(){r.autoFocus&&X.focus(L.current,r.autoFocus)});var g=P(),E=oe.isNotEmpty(r.tooltip),b=In.getOtherProps(r),x=n({id:r.id,className:le(r.className,p("root",{checked:g,context:s})),style:r.style,"data-p-highlight":g,"data-p-disabled":r.disabled,onContextMenu:r.onContextMenu,onMouseDown:r.onMouseDown},b,m("root")),c=function(){var v=oe.reduceKeys(b,X.ARIA_PROPS),O=n(ss({id:r.inputId,type:"checkbox",className:p("input"),name:r.name,tabIndex:r.tabIndex,onFocus:function(F){return f(F)},onBlur:function(F){return w(F)},onChange:function(F){return T(F)},disabled:r.disabled,readOnly:r.readOnly,required:r.required,"aria-invalid":r.invalid,checked:g},v),m("input"));return l.createElement("input",tn({ref:L},O))},h=function(){var v=n({className:p("icon")},m("icon")),O=n({className:p("box",{checked:g}),"data-p-highlight":g,"data-p-disabled":r.disabled},m("box")),j=g?r.icon||l.createElement(Ds,v):null,F=Xe.getJSXIcon(j,ss({},v),{props:r,checked:g});return l.createElement("div",O,F)};return l.createElement(l.Fragment,null,l.createElement("div",tn({ref:I},x),c(),h()),E&&l.createElement(_r,tn({target:I,content:r.tooltip,pt:m("tooltip")},r.tooltipOptions)))}));eo.displayName="Checkbox";function br(){return br=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},br.apply(null,arguments)}function cn(t){"@babel/helpers - typeof";return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}function Ea(t,e){if(cn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(cn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function wa(t){var e=Ea(t,"string");return cn(e)=="symbol"?e:e+""}function Sa(t,e,n){return(e=wa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Ta(t){if(Array.isArray(t))return xr(t)}function Ra(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function to(t,e){if(t){if(typeof t=="string")return xr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xr(t,e):void 0}}function Ia(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ca(t){return Ta(t)||Ra(t)||to(t)||Ia()}function Oa(t){if(Array.isArray(t))return t}function Ma(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e!==0)for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function Pa(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cn(t,e){return Oa(t)||Ma(t,e)||to(t,e)||Pa()}var Na={handle:function(e){var n=e.index,s=e.handleIndex;return le("p-slider-handle",{"p-slider-handle-start":n===0,"p-slider-handle-end":n===1,"p-slider-handle-active":s.current===n})},range:"p-slider-range",root:function(e){var n=e.props,s=e.vertical,r=e.horizontal;return le("p-slider p-component",{"p-disabled":n.disabled,"p-slider-horizontal":r,"p-slider-vertical":s})}},Aa=`
@layer primereact {
    .p-slider {
        position: relative;
    }
    
    .p-slider .p-slider-handle {
        position: absolute;
        cursor: grab;
        touch-action: none;
        display: block;
        z-index: 1;
    }
    
    .p-slider .p-slider-handle.p-slider-handle-active {
        z-index: 2;
    }
    
    .p-slider-range {
        position: absolute;
        display: block;
    }
    
    .p-slider-horizontal .p-slider-range {
        top: 0;
        left: 0;
        height: 100%;
    }
    
    .p-slider-horizontal .p-slider-handle {
        top: 50%;
    }
    
    .p-slider-vertical {
        height: 100px;
    }
    
    .p-slider-vertical .p-slider-handle {
        left: 50%;
    }
    
    .p-slider-vertical .p-slider-range {
        bottom: 0;
        left: 0;
        width: 100%;
    }
}
`,_a={handle:{position:"absolute"},range:{position:"absolute"}},Yt=dt.extend({defaultProps:{__TYPE:"Slider",id:null,value:null,min:0,max:100,orientation:"horizontal",step:null,range:!1,style:null,className:null,disabled:!1,tabIndex:0,onChange:null,onSlideEnd:null,children:void 0},css:{classes:Na,styles:Aa,inlineStyles:_a}});function os(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?os(Object(n),!0).forEach(function(s){Sa(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):os(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var no=l.memo(l.forwardRef(function(t,e){var n,s,r,o=Qe(),a=l.useContext(ot),i=Yt.getProps(t,a),u=l.useRef(null),d=l.useRef(0),m=l.useRef(!1),p=l.useRef(!1),S=l.useRef(0),I=l.useRef(0),L=l.useRef(0),P=l.useRef(0),T=l.useRef(),f=i.range?(n=i.value)!==null&&n!==void 0?n:[i.min,i.max]:(s=(r=i.value)!==null&&r!==void 0?r:i.min)!==null&&s!==void 0?s:0,w=i.orientation==="horizontal",g=i.orientation==="vertical",E=En({type:"mousemove",listener:function(k){return Re(k)}}),b=Cn(E,2),x=b[0],c=b[1],h=En({type:"mouseup",listener:function(k){return Be(k)}}),y=Cn(h,2),v=y[0],O=y[1],j=En({type:"touchmove",listener:function(k){return Re(k)}}),F=Cn(j,2),$=F[0],A=F[1],D=En({type:"touchend",listener:function(k){return Be(k)}}),R=Cn(D,2),M=R[0],B=R[1],K=Yt.setMetaData({props:i}),G=K.ptm,re=K.cx,ye=K.sx,ue=K.isUnstyled;pt(Yt.css.styles,ue,{name:"slider"});var ee=function(k,q){var Q=i.range?f[d.current]:f,de=(i.step||1)*q;Pe(k,Q+de),k.preventDefault()},ie=function(k,q){i.disabled||(p.current=!0,_e(),m.current=!0,i.range&&f[0]===i.max?d.current=0:d.current=q,k.preventDefault())},Re=function(k){p.current&&(be(k),k.preventDefault())},Be=function(k){if(p.current){p.current=!1;var q=be(k);i.onSlideEnd&&i.onSlideEnd({originalEvent:k,value:q}),T.current=void 0,c(),O(),A(),B()}},Oe=function(k,q){x(),v(),ie(k,q)},me=function(k,q){k.changedTouches&&k.changedTouches[0]&&(T.current=k.changedTouches[0].identifier),$(),M(),ie(k,q)},Ie=function(k,q){if(!i.disabled){d.current=q;var Q=k.key;switch(Q){case"ArrowRight":case"ArrowUp":ee(k,1);break;case"ArrowLeft":case"ArrowDown":ee(k,-1);break;case"PageUp":ee(k,10),k.preventDefault();break;case"PageDown":ee(k,-10),k.preventDefault();break;case"Home":ee(k,-f),k.preventDefault();break;case"End":ee(k,i.max),k.preventDefault();break}}},ve=function(k){if(!i.disabled){if(!m.current){_e();var q=be(k);i.onSlideEnd&&i.onSlideEnd({originalEvent:k,value:q})}m.current=!1}},_e=function(){var k=u.current.getBoundingClientRect();S.current=k.left+X.getWindowScrollLeft(),I.current=k.top+X.getWindowScrollTop(),L.current=u.current.offsetWidth,P.current=u.current.offsetHeight},Me=function(k){var q,Q=Array.from((q=k.changedTouches)!==null&&q!==void 0?q:[]).find(function(de){return de.identifier===T.current})||k;return{pageX:Q.pageX,pageY:Q.pageY}},be=function(k){var q,Q=Me(k),de=Q.pageX,U=Q.pageY;if(!(!de||!U)){w?q=(de-S.current)*100/L.current:q=(I.current+P.current-U)*100/P.current;var V=(i.max-i.min)*(q/100)+i.min;if(i.step){var ne=i.range?f[d.current]:f,Ee=V-ne;Ee<0?V=ne+Math.ceil(V/i.step-ne/i.step)*i.step:Ee>0&&(V=ne+Math.floor(V/i.step-ne/i.step)*i.step)}else V=Math.floor(V);return Pe(k,V)}},Pe=function(k,q){var Q=parseFloat(q.toFixed(10)),de=Q;return i.range?(d.current===0?Q<i.min?Q=i.min:Q>i.max&&(Q=i.max):Q>i.max?Q=i.max:Q<i.min&&(Q=i.min),de=Ca(f),de[d.current]=Q,i.onChange&&i.onChange({originalEvent:k,value:de})):(Q<i.min?Q=i.min:Q>i.max&&(Q=i.max),de=Q,i.onChange&&i.onChange({originalEvent:k,value:de})),de},Fe=function(k,q,Q){k=oe.isEmpty(k)?null:k,q=oe.isEmpty(q)?null:q;var de={transition:p.current?"none":null,left:k!=null?k+"%":null,bottom:q!=null?q+"%":null},U=o(bt({className:re("handle",{index:Q,handleIndex:d}),style:bt(bt({},ye("handle",{dragging:p,leftValue:k,bottomValue:q})),de),tabIndex:i.tabIndex,role:"slider",onMouseDown:function(ne){return Oe(ne,Q)},onTouchStart:function(ne){return me(ne,Q)},onKeyDown:function(ne){return Ie(ne,Q)},"aria-valuemin":i.min,"aria-valuemax":i.max,"aria-valuenow":k||q||0,"aria-orientation":i.orientation},nt),G("handle"));return l.createElement("span",U)},Le=function(){var k=(f[0]<i.min?i.min:f[0]-i.min)*100/(i.max-i.min),q=(f[1]>i.max?i.max:f[1]-i.min)*100/(i.max-i.min),Q=w?Fe(k,null,0):Fe(null,k,0),de=w?Fe(q,null,1):Fe(null,q,1),U=q>k?q-k:k-q,V=q>k?k:q,ne=w?{left:V+"%",width:U+"%"}:{bottom:V+"%",height:U+"%"},Ee=o({className:re("range"),style:bt(bt({},ye("range")),ne)},G("range"));return l.createElement(l.Fragment,null,l.createElement("span",Ee),Q,de)},et=function(){var k;f<i.min?k=i.min:f>i.max?k=i.max:k=(f-i.min)*100/(i.max-i.min);var q=w?{width:k+"%"}:{height:k+"%"},Q=w?Fe(k,null,null):Fe(null,k,null),de=o({className:re("range"),style:bt(bt({},ye("range")),q)},G("range"));return l.createElement(l.Fragment,null,l.createElement("span",de),Q)};l.useImperativeHandle(e,function(){return{props:i,getElement:function(){return u.current}}});var tt=Yt.getOtherProps(i),nt=oe.reduceKeys(tt,X.ARIA_PROPS),je=i.range?Le():et(),it=o({style:i.style,className:le(i.className,re("root",{vertical:g,horizontal:w})),onClick:ve},Yt.getOtherProps(i),G("root"));return l.createElement("div",br({id:i.id,ref:u},it),je)}));no.displayName="Slider";const ja="customizerRoot_CustomizerPanel",Fa="customizerFieldset_CustomizerPanel",La="parameterInput_CustomizerPanel",ka="parameterInputRow_CustomizerPanel",$a="parameterInputLeft_CustomizerPanel",Da="parameterInputLabel_CustomizerPanel",Ua="parameterInputReset_CustomizerPanel",Ba="parameterInputResetHidden_CustomizerPanel",Va="parameterInputResetVisible_CustomizerPanel",za="parameterInputCaption_CustomizerPanel",Ha="parameterInputRight_CustomizerPanel",Ka="parameterInputDropdown_CustomizerPanel",Ga="parameterInputNumber_CustomizerPanel",Wa="parameterInputText_CustomizerPanel",Ya="parameterInputArrayRow_CustomizerPanel",qa="parameterInputSlider_CustomizerPanel",Te={customizerRoot:ja,customizerFieldset:Fa,parameterInput:La,parameterInputRow:ka,parameterInputLeft:$a,parameterInputLabel:Da,parameterInputReset:Ua,parameterInputResetHidden:Ba,parameterInputResetVisible:Va,parameterInputCaption:za,parameterInputRight:Ha,parameterInputDropdown:Ka,parameterInputNumber:Ga,parameterInputText:Wa,parameterInputArrayRow:Ya,parameterInputSlider:qa};function Ja(t){const e=(t.parameterSet?.parameters??[]).reduce((r,o)=>(r[o.group]||(r[o.group]=[]),r[o.group].push(o),r),{}),n=Object.entries(e),s=n.length===1;return t.parameterSet?_.jsx("div",{className:Te.customizerRoot+(t.className?" "+t.className:""),style:t.style,children:n.map(([r,o])=>s?_.jsx(_.Fragment,{children:o.map(a=>_.jsx(is,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))}):_.jsx(Qs,{className:Te.customizerFieldset,legend:r,toggleable:!0,children:o.map(a=>_.jsx(is,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))},r))}):_.jsx(Bt,{text:"Waiting for customizer to run"})}function is({param:t,value:e,style:n,handleChange:s}){const r=e!==void 0&&JSON.stringify(e)!==JSON.stringify(t.initial);return _.jsxs("div",{className:Te.parameterInput,style:n,children:[_.jsxs("div",{className:Te.parameterInputRow,children:[_.jsxs("div",{className:Te.parameterInputLeft,children:[_.jsxs("label",{className:Te.parameterInputLabel,children:[_.jsx("b",{children:t.name}),_.jsx("i",{className:"pi pi-refresh "+Te.parameterInputReset+" "+(r?Te.parameterInputResetVisible:Te.parameterInputResetHidden),onClick:()=>s(t.name,t.initial)})]}),_.jsx("div",{className:Te.parameterInputCaption,children:t.caption})]}),_.jsxs("div",{className:Te.parameterInputRight,children:[t.type==="number"&&"options"in t&&_.jsx(Yr,{className:Te.parameterInputDropdown,value:e??t.initial,options:t.options,onChange:o=>s(t.name,o.value),optionLabel:"name",optionValue:"value"}),t.type==="string"&&t.options&&_.jsx(Yr,{className:Te.parameterInputDropdown,value:e??t.initial,options:t.options,onChange:o=>s(t.name,o.value),optionLabel:"name",optionValue:"value"}),t.type==="boolean"&&_.jsx(eo,{checked:e??t.initial,onChange:o=>s(t.name,o.checked)}),!Array.isArray(t.initial)&&t.type==="number"&&!("options"in t)&&_.jsx(qr,{className:Te.parameterInputNumber,value:e??t.initial,showButtons:!0,size:5,onValueChange:o=>s(t.name,o.value)}),t.type==="string"&&!t.options&&_.jsx(_s,{className:Te.parameterInputText,value:e??t.initial,onChange:o=>s(t.name,o.target.value)}),Array.isArray(t.initial)&&"min"in t&&_.jsx("div",{className:Te.parameterInputArrayRow,children:t.initial.map((o,a)=>_.jsx(qr,{className:Te.parameterInputNumber,value:e?.[a]!==void 0&&e?.[a]!==null?e[a]:t.initial[a],min:t.min,max:t.max,showButtons:!0,size:5,step:t.step,onValueChange:i=>{const u=[...e??t.initial];u[a]=i.value,s(t.name,u)}},a))})]})]}),!Array.isArray(t.initial)&&t.type==="number"&&t.min!==void 0&&_.jsx(no,{className:Te.parameterInputSlider,value:e??t.initial,min:t.min,max:t.max,step:t.step,onChange:o=>s(t.name,o.value)})]})}function Er(){return Er=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Er.apply(null,arguments)}function un(t){"@babel/helpers - typeof";return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(t)}function Xa(t,e){if(un(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(un(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Za(t){var e=Xa(t,"string");return un(e)=="symbol"?e:e+""}function Qa(t,e,n){return(e=Za(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var el={root:function(e){var n=e.props,s=e.context,r=e.isFilled;return le("p-inputtextarea p-inputtext p-component",{"p-disabled":n.disabled,"p-filled":r,"p-inputtextarea-resizable":n.autoResize,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":s&&s.inputStyle==="filled"})}},tl=`
@layer primereact {
    .p-inputtextarea-resizable {
        overflow: hidden;
        resize: none;
    }
    
    .p-fluid .p-inputtextarea {
        width: 100%;
    }
}
`,On=dt.extend({defaultProps:{__TYPE:"InputTextarea",__parentMetadata:null,autoResize:!1,invalid:!1,variant:null,keyfilter:null,onBlur:null,onFocus:null,onBeforeInput:null,onInput:null,onKeyDown:null,onKeyUp:null,onPaste:null,tooltip:null,tooltipOptions:null,validateOnly:!1,children:void 0,className:null},css:{classes:el,styles:tl}});function as(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ls(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?as(Object(n),!0).forEach(function(s){Qa(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):as(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var $r=l.memo(l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=On.getProps(t,s),o=l.useRef(e),a=l.useRef(0),i=On.setMetaData(ls(ls({props:r},r.__parentMetadata),{},{context:{disabled:r.disabled}})),u=i.ptm,d=i.cx,m=i.isUnstyled;pt(On.css.styles,m,{name:"inputtextarea"});var p=function(h){r.autoResize&&w(),r.onFocus&&r.onFocus(h)},S=function(h){r.autoResize&&w(),r.onBlur&&r.onBlur(h)},I=function(h){r.autoResize&&w(),r.onKeyUp&&r.onKeyUp(h)},L=function(h){r.onKeyDown&&r.onKeyDown(h),r.keyfilter&&er.onKeyPress(h,r.keyfilter,r.validateOnly)},P=function(h){r.onBeforeInput&&r.onBeforeInput(h),r.keyfilter&&er.onBeforeInput(h,r.keyfilter,r.validateOnly)},T=function(h){r.onPaste&&r.onPaste(h),r.keyfilter&&er.onPaste(h,r.keyfilter,r.validateOnly)},f=function(h){var y=h.target;r.autoResize&&w(oe.isEmpty(y.value)),r.onInput&&r.onInput(h),oe.isNotEmpty(y.value)?X.addClass(y,"p-filled"):X.removeClass(y,"p-filled")},w=function(h){var y=o.current;y&&g()&&(a.current||(a.current=y.scrollHeight,y.style.overflow="hidden"),(a.current!==y.scrollHeight||h)&&(y.style.height="",y.style.height=y.scrollHeight+"px",parseFloat(y.style.height)>=parseFloat(y.style.maxHeight)?(y.style.overflowY="scroll",y.style.height=y.style.maxHeight):y.style.overflow="hidden",a.current=y.scrollHeight))},g=function(){if(X.isVisible(o.current)){var h=o.current.getBoundingClientRect();return h.width>0&&h.height>0}return!1};l.useEffect(function(){oe.combinedRefs(o,e)},[o,e]),l.useEffect(function(){r.autoResize&&w(!0)},[r.autoResize,r.value]);var E=l.useMemo(function(){return oe.isNotEmpty(r.value)||oe.isNotEmpty(r.defaultValue)},[r.value,r.defaultValue]),b=oe.isNotEmpty(r.tooltip),x=n({ref:o,className:le(r.className,d("root",{context:s,isFilled:E})),onFocus:p,onBlur:S,onKeyUp:I,onKeyDown:L,onBeforeInput:P,onInput:f,onPaste:T},On.getOtherProps(r),u("root"));return l.createElement(l.Fragment,null,l.createElement("textarea",x),b&&l.createElement(_r,Er({target:o,content:r.tooltip,pt:u("tooltip")},r.tooltipOptions)))}));$r.displayName="InputTextarea";function wr(){return wr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},wr.apply(null,arguments)}function nl(t){if(Array.isArray(t))return t}function rl(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e!==0)for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function cs(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function sl(t,e){if(t){if(typeof t=="string")return cs(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cs(t,e):void 0}}function ol(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function us(t,e){return nl(t)||rl(t,e)||sl(t,e)||ol()}var Mn=dt.extend({defaultProps:{__TYPE:"Panel",id:null,header:null,headerTemplate:null,footer:null,footerTemplate:null,toggleable:null,style:null,className:null,collapsed:null,expandIcon:null,collapseIcon:null,icons:null,transitionOptions:null,onExpand:null,onCollapse:null,onToggle:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return le("p-panel p-component",{"p-panel-toggleable":n.toggleable})},header:"p-panel-header",title:"p-panel-title",icons:"p-panel-icons",toggler:"p-panel-header-icon p-panel-toggler p-link",togglerIcon:"p-panel-header-icon p-panel-toggler p-link",toggleableContent:"p-toggleable-content",content:"p-panel-content",footer:"p-panel-footer",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-panel-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
            }
            
            .p-panel-title {
              line-height: 1;
            }
            
            .p-panel-header-icon {
              display: inline-flex;
              justify-content: center;
              align-items: center;
              cursor: pointer;
              text-decoration: none;
              overflow: hidden;
              position: relative;
            }
        }
        `}}),wt=l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=Mn.getProps(t,s),o=l.useState(r.id),a=us(o,2),i=a[0],u=a[1],d=l.useState(r.collapsed),m=us(d,2),p=m[0],S=m[1],I=l.useRef(null),L=l.useRef(null),P=r.toggleable?r.onToggle?r.collapsed:p:!1,T=i+"_header",f=i+"_content",w=Mn.setMetaData({props:r,state:{id:i,collapsed:P}}),g=w.ptm,E=w.cx,b=w.isUnstyled;pt(Mn.css.styles,b,{name:"panel"});var x=function(M){r.toggleable&&(P?c(M):h(M),M&&(r.onToggle&&r.onToggle({originalEvent:M,value:!P}),M.preventDefault()))},c=function(M){r.onToggle||S(!1),r.onExpand&&M&&r.onExpand(M)},h=function(M){r.onToggle||S(!0),r.onCollapse&&M&&r.onCollapse(M)};l.useImperativeHandle(e,function(){return{props:r,toggle:x,expand:c,collapse:h,getElement:function(){return I.current},getContent:function(){return L.current}}}),gn(function(){i||u(Wn())});var y=function(){if(r.toggleable){var M=i+"_label",B=n({className:E("toggler"),onClick:x,id:M,"aria-controls":f,"aria-expanded":!P,type:"button",role:"button","aria-label":r.header},g("toggler")),K=n(g("togglericon")),G=P?r.expandIcon||l.createElement(Bs,K):r.collapseIcon||l.createElement($s,K),re=Xe.getJSXIcon(G,K,{props:r,collapsed:P});return l.createElement("button",B,re,l.createElement(hn,null))}return null},v=function(){var M=oe.getJSXElement(r.header,r),B=oe.getJSXElement(r.icons,r),K=y(),G=n({id:T,className:E("title")},g("title")),re=l.createElement("span",G,M),ye=n({className:E("icons")},g("icons")),ue=l.createElement("div",ye,B,K),ee=n({className:E("header")},g("header")),ie=l.createElement("div",ee,re,ue);if(r.headerTemplate){var Re={className:"p-panel-header",titleClassName:"p-panel-title",iconsClassName:"p-panel-icons",togglerClassName:"p-panel-header-icon p-panel-toggler p-link",onTogglerClick:x,titleElement:re,iconsElement:ue,togglerElement:K,element:ie,id:i+"_header",props:r,collapsed:P};return oe.getJSXElement(r.headerTemplate,Re)}else if(r.header||r.toggleable)return ie;return null},O=function(){var M=oe.getJSXElement(r.footer,r),B=n({className:E("footer")},g("footer")),K=l.createElement("div",B,M);if(r.footerTemplate){var G={className:E("footer"),element:K,props:r};return oe.getJSXElement(r.footerTemplate,G)}else if(r.footer)return K;return null},j=function(){var M=n({ref:L,className:E("toggleableContent"),"aria-hidden":P,role:"region",id:f,"aria-labelledby":T},g("toggleablecontent")),B=n({className:E("content")},g("content")),K=n({classNames:E("transition"),timeout:{enter:1e3,exit:450},in:!P,unmountOnExit:!0,options:r.transitionOptions},g("transition"));return l.createElement(yn,wr({nodeRef:L},K),l.createElement("div",M,l.createElement("div",B,r.children)))},F=n({id:i,ref:I,style:r.style,className:le(r.className,E("root"))},Mn.getOtherProps(r),g("root")),$=v(),A=j(),D=O();return l.createElement("div",F,$,A,D)});wt.displayName="Panel";const il=({modelId:t,collapsed:e,onToggle:n})=>{const s=js(),[r,o]=l.useState([]),[a,i]=l.useState(""),[u,d]=l.useState(!0),[m,p]=l.useState(!1),[S,I]=l.useState(null),L=async()=>{d(!0),I(null);try{const T=await en.fetchModelComments(t);o(T)}catch{I("Failed to load comments.")}finally{d(!1)}};l.useEffect(()=>{L()},[t]);const P=async()=>{if(a.trim())try{await en.addModelComment(t,a),o(T=>[{id:"temp-"+oi(),model_id:t,user_id:s.user.id,username:s.username,body:a,created_at:ur(new Date)},...T]),i("")}catch{I("Failed to post comment.")}finally{p(!1)}};return _.jsx(wt,{toggleable:!0,header:"Comments",style:{flex:1},className:"panel-comments",collapsed:e,onToggle:n,children:u?_.jsx(Bt,{text:"Loading comments"}):_.jsxs(_.Fragment,{children:[s.user?_.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8},children:[_.jsx($r,{style:{flex:1,resize:"vertical"},maxLength:2e3,placeholder:"Add a comment...",value:a,onChange:T=>i(T.target.value),disabled:m}),_.jsx(sn,{label:"Post",icon:"pi pi-send",outlined:!0,onClick:P,loading:m})]}):_.jsx("div",{children:"You need to be logged in to post comments."}),S&&_.jsx("div",{style:{color:"red",marginBottom:8},children:S}),r.length===0?_.jsx("div",{children:"No comments yet."}):r.map(T=>_.jsxs("div",{children:[_.jsxs("b",{children:[_.jsx("a",{href:`#/user/${T.username}`,children:T.username})," - ",T.created_at]}),_.jsx("p",{dangerouslySetInnerHTML:{__html:ks(T.body)}})]},T.id))]})})},Sr=t=>t.replaceAll(/\/\*(.|[\s\S])*?\*\/|\/\/.*?$/gm,"");function al(t,e,n){const s=Sr(e),r=[],o={},a={},i=[],u=[];for(const d of s.matchAll(/(use|include)\s*<([^>]+)>/g))(d[1]=="use"?u:i).push(d[2]);for(const d of s.matchAll(/(?:^|[{};])\s*([$\w]+)\s*=/g))r.push(d[1]);for(const d of s.matchAll(/(function|module)\s+([$\w]+)\s*\(([^)]*)\)(?:\s*(?:=\s*)?(\{\}|[^{}]+?;))?/gm)){const m=d[1],p=d[2];if(n&&p.startsWith("_"))continue;const S=d[3],I=d[4],L=[];if(/^(\s*([$\w]+(\s*=[^,()[]+)?(\s*,\s*[$\w]+(\s*=[^,()[]+)?)*)?\s*)$/m.test(S))for(const P of S.split(",")){const T=/^\s*([$\w]+)(?:\s*=([^,()[]+))?\s*$/.exec(P);if(T){const f=T[1],w=T[2];L.push({name:f,defaultValue:w})}}(m=="function"?o:a)[p]={path:t,name:p,signature:`${p}(${S.replaceAll(/[\s]+/gm," ").replaceAll(/\b | \b/g,"")})`,params:L,referencesChildren:I!=null?I.indexOf("children()")>=0:null}}return{vars:r,functions:o,modules:a,includes:i,uses:u}}const ll=`
  $fa=undef;
  $fs=undef;
  $fn=undef;
  $t=undef;

  $preview=undef;

  // shows rotation
  $vpr=undef;
  // shows translation (i.e. won't be affected by rotate and zoom)
  $vpt=undef;
  // shows the FOV of the view [Note: Requires version 2021.01]
  $vpf=undef;
  // shows the camera distance [Note: Requires version 2015.03]
  $vpd=undef;

  PI=undef;

  function abs(x) = x;
  function acos(x) = x;
  function asin(x) = x;
  function atan(x) = x;
  function atan2(y, x) = x;
  function ceil(x) = x;
  function chr(x) = 0;
  function len(assignments) = $children;
  function let(x) = x;
  function ln(x) = x;
  function log(x) = x;
  function lookup(key, array) = x;
  function max(values) = x;
  function min(values) = x;
  function sqrt(x) = x;
  function tan(degrees) = x;
  function rands(min_value, max_value, value_count, seed_value=undef) = x;
  function search(match_value, string_or_vector, num_returns_per_match=1, index_col_num=0) = x;
  function ord(x) = x;
  function round(x) = x;
  function sign(x) = x;
  function sin(degrees) = x;
  function str(values) = x;
  function norm(x) = x;
  function pow(base, exponent) = x;
  function concat(values) = x;
  function cos(degrees) = x;
  function cross(a, b) = x;
  function floor(x) = x;
  function exp(x) = x;
  function chr(x) = x;
  function is_undef(x) = x;
  function is_list(x) = x;
  function is_num(x) = x;
  function is_bool(x) = x;
  function is_string(x) = x;
  function is_function(x) = x;

  function version() = '';
  function version_num() = 0;

  $parent_modules=0;
  module parent_module(n) {}

  module children() {}

  module render(convexity=undef) {}
  module surface(file, center=false, invert=false, convexity=undef) {}

  function assert(condition, message=undef) = children();
  module assert(condition, message=undef) children();

  module cube(size, center=false) {}
  module sphere(r, d=undef, $fa, $fs, $fn) {}
  module cylinder(h, r, r1=undef, r2, d, d1, d2, center=false, $fa, $fs, $fn) {}
  module polyhedron(points, faces, convexity=undef) {}

  module square(size, center=false) {}
  module circle(r, d=undef, $fa, $fs, $fn) {}
  module polygon(points, paths, convexity=undef) {}
  module linear_extrude(height, center=false, twist=undef, slices=undef, scale=undef, convexity=undef) children();
  module rotate_extrude(degrees, convexity=undef, $fa, $fs, $fn) children();

  module scale(v) children();
  module resize(newsize, auto=false) children();
  module rotate(a, v=undef) children();
  module translate(v) children();
  module mirror(v) children();
  module multmatrix(m) children();

  module color(c, alpha) children();

  module offset(r, delta=undef, chamfer) children();

  module minkowski() children();
  module union() children();
  module difference() children();
  module intersection() children();
  module hull() children();

  module children() {}

  // module for(i=undef) children();

  module import(file, convexity=undef, $fn, $fa, $fs) {}
`,cl=["abs","acos","asin","atan","atan2","ceil","len","let","ln","log","lookup","max","min","sqrt","tan","rands","search","sign","sin","str","norm","pow","concat","cos","cross","floor","exp","chr"],ul=["children","circle","color","cube","cylinder","diameter","difference","echo","extrude","for","function","hull","if","include","intersection_for","intersection","linear","minkowski","mirror","module","multmatrix","offset","polyhedron","projection","radius","render","resize","rotate","round","scale","sphere","square","surface","translate","union","use","value","version"],fl=["false","true","PI","undef","$children","$fa","$fn","$fs","$t","$vpd","$vpr","$vpt"],dl=t=>({colorizedBracketPairs:[["{","}"],["(",")"],["[","]"]],wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:t.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:t.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:t.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:t.languages.IndentAction.None,removeText:1}}],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string","comment"]},{open:"/**",close:" */",notIn:["string"]}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}}),pl={defaultToken:"invalid",tokenPostfix:".js",keywords:[...cl,...ul,...fl,"each"],typeKeywords:[],operators:["<=",">=","==","!=","=>","+","-","*","/","%","<<",">>",">>>","&","|","^","!","&&","||","?",":","="],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\[abfnrtv\\"']/,digits:/\d+/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},ro={getConf:dl,language:pl};function fs(t,e,n){const s=[],r=[];let o=!0,a=0;for(const u of n.params??[]){if(o)if(u.defaultValue!=null)o=!1;else{s.push(`${u.name.replaceAll("$","\\$")}=${"${"+ ++a+":"+u.name+"}"}`);continue}r.push(u.name)}r.length&&s.push(`${"${"+ ++a+":"+r.join("|")+"=}"}`);let i=`${e.replaceAll("$","\\$")}(${s.join(", ")})`;return n.referencesChildren!==null&&(i+=n.referencesChildren?" ${"+ ++a+":children}":";"),{label:n.signature,kind:t.languages.CompletionItemKind.Function,insertText:i,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}}const ml=t=>[...[!0,!1].map(e=>({label:`${e}`,kind:t.languages.CompletionItemKind.Value,insertText:`${e}`,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...ro.language.keywords.map(e=>({label:e,kind:t.languages.CompletionItemKind.Function,insertText:e,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))],hl=["for(${1:variable}=[${2:start}:${3:end}) ${4:body}","for(${1:variable}=[${2:start}:${3:increment}:${4:end}) ${5:body}",`if (\${1:condition}) {
	$0
} else {
	
}`];function gl(t){return t.replaceAll(/\$\{\d+:([$\w]+)\}/g,"$1").replaceAll(/\$\d+/g,"").replaceAll(/\s+/g," ").trim()}async function yl(t,e,n,s){const r={},o=p=>p.startsWith("/")?p:`${n}/${p}`,a={};for(const[p,{deployed:S,symlinks:I}]of Object.entries(s))if(p!="fonts"&&S!==!1)for(const L in I)a[L]=`${p}/${I[L]}`;async function i(p){p in a&&(p=a[p]),p=o(p);try{const S=e.readFileSync(p);return new TextDecoder("utf-8").decode(S)}catch(S){throw S}}const u="<builtins>";let d;function m(p,S,{skipPrivates:I,addBuiltins:L}){return r[p]??=new Promise(async(P,T)=>{S==null&&(S=await i(p));const f={functions:{},modules:{},vars:[],includes:[],uses:[]},w=(x,c)=>{f.functions={...f.functions,...c.functions},f.modules={...f.modules,...c.modules},x||(f.vars=[...f.vars,...c.vars])},g=(p.split("/").slice(0,-1).join("/")||".")+"/",E=async(x,c)=>{let h=!1;for(const y of[`/libraries/${c}`,`${g}/${c}`,c])try{const v=await i(y),O=await m(c,v,{skipPrivates:!0,addBuiltins:!1});w(x,O),h=!0;break}catch(v){console.warn(`Failed to read file option ${y} for ${c} ${x?"used":"included"} by ${p}`,v)}h||console.error("Failed to find ",c,"(context imported in ",p,")")};L&&p!=u&&w(!1,d);const b=al(p,S,I);await Promise.all([...(b.uses??[]).map(x=>[x,!0]),...(b.includes??[]).map(x=>[x,!1])].map(([x,c])=>E(c,x))),w(!1,b),P(f)})}return d=await m(u,ll,{skipPrivates:!1,addBuiltins:!1}),{triggerCharacters:["<","/"],provideCompletionItems:(async(p,S,I,L)=>{try{const{word:P}=p.getWordUntilPosition(S),T=p.getOffsetAt(S),f=p.getValue();let w=f.substring(0,T);const g=w.lastIndexOf(`
`);w=w.substring(g+1);const E=/\b(include|use)\s*<([^<>\n"]*)$/.exec(w);if(E){const j=E[2];let F,$,A;const D=j.lastIndexOf("/");D<0?(A="",$=j):(A=j.substring(0,D),$=j.substring(D+1));const R=A==""?"":"/"+A;let M=null;for(const K of[tr("/libraries",R),tr(n,R)]){M=A==""?[...Object.keys(a)]:[];try{M=[...e.readdirSync(K)??[],...M];break}catch{}}const B=[];if(!M)console.warn("Failed to find folder named "+R);else for(const K of M){if($!=""&&!K.startsWith($)||/^(LICENSE.*|fonts)$/.test(K)||A==""&&K in s&&s[K].symlinks)continue;const G=!K.endsWith(".scad"),re=K+(G?"":`>
`);B.push({label:K,kind:G?t.languages.CompletionItemKind.Folder:t.languages.CompletionItemKind.File,insertText:re})}return B.sort(),{suggestions:B}}const b=tr(n,"foo.scad");delete r[b];const x=await m(b,f,{skipPrivates:!1,addBuiltins:!0}),c=Sr(w),h=/(^|.*?[{});]|>\s*\n)\s*([$\w]*)$/m.exec(c);if(h){const j=h[1],F=[...ml(t),...zr(x.modules??{},($,A)=>fs(t,$,A),$=>$.indexOf(P)>=0),...(x.vars??[]).filter($=>$.indexOf(P)>=0).map($=>({label:$,kind:t.languages.CompletionItemKind.Variable,insertText:$.replaceAll("$","\\$"),insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...hl.map($=>({label:gl($).replaceAll(/ body/g,""),kind:t.languages.CompletionItemKind.Keyword,insertText:$,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))];return F.sort(($,A)=>$.insertText.indexOf(j)-A.insertText.indexOf(j)),{suggestions:F}}const y=Sr(f),v=[...zr(x.functions??{},(j,F)=>[j,fs(t,j,F)],j=>j.indexOf(P)>=0)];return v.sort(([j],[F])=>j.indexOf(P)-F.indexOf(P)),{suggestions:v.map(([j,F])=>F)}}catch(P){return console.error(P),{suggestions:[]}}})}}async function vl(t,e,n,s){t.languages.register({id:"openscad",extensions:[".scad"],mimetypes:["text/openscad"]});const{getConf:r,language:o}=ro;t.languages.setLanguageConfiguration("openscad",r(t)),t.languages.setMonarchTokensProvider("openscad",o),t.languages.registerCompletionItemProvider("openscad",await yl(t,e,n,s))}function ds(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function bl(t){if(Array.isArray(t))return t}function xl(t,e,n){return(e=Cl(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function El(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e!==0)for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function wl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ps(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ms(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ps(Object(n),!0).forEach(function(s){xl(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ps(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Sl(t,e){if(t==null)return{};var n,s,r=Tl(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(s=0;s<o.length;s++)n=o[s],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Tl(t,e){if(t==null)return{};var n={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(e.indexOf(s)!==-1)continue;n[s]=t[s]}return n}function Rl(t,e){return bl(t)||El(t,e)||Ol(t,e)||wl()}function Il(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Cl(t){var e=Il(t,"string");return typeof e=="symbol"?e:e+""}function Ol(t,e){if(t){if(typeof t=="string")return ds(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ds(t,e):void 0}}function Ml(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function gs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hs(Object(n),!0).forEach(function(s){Ml(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Pl(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(s){return e.reduceRight(function(r,o){return o(r)},s)}}function Qt(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,i=new Array(a),u=0;u<a;u++)i[u]=arguments[u];return e.apply(n,[].concat(r,i))}}}function Bn(t){return{}.toString.call(t).includes("Object")}function Nl(t){return!Object.keys(t).length}function fn(t){return typeof t=="function"}function Al(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _l(t,e){return Bn(e)||ut("changeType"),Object.keys(e).some(function(n){return!Al(t,n)})&&ut("changeField"),e}function jl(t){fn(t)||ut("selectorType")}function Fl(t){fn(t)||Bn(t)||ut("handlerType"),Bn(t)&&Object.values(t).some(function(e){return!fn(e)})&&ut("handlersType")}function Ll(t){t||ut("initialIsRequired"),Bn(t)||ut("initialType"),Nl(t)&&ut("initialContent")}function kl(t,e){throw new Error(t[e]||t.default)}var $l={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ut=Qt(kl)($l),Pn={changes:_l,selector:jl,handler:Fl,initial:Ll};function Dl(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Pn.initial(t),Pn.handler(e);var n={current:t},s=Qt(Vl)(n,e),r=Qt(Bl)(n),o=Qt(Pn.changes)(t),a=Qt(Ul)(n);function i(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(m){return m};return Pn.selector(d),d(n.current)}function u(d){Pl(s,r,o,a)(d)}return[i,u]}function Ul(t,e){return fn(e)?e(t.current):e}function Bl(t,e){return t.current=gs(gs({},t.current),e),e}function Vl(t,e,n){return fn(e)?e(t.current):Object.keys(n).forEach(function(s){var r;return(r=e[s])===null||r===void 0?void 0:r.call(e,t.current[s])}),n}var zl={create:Dl},Hl={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function Kl(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,i=new Array(a),u=0;u<a;u++)i[u]=arguments[u];return e.apply(n,[].concat(r,i))}}}function Gl(t){return{}.toString.call(t).includes("Object")}function Wl(t){return t||ys("configIsRequired"),Gl(t)||ys("configType"),t.urls?(Yl(),{paths:{vs:t.urls.monacoBase}}):t}function Yl(){console.warn(so.deprecation)}function ql(t,e){throw new Error(t[e]||t.default)}var so={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},ys=Kl(ql)(so),Jl={config:Wl},Xl=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return function(r){return n.reduceRight(function(o,a){return a(o)},r)}};function oo(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],oo(t[n],e[n]))}),ms(ms({},t),e)}var Zl={type:"cancelation",msg:"operation is manually canceled"};function ir(t){var e=!1,n=new Promise(function(s,r){t.then(function(o){return e?r(Zl):s(o)}),t.catch(r)});return n.cancel=function(){return e=!0},n}var Ql=["monaco"],ec=zl.create({config:Hl,isInitialized:!1,resolve:null,reject:null,monaco:null}),io=Rl(ec,2),vn=io[0],Yn=io[1];function tc(t){var e=Jl.config(t),n=e.monaco,s=Sl(e,Ql);Yn(function(r){return{config:oo(r.config,s),monaco:n}})}function nc(){var t=vn(function(e){var n=e.monaco,s=e.isInitialized,r=e.resolve;return{monaco:n,isInitialized:s,resolve:r}});if(!t.isInitialized){if(Yn({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),ir(ar);if(window.monaco&&window.monaco.editor)return ao(window.monaco),t.resolve(window.monaco),ir(ar);Xl(rc,oc)(ic)}return ir(ar)}function rc(t){return document.body.appendChild(t)}function sc(t){var e=document.createElement("script");return t&&(e.src=t),e}function oc(t){var e=vn(function(s){var r=s.config,o=s.reject;return{config:r,reject:o}}),n=sc("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function ic(){var t=vn(function(n){var s=n.config,r=n.resolve,o=n.reject;return{config:s,resolve:r,reject:o}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){var s=n.m||n;ao(s),t.resolve(s)},function(n){t.reject(n)})}function ao(t){vn().monaco||Yn({monaco:t})}function ac(){return vn(function(t){var e=t.monaco;return e})}var ar=new Promise(function(t,e){return Yn({resolve:t,reject:e})}),lo={config:tc,init:nc,__getMonacoInstance:ac},lc={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},lr=lc,cc={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},uc=cc;function fc({children:t}){return qe.createElement("div",{style:uc.container},t)}var dc=fc,pc=dc;function mc({width:t,height:e,isEditorReady:n,loading:s,_ref:r,className:o,wrapperProps:a}){return qe.createElement("section",{style:{...lr.wrapper,width:t,height:e},...a},!n&&qe.createElement(pc,null,s),qe.createElement("div",{ref:r,style:{...lr.fullWidth,...!n&&lr.hide},className:o}))}var hc=mc,co=l.memo(hc);function gc(t){l.useEffect(t,[])}var uo=gc;function yc(t,e,n=!0){let s=l.useRef(!0);l.useEffect(s.current||!n?()=>{s.current=!1}:t,e)}var $e=yc;function nn(){}function Lt(t,e,n,s){return vc(t,s)||bc(t,e,n,s)}function vc(t,e){return t.editor.getModel(fo(t,e))}function bc(t,e,n,s){return t.editor.createModel(e,n,s?fo(t,s):void 0)}function fo(t,e){return t.Uri.parse(e)}function xc({original:t,modified:e,language:n,originalLanguage:s,modifiedLanguage:r,originalModelPath:o,modifiedModelPath:a,keepCurrentOriginalModel:i=!1,keepCurrentModifiedModel:u=!1,theme:d="light",loading:m="Loading...",options:p={},height:S="100%",width:I="100%",className:L,wrapperProps:P={},beforeMount:T=nn,onMount:f=nn}){let[w,g]=l.useState(!1),[E,b]=l.useState(!0),x=l.useRef(null),c=l.useRef(null),h=l.useRef(null),y=l.useRef(f),v=l.useRef(T),O=l.useRef(!1);uo(()=>{let A=lo.init();return A.then(D=>(c.current=D)&&b(!1)).catch(D=>D?.type!=="cancelation"&&console.error("Monaco initialization: error:",D)),()=>x.current?$():A.cancel()}),$e(()=>{if(x.current&&c.current){let A=x.current.getOriginalEditor(),D=Lt(c.current,t||"",s||n||"text",o||"");D!==A.getModel()&&A.setModel(D)}},[o],w),$e(()=>{if(x.current&&c.current){let A=x.current.getModifiedEditor(),D=Lt(c.current,e||"",r||n||"text",a||"");D!==A.getModel()&&A.setModel(D)}},[a],w),$e(()=>{let A=x.current.getModifiedEditor();A.getOption(c.current.editor.EditorOption.readOnly)?A.setValue(e||""):e!==A.getValue()&&(A.executeEdits("",[{range:A.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),A.pushUndoStop())},[e],w),$e(()=>{x.current?.getModel()?.original.setValue(t||"")},[t],w),$e(()=>{let{original:A,modified:D}=x.current.getModel();c.current.editor.setModelLanguage(A,s||n||"text"),c.current.editor.setModelLanguage(D,r||n||"text")},[n,s,r],w),$e(()=>{c.current?.editor.setTheme(d)},[d],w),$e(()=>{x.current?.updateOptions(p)},[p],w);let j=l.useCallback(()=>{if(!c.current)return;v.current(c.current);let A=Lt(c.current,t||"",s||n||"text",o||""),D=Lt(c.current,e||"",r||n||"text",a||"");x.current?.setModel({original:A,modified:D})},[n,e,r,t,s,o,a]),F=l.useCallback(()=>{!O.current&&h.current&&(x.current=c.current.editor.createDiffEditor(h.current,{automaticLayout:!0,...p}),j(),c.current?.editor.setTheme(d),g(!0),O.current=!0)},[p,d,j]);l.useEffect(()=>{w&&y.current(x.current,c.current)},[w]),l.useEffect(()=>{!E&&!w&&F()},[E,w,F]);function $(){let A=x.current?.getModel();i||A?.original?.dispose(),u||A?.modified?.dispose(),x.current?.dispose()}return qe.createElement(co,{width:I,height:S,isEditorReady:w,loading:m,_ref:h,className:L,wrapperProps:P})}var Ec=xc;l.memo(Ec);function wc(t){let e=l.useRef();return l.useEffect(()=>{e.current=t},[t]),e.current}var Sc=wc,Nn=new Map;function Tc({defaultValue:t,defaultLanguage:e,defaultPath:n,value:s,language:r,path:o,theme:a="light",line:i,loading:u="Loading...",options:d={},overrideServices:m={},saveViewState:p=!0,keepCurrentModel:S=!1,width:I="100%",height:L="100%",className:P,wrapperProps:T={},beforeMount:f=nn,onMount:w=nn,onChange:g,onValidate:E=nn}){let[b,x]=l.useState(!1),[c,h]=l.useState(!0),y=l.useRef(null),v=l.useRef(null),O=l.useRef(null),j=l.useRef(w),F=l.useRef(f),$=l.useRef(void 0),A=l.useRef(s),D=Sc(o),R=l.useRef(!1),M=l.useRef(!1);uo(()=>{let G=lo.init();return G.then(re=>(y.current=re)&&h(!1)).catch(re=>re?.type!=="cancelation"&&console.error("Monaco initialization: error:",re)),()=>v.current?K():G.cancel()}),$e(()=>{let G=Lt(y.current,t||s||"",e||r||"",o||n||"");G!==v.current?.getModel()&&(p&&Nn.set(D,v.current?.saveViewState()),v.current?.setModel(G),p&&v.current?.restoreViewState(Nn.get(o)))},[o],b),$e(()=>{v.current?.updateOptions(d)},[d],b),$e(()=>{!v.current||s===void 0||(v.current.getOption(y.current.editor.EditorOption.readOnly)?v.current.setValue(s):s!==v.current.getValue()&&(M.current=!0,v.current.executeEdits("",[{range:v.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),v.current.pushUndoStop(),M.current=!1))},[s],b),$e(()=>{let G=v.current?.getModel();b&&G&&r&&y.current?.editor.setModelLanguage(G,r)},[r,b],b),$e(()=>{i!==void 0&&v.current?.revealLine(i)},[i],b),$e(()=>{y.current?.editor.setTheme(a)},[a],b);let B=l.useCallback(()=>{if(!(!O.current||!y.current)&&!R.current){F.current(y.current);let G=o||n,re=Lt(y.current,s||t||"",e||r||"",G||"");v.current=y.current?.editor.create(O.current,{model:re,automaticLayout:!0,...d},m),p&&v.current.restoreViewState(Nn.get(G)),y.current.editor.setTheme(a),i!==void 0&&v.current.revealLine(i),x(!0),R.current=!0}},[t,e,n,s,r,o,d,m,p,a,i]);l.useEffect(()=>{b&&j.current(v.current,y.current)},[b]),l.useEffect(()=>{!c&&!b&&B()},[c,b,B]),A.current=s,l.useEffect(()=>{b&&g&&($.current?.dispose(),$.current=v.current?.onDidChangeModelContent(G=>{M.current||g(v.current.getValue(),G)}))},[b,g]),l.useEffect(()=>{if(b){let G=y.current.editor.onDidChangeMarkers(re=>{let ye=v.current.getModel()?.uri;if(ye&&re.find(ue=>ue.path===ye.path)){let ue=y.current.editor.getModelMarkers({resource:ye});E?.(ue)}});return()=>{G?.dispose()}}return()=>{}},[b,E]);function K(){$.current?.dispose(),S?p&&Nn.set(o,v.current.saveViewState()):v.current.getModel()?.dispose(),v.current.dispose(),v.current=null,R.current=!1,x(!1)}return qe.createElement(co,{width:I,height:L,isEditorReady:b,loading:u,_ref:O,className:P,wrapperProps:T})}var Rc=Tc,Ic=l.memo(Rc),Cc=Ic;function Ct(){return Ct=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ct.apply(null,arguments)}function Tr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Oc(t){if(Array.isArray(t))return Tr(t)}function Mc(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function po(t,e){if(t){if(typeof t=="string")return Tr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tr(t,e):void 0}}function Pc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nc(t){return Oc(t)||Mc(t)||po(t)||Pc()}function dn(t){"@babel/helpers - typeof";return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(t)}function Ac(t,e){if(dn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(dn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _c(t){var e=Ac(t,"string");return dn(e)=="symbol"?e:e+""}function Vn(t,e,n){return(e=_c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jc(t){if(Array.isArray(t))return t}function Fc(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function Lc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qt(t,e){return jc(t)||Fc(t,e)||po(t,e)||Lc()}var kc={root:function(e){var n=e.props,s=e.focusedState,r=e.context,o=e.overlayVisibleState,a=e.isValueEmpty;return le("p-treeselect p-component p-inputwrapper",{"p-treeselect-chip":n.display==="chip","p-treeselect-clearable":n.showClear&&!n.disabled,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-focus":s,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled","p-inputwrapper-filled":!a,"p-inputwrapper-focus":s||o})},label:function(e){var n=e.props,s=e.isValueEmpty,r=e.getLabel;return le("p-treeselect-label",{"p-placeholder":r()===n.placeholder,"p-treeselect-label-empty":!n.placeholder&&s})},panel:function(e){var n=e.panelProps,s=e.context;return le("p-treeselect-panel p-component",n.panelClassName,{"p-input-filled":s&&s.inputStyle==="filled"||De.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||De.ripple===!1})},labelContainer:"p-treeselect-label-container",tokenLabel:"p-treeselect-token-label",token:"p-treeselect-token",trigger:"p-treeselect-trigger",triggerIcon:"p-treeselect-trigger-icon p-clickable",emptyMessage:"p-treeselect-empty-message",filterContainer:"p-treeselect-filter-container",filter:"p-treeselect-filter p-inputtext p-component",filterIcon:"p-treeselect-filter-icon",closeIcon:"p-treeselect-close-icon",clearIcon:"p-treeselect-clear-icon p-clickable",closeButton:"p-treeselect-close p-link",header:"p-treeselect-header",wrapper:"p-treeselect-items-wrapper",transition:"p-connected-overlay"},$c=`
@layer primereact {
    .p-treeselect {
        display: inline-flex;
        cursor: pointer;
        position: relative;
        user-select: none;
    }

    .p-treeselect-trigger {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .p-treeselect-label-container {
        overflow: hidden;
        flex: 1 1 auto;
        cursor: pointer;
    }

    .p-treeselect-label  {
        display: block;
        white-space: nowrap;
        cursor: pointer;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .p-treeselect-label-empty {
        overflow: hidden;
        visibility: hidden;
    }

    .p-treeselect-token {
        cursor: default;
        display: inline-flex;
        align-items: center;
        flex: 0 0 auto;
    }

    .p-treeselect .p-treeselect-panel {
        min-width: 100%;
    }

    .p-treeselect-items-wrapper {
        overflow: auto;
    }

    .p-treeselect-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .p-treeselect-filter-container {
        position: relative;
        flex: 1 1 auto;
    }

    .p-treeselect-filter-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-treeselect-filter-container .p-inputtext {
        width: 100%;
    }

    .p-treeselect-close {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
        position: relative;
        margin-left: auto;
    }

    .p-treeselect-clear-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-fluid .p-treeselect {
        display: flex;
}
}
`,Jt=dt.extend({defaultProps:{__TYPE:"TreeSelect",appendTo:null,ariaLabel:null,ariaLabelledBy:null,className:null,closeIcon:null,clearIcon:null,disabled:!1,display:"comma",dropdownIcon:null,emptyMessage:null,expandedKeys:null,filter:!1,filterBy:"label",filterDelay:300,filterIcon:null,filterInputAutoFocus:!0,filterLocale:void 0,filterMode:"lenient",filterPlaceholder:null,filterTemplate:null,filterValue:null,inputId:null,inputRef:null,invalid:!1,variant:null,metaKeySelection:!1,name:null,nodeTemplate:null,onChange:null,onFocus:null,onBlur:null,onFilterValueChange:null,onHide:null,onNodeClick:null,onNodeCollapse:null,onNodeDoubleClick:null,onNodeExpand:null,onNodeSelect:null,onNodeUnselect:null,onShow:null,options:null,panelClassName:null,panelFooterTemplate:null,panelHeaderTemplate:null,panelStyle:null,placeholder:null,resetFilterOnHide:!1,scrollHeight:"400px",selectionMode:"single",showClear:!1,style:null,tabIndex:null,togglerTemplate:null,transitionOptions:null,value:null,valueTemplate:null,children:void 0},css:{classes:kc,styles:$c}});function vs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Dc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vs(Object(n),!0).forEach(function(s){Vn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var mo=l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=t.ptm,o=t.cx,a=function(p,S){return r(p,Dc({hostName:t.hostName},S))},i=function(p){p.key==="Escape"&&(p.preventDefault(),t.hide())},u=function(){var p={maxHeight:t.scrollHeight||"auto"},S=n({className:o("panel",{panelProps:t,context:s}),style:t.panelStyle,onKeyDown:i,onClick:t.onClick},a("panel")),I=n({className:o("wrapper"),style:p},a("wrapper")),L=n({classNames:o("transition"),in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},a("transition"));return l.createElement(yn,Ct({nodeRef:e},L),l.createElement("div",Ct({ref:e},S),t.firstHiddenFocusableElementOnOverlay,t.header,l.createElement("div",I,t.children),t.footer,t.lastHiddenFocusableElementOnOverlay))},d=u();return l.createElement(Ar,{element:d,appendTo:t.appendTo})});mo.displayName="TreeSelectPanel";function bs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bs(Object(n),!0).forEach(function(s){Vn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Xt(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Uc(t))||e){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(d){throw d},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var d=n.next();return a=d.done,d},e:function(d){i=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(i)throw o}}}}function Uc(t,e){if(t){if(typeof t=="string")return xs(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xs(t,e):void 0}}function xs(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}var ho=l.memo(l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=Jt.getProps(t,s),o=l.useState(!1),a=qt(o,2),i=a[0],u=a[1],d=l.useState(!1),m=qt(d,2),p=m[0],S=m[1],I=l.useState(r.expandedKeys),L=qt(I,2),P=L[0],T=L[1],f=Xo("",r.filterDelay||0),w=qt(f,3),g=w[0],E=w[1],b=w[2],x=l.useRef(null),c=l.useRef(null),h=l.useRef(null),y=l.useRef(r.inputRef),v=l.useRef(null),O=l.useRef(null),j=l.useRef(null),F=l.useRef(null),$=l.useRef(null),A=l.useRef(!1),D=l.useRef(""),R=r.onToggle?r.expandedKeys:P,M=r.onFilterValueChange?r.filterValue:E,B=oe.isEmpty(r.value),K=r.selectionMode==="single",G=r.selectionMode==="checkbox",re=oe.isNotEmpty(r.tooltip),ye={props:r,state:{focused:i,overlayVisible:p,expandedKeys:R,filterValue:M}},ue=Jt.setMetaData(ye),ee=ue.ptm,ie=ue.cx,Re=ue.isUnstyled;pt(Jt.css.styles,Re,{name:"treeselect"});var Be={filter:function(C){return z(C)},reset:function(){return Z()}},Oe=Fs({target:x,overlay:c,listener:function(C,W){var fe=W.valid,pe=W.type;fe&&(pe==="outside"||s.hideOverlaysOnDocumentScrolling?be():X.isDocument(C.target)||ht())},when:p}),me=qt(Oe,2),Ie=me[0],ve=me[1],_e=function(){return Gt.length?Gt.map(function(C){return C.label}).join(", "):r.placeholder},Me=function(){S(!0)},be=function(){S(!1),y.current&&X.focus(y.current)},Pe=function(){u(!0),r.onFocus&&r.onFocus()},Fe=function(){u(!1),r.onBlur&&r.onBlur()},Le=function(C){!r.disabled&&(!c.current||!c.current.contains(C.target))&&!X.isAttributeEquals(C.target,"data-pc-section","closebutton")&&(X.focus(y.current),p?be():Me())},et=function(C){r.onChange&&(O.current=!0,r.onChange({originalEvent:C.originalEvent,value:C.value,stopPropagation:function(){C.originalEvent.stopPropagation()},preventDefault:function(){C.originalEvent.preventDefault()},target:{name:r.name,id:r.id,value:C.value}}))},tt=function(C){r.onChange&&(O.current=!0,r.onChange({originalEvent:C,value:void 0,stopPropagation:function(){C?.stopPropagation()},preventDefault:function(){C?.preventDefault()},target:{name:r.name,id:r.id,value:void 0}}))},nt=function(C){(C.key==="Enter"||C.code==="Space")&&(tt(C),C.preventDefault())},je=function(C){r.onNodeSelect&&r.onNodeSelect(C),K&&be()},it=function(C){r.onNodeUnselect&&r.onNodeUnselect(C),G&&C.originalEvent.stopPropagation()},ce=function(C){r.onToggle?r.onToggle(C):T(C.value)},k=function(C){b(C.value)},q=function(C){Us.emit("overlay-click",{originalEvent:C,target:x.current})},Q=function(C){var W=C.relatedTarget===y.current?X.getFirstFocusableElement(c.current,':not([data-p-hidden-focusable="true"])'):y.current;X.focus(W)},de=function(C){var W=C.relatedTarget===y.current?X.getLastFocusableElement(c.current,':not([data-p-hidden-focusable="true"])'):y.current;X.focus(W)},U=function(C,W){switch(C.code){case"ArrowDown":C.preventDefault(),jt();break;case"ArrowUp":C.preventDefault(),y.current&&X.focus(y.current);break;case"Enter":case"NumpadEnter":C.preventDefault(),W&&be();break;case"Escape":rt(C);break}},V=function(C){switch(C.code){case"ArrowDown":ne(C);break;case"Space":case"Enter":case"NumpadEnter":Ee(C);break;case"Escape":rt(C);break;case"Tab":p&&(C.preventDefault(),C.shiftKey?jt():te(C));break}},ne=function(C){p||(A.current=!0,Me(),C.preventDefault())},Ee=function(C){p?be():ne(C),C.preventDefault()},rt=function(C){p&&(be(),C.preventDefault())},te=function(C){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;W||p&&N()&&(X.focus(F.current),C.preventDefault())},N=function(){return X.getFocusableElements(c.current,':not([data-p-hidden-focusable="true"])').length>0},z=function(C){var W=C.target.value;r.onFilterValueChange?r.onFilterValueChange({originalEvent:C,value:W}):b(W)},Z=function(){b("")},we=function(){Je.set("overlay",c.current,s&&s.autoZIndex||De.autoZIndex,s&&s.zIndex.overlay||De.zIndex.overlay),X.addStyles(c.current,{position:"absolute",top:"0",left:"0"}),jt(),ht(),Xn()},_t=function(){Ie(),r.filter&&r.filterInputAutoFocus&&X.focus(h.current,r.filterInputAutoFocus),r.onShow&&r.onShow()},mt=function(){ve()},zt=function(){r.filter&&r.resetFilterOnHide&&Z(),Je.clear(c.current),r.onHide&&r.onHide()},ht=function(){X.alignOverlay(c.current,v.current.parentElement,r.appendTo||s&&s.appendTo||De.appendTo)},Xn=function(){var C=X.findSingle(c.current,'[data-pc-section="content"][data-p-highlight="true"]');C&&C.scrollIntoView&&C.scrollIntoView({block:"nearest",inline:"start"})},Ht=function(C,W,fe){if(C){if(Ve(C,W)&&(fe.push(C),delete W[C.key]),Object.keys(W).length&&C.children){var pe=Xt(C.children),Ce;try{for(pe.s();!(Ce=pe.n()).done;){var ze=Ce.value;Ht(ze,W,fe)}}catch(He){pe.e(He)}finally{pe.f()}}}else{var Se=Xt(r.options),Ge;try{for(Se.s();!(Ge=Se.n()).done;){var vt=Ge.value;Ht(vt,W,fe)}}catch(He){Se.e(He)}finally{Se.f()}}},Ve=function(C,W){return G?W[C.key]&&W[C.key].checked:W[C.key]},Kt=function(){var C=K?Vn({},"".concat(r.value),!0):at({},r.value);T({}),C&&r.options&&gt(null,null,C)},jt=function(){var C,W=X.find((C=j.current)===null||C===void 0?void 0:C.getElement(),'[data-pc-section="node"]'),fe=Nc(W).find(function(pe){return pe.getAttribute("tabindex")==="0"});X.focus(fe)},gt=function(C,W,fe){if(C){if(Ve(C,fe)&&(Zn(W),delete fe[C.key]),Object.keys(fe).length&&C.children){var pe=Xt(C.children),Ce;try{for(pe.s();!(Ce=pe.n()).done;){var ze=Ce.value;W.push(C.key),gt(ze,W,fe)}}catch(He){pe.e(He)}finally{pe.f()}}}else{var Se=Xt(r.options),Ge;try{for(Se.s();!(Ge=Se.n()).done;){var vt=Ge.value;gt(vt,[],fe)}}catch(He){Se.e(He)}finally{Se.f()}}},Zn=function(C){if(C.length>0){var W=at({},P||{}),fe=Xt(C),pe;try{for(fe.s();!(pe=fe.n()).done;){var Ce=pe.value;W[Ce]=!0}}catch(ze){fe.e(ze)}finally{fe.f()}T(W)}},Qn=function(){var C=[];if(oe.isNotEmpty(r.value)&&r.options){var W=K?Vn({},"".concat(r.value),!0):at({},r.value);Ht(null,W,C)}return C};l.useImperativeHandle(e,function(){return{props:r,clear:tt,show:Me,hide:be,focus:function(){return X.focus(y.current)},getElement:function(){return x.current}}}),l.useEffect(function(){oe.combinedRefs(y,r.inputRef)},[y,r.inputRef]),gn(function(){Kt(),D.current=Wn()+"_list",r.autoFocus&&X.focus(y.current,r.autoFocus),ht()}),Et(function(){p&&r.filter&&ht()}),Et(function(){Kt()},[r.options]),Et(function(){A.current&&p&&(A.current=!1,jt())},[p]),Et(function(){p&&P&&ht()},[P]),Et(function(){p&&(O.current||Kt(),O.current=!1)},[r.value]),Nr(function(){Je.clear(c.current)});var yt=function(){var C=n({className:"p-hidden-accessible"},ee("hiddenInputWrapper")),W=n(at({ref:y,role:"listbox",id:r.inputId,type:"text","aria-expanded":p,"aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-haspopup":"tree","aria-controls":D.current,onFocus:Pe,onBlur:Fe,onKeyDown:V,disabled:r.disabled,tabIndex:r.tabIndex},$o),ee("hiddenInput"));return l.createElement("div",C,l.createElement("input",Ct({},W,{readOnly:!0})))},ke=function(){var C=n({className:ie("token")},ee("token")),W=n({className:ie("tokenLabel")},ee("tokenLabel")),fe=n({className:ie("labelContainer")},ee("labelContainer")),pe=n({className:ie("label",{isValueEmpty:B,getLabel:_e})},ee("label")),Ce=null;return r.valueTemplate?Ce=oe.getJSXElement(r.valueTemplate,Gt,r):r.display==="comma"?Ce=_e()||"empty":r.display==="chip"&&(Ce=l.createElement(l.Fragment,null,Gt&&Gt.map(function(ze,Se){return l.createElement("div",Ct({},C,{key:"".concat(ze.key,"_").concat(Se)}),l.createElement("span",W,ze.label))}),B&&(r.placeholder||"empty"))),l.createElement("div",fe,l.createElement("div",pe,Ce))},No=function(){var C=n({ref:v,className:ie("trigger"),role:"button","aria-haspopup":"tree","aria-expanded":p},ee("trigger")),W=n({className:ie("triggerIcon")},ee("triggerIcon")),fe=r.dropdownIcon||l.createElement(hi,W),pe=Xe.getJSXIcon(fe,at({},W),{props:r});return l.createElement("div",C,pe)},Ao=function(){if(r.value!=null&&r.showClear&&!r.disabled){var C=n({className:ie("clearIcon"),onPointerUp:tt,tabIndex:r.tabIndex||"0",onKeyDown:nt,"aria-label":Zo("clear")},ee("clearIcon")),W=r.clearIcon||l.createElement(fr,C);return Xe.getJSXIcon(W,at({},C),{props:r})}return null},_o=function(){return l.createElement(li,{ref:j,id:D.current,emptyMessage:r.emptyMessage,expandedKeys:R,filter:r.filter,filterBy:r.filterBy,filterDelay:r.filterDelay,filterLocale:r.filterLocale,filterMode:r.filterMode,filterPlaceholder:r.filterPlaceholder,filterValue:M,metaKeySelection:r.metaKeySelection,nodeTemplate:r.nodeTemplate,onCollapse:r.onNodeCollapse,onExpand:r.onNodeExpand,onFilterValueChange:k,onNodeClick:r.onNodeClick,onNodeDoubleClick:r.onNodeDoubleClick,onSelect:je,onSelectionChange:et,onToggle:ce,onUnselect:it,selectionKeys:r.value,selectionMode:r.selectionMode,showHeader:!1,togglerTemplate:r.togglerTemplate,value:r.options,pt:ee("tree"),__parentMetadata:{parent:ye}})},jo=function(){if(r.filter){var C=r.onFilterValueChange?r.filterValue:g;C=oe.isNotEmpty(C)?C:"";var W=n({className:ie("filterContainer")},ee("filterContainer")),fe=n({ref:h,type:"text",value:C,autoComplete:"off",className:ie("filter"),placeholder:r.filterPlaceholder,onKeyDown:function(He){return U(He,!1)},onChange:z,disabled:r.disabled},ee("filter")),pe=n({className:ie("filterIcon")},ee("filterIcon")),Ce=r.filterIcon||l.createElement(gi,pe),ze=Xe.getJSXIcon(Ce,at({},pe),{props:r}),Se=l.createElement("div",W,l.createElement("input",fe),ze);if(r.filterTemplate){var Ge={className:"p-treeselect-filter-container",element:Se,filterOptions:Be,filterInputKeyDown:function(He){return U(He,function(){})},filterInputChange:z,filterIconClassName:"p-dropdown-filter-icon",props:r};Se=oe.getJSXElement(r.filterTemplate,Ge)}return l.createElement(l.Fragment,null,Se)}},Fo=function(){var C=jo(),W=n({className:ie("closeIcon"),"aria-hidden":!0},ee("closeIcon")),fe=r.closeIcon||l.createElement(fr,W),pe=Xe.getJSXIcon(fe,at({},W),{props:r}),Ce=n({type:"button",className:ie("closeButton"),onKeyDown:function(qo){return U(qo,!0)},onClick:be,"aria-label":As("close")},ee("closeButton")),ze=n({className:ie("header")},ee("header")),Se=l.createElement("button",Ce,pe,l.createElement(hn,null)),Ge=l.createElement("div",ze,C,Se);if(r.panelHeaderTemplate){var vt={className:"p-treeselect-header",filterElement:C,closeElement:Se,closeElementClassName:"p-treeselect-close p-link",closeIconClassName:"p-treeselect-close-icon",onCloseClick:be,element:Ge,props:r};return l.createElement("div",null,Ge,oe.getJSXElement(r.panelHeaderTemplate,vt))}return Ge},Lo=function(){return oe.getJSXElement(r.panelFooterTemplate,r)},Gt=Qn(),ko=Jt.getOtherProps(r),$o=oe.reduceKeys(ko,X.ARIA_PROPS),Do=n({ref:F,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:Q,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},ee("firstHiddenFocusableElementOnOverlay")),Uo=n({ref:$,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:de,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},ee("lastHiddenFocusableElementOnOverlay")),Bo=n({ref:x,className:le(r.className,ie("root",{context:s,focusedState:i,overlayVisibleState:p,isValueEmpty:B})),style:r.style,onClick:Le},Jt.getOtherProps(r),ee("root")),Vo=yt(),zo=ke(),Ho=No(),Ko=Ao(),Go=_o(),Wo=Fo(),Yo=Lo();return l.createElement("div",Bo,Vo,zo,Ko,Ho,l.createElement(mo,{hostName:"TreeSelect",ref:c,appendTo:r.appendTo,panelStyle:r.panelStyle,panelClassName:r.panelClassName,scrollHeight:r.scrollHeight,onClick:q,header:Wo,hide:be,footer:Yo,firstHiddenFocusableElementOnOverlay:l.createElement("span",Do),lastHiddenFocusableElementOnOverlay:l.createElement("span",Uo),transitionOptions:r.transitionOptions,in:p,onEnter:we,onEntered:_t,onExit:mt,onExited:zt,ptm:ee,cx:ie},Go),re&&l.createElement(_r,Ct({target:x,content:r.tooltip,pt:ee("tooltip")},r.tooltipOptions)))}));ho.displayName="TreeSelect";function go(t,e=500){const n=l.useRef(null);return l.useCallback((...r)=>{n.current&&clearTimeout(n.current),n.current=window.setTimeout(()=>{t(...r)},e)},[t,e])}function pn(t){"@babel/helpers - typeof";return pn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pn(t)}function Bc(t,e){if(pn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(pn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Vc(t){var e=Bc(t,"string");return pn(e)=="symbol"?e:e+""}function zc(t,e,n){return(e=Vc(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function St(){return St=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},St.apply(null,arguments)}function Rr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Hc(t){if(Array.isArray(t))return Rr(t)}function Kc(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function yo(t,e){if(t){if(typeof t=="string")return Rr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rr(t,e):void 0}}function Gc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Es(t){return Hc(t)||Kc(t)||yo(t)||Gc()}function Wc(t){if(Array.isArray(t))return t}function Yc(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,o,a,i=[],u=!0,d=!1;try{if(o=(n=n.call(t)).next,e!==0)for(;!(u=(s=o.call(n)).done)&&(i.push(s.value),i.length!==e);u=!0);}catch(m){d=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}function qc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ft(t,e){return Wc(t)||Yc(t,e)||yo(t,e)||qc()}var Jc=`
@layer primereact {
    .p-menu-overlay {
        position: absolute;
        /* Github #3122: Prevent animation flickering  */
        top: -9999px;
        left: -9999px;
    }

    .p-menu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-menu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-menu .p-menuitem-text {
        line-height: 1;
    }
}
`,Xc={root:function(e){var n=e.props,s=e.context;return le("p-menu p-component",{"p-menu-overlay":n.popup,"p-input-filled":s&&s.inputStyle==="filled"||De.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||De.ripple===!1})},menu:"p-menu-list p-reset",content:function(e){var n=e.item;return le("p-menuitem-content",{"p-disabled":n.disabled})},action:function(e){var n=e.item;return le("p-menuitem-link",{"p-disabled":n.disabled})},menuitem:function(e){var n=e.focused;return le("p-menuitem",{"p-focus":n})},submenuHeader:function(e){var n=e.submenu;return le("p-submenu-header",{"p-disabled":n.disabled})},separator:"p-menu-separator",label:"p-menuitem-text",icon:"p-menuitem-icon",transition:"p-connected-overlay"},Zc={submenuHeader:function(e){var n=e.submenu;return n.style},menuitem:function(e){var n=e.item;return n.style}},An=dt.extend({defaultProps:{__TYPE:"Menu",id:null,ariaLabel:null,ariaLabelledBy:null,tabIndex:0,model:null,popup:!1,popupAlignment:"left",style:null,className:null,autoZIndex:!0,baseZIndex:0,appendTo:null,onFocus:null,onBlur:null,transitionOptions:null,onShow:null,onHide:null,children:void 0,closeOnEscape:!0},css:{classes:Xc,styles:Jc,inlineStyles:Zc}});function ws(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Qc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ws(Object(n),!0).forEach(function(s){zc(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ws(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var vo=l.memo(l.forwardRef(function(t,e){var n=Qe(),s=l.useContext(ot),r=An.getProps(t,s),o=l.useState(r.id),a=Ft(o,2),i=a[0],u=a[1],d=l.useState(!r.popup),m=Ft(d,2),p=m[0],S=m[1],I=l.useState(-1),L=Ft(I,2),P=L[0],T=L[1],f=l.useState(-1),w=Ft(f,2),g=w[0],E=w[1],b=l.useState(!1),x=Ft(b,2),c=x[0],h=x[1],y=An.setMetaData({props:r,state:{id:i,visible:p,focused:c}}),v=y.ptm,O=y.cx,j=y.sx,F=y.isUnstyled,$=function(N,z){return v(N,{context:z})};pt(An.css.styles,F,{name:"menu"});var A=l.useRef(null),D=l.useRef(null),R=l.useRef(null),M=!!(p&&r.popup&&r.closeOnEscape),B=Qo("menu",M);ei({callback:function(N){je(N)},when:M&&B,priority:[ti.MENU,B]});var K=Fs({target:R,overlay:A,listener:function(N,z){var Z=z.valid,we=z.type;Z&&(s.hideOverlaysOnDocumentScrolling||we==="outside"?(je(N),T(-1)):X.isDocument(N.target)||X.absolutePosition(A.current,R.current,r.popupAlignment))},when:p}),G=Ft(K,2),re=G[0],ye=G[1],ue=function(N){r.popup&&Us.emit("overlay-click",{originalEvent:N,target:R.current})},ee=function(N,z,Z){if(z.disabled){N.preventDefault();return}z.command&&z.command({originalEvent:N,item:z}),r.popup&&je(N),!r.popup&&P!==Z&&T(Z),z.url||(N.preventDefault(),N.stopPropagation())},ie=function(N,z){N&&r.popup&&P!==z&&T(z)},Re=function(N){h(!0),r.popup||(g!==-1?(Le(g),E(-1)):Le(0)),r.onFocus&&r.onFocus(N)},Be=function(N){var z=N.currentTarget,Z=N.relatedTarget;Z&&z.contains(Z)||(h(!1),T(-1),r.onBlur&&r.onBlur(N))},Oe=function(N){switch(N.code){case"ArrowDown":me(N);break;case"ArrowUp":Ie(N);break;case"Home":ve(N);break;case"End":_e(N);break;case"Enter":case"NumpadEnter":Me(N);break;case"Space":be(N);break;case"Escape":r.popup&&(X.focus(R.current),je(N));case"Tab":r.popup&&p&&je(N);break}},me=function(N){var z=Pe(P);Le(z),N.preventDefault()},Ie=function(N){if(N.altKey&&r.popup)X.focus(R.current),je(N),N.preventDefault();else{var z=Fe(P);Le(z),N.preventDefault()}},ve=function(N){Le(0),N.preventDefault()},_e=function(N){Le(X.find(A.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]').length-1),N.preventDefault()},Me=function(N){var z=X.findSingle(A.current,'li[id="'.concat("".concat(P),'"]')),Z=z&&X.findSingle(z,'a[data-pc-section="action"]');r.popup&&X.focus(R.current),Z?Z.click():z&&z.click(),N.preventDefault()},be=function(N){Me(N)},Pe=function(N){var z=X.find(A.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),Z=Es(z).findIndex(function(we){return we.id===N});return Z>-1?Z+1:0},Fe=function(N){var z=X.find(A.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),Z=Es(z).findIndex(function(we){return we.id===N});return Z>-1?Z-1:0},Le=function(N){var z=X.find(A.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),Z=N>=z.length?z.length-1:N<0?0:N;Z>-1&&T(z[Z].getAttribute("id"))},et=function(){return P!==-1?P:null},tt=function(N){r.popup&&(p?je(N):nt(N))},nt=function(N){R.current=N.currentTarget,S(!0),r.onShow&&r.onShow(N)},je=function(N){R.current=N.currentTarget,S(!1),r.onHide&&r.onHide(N)},it=function(){X.addStyles(A.current,{position:"absolute",top:"0",left:"0"}),Je.set("menu",A.current,s&&s.autoZIndex||De.autoZIndex,r.baseZIndex||s&&s.zIndex.menu||De.zIndex.menu),X.absolutePosition(A.current,R.current,r.popupAlignment),r.popup&&(X.focus(D.current),Le(0))},ce=function(){re()},k=function(){R.current=null,ye()},q=function(){Je.clear(A.current)};gn(function(){i||u(Wn())}),Nr(function(){Je.clear(A.current)}),l.useImperativeHandle(e,function(){return{props:r,toggle:tt,show:nt,hide:je,getElement:function(){return A.current},getTarget:function(){return R.current}}});var Q=function(N,z){var Z=i+"_sub_"+z,we=N.items.map(function(mt,zt){return U(mt,zt,Z)}),_t=n({id:Z,role:"none",className:le(N.className,O("submenuHeader",{submenu:N})),style:j("submenuHeader",{submenu:N}),"data-p-disabled":N.disabled},v("submenuHeader"));return l.createElement(l.Fragment,{key:Z},l.createElement("li",St({},_t,{key:Z}),N.label),we)},de=function(N,z){if(N.visible===!1)return null;var Z=i+"_separator_"+z,we=n({id:Z,className:le(N.className,O("separator")),role:"separator"},v("separator"));return l.createElement("li",St({},we,{key:Z}))},U=function(N,z){var Z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(N.visible===!1)return null;var we={item:N,index:z,parentId:Z},_t=le("p-menuitem-link",{"p-disabled":N.disabled}),mt=le("p-menuitem-icon",N.icon),zt=n({className:O("icon")},$("icon",we)),ht=Xe.getJSXIcon(N.icon,Qc({},zt),{props:r}),Xn=n({className:O("label")},$("label",we)),Ht=N.label&&l.createElement("span",Xn,N.label),Ve=N.id||(Z||i)+"_"+z,Kt=n({onClick:function(ke){return ee(ke,N,Ve)},onMouseMove:function(ke){return ie(ke,Ve)},className:O("content",{item:N})},$("content",we)),jt=n({href:N.url||"#",className:O("action",{item:N}),onFocus:function(ke){return ke.stopPropagation()},target:N.target,tabIndex:"-1","aria-label":N.label,"aria-disabled":N.disabled,"data-p-disabled":N.disabled},$("action",we)),gt=l.createElement("div",Kt,l.createElement("a",jt,ht,Ht,l.createElement(hn,null)));if(N.template){var Zn={onClick:function(ke){return ee(ke,N,Ve)},onMouseMove:function(ke){return ie(ke,Ve)},className:_t,tabIndex:"-1",labelClassName:"p-menuitem-text",iconClassName:mt,element:gt,props:r};gt=oe.getJSXElement(N.template,N,Zn)}var Qn=n({id:Ve,className:le(N.className,O("menuitem",{focused:P===Ve})),onClick:function(ke){return ee(ke,N,Ve)},style:j("menuitem",{item:N}),role:"menuitem","aria-label":N.label,"aria-disabled":N.disabled,"data-p-focused":et()===Ve,"data-p-disabled":N.disabled||!1},$("menuitem",we));return l.createElement("li",St({},Qn,{key:Ve}),gt)},V=function(N,z){return N.visible===!1?null:N.separator?de(N,z):N.items?Q(N,z):U(N,z)},ne=function(){return r.model.map(V)},Ee=function(){if(r.model){var N=ne(),z=n({className:le(r.className,O("root",{context:s})),style:r.style,onClick:function(mt){return ue(mt)}},An.getOtherProps(r),v("root")),Z=n({ref:D,className:O("menu"),id:i+"_list",tabIndex:r.tabIndex||"0",role:"menu","aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-activedescendant":c?et():void 0,onFocus:Re,onKeyDown:Oe,onBlur:Be},v("menu")),we=n({classNames:O("transition"),in:p,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:it,onEntered:ce,onExit:k,onExited:q},v("transition"));return l.createElement(yn,St({nodeRef:A},we),l.createElement("div",St({id:r.id,ref:A},z),l.createElement("ul",Z,N)))}return null},rt=Ee();return r.popup?l.createElement(Ar,{element:rt,appendTo:r.appendTo}):rt}));vo.displayName="Menu";const eu=function(e){const[n,s]=l.useState(null),[r,o]=l.useState(null),[a,i]=l.useState([]),[u,d]=l.useState(e.path),[m,p]=l.useState(!0),[S,I]=l.useState(""),[L,P]=l.useState({}),[T,f]=l.useState(e.homeFileProp??""),w=l.useRef(null),g=l.useRef(null),[E,b]=l.useState(!1),x=(R,M)=>alert(`${R}: ${M}`);function c(R="/"){const M=[];try{const B=ci(R);B.sort();for(const K of B){const G=R==="/"?`/${K}`:`${R}/${K}`;xt(G)&&Hr(G).isDirectory()?M.push({key:G,label:K+"/",data:G,selectable:!1,children:c(G),icon:"pi pi-folder"}):M.push({key:G,label:K,data:G,selectable:!0,icon:"pi pi-file"})}}catch(B){x("Failed to build tree",B)}return M}const h=()=>{if(!e.hideTopBar)try{const R=c("/");i(R),!u&&R.length&&d(T)}catch(R){x("Failed to list files",R)}},y=()=>{const R=prompt("Enter new file name (with extension):","/newfile.scad");if(R&&R.startsWith("/"))try{xt(R)?alert("File already exists!"):(Kr(R.substring(0,R.lastIndexOf("/")),{recursive:!0}),nr(R,""),d(R),h())}catch(M){x("Failed to create file",M)}},v=()=>{const R=prompt("Enter new name for current file:",u);if(R&&R.startsWith("/"))try{xt(R)?alert("File already exists!"):(Kr(R.substring(0,R.lastIndexOf("/")),{recursive:!0}),nr(R,rr(u,"utf-8")),Gr(u),d(R),h())}catch(M){x("Failed to rename file",M)}},O=()=>{if(window.confirm(`Delete ${u}?`))try{Gr(u),h(),d("")}catch(R){x("Failed to delete file",R)}},j=go(R=>{if(!(m||!u))try{if(console.debug("ZenMonacoPrime",`Saving ${u}`),nr(u,R??""),R==S)return;e.onSave?.(R)}catch(M){x("Failed to save file",M)}},1e3),F=l.useCallback(R=>{R&&j(R)},[j]),$=(R,M)=>{M.editor.addEditorAction({id:"openscad-save-do-nothing",label:"Save (disabled)",keybindings:[M.KeyMod.CtrlCmd|M.KeyCode.KeyS],run:()=>{}}),M.editor.addKeybindingRules([{keybinding:M.KeyMod.CtrlCmd|M.KeyCode.KeyD,command:"monaco.editor.action.deleteLines"},{keybinding:M.KeyMod.CtrlCmd|M.KeyMod.Shift|M.KeyCode.KeyD,command:"monaco.editor.action.copyLinesDownAction"},{keybinding:M.KeyMod.CtrlCmd|M.KeyCode.KeyK,command:"monaco.editor.action.quickCommand"},{keybinding:M.KeyCode.F8,command:void 0}]),vl(M,ui,"/",yi),s(R),o(M)};l.useEffect(()=>{if(!n||!r)return;const R=n.getModel();R&&r.editor.setModelMarkers(R,"openscad",e.markers??[])},[e.markers]),l.useEffect(()=>{e.isInitializing||!u||S!=""||(async()=>{try{if(console.debug("ZenMonacoPrime",`Loading ${u}`),xt(u)){const R=rr(u,"utf-8");R!=S&&I(R)}else I("");h(),p(!1)}catch(R){x("Failed to read file",R),I("")}})()},[e.isInitializing,u,h]),l.useEffect(()=>{if(e.reloadKey!==void 0&&e.reloadKey>0&&(console.debug("ZenMonacoPrime",`Reloading ${u}`),xt(u))){const R=rr(u,"utf-8");n?.setValue(R),p(!1)}},[e.reloadKey]),l.useEffect(()=>{const R=()=>{g.current&&b(g.current.offsetWidth<600)};return window.addEventListener("resize",R),R(),()=>window.removeEventListener("resize",R)},[]);const A=u||null,D=[{label:"New File",icon:"pi pi-plus",command:y},{label:"Rename",icon:"pi pi-pencil",command:v},{label:"Delete",icon:"pi pi-trash",command:O},{separator:!0},{label:"Set as Home",icon:"pi pi-home",command:()=>f(u)}];return _.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",...e.style},children:[!e.hideTopBar&&_.jsxs("div",{style:{flex:0,display:"flex",alignItems:"center",gap:"8px",padding:"8px",background:"#222"},children:[_.jsxs("div",{style:{position:"relative",flex:0},children:[_.jsx(vo,{model:D,popup:!0,ref:w}),_.jsx(sn,{"aria-label":"Editor menu",style:{minWidth:48,minHeight:48},title:"Menu",onClick:R=>w.current&&w.current.toggle(R),disabled:m,icon:"pi pi-bars",text:!0})]}),_.jsx("div",{style:{position:"relative",flex:1,display:"flex",alignItems:"center"},children:_.jsx(ho,{value:A,options:a,expandedKeys:L,onToggle:R=>P(R.value),onChange:R=>{const M=R.value;typeof M=="string"&&xt(M)&&!Hr(M).isDirectory()&&d(M)},selectionMode:"single",filter:!0,placeholder:"Select a file",className:"w-full",style:{minWidth:300},disabled:m,panelStyle:{maxHeight:600,overflowY:"auto"}})}),_.jsx("div",{style:{position:"relative",flex:0},children:_.jsx(sn,{"aria-label":"Go to HomePage",title:"Go to HomePage",style:{minWidth:48,minHeight:48,color:T?"#fff":"#888"},disabled:!T,onClick:()=>T&&d(T),icon:"pi pi-home",text:!0})})]}),_.jsx("div",{ref:g,style:{flex:1},children:m?_.jsx(Bt,{text:"Loading filesystem"}):_.jsx(Cc,{width:"100%",height:"100%",defaultLanguage:"openscad",value:S,path:u,onChange:F,theme:"vs-dark",onMount:$,options:{automaticLayout:!0,fontSize:16,lineNumbers:E?"off":"on",minimap:{enabled:!E},scrollBeyondLastLine:!1,tabSize:2,insertSpaces:!0,detectIndentation:!0,maxTokenizationLineLength:2e3,lineNumbersMinChars:4},loading:_.jsx(Bt,{text:"Loading monaco editor"})})})]})};class bo{constructor(){this._listeners={}}addEventListener(e,n){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(n)===-1&&s[e].push(n),this}removeEventListener(e,n){const r=this._listeners[e];if(r!==void 0){const o=r.indexOf(n);o!==-1&&r.splice(o,1)}return this}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){const r=s.slice(0);for(let o=0,a=r.length;o<a;o++)r[o].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class kt{constructor(e,n,s,r={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=n,this._child=s,this._attributes=r,!n.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class tu extends bo{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const n=new Set;for(const s of this.listParentEdges(e))n.add(s.getParent());return Array.from(n)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const n=new Set;for(const s of this.listChildEdges(e))n.add(s.getChild());return Array.from(n)}disconnectParents(e,n){for(const s of this.listParentEdges(e))(!n||n(s.getParent()))&&s.dispose();return this}_createEdge(e,n,s,r){const o=new kt(e,n,s,r);this._edges.add(o);const a=o.getParent();this._parentEdges.has(a)||this._parentEdges.set(a,new Set),this._parentEdges.get(a).add(o);const i=o.getChild();return this._childEdges.has(i)||this._childEdges.set(i,new Set),this._childEdges.get(i).add(o),o}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function rn(){return rn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},rn.apply(this,arguments)}class ct{constructor(e){if(this.list=[],e)for(const n of e)this.list.push(n)}add(e){this.list.push(e)}remove(e){const n=this.list.indexOf(e);n>=0&&this.list.splice(n,1)}removeChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);for(const s of n)this.remove(s);return n}listRefsByChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);return n}values(){return this.list}}class he{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const n of e)this.add(n)}add(e){const n=e.getChild();this.removeChild(n),this.set.add(e),this.map.set(n,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const n=this.map.get(e)||null;return n&&this.remove(n),n}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class Ze{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,n){this.map[e]=n}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const ae=Symbol("attributes"),Tt=Symbol("immutableKeys");class Dr extends bo{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[ae]=void 0,this[Tt]=void 0,this.graph=e,this[Tt]=new Set,this[ae]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),n={};for(const s in e){const r=e[s];if(r instanceof Dr){const o=this.graph._createEdge(s,this,r);this[Tt].add(s),n[s]=o}else n[s]=r}return n}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,n){for(const s in this[ae]){const r=this[ae][s];if(r instanceof kt){const o=r;o.getChild()===e&&this.setRef(s,n,o.getAttributes())}else if(r instanceof ct)for(const o of r.listRefsByChild(e)){const a=o.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}else if(r instanceof he){const o=r.getRefByChild(e);if(o){const a=o.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}}else if(r instanceof Ze)for(const o of r.keys()){const a=r.get(o);a.getChild()===e&&this.setRefMap(s,o,n,a.getAttributes())}}return this}get(e){return this[ae][e]}set(e,n){return this[ae][e]=n,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const n=this[ae][e];return n?n.getChild():null}setRef(e,n,s){if(this[Tt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[ae][e];if(r&&r.dispose(),!n)return this;const o=this.graph._createEdge(e,this,n,s);return this[ae][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(s=>s.getChild())}addRef(e,n,s){const r=this.graph._createEdge(e,this,n,s);return this.assertRefList(e).add(r),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,n){const s=this.assertRefList(e);if(s instanceof ct)for(const r of s.listRefsByChild(n))r.dispose();else{const r=s.getRefByChild(n);r&&r.dispose()}return this}assertRefList(e){const n=this[ae][e];if(n instanceof ct||n instanceof he)return n;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(n=>n.getChild())}getRefMap(e,n){const r=this.assertRefMap(e).get(n);return r?r.getChild():null}setRefMap(e,n,s,r){const o=this.assertRefMap(e),a=o.get(n);if(a&&a.dispose(),!s)return this;r=Object.assign(r||{},{key:n});const i=this.graph._createEdge(e,this,s,rn({},r,{key:n}));return o.set(n,i),this.dispatchEvent({type:"change",attribute:e,key:n})}assertRefMap(e){const n=this[ae][e];if(n instanceof Ze)return n;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(rn({},e,{target:this})),this.graph.dispatchEvent(rn({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const n=e.getName();if(this[ae][n]===e)this[ae][n]=null,this[Tt].has(n)&&e.getChild().dispose();else if(this[ae][n]instanceof ct)this[ae][n].remove(e);else if(this[ae][n]instanceof he)this[ae][n].remove(e);else if(this[ae][n]instanceof Ze){const s=this[ae][n];for(const r of s.keys())s.get(r)===e&&s.delete(r)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:n})}}const xo="v4.2.1",zn="@glb.bin";var H;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(H||(H={}));var Hn;(function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"})(Hn||(Hn={}));var Ue;(function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"})(Ue||(Ue={}));var Ir;(function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"})(Ir||(Ir={}));var st;(function(t){t.GLTF="GLTF",t.GLB="GLB"})(st||(st={}));const qn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class se{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const n=atob(e.split(",")[1]),s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}else{const n=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(n,s?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let n=0;for(const o of e)n+=o.byteLength;const s=new Uint8Array(n);let r=0;for(const o of e)s.set(o,r),r+=o.byteLength;return s}static pad(e,n=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const r=new Uint8Array(s);if(r.set(e),n!==0)for(let o=e.byteLength;o<s;o++)r[o]=n;return r}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,n){if(e===n)return!0;if(e.byteLength!==n.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==n[s])return!1;return!0}static toView(e,n=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+n,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class nu{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let n=new DataView(e.buffer,e.byteOffset+4),s,r;for(;n.byteLength;){if(s=n.getUint16(0,!1),ru(n,s),r=n.getUint8(s+1),r===192||r===193||r===194)return[n.getUint16(s+7,!1),n.getUint16(s+5,!1)];n=new DataView(e.buffer,n.byteOffset+s+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class Jn{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const n=new DataView(e.buffer,e.byteOffset);return se.decodeText(e.slice(12,16))===Jn.PNG_FRIED_CHUNK_NAME?[n.getUint32(32,!1),n.getUint32(36,!1)]:[n.getUint32(16,!1),n.getUint32(20,!1)]}getChannels(e){return 4}}Jn.PNG_FRIED_CHUNK_NAME="CgBI";class Ot{static registerFormat(e,n){this.impls[e]=n}static getMimeType(e){for(const n in this.impls)if(this.impls[n].match(e))return n;return null}static getSize(e,n){return this.impls[n]?this.impls[n].getSize(e):null}static getChannels(e,n){return this.impls[n]?this.impls[n].getChannels(e):null}static getVRAMByteLength(e,n){if(!this.impls[n])return null;if(this.impls[n].getVRAMByteLength)return this.impls[n].getVRAMByteLength(e);let s=0;const r=4,o=this.getSize(e,n);if(!o)return null;for(;o[0]>1||o[1]>1;)s+=o[0]*o[1]*r,o[0]=Math.max(Math.floor(o[0]/2),1),o[1]=Math.max(Math.floor(o[1]/2),1);return s+=1*r,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Ot.impls={"image/jpeg":new nu,"image/png":new Jn};function ru(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}class Pt{static basename(e){const n=e.split(/[\\/]/).pop();return n.substring(0,n.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const n=e.match(/data:(image\/\w+)/)[1];return Ot.mimeTypeToExtension(n)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Cr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function su(){var t=new Cr(3);return Cr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function cr(t){var e=t[0],n=t[1],s=t[2];return Math.hypot(e,n,s)}(function(){var t=su();return function(e,n,s,r,o,a){var i,u;for(n||(n=3),s||(s=0),r?u=Math.min(r*n+s,e.length):u=e.length,i=s;i<u;i+=n)t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],o(t,t,a),e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2];return e}})();const Ss="https://null.example";class We{static dirname(e){const n=e.lastIndexOf("/");return n===-1?"./":e.substring(0,n+1)}static basename(e){return Pt.basename(new URL(e,Ss).pathname)}static extension(e){return Pt.extension(new URL(e,Ss).pathname)}static resolve(e,n){if(!this.isRelativePath(n))return n;const s=e.split("/"),r=n.split("/");s.pop();for(let o=0;o<r.length;o++)r[o]!=="."&&(r[o]===".."?s.pop():s.push(r[o]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}We.DEFAULT_INIT={};We.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Ts(t){return Object.prototype.toString.call(t)==="[object Object]"}function It(t){if(Ts(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(Ts(n)===!1||Object.hasOwn(n,"isPrototypeOf")===!1)}var Or,Mr;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(Mr||(Mr={}));class Ke{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Ke.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Ke.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Ke.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Ke.Verbosity.ERROR&&console.error(e)}}Or=Ke;Ke.Verbosity=Mr;Ke.DEFAULT_INSTANCE=new Or(Or.Verbosity.INFO);function ou(t){var e=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],i=t[6],u=t[7],d=t[8],m=t[9],p=t[10],S=t[11],I=t[12],L=t[13],P=t[14],T=t[15],f=e*a-n*o,w=e*i-s*o,g=e*u-r*o,E=n*i-s*a,b=n*u-r*a,x=s*u-r*i,c=d*L-m*I,h=d*P-p*I,y=d*T-S*I,v=m*P-p*L,O=m*T-S*L,j=p*T-S*P;return f*j-w*O+g*v+E*y-b*h+x*c}function iu(t,e,n){var s=e[0],r=e[1],o=e[2],a=e[3],i=e[4],u=e[5],d=e[6],m=e[7],p=e[8],S=e[9],I=e[10],L=e[11],P=e[12],T=e[13],f=e[14],w=e[15],g=n[0],E=n[1],b=n[2],x=n[3];return t[0]=g*s+E*i+b*p+x*P,t[1]=g*r+E*u+b*S+x*T,t[2]=g*o+E*d+b*I+x*f,t[3]=g*a+E*m+b*L+x*w,g=n[4],E=n[5],b=n[6],x=n[7],t[4]=g*s+E*i+b*p+x*P,t[5]=g*r+E*u+b*S+x*T,t[6]=g*o+E*d+b*I+x*f,t[7]=g*a+E*m+b*L+x*w,g=n[8],E=n[9],b=n[10],x=n[11],t[8]=g*s+E*i+b*p+x*P,t[9]=g*r+E*u+b*S+x*T,t[10]=g*o+E*d+b*I+x*f,t[11]=g*a+E*m+b*L+x*w,g=n[12],E=n[13],b=n[14],x=n[15],t[12]=g*s+E*i+b*p+x*P,t[13]=g*r+E*u+b*S+x*T,t[14]=g*o+E*d+b*I+x*f,t[15]=g*a+E*m+b*L+x*w,t}function au(t,e){var n=e[0],s=e[1],r=e[2],o=e[4],a=e[5],i=e[6],u=e[8],d=e[9],m=e[10];return t[0]=Math.hypot(n,s,r),t[1]=Math.hypot(o,a,i),t[2]=Math.hypot(u,d,m),t}function lu(t,e){var n=new Cr(3);au(n,e);var s=1/n[0],r=1/n[1],o=1/n[2],a=e[0]*s,i=e[1]*r,u=e[2]*o,d=e[4]*s,m=e[5]*r,p=e[6]*o,S=e[8]*s,I=e[9]*r,L=e[10]*o,P=a+m+L,T=0;return P>0?(T=Math.sqrt(P+1)*2,t[3]=.25*T,t[0]=(p-I)/T,t[1]=(S-u)/T,t[2]=(i-d)/T):a>m&&a>L?(T=Math.sqrt(1+a-m-L)*2,t[3]=(p-I)/T,t[0]=.25*T,t[1]=(i+d)/T,t[2]=(S+u)/T):m>L?(T=Math.sqrt(1+m-a-L)*2,t[3]=(S-u)/T,t[0]=(i+d)/T,t[1]=.25*T,t[2]=(p+I)/T):(T=Math.sqrt(1+L-a-m)*2,t[3]=(i-d)/T,t[0]=(S+u)/T,t[1]=(p+I)/T,t[2]=.25*T),t}class ge{static identity(e){return e}static eq(e,n,s=1e-5){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-n[r])>s)return!1;return!0}static clamp(e,n,s){return e<n?n:e>s?s:e}static decodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return Math.round(ge.clamp(e,0,1)*65535);case 5121:return Math.round(ge.clamp(e,0,1)*255);case 5122:return Math.round(ge.clamp(e,-1,1)*32767);case 5120:return Math.round(ge.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,n,s,r){let o=cr([e[0],e[1],e[2]]);const a=cr([e[4],e[5],e[6]]),i=cr([e[8],e[9],e[10]]);ou(e)<0&&(o=-o),n[0]=e[12],n[1]=e[13],n[2]=e[14];const d=e.slice(),m=1/o,p=1/a,S=1/i;d[0]*=m,d[1]*=m,d[2]*=m,d[4]*=p,d[5]*=p,d[6]*=p,d[8]*=S,d[9]*=S,d[10]*=S,lu(s,d),r[0]=o,r[1]=a,r[2]=i}static compose(e,n,s,r){const o=r,a=n[0],i=n[1],u=n[2],d=n[3],m=a+a,p=i+i,S=u+u,I=a*m,L=a*p,P=a*S,T=i*p,f=i*S,w=u*S,g=d*m,E=d*p,b=d*S,x=s[0],c=s[1],h=s[2];return o[0]=(1-(T+w))*x,o[1]=(L+b)*x,o[2]=(P-E)*x,o[3]=0,o[4]=(L-b)*c,o[5]=(1-(I+w))*c,o[6]=(f+g)*c,o[7]=0,o[8]=(P+E)*h,o[9]=(f-g)*h,o[10]=(1-(I+T))*h,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function cu(t,e){if(!!t!=!!e)return!1;const n=t.getChild(),s=e.getChild();return n===s||n.equals(s)}function uu(t,e){if(!!t!=!!e)return!1;const n=t.values(),s=e.values();if(n.length!==s.length)return!1;for(let r=0;r<n.length;r++){const o=n[r],a=s[r];if(o.getChild()!==a.getChild()&&!o.getChild().equals(a.getChild()))return!1}return!0}function fu(t,e){if(!!t!=!!e)return!1;const n=t.keys(),s=e.keys();if(n.length!==s.length)return!1;for(const r of n){const o=t.get(r),a=e.get(r);if(!!o!=!!a)return!1;const i=o.getChild(),u=a.getChild();if(i!==u&&!i.equals(u))return!1}return!0}function Eo(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function wo(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!It(t)||!It(e))return t===e;const n=t,s=e;let r=0,o=0,a;for(a in n)r++;for(a in s)o++;if(r!==o)return!1;for(a in n){const i=n[a],u=s[a];if(Kn(i)&&Kn(u)){if(!Eo(i,u))return!1}else if(It(i)&&It(u)){if(!wo(i,u))return!1}else if(i!==u)return!1}return!0}function Kn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Rs="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",du=999,pu=6,Is=new Set,mu=function(){let e="";for(let n=0;n<pu;n++)e+=Rs.charAt(Math.floor(Math.random()*Rs.length));return e},hu=function(){for(let e=0;e<du;e++){const n=mu();if(!Is.has(n))return Is.add(n),n}return""},ft=t=>t,gu=new Set;class Ur extends Dr{constructor(e,n=""){super(e),this[ae].name=n,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,n){return Array.isArray(n)&&(n=n.slice()),super.set(e,n)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,ft)}copy(e,n=ft){for(const s in this[ae]){const r=this[ae][s];if(r instanceof kt)this[Tt].has(s)||r.dispose();else if(r instanceof ct||r instanceof he)for(const o of r.values())o.dispose();else if(r instanceof Ze)for(const o of r.values())o.dispose()}for(const s in e[ae]){const r=this[ae][s],o=e[ae][s];if(o instanceof kt)this[Tt].has(s)?r.getChild().copy(n(o.getChild()),n):this.setRef(s,n(o.getChild()),o.getAttributes());else if(o instanceof he||o instanceof ct)for(const a of o.values())this.addRef(s,n(a.getChild()),a.getAttributes());else if(o instanceof Ze)for(const a of o.keys()){const i=o.get(a);this.setRefMap(s,a,n(i.getChild()),i.getAttributes())}else It(o)?this[ae][s]=JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?this[ae][s]=o.slice():this[ae][s]=o}return this}equals(e,n=gu){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[ae]){if(n.has(s))continue;const r=this[ae][s],o=e[ae][s];if(r instanceof kt||o instanceof kt){if(!cu(r,o))return!1}else if(r instanceof he||o instanceof he||r instanceof ct||o instanceof ct){if(!uu(r,o))return!1}else if(r instanceof Ze||o instanceof Ze){if(!fu(r,o))return!1}else if(It(r)||It(o)){if(!wo(r,o))return!1}else if(Kn(r)||Kn(o)){if(!Eo(r,o))return!1}else if(r!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Ae extends Ur{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new Ze})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,n){return n&&n._validateParent(this),this.setRefMap("extensions",e,n)}listExtensions(){return this.listRefMapValues("extensions")}}class J extends Ae{init(){this.propertyType=H.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:J.Type.SCALAR,componentType:J.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case J.Type.SCALAR:return 1;case J.Type.VEC2:return 2;case J.Type.VEC3:return 3;case J.Type.VEC4:return 4;case J.Type.MAT2:return 4;case J.Type.MAT3:return 9;case J.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case J.ComponentType.BYTE:return 1;case J.ComponentType.UNSIGNED_BYTE:return 1;case J.ComponentType.SHORT:return 2;case J.ComponentType.UNSIGNED_SHORT:return 2;case J.ComponentType.UNSIGNED_INT:return 4;case J.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMin(e),n)for(let o=0;o<s;o++)e[o]=ge.decodeNormalizedInt(e[o],r);return e}getMin(e){const n=this.getArray(),s=this.getCount(),r=this.getElementSize();for(let o=0;o<r;o++)e[o]=1/0;for(let o=0;o<s*r;o+=r)for(let a=0;a<r;a++){const i=n[o+a];Number.isFinite(i)&&(e[a]=Math.min(e[a],i))}return e}getMaxNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMax(e),n)for(let o=0;o<s;o++)e[o]=ge.decodeNormalizedInt(e[o],r);return e}getMax(e){const n=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let o=0;o<r;o++)e[o]=-1/0;for(let o=0;o<s*r;o+=r)for(let a=0;a<r;a++){const i=n[o+a];Number.isFinite(i)&&(e[a]=Math.max(e[a],i))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return J.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const n=this.getElementSize(),s=this.getComponentType(),r=this.getArray();return this.getNormalized()?ge.decodeNormalizedInt(r[e*n],s):r[e*n]}setScalar(e,n){const s=this.getElementSize(),r=this.getComponentType(),o=this.getArray();return this.getNormalized()?o[e*s]=ge.encodeNormalizedInt(n,r):o[e*s]=n,this}getElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),o=this.getComponentType(),a=this.getArray();for(let i=0;i<r;i++)s?n[i]=ge.decodeNormalizedInt(a[e*r+i],o):n[i]=a[e*r+i];return n}setElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),o=this.getComponentType(),a=this.getArray();for(let i=0;i<r;i++)s?a[e*r+i]=ge.encodeNormalizedInt(n[i],o):a[e*r+i]=n[i];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?yu(e):J.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}J.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};J.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function yu(t){switch(t.constructor){case Float32Array:return J.ComponentType.FLOAT;case Uint32Array:return J.ComponentType.UNSIGNED_INT;case Uint16Array:return J.ComponentType.UNSIGNED_SHORT;case Uint8Array:return J.ComponentType.UNSIGNED_BYTE;case Int16Array:return J.ComponentType.SHORT;case Int8Array:return J.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class So extends Ae{init(){this.propertyType=H.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new he,samplers:new he})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class To extends Ae{init(){this.propertyType=H.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}To.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class bn extends Ae{init(){this.propertyType=H.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:bn.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Ue.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Ue.OTHER})}}bn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Ro extends Ae{init(){this.propertyType=H.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class At extends Ae{init(){this.propertyType=H.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:At.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}At.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class vu extends Ur{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}vu.EXTENSION_NAME=void 0;class Ye extends Ae{init(){this.propertyType=H.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ye.WrapMode.REPEAT,wrapT:Ye.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ye.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Ye.MagFilter={NEAREST:9728,LINEAR:9729};Ye.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:_n,G:jn,B:Fn,A:bu}=Ir;class Nt extends Ae{init(){this.propertyType=H.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Nt.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ye(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ye(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ye(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ye(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ye(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const n=this.get("baseColorFactor").slice();return n[3]=e,this.set("baseColorFactor",n)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:_n|jn|Fn|bu,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:_n|jn|Fn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:_n|jn|Fn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:_n})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:jn|Fn})}}Nt.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Io extends Ae{init(){this.propertyType=H.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new he})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class Co extends Ae{init(){this.propertyType=H.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new he})}copy(e,n=ft){if(n===ft)throw new Error("Node cannot be copied.");return super.copy(e,n)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return ge.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const n=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return ge.decompose(e,n,s,r),this.set("translation",n).set("rotation",s).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return ge.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return ge.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return ge.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r!=null;r=r.getParentNode())e.push(r);let n;const s=e.pop().getMatrix();for(;n=e.pop();)iu(s,s,n.getMatrix());return s}addChild(e){const n=e.getParentNode();n&&n.removeChild(e);for(const s of e.listParents())s.propertyType===H.SCENE&&s.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===H.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const n of this.listChildren())n.traverse(e);return this}}class xn extends Ae{init(){this.propertyType=H.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:xn.Mode.TRIANGLES,material:null,indices:null,attributes:new Ze,targets:new he})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Ue.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:Ue.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}xn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class xu extends Ur{init(){this.propertyType=H.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Ze})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:Ue.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Ne(){return Ne=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ne.apply(null,arguments)}class Oo extends Ae{init(){this.propertyType=H.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new he})}copy(e,n=ft){if(n===ft)throw new Error("Scene cannot be copied.");return super.copy(e,n)}addChild(e){const n=e.getParentNode();return n&&n.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const n of this.listChildren())n.traverse(e);return this}}class Mo extends Ae{init(){this.propertyType=H.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new he})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Ue.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Po extends Ae{init(){this.propertyType=H.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Ot.extensionToMimeType(Pt.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const n=Ot.extensionToMimeType(Pt.extension(e));return n&&this.set("mimeType",n),this}getImage(){return this.get("image")}setImage(e){return this.set("image",se.assertView(e))}getSize(){const e=this.get("image");return e?Ot.getSize(e,this.getMimeType()):null}}class Eu extends Ae{init(){this.propertyType=H.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${xo}`,version:"2.0"},defaultScene:null,accessors:new he,animations:new he,buffers:new he,cameras:new he,materials:new he,meshes:new he,nodes:new he,scenes:new he,skins:new he,textures:new he})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",n=>{this._addChildOfRoot(n.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,n=ft){if(n===ft)throw new Error("Root cannot be copied.");this.set("asset",Ne({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ne({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?n(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const r=e.getExtension(s);this.setExtension(s,n(r))}return this}_addChildOfRoot(e){return e instanceof Oo?this.addRef("scenes",e):e instanceof Co?this.addRef("nodes",e):e instanceof At?this.addRef("cameras",e):e instanceof Mo?this.addRef("skins",e):e instanceof Io?this.addRef("meshes",e):e instanceof Nt?this.addRef("materials",e):e instanceof Po?this.addRef("textures",e):e instanceof So?this.addRef("animations",e):e instanceof J?this.addRef("accessors",e):e instanceof Ro&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Vt{static fromGraph(e){return Vt._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new tu,this._root=new Eu(this._graph),this._logger=Ke.DEFAULT_INSTANCE,Vt._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const n=e.map(s=>s.name);for(const s of e)await s(this,{stack:n});return this}createExtension(e){const n=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(r=>r.extensionName===n)||new e(this)}createScene(e=""){return new Oo(this._graph,e)}createNode(e=""){return new Co(this._graph,e)}createCamera(e=""){return new At(this._graph,e)}createSkin(e=""){return new Mo(this._graph,e)}createMesh(e=""){return new Io(this._graph,e)}createPrimitive(){return new xn(this._graph)}createPrimitiveTarget(e=""){return new xu(this._graph,e)}createMaterial(e=""){return new Nt(this._graph,e)}createTexture(e=""){return new Po(this._graph,e)}createAnimation(e=""){return new So(this._graph,e)}createAnimationChannel(e=""){return new To(this._graph,e)}createAnimationSampler(e=""){return new bn(this._graph,e)}createAccessor(e="",n=null){return n||(n=this.getRoot().listBuffers()[0]),new J(this._graph,e).setBuffer(n)}createBuffer(e=""){return new Ro(this._graph,e)}}Vt._GRAPH_DOCUMENTS=new WeakMap;class wu{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,n){this.textureInfos.set(e,n),n.texCoord!==void 0&&e.setTexCoord(n.texCoord),n.extras!==void 0&&e.setExtras(n.extras);const s=this.jsonDoc.json.textures[n.index];if(s.sampler===void 0)return;const r=this.jsonDoc.json.samplers[s.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const Cs={logger:Ke.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Su=new Set([H.BUFFER,H.TEXTURE,H.MATERIAL,H.MESH,H.PRIMITIVE,H.NODE,H.SCENE]);class Tu{static read(e,n=Cs){const s=Ne({},Cs,n),{json:r}=e,o=new Vt().setLogger(s.logger);this.validate(e,s);const a=new wu(e),i=r.asset,u=o.getRoot().getAsset();i.copyright&&(u.copyright=i.copyright),i.extras&&(u.extras=i.extras),r.extras!==void 0&&o.getRoot().setExtras(Ne({},r.extras));const d=r.extensionsUsed||[],m=r.extensionsRequired||[];s.extensions.sort((c,h)=>c.EXTENSION_NAME>h.EXTENSION_NAME?1:-1);for(const c of s.extensions)if(d.includes(c.EXTENSION_NAME)){const h=o.createExtension(c).setRequired(m.includes(c.EXTENSION_NAME)),y=h.prereadTypes.filter(v=>!Su.has(v));y.length&&s.logger.warn(`Preread hooks for some types (${y.join()}), requested by extension ${h.extensionName}, are unsupported. Please file an issue or a PR.`);for(const v of h.readDependencies)h.install(v,s.dependencies[v])}const p=r.buffers||[];o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.BUFFER)).forEach(c=>c.preread(a,H.BUFFER)),a.buffers=p.map(c=>{const h=o.createBuffer(c.name);return c.extras&&h.setExtras(c.extras),c.uri&&c.uri.indexOf("__")!==0&&h.setURI(c.uri),h});const S=r.bufferViews||[];a.bufferViewBuffers=S.map((c,h)=>{if(!a.bufferViews[h]){const y=e.json.buffers[c.buffer],v=y.uri?e.resources[y.uri]:e.resources[zn],O=c.byteOffset||0;a.bufferViews[h]=se.toView(v,O,c.byteLength)}return a.buffers[c.buffer]});const I=r.accessors||[];a.accessors=I.map(c=>{const h=a.bufferViewBuffers[c.bufferView],y=o.createAccessor(c.name,h).setType(c.type);return c.extras&&y.setExtras(c.extras),c.normalized!==void 0&&y.setNormalized(c.normalized),c.bufferView===void 0||y.setArray($n(c,a)),y});const L=r.images||[],P=r.textures||[];o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.TEXTURE)).forEach(c=>c.preread(a,H.TEXTURE)),a.textures=L.map(c=>{const h=o.createTexture(c.name);if(c.extras&&h.setExtras(c.extras),c.bufferView!==void 0){const y=r.bufferViews[c.bufferView],v=e.json.buffers[y.buffer],O=v.uri?e.resources[v.uri]:e.resources[zn],j=y.byteOffset||0,F=y.byteLength,$=O.slice(j,j+F);h.setImage($)}else c.uri!==void 0&&(h.setImage(e.resources[c.uri]),c.uri.indexOf("__")!==0&&h.setURI(c.uri));if(c.mimeType!==void 0)h.setMimeType(c.mimeType);else if(c.uri){const y=Pt.extension(c.uri);h.setMimeType(Ot.extensionToMimeType(y))}return h}),o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.MATERIAL)).forEach(c=>c.preread(a,H.MATERIAL));const T=r.materials||[];a.materials=T.map(c=>{const h=o.createMaterial(c.name);c.extras&&h.setExtras(c.extras),c.alphaMode!==void 0&&h.setAlphaMode(c.alphaMode),c.alphaCutoff!==void 0&&h.setAlphaCutoff(c.alphaCutoff),c.doubleSided!==void 0&&h.setDoubleSided(c.doubleSided);const y=c.pbrMetallicRoughness||{};if(y.baseColorFactor!==void 0&&h.setBaseColorFactor(y.baseColorFactor),c.emissiveFactor!==void 0&&h.setEmissiveFactor(c.emissiveFactor),y.metallicFactor!==void 0&&h.setMetallicFactor(y.metallicFactor),y.roughnessFactor!==void 0&&h.setRoughnessFactor(y.roughnessFactor),y.baseColorTexture!==void 0){const v=y.baseColorTexture,O=a.textures[P[v.index].source];h.setBaseColorTexture(O),a.setTextureInfo(h.getBaseColorTextureInfo(),v)}if(c.emissiveTexture!==void 0){const v=c.emissiveTexture,O=a.textures[P[v.index].source];h.setEmissiveTexture(O),a.setTextureInfo(h.getEmissiveTextureInfo(),v)}if(c.normalTexture!==void 0){const v=c.normalTexture,O=a.textures[P[v.index].source];h.setNormalTexture(O),a.setTextureInfo(h.getNormalTextureInfo(),v),c.normalTexture.scale!==void 0&&h.setNormalScale(c.normalTexture.scale)}if(c.occlusionTexture!==void 0){const v=c.occlusionTexture,O=a.textures[P[v.index].source];h.setOcclusionTexture(O),a.setTextureInfo(h.getOcclusionTextureInfo(),v),c.occlusionTexture.strength!==void 0&&h.setOcclusionStrength(c.occlusionTexture.strength)}if(y.metallicRoughnessTexture!==void 0){const v=y.metallicRoughnessTexture,O=a.textures[P[v.index].source];h.setMetallicRoughnessTexture(O),a.setTextureInfo(h.getMetallicRoughnessTextureInfo(),v)}return h}),o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.MESH)).forEach(c=>c.preread(a,H.MESH));const f=r.meshes||[];o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.PRIMITIVE)).forEach(c=>c.preread(a,H.PRIMITIVE)),a.meshes=f.map(c=>{const h=o.createMesh(c.name);return c.extras&&h.setExtras(c.extras),c.weights!==void 0&&h.setWeights(c.weights),(c.primitives||[]).forEach(v=>{const O=o.createPrimitive();v.extras&&O.setExtras(v.extras),v.material!==void 0&&O.setMaterial(a.materials[v.material]),v.mode!==void 0&&O.setMode(v.mode);for(const[$,A]of Object.entries(v.attributes||{}))O.setAttribute($,a.accessors[A]);v.indices!==void 0&&O.setIndices(a.accessors[v.indices]);const j=c.extras&&c.extras.targetNames||[];(v.targets||[]).forEach(($,A)=>{const D=j[A]||A.toString(),R=o.createPrimitiveTarget(D);for(const[M,B]of Object.entries($))R.setAttribute(M,a.accessors[B]);O.addTarget(R)}),h.addPrimitive(O)}),h});const w=r.cameras||[];a.cameras=w.map(c=>{const h=o.createCamera(c.name).setType(c.type);if(c.extras&&h.setExtras(c.extras),c.type===At.Type.PERSPECTIVE){const y=c.perspective;h.setYFov(y.yfov),h.setZNear(y.znear),y.zfar!==void 0&&h.setZFar(y.zfar),y.aspectRatio!==void 0&&h.setAspectRatio(y.aspectRatio)}else{const y=c.orthographic;h.setZNear(y.znear).setZFar(y.zfar).setXMag(y.xmag).setYMag(y.ymag)}return h});const g=r.nodes||[];o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.NODE)).forEach(c=>c.preread(a,H.NODE)),a.nodes=g.map(c=>{const h=o.createNode(c.name);if(c.extras&&h.setExtras(c.extras),c.translation!==void 0&&h.setTranslation(c.translation),c.rotation!==void 0&&h.setRotation(c.rotation),c.scale!==void 0&&h.setScale(c.scale),c.matrix!==void 0){const y=[0,0,0],v=[0,0,0,1],O=[1,1,1];ge.decompose(c.matrix,y,v,O),h.setTranslation(y),h.setRotation(v),h.setScale(O)}return c.weights!==void 0&&h.setWeights(c.weights),h});const E=r.skins||[];a.skins=E.map(c=>{const h=o.createSkin(c.name);c.extras&&h.setExtras(c.extras),c.inverseBindMatrices!==void 0&&h.setInverseBindMatrices(a.accessors[c.inverseBindMatrices]),c.skeleton!==void 0&&h.setSkeleton(a.nodes[c.skeleton]);for(const y of c.joints)h.addJoint(a.nodes[y]);return h}),g.map((c,h)=>{const y=a.nodes[h];(c.children||[]).forEach(O=>y.addChild(a.nodes[O])),c.mesh!==void 0&&y.setMesh(a.meshes[c.mesh]),c.camera!==void 0&&y.setCamera(a.cameras[c.camera]),c.skin!==void 0&&y.setSkin(a.skins[c.skin])});const b=r.animations||[];a.animations=b.map(c=>{const h=o.createAnimation(c.name);c.extras&&h.setExtras(c.extras);const v=(c.samplers||[]).map(j=>{const F=o.createAnimationSampler().setInput(a.accessors[j.input]).setOutput(a.accessors[j.output]).setInterpolation(j.interpolation||bn.Interpolation.LINEAR);return j.extras&&F.setExtras(j.extras),h.addSampler(F),F});return(c.channels||[]).forEach(j=>{const F=o.createAnimationChannel().setSampler(v[j.sampler]).setTargetPath(j.target.path);j.target.node!==void 0&&F.setTargetNode(a.nodes[j.target.node]),j.extras&&F.setExtras(j.extras),h.addChannel(F)}),h});const x=r.scenes||[];return o.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.SCENE)).forEach(c=>c.preread(a,H.SCENE)),a.scenes=x.map(c=>{const h=o.createScene(c.name);return c.extras&&h.setExtras(c.extras),(c.nodes||[]).map(v=>a.nodes[v]).forEach(v=>h.addChild(v)),h}),r.scene!==void 0&&o.getRoot().setDefaultScene(a.scenes[r.scene]),o.getRoot().listExtensionsUsed().forEach(c=>c.read(a)),I.forEach((c,h)=>{const y=a.accessors[h],v=!!c.sparse,O=!c.bufferView&&!y.getArray();(v||O)&&y.setSparse(!0).setArray(Iu(c,a))}),o}static validate(e,n){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const r of s.extensionsRequired)if(!n.extensions.find(o=>o.EXTENSION_NAME===r))throw new Error(`Missing required extension, "${r}".`)}if(s.extensionsUsed)for(const r of s.extensionsUsed)n.extensions.find(o=>o.EXTENSION_NAME===r)||n.logger.warn(`Missing optional extension, "${r}".`)}}function Ru(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],o=qn[t.componentType],a=J.getElementSize(t.type),i=o.BYTES_PER_ELEMENT,u=t.byteOffset||0,d=new o(t.count*a),m=new DataView(s.buffer,s.byteOffset,s.byteLength),p=r.byteStride;for(let S=0;S<t.count;S++)for(let I=0;I<a;I++){const L=u+S*p+I*i;let P;switch(t.componentType){case J.ComponentType.FLOAT:P=m.getFloat32(L,!0);break;case J.ComponentType.UNSIGNED_INT:P=m.getUint32(L,!0);break;case J.ComponentType.UNSIGNED_SHORT:P=m.getUint16(L,!0);break;case J.ComponentType.UNSIGNED_BYTE:P=m.getUint8(L);break;case J.ComponentType.SHORT:P=m.getInt16(L,!0);break;case J.ComponentType.BYTE:P=m.getInt8(L);break;default:throw new Error(`Unexpected componentType "${t.componentType}".`)}d[S*a+I]=P}return d}function $n(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],o=qn[t.componentType],a=J.getElementSize(t.type),i=o.BYTES_PER_ELEMENT,u=a*i;if(r.byteStride!==void 0&&r.byteStride!==u)return Ru(t,e);const d=s.byteOffset+(t.byteOffset||0),m=t.count*a*i;return new o(s.buffer.slice(d,d+m))}function Iu(t,e){const n=qn[t.componentType],s=J.getElementSize(t.type);let r;t.bufferView!==void 0?r=$n(t,e):r=new n(t.count*s);const o=t.sparse;if(!o)return r;const a=o.count,i=Ne({},t,o.indices,{count:a,type:"SCALAR"}),u=Ne({},t,o.values,{count:a}),d=$n(i,e),m=$n(u,e);for(let p=0;p<i.count;p++)for(let S=0;S<s;S++)r[d[p]*s+S]=m[p*s+S];return r}var mn;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(mn||(mn={}));class Mt{constructor(e,n,s){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=n,this.options=s;const r=e.getRoot(),o=r.listBuffers().length,a=r.listTextures().length;this.bufferURIGenerator=new Os(o>1,()=>s.basename||"buffer"),this.imageURIGenerator=new Os(a>1,i=>Cu(e,i)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,n){const s={magFilter:n.getMagFilter()||void 0,minFilter:n.getMinFilter()||void 0,wrapS:n.getWrapS(),wrapT:n.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},a=JSON.stringify(o);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const i={index:this.textureDefIndexMap.get(a)};return n.getTexCoord()!==0&&(i.texCoord=n.getTexCoord()),Object.keys(n.getExtras()).length>0&&(i.extras=n.getExtras()),this.textureInfoDefMap.set(n,i),i}createPropertyDef(e){const n={};return e.getName()&&(n.name=e.getName()),Object.keys(e.getExtras()).length>0&&(n.extras=e.getExtras()),n}createAccessorDef(e){const n=this.createPropertyDef(e);return n.type=e.getType(),n.componentType=e.getComponentType(),n.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(r=>r.getName()==="attributes"&&r.getAttributes().key==="POSITION"||r.getName()==="input")&&(n.max=e.getMax([]).map(Math.fround),n.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(n.normalized=e.getNormalized()),n}createImageData(e,n,s){if(this.options.format===st.GLB)this.imageBufferViews.push(n),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:n.byteLength});else{const r=Ot.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.assignResourceURI(e.uri,n,!1)}}assignResourceURI(e,n,s){const r=this.jsonDoc.resources;if(!(e in r)){r[e]=n;return}if(n===r[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const o=`Resource URI "${e}" already assigned to different data.`;if(!s){this.logger.warn(o);return}throw new Error(o)}getAccessorUsage(e){const n=this._accessorUsageMap.get(e);if(n)return n;if(e.getSparse())return Ue.SPARSE;for(const s of this._doc.getGraph().listParentEdges(e)){const{usage:r}=s.getAttributes();if(r)return r;s.getParent().propertyType!==H.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return Ue.OTHER}addAccessorToUsageGroup(e,n){const s=this._accessorUsageMap.get(e);if(s&&s!==n)throw new Error(`Accessor with usage "${s}" cannot be reused as "${n}".`);return this._accessorUsageMap.set(e,n),this}}Mt.BufferViewTarget=mn;Mt.BufferViewUsage=Ue;Mt.USAGE_TO_TARGET={[Ue.ARRAY_BUFFER]:mn.ARRAY_BUFFER,[Ue.ELEMENT_ARRAY_BUFFER]:mn.ELEMENT_ARRAY_BUFFER};class Os{constructor(e,n){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=n}createURI(e,n){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${n}`}else return`${this.basename(e)}.${n}`}}function Cu(t,e){const n=t.getGraph().listParentEdges(e).find(s=>s.getParent()!==t.getRoot());return n?n.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Ln}=Mt,{UNSIGNED_INT:Ou,UNSIGNED_SHORT:Mu,UNSIGNED_BYTE:Pu}=J.ComponentType,Nu=new Set([H.ACCESSOR,H.BUFFER,H.MATERIAL,H.MESH]);class Au{static write(e,n){const s=e.getGraph(),r=e.getRoot(),o={asset:Ne({generator:`glTF-Transform ${xo}`},r.getAsset()),extras:Ne({},r.getExtras())},a={json:o,resources:{}},i=new Mt(e,a,n),u=n.logger||Ke.DEFAULT_INSTANCE,d=new Set(n.extensions.map(f=>f.EXTENSION_NAME)),m=e.getRoot().listExtensionsUsed().filter(f=>d.has(f.extensionName)).sort((f,w)=>f.extensionName>w.extensionName?1:-1),p=e.getRoot().listExtensionsRequired().filter(f=>d.has(f.extensionName)).sort((f,w)=>f.extensionName>w.extensionName?1:-1);m.length<e.getRoot().listExtensionsUsed().length&&u.warn("Some extensions were not registered for I/O, and will not be written.");for(const f of m){const w=f.prewriteTypes.filter(g=>!Nu.has(g));w.length&&u.warn(`Prewrite hooks for some types (${w.join()}), requested by extension ${f.extensionName}, are unsupported. Please file an issue or a PR.`);for(const g of f.writeDependencies)f.install(g,n.dependencies[g])}function S(f,w,g,E){const b=[];let x=0;for(const y of f){const v=i.createAccessorDef(y);v.bufferView=o.bufferViews.length;const O=y.getArray(),j=se.pad(se.toView(O));v.byteOffset=x,x+=j.byteLength,b.push(j),i.accessorIndexMap.set(y,o.accessors.length),o.accessors.push(v)}const c=se.concat(b),h={buffer:w,byteOffset:g,byteLength:c.byteLength};return E&&(h.target=E),o.bufferViews.push(h),{buffers:b,byteLength:x}}function I(f,w,g){const E=f[0].getCount();let b=0;for(const v of f){const O=i.createAccessorDef(v);O.bufferView=o.bufferViews.length,O.byteOffset=b;const j=v.getElementSize(),F=v.getComponentSize();b+=se.padNumber(j*F),i.accessorIndexMap.set(v,o.accessors.length),o.accessors.push(O)}const x=E*b,c=new ArrayBuffer(x),h=new DataView(c);for(let v=0;v<E;v++){let O=0;for(const j of f){const F=j.getElementSize(),$=j.getComponentSize(),A=j.getComponentType(),D=j.getArray();for(let R=0;R<F;R++){const M=v*b+O+R*$,B=D[v*F+R];switch(A){case J.ComponentType.FLOAT:h.setFloat32(M,B,!0);break;case J.ComponentType.BYTE:h.setInt8(M,B);break;case J.ComponentType.SHORT:h.setInt16(M,B,!0);break;case J.ComponentType.UNSIGNED_BYTE:h.setUint8(M,B);break;case J.ComponentType.UNSIGNED_SHORT:h.setUint16(M,B,!0);break;case J.ComponentType.UNSIGNED_INT:h.setUint32(M,B,!0);break;default:throw new Error("Unexpected component type: "+A)}}O+=se.padNumber(F*$)}}const y={buffer:w,byteOffset:g,byteLength:x,byteStride:b,target:Mt.BufferViewTarget.ARRAY_BUFFER};return o.bufferViews.push(y),{byteLength:x,buffers:[new Uint8Array(c)]}}function L(f,w,g){const E=[];let b=0;const x=new Map;let c=-1/0,h=!1;for(const A of f){const D=i.createAccessorDef(A);o.accessors.push(D),i.accessorIndexMap.set(A,o.accessors.length-1);const R=[],M=[],B=[],K=new Array(A.getElementSize()).fill(0);for(let ue=0,ee=A.getCount();ue<ee;ue++)if(A.getElement(ue,B),!ge.eq(B,K,0)){c=Math.max(ue,c),R.push(ue);for(let ie=0;ie<B.length;ie++)M.push(B[ie])}const G=R.length,re={accessorDef:D,count:G};if(x.set(A,re),G===0)continue;G>A.getCount()/2&&(h=!0);const ye=qn[A.getComponentType()];re.indices=R,re.values=new ye(M)}if(!Number.isFinite(c))return{buffers:E,byteLength:b};h&&u.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const y=c<255?Uint8Array:c<65535?Uint16Array:Uint32Array,v=c<255?Pu:c<65535?Mu:Ou,O={buffer:w,byteOffset:g+b,byteLength:0};for(const A of f){const D=x.get(A);if(D.count===0)continue;D.indicesByteOffset=O.byteLength;const R=se.pad(se.toView(new y(D.indices)));E.push(R),b+=R.byteLength,O.byteLength+=R.byteLength}o.bufferViews.push(O);const j=o.bufferViews.length-1,F={buffer:w,byteOffset:g+b,byteLength:0};for(const A of f){const D=x.get(A);if(D.count===0)continue;D.valuesByteOffset=F.byteLength;const R=se.pad(se.toView(D.values));E.push(R),b+=R.byteLength,F.byteLength+=R.byteLength}o.bufferViews.push(F);const $=o.bufferViews.length-1;for(const A of f){const D=x.get(A);D.count!==0&&(D.accessorDef.sparse={count:D.count,indices:{bufferView:j,byteOffset:D.indicesByteOffset,componentType:v},values:{bufferView:$,byteOffset:D.valuesByteOffset}})}return{buffers:E,byteLength:b}}if(o.accessors=[],o.bufferViews=[],o.samplers=[],o.textures=[],o.images=r.listTextures().map((f,w)=>{const g=i.createPropertyDef(f);f.getMimeType()&&(g.mimeType=f.getMimeType());const E=f.getImage();return E&&i.createImageData(g,E,f),i.imageIndexMap.set(f,w),g}),m.filter(f=>f.prewriteTypes.includes(H.ACCESSOR)).forEach(f=>f.prewrite(i,H.ACCESSOR)),r.listAccessors().forEach(f=>{const w=i.accessorUsageGroupedByParent,g=i.accessorParents;if(i.accessorIndexMap.has(f))return;const E=i.getAccessorUsage(f);if(i.addAccessorToUsageGroup(f,E),w.has(E)){const b=s.listParents(f).find(x=>x.propertyType!==H.ROOT);g.set(f,b)}}),m.filter(f=>f.prewriteTypes.includes(H.BUFFER)).forEach(f=>f.prewrite(i,H.BUFFER)),(r.listAccessors().length>0||i.otherBufferViews.size>0||r.listTextures().length>0&&n.format===st.GLB)&&r.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");o.buffers=[],r.listBuffers().forEach((f,w)=>{const g=i.createPropertyDef(f),E=i.accessorUsageGroupedByParent,b=f.listParents().filter(F=>F instanceof J),x=new Set(b.map(F=>i.accessorParents.get(F))),c=new Map(Array.from(x).map((F,$)=>[F,$])),h={};for(const F of b){var y;if(i.accessorIndexMap.has(F))continue;const $=i.getAccessorUsage(F);let A=$;if(E.has($)){const D=i.accessorParents.get(F);A+=`:${c.get(D)}`}h[y=A]||(h[y]={usage:$,accessors:[]}),h[A].accessors.push(F)}const v=[],O=o.buffers.length;let j=0;for(const{usage:F,accessors:$}of Object.values(h))if(F===Ln.ARRAY_BUFFER&&n.vertexLayout===Hn.INTERLEAVED){const A=I($,O,j);j+=A.byteLength;for(const D of A.buffers)v.push(D)}else if(F===Ln.ARRAY_BUFFER)for(const A of $){const D=I([A],O,j);j+=D.byteLength;for(const R of D.buffers)v.push(R)}else if(F===Ln.SPARSE){const A=L($,O,j);j+=A.byteLength;for(const D of A.buffers)v.push(D)}else if(F===Ln.ELEMENT_ARRAY_BUFFER){const A=Mt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,D=S($,O,j,A);j+=D.byteLength;for(const R of D.buffers)v.push(R)}else{const A=S($,O,j);j+=A.byteLength;for(const D of A.buffers)v.push(D)}if(i.imageBufferViews.length&&w===0){for(let F=0;F<i.imageBufferViews.length;F++)if(o.bufferViews[o.images[F].bufferView].byteOffset=j,j+=i.imageBufferViews[F].byteLength,v.push(i.imageBufferViews[F]),j%8){const $=8-j%8;j+=$,v.push(new Uint8Array($))}}if(i.otherBufferViews.has(f))for(const F of i.otherBufferViews.get(f))o.bufferViews.push({buffer:O,byteOffset:j,byteLength:F.byteLength}),i.otherBufferViewsIndexMap.set(F,o.bufferViews.length-1),j+=F.byteLength,v.push(F);if(j){let F;n.format===st.GLB?F=zn:(F=i.bufferURIGenerator.createURI(f,"bin"),g.uri=F),g.byteLength=j,i.assignResourceURI(F,se.concat(v),!0)}o.buffers.push(g),i.bufferIndexMap.set(f,w)}),r.listAccessors().find(f=>!f.getBuffer())&&u.warn("Skipped writing one or more Accessors: no Buffer assigned."),m.filter(f=>f.prewriteTypes.includes(H.MATERIAL)).forEach(f=>f.prewrite(i,H.MATERIAL)),o.materials=r.listMaterials().map((f,w)=>{const g=i.createPropertyDef(f);if(f.getAlphaMode()!==Nt.AlphaMode.OPAQUE&&(g.alphaMode=f.getAlphaMode()),f.getAlphaMode()===Nt.AlphaMode.MASK&&(g.alphaCutoff=f.getAlphaCutoff()),f.getDoubleSided()&&(g.doubleSided=!0),g.pbrMetallicRoughness={},ge.eq(f.getBaseColorFactor(),[1,1,1,1])||(g.pbrMetallicRoughness.baseColorFactor=f.getBaseColorFactor()),ge.eq(f.getEmissiveFactor(),[0,0,0])||(g.emissiveFactor=f.getEmissiveFactor()),f.getRoughnessFactor()!==1&&(g.pbrMetallicRoughness.roughnessFactor=f.getRoughnessFactor()),f.getMetallicFactor()!==1&&(g.pbrMetallicRoughness.metallicFactor=f.getMetallicFactor()),f.getBaseColorTexture()){const E=f.getBaseColorTexture(),b=f.getBaseColorTextureInfo();g.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(E,b)}if(f.getEmissiveTexture()){const E=f.getEmissiveTexture(),b=f.getEmissiveTextureInfo();g.emissiveTexture=i.createTextureInfoDef(E,b)}if(f.getNormalTexture()){const E=f.getNormalTexture(),b=f.getNormalTextureInfo(),x=i.createTextureInfoDef(E,b);f.getNormalScale()!==1&&(x.scale=f.getNormalScale()),g.normalTexture=x}if(f.getOcclusionTexture()){const E=f.getOcclusionTexture(),b=f.getOcclusionTextureInfo(),x=i.createTextureInfoDef(E,b);f.getOcclusionStrength()!==1&&(x.strength=f.getOcclusionStrength()),g.occlusionTexture=x}if(f.getMetallicRoughnessTexture()){const E=f.getMetallicRoughnessTexture(),b=f.getMetallicRoughnessTextureInfo();g.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(E,b)}return i.materialIndexMap.set(f,w),g}),m.filter(f=>f.prewriteTypes.includes(H.MESH)).forEach(f=>f.prewrite(i,H.MESH)),o.meshes=r.listMeshes().map((f,w)=>{const g=i.createPropertyDef(f);let E=null;return g.primitives=f.listPrimitives().map(b=>{const x={attributes:{}};x.mode=b.getMode();const c=b.getMaterial();c&&(x.material=i.materialIndexMap.get(c)),Object.keys(b.getExtras()).length&&(x.extras=b.getExtras());const h=b.getIndices();h&&(x.indices=i.accessorIndexMap.get(h));for(const y of b.listSemantics())x.attributes[y]=i.accessorIndexMap.get(b.getAttribute(y));for(const y of b.listTargets()){const v={};for(const O of y.listSemantics())v[O]=i.accessorIndexMap.get(y.getAttribute(O));x.targets=x.targets||[],x.targets.push(v)}return b.listTargets().length&&!E&&(E=b.listTargets().map(y=>y.getName())),x}),f.getWeights().length&&(g.weights=f.getWeights()),E&&(g.extras=g.extras||{},g.extras.targetNames=E),i.meshIndexMap.set(f,w),g}),o.cameras=r.listCameras().map((f,w)=>{const g=i.createPropertyDef(f);if(g.type=f.getType(),g.type===At.Type.PERSPECTIVE){g.perspective={znear:f.getZNear(),zfar:f.getZFar(),yfov:f.getYFov()};const E=f.getAspectRatio();E!==null&&(g.perspective.aspectRatio=E)}else g.orthographic={znear:f.getZNear(),zfar:f.getZFar(),xmag:f.getXMag(),ymag:f.getYMag()};return i.cameraIndexMap.set(f,w),g}),o.nodes=r.listNodes().map((f,w)=>{const g=i.createPropertyDef(f);return ge.eq(f.getTranslation(),[0,0,0])||(g.translation=f.getTranslation()),ge.eq(f.getRotation(),[0,0,0,1])||(g.rotation=f.getRotation()),ge.eq(f.getScale(),[1,1,1])||(g.scale=f.getScale()),f.getWeights().length&&(g.weights=f.getWeights()),i.nodeIndexMap.set(f,w),g}),o.skins=r.listSkins().map((f,w)=>{const g=i.createPropertyDef(f),E=f.getInverseBindMatrices();E&&(g.inverseBindMatrices=i.accessorIndexMap.get(E));const b=f.getSkeleton();return b&&(g.skeleton=i.nodeIndexMap.get(b)),g.joints=f.listJoints().map(x=>i.nodeIndexMap.get(x)),i.skinIndexMap.set(f,w),g}),r.listNodes().forEach((f,w)=>{const g=o.nodes[w],E=f.getMesh();E&&(g.mesh=i.meshIndexMap.get(E));const b=f.getCamera();b&&(g.camera=i.cameraIndexMap.get(b));const x=f.getSkin();x&&(g.skin=i.skinIndexMap.get(x)),f.listChildren().length>0&&(g.children=f.listChildren().map(c=>i.nodeIndexMap.get(c)))}),o.animations=r.listAnimations().map((f,w)=>{const g=i.createPropertyDef(f),E=new Map;return g.samplers=f.listSamplers().map((b,x)=>{const c=i.createPropertyDef(b);return c.input=i.accessorIndexMap.get(b.getInput()),c.output=i.accessorIndexMap.get(b.getOutput()),c.interpolation=b.getInterpolation(),E.set(b,x),c}),g.channels=f.listChannels().map(b=>{const x=i.createPropertyDef(b);return x.sampler=E.get(b.getSampler()),x.target={node:i.nodeIndexMap.get(b.getTargetNode()),path:b.getTargetPath()},x}),i.animationIndexMap.set(f,w),g}),o.scenes=r.listScenes().map((f,w)=>{const g=i.createPropertyDef(f);return g.nodes=f.listChildren().map(E=>i.nodeIndexMap.get(E)),i.sceneIndexMap.set(f,w),g});const T=r.getDefaultScene();return T&&(o.scene=r.listScenes().indexOf(T)),o.extensionsUsed=m.map(f=>f.extensionName),o.extensionsRequired=p.map(f=>f.extensionName),m.forEach(f=>f.write(i)),_u(o),a}}function _u(t){const e=[];for(const n in t){const s=t[n];(Array.isArray(s)&&s.length===0||s===null||s===""||s&&typeof s=="object"&&Object.keys(s).length===0)&&e.push(n)}for(const n of e)delete t[n]}var Gn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Gn||(Gn={}));class ju{constructor(){this._logger=Ke.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=Hn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const n of e)this._extensions.add(n),n.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const n=await this.readURI(e,"view");this.lastReadBytes=n.byteLength;const s=Ms(n)?this._binaryToJSON(n):{json:JSON.parse(se.decodeText(n)),resources:{}};return await this._readResourcesExternal(s,this.dirname(e)),this._readResourcesInternal(s),s}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Tu.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const n=this._binaryToJSON(se.assertView(e));this._readResourcesInternal(n);const s=n.json;if(s.buffers&&s.buffers.some(r=>Fu(n,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(r=>Lu(n,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return n}async readBinary(e){return this.readJSON(await this.binaryToJSON(se.assertView(e)))}async writeJSON(e,n={}){if(n.format===st.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Au.write(e,{format:n.format||st.GLTF,basename:n.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:Ne({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:n,resources:s}=await this.writeJSON(e,{format:st.GLB}),r=new Uint32Array([1179937895,2,12]),o=JSON.stringify(n),a=se.pad(se.encodeText(o),32),i=se.toView(new Uint32Array([a.byteLength,1313821514])),u=se.concat([i,a]);r[r.length-1]+=u.byteLength;const d=Object.values(s)[0];if(!d||!d.byteLength)return se.concat([se.toView(r),u]);const m=se.pad(d,0),p=se.toView(new Uint32Array([m.byteLength,5130562])),S=se.concat([p,m]);return r[r.length-1]+=S.byteLength,se.concat([se.toView(r),u,S])}async _readResourcesExternal(e,n){var s=this;const r=e.json.images||[],o=e.json.buffers||[],a=[...r,...o].map(async function(i){const u=i.uri;if(!u||u.match(/data:/))return Promise.resolve();e.resources[u]=await s.readURI(s.resolve(n,u),"view"),s.lastReadBytes+=e.resources[u].byteLength});await Promise.all(a)}_readResourcesInternal(e){function n(o){if(o.uri){if(o.uri in e.resources){se.assertView(e.resources[o.uri]);return}if(o.uri.match(/data:/)){const a=`__${hu()}.${Pt.extension(o.uri)}`;e.resources[a]=se.createBufferFromDataURI(o.uri),o.uri=a}}}(e.json.images||[]).forEach(o=>{if(o.bufferView===void 0&&o.uri===void 0)throw new Error("Missing resource URI or buffer view.");n(o)}),(e.json.buffers||[]).forEach(n)}_copyJSON(e){const{images:n,buffers:s}=e.json;return e={json:Ne({},e.json),resources:Ne({},e.resources)},n&&(e.json.images=n.map(r=>Ne({},r))),s&&(e.json.buffers=s.map(r=>Ne({},r))),e}_binaryToJSON(e){if(!Ms(e))throw new Error("Invalid glTF 2.0 binary.");const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==Gn.JSON)throw new Error("Missing required GLB JSON chunk.");const s=20,r=n[0],o=se.decodeText(se.toView(e,s,r)),a=JSON.parse(o),i=s+r;if(e.byteLength<=i)return{json:a,resources:{}};const u=new Uint32Array(e.buffer,e.byteOffset+i,2);if(u[1]!==Gn.BIN)return{json:a,resources:{}};const d=u[0],m=se.toView(e,i+8,d);return{json:a,resources:{[zn]:m}}}}function Fu(t,e){return e.uri!==void 0&&!(e.uri in t.resources)}function Lu(t,e){return e.uri!==void 0&&!(e.uri in t.resources)&&e.bufferView===void 0}function Ms(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}class ku extends ju{constructor(e=null,n=We.DEFAULT_INIT){super(),this._fetch=void 0,this._fetchConfig=void 0,this._init=void 0,this._fetchEnabled=!1,this._fetch=e,this._fetchConfig=n,this._init=this.init()}async init(){return this._init?this._init:Promise.all([Br(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),Br(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])]).then(([e,n])=>{this._fs=e.promises,this._path=n})}setAllowNetwork(e){if(e&&!this._fetch)throw new Error("NodeIO requires a Fetch API implementation for HTTP requests.");return this._fetchEnabled=e,this}async readURI(e,n){if(await this.init(),We.isAbsoluteURL(e)){if(!this._fetchEnabled||!this._fetch)throw new Error("Network request blocked. Allow HTTP requests explicitly, if needed.");const s=await this._fetch(e,this._fetchConfig);switch(n){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}else switch(n){case"view":return this._fs.readFile(e);case"text":return this._fs.readFile(e,"utf8")}}resolve(e,n){return We.isAbsoluteURL(e)||We.isAbsoluteURL(n)?We.resolve(e,n):this._path.resolve(e,decodeURIComponent(n))}dirname(e){return We.isAbsoluteURL(e)?We.dirname(e):this._path.dirname(e)}async write(e,n){await this.init(),await(!!e.match(/\.glb$/)?this._writeGLB(e,n):this._writeGLTF(e,n))}async _writeGLTF(e,n){var s=this;this.lastWriteBytes=0;const{json:r,resources:o}=await this.writeJSON(n,{format:st.GLTF,basename:Pt.basename(e)}),{_fs:a,_path:i}=this,u=i.dirname(e),d=JSON.stringify(r,null,2);await a.writeFile(e,d),this.lastWriteBytes+=d.length;for(const m of $u(Object.keys(o),10))await Promise.all(m.map(async function(p){if(We.isAbsoluteURL(p)){if(We.extension(p)==="bin")throw new Error(`Cannot write buffer to path "${p}".`);return}const S=i.join(u,decodeURIComponent(p));await a.mkdir(i.dirname(S),{recursive:!0}),await a.writeFile(S,o[p]),s.lastWriteBytes+=o[p].byteLength}))}async _writeGLB(e,n){const s=await this.writeBinary(n);await this._fs.writeFile(e,s),this.lastWriteBytes=s.byteLength}}function $u(t,e){const n=[];for(let s=0,r=t.length;s<r;s+=e){const o=[];for(let a=0;a<e&&s+a<r;a++)o.push(t[s+a]);n.push(o)}return n}const Du=[79/255,209/255,197/255,1];function kn(t,e=1){let n=t.replace(/^#/,"");n.length===3?n=n.split("").map(i=>i+i).join(""):n.length===4&&(n=n.split("").map(i=>i+i).join(""));let s=0,r=0,o=0,a=e;if(n.length===6)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,o=parseInt(n.slice(4,6),16)/255;else if(n.length===8)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,o=parseInt(n.slice(4,6),16)/255,a=parseInt(n.slice(6,8),16)/255;else throw new Error("Invalid hex color format");return[s,r,o,a]}function Uu(t,e,{positions:n,indices:s,colors:r}){const o=t.createPrimitive().setMode(xn.Mode.TRIANGLES).setMaterial(t.createMaterial().setDoubleSided(!0).setAlphaMode(e[3]<1?"BLEND":"OPAQUE").setMetallicFactor(0).setRoughnessFactor(.8).setBaseColorFactor(e)).setAttribute("POSITION",t.createAccessor().setType(J.Type.VEC3).setArray(n)).setIndices(t.createAccessor().setType(J.Type.SCALAR).setArray(s));return r&&o.setAttribute("COLOR_0",t.createAccessor().setType(J.Type.VEC3).setArray(r)),o}function Bu(t){const e=new Float32Array(t.vertices.length*3),n=new Uint32Array(t.faces.length*3),s=new Map;let r=0;const o=a=>{let i=s.get(a);if(i===void 0){const u=r*3,d=t.vertices[a];e[u]=d.x,e[u+1]=d.y,e[u+2]=d.z,i=r++,s.set(a,i)}return i};return t.faces.forEach((a,i)=>{const{vertices:u}=a;if(u.length<3)throw new Error("Face must have at least 3 vertices");const d=i*3;n[d]=o(u[0]),n[d+1]=o(u[1]),n[d+2]=o(u[2])}),{positions:e.slice(0,r*3),indices:n}}async function Vu(t,e=!1){const n=[[.615686274509804,.796078431372549,.3176470588235294,1],[.9764705882352941,.8431372549019608,.17254901960784313,1]],s=e?[kn("#322"),kn("#222")]:[kn("#efdfdf"),kn("#fff")],r=t.colors.map(m=>{for(let p=0;p<n.length;++p)if(m.length===4&&Math.abs(m[0]-n[p][0])<1e-6&&Math.abs(m[1]-n[p][1])<1e-6&&Math.abs(m[2]-n[p][2])<1e-6&&Math.abs(m[3]-n[p][3])<1e-6)return s[p];return m}),o=new Vt;o.createBuffer();const a=o.createScene(),i=o.createMesh(),u=new Map;t.faces.forEach(m=>{let p=u.get(m.colorIndex);p||u.set(m.colorIndex,p=[]),p.push(m)});for(const[m,p]of u.entries()){const S=r[m];i.addPrimitive(Uu(o,S,Bu({vertices:t.vertices,faces:p})))}a.addChild(o.createNode().setMesh(i));const d=await new ku().writeBinary(o);return new Blob([d],{type:"model/gltf-binary"})}const Ps=`
/* [Meta] */
title = "OpenSCAD Demo";
show_text = true;
debug = true;

/* [Plate Settings] */
// Plate size (mm)
plate_size = 40;          // [20:1:80]
// Plate thickness
thickness  = 6;           // [2:0.5:20]
// Corner rounding
fillet     = 3;           // [0:0.5:10]

/* [Holes] */
// Number of holes
hole_count   = 6;         // [0:1:12]
// Hole diameter
hole_d       = 4;         // [2:0.5:10]
// Hole pattern
hole_pattern = "circle";  // ["circle", "grid"]

/* [Quality] */
$fs = $preview ? 1   : 0.2;
$fa = $preview ? 15  : 5;


/* ---------- Helpers ---------- */

module label(txt) {
    if (show_text)
        color("pink")
            translate([0, -plate_size/2 - 8, thickness])
                linear_extrude(1)
                    text(txt, size=6, halign="center");
}


/* ---------- Geometry ---------- */

module holes_2d() {
    if (hole_pattern == "circle")
        for (i = [0 : hole_count - 1])
            rotate(360 / hole_count * i)
                translate([plate_size / 3, 0])
                    circle(d = hole_d);
    else
        for (x = [-1, 0, 1], y = [-1, 0, 1])
            translate([x * plate_size / 4, y * plate_size / 4])
                circle(d = hole_d);
}

module plate_2d() {
    difference() {
        offset(r = fillet)
            square(plate_size - 2 * fillet, center = true);
        holes_2d();
    }
}


/* ---------- Output ---------- */

color("steelblue")
difference() {
    linear_extrude(thickness)
        plate_2d();

    // Debug cutaway
    if (debug)
        translate([0, 0, thickness/2])
            cube([plate_size, plate_size/2, thickness+1], center=true);
}

label(title);

`;function Ns(t){const e=t.split(`
`).map(m=>m.trim()).filter(m=>m.length>0&&!m.startsWith("#"));if(e.length===0)throw new Error("Empty OFF file");let n,s=0;if(e[0].match(/^OFF(\s|$)/))n=e[0].substring(3).trim(),s=1;else if(e[s]==="OFF"&&e.length>1)n=e[1],s=2;else throw new Error("Invalid OFF file: missing OFF header");const[r,o]=n.split(/\s+/).map(Number);if(isNaN(r)||isNaN(o))throw new Error("Invalid OFF file: invalid vertex or face counts");if(s+r+o>e.length)throw new Error("Invalid OFF file: not enough lines");const a=[];for(let m=0;m<r;m++){const p=e[s+m].split(/\s+/).map(Number);if(p.length<3||p.some(isNaN))throw new Error(`Invalid OFF file: invalid vertex at line ${s+m+1}`);a.push({x:p[0],y:p[1],z:p[2]})}s+=r;const i=[],u=new Map,d=[];for(let m=0;m<o;m++){const p=e[s+m].split(/\s+/).map(Number),S=p[0],I=p.slice(1,S+1),L=p.length>=S+4?p.slice(S+1,S+5).map(f=>f/255):Du;if(I.length<3)throw new Error(`Invalid OFF file: face at line ${s+m+1} must have at least 3 vertices`);const P=L?L.join(","):"";let T=u.get(P);if(T==null){T=i.length;const[f,w,g,E]=L;i.push([f,w,g,E??1]),u.set(P,T)}if(I.length==3)d.push({vertices:I,colorIndex:T});else for(let f=1;f<I.length-1;f++)d.push({vertices:[I[0],I[f],I[f+1]],colorIndex:T})}return{vertices:a,faces:d,colors:i}}function zu(t,e,n){const s=e.x-t.x,r=e.y-t.y,o=e.z-t.z,a=n.x-t.x,i=n.y-t.y,u=n.z-t.z;return{x:r*u-o*i,y:o*a-s*u,z:s*i-r*a}}async function Hu(t){let e=`solid polyhedron
`;for(const n of t.faces){const[s,r,o]=n.vertices,a=t.vertices[s],i=t.vertices[r],u=t.vertices[o],d=zu(a,i,u);e+=`  facet normal ${d.x} ${d.y} ${d.z}
`,e+=`    outer loop
`,e+=`      vertex ${a.x} ${a.y} ${a.z}
`,e+=`      vertex ${i.x} ${i.y} ${i.z}
`,e+=`      vertex ${u.x} ${u.y} ${u.z}
`,e+=`    endloop
`,e+=`  endfacet
`}return e+=`endsolid polyhedron
`,new Blob([e],{type:"model/stl"})}const Ku="editor-page-container_EditorPage",Gu="sidebar_EditorPage",Wu="main_EditorPage",Yu="main-sub_EditorPage",qu="panel-editor_EditorPage",Ju="panel-logs_EditorPage",Xu="model-viewer-container_EditorPage",Zu="model-viewer_EditorPage",lt={editorPageContainer:Ku,sidebar:Gu,main:Wu,mainSub:Yu,panelEditor:qu,panelLogs:Ju,modelViewerContainer:Xu,modelViewer:Zu};function ff({viewModelId:t}){const{modelId:e}=ni();e&&(t=e);const[n,s]=ri(),{user:r}=js(),o=ii("readonly")!==null,[a,i]=l.useState(void 0),[u,d]=l.useState(void 0),m=t??"new",[p,S]=l.useState(void 0),[I,L]=l.useState(void 0),[P,T]=l.useState(void 0),[f,w]=l.useState(void 0),[g,E]=l.useState(void 0),[b,x]=l.useState(void 0),[c,h]=l.useState(!1),[y,v]=l.useState(!1),[O,j]=l.useState(!0),[F,$]=l.useState(!1),[A,D]=l.useState(void 0),[R,M]=l.useState(void 0),[B,K]=l.useState({}),[G,re]=l.useState(!1),[ye,ue]=l.useState(null),[ee,ie]=l.useState(t!==void 0?0:1),Re=l.useRef(null),Be=l.useRef(null),Oe=l.useRef(!1),[me,Ie]=l.useState(0),ve=l.useCallback(()=>`/src/${m}/index.scad`,[m]),_e=l.useCallback(async U=>{try{const V=ve();if(m=="new")sr(V,Ps,!1);else if(!xt(V)&&U!==void 0)sr(V,U.source_code,!0);else if(U!==void 0){const ne=wn(V);await ai(ne)!=U.source_code_hash&&$(!0)}}catch(V){console.error(V)}},[m,ve]),Me=l.useCallback(async()=>{w("Checking Syntax...");try{const U=ve(),V=wn(U),Ee=await Ni({activePath:U,sources:[{path:U,content:V}]})({now:!0});Ee.parameterSet&&D(Ee.parameterSet),Ee.markers&&M(Ee.markers)}catch(U){E(U?.message||String(U))}finally{w(void 0)}},[]),be=U=>async()=>{w(U?"Previewing...":"Rendering..."),E(void 0),x(void 0);try{const V=ve();let ne=wn(V);const te=await _i({scadPath:V,sources:[{path:V,content:ne}],vars:B,isPreview:U,mountArchives:!0,renderFormat:"off",streamsCallback:z=>{"stderr"in z&&x(Z=>(Z?Z+`
`:"")+z.stderr),"stdout"in z&&x(Z=>(Z?Z+`
`:"")+z.stdout)}})({now:!0});I&&URL.revokeObjectURL(I),L(URL.createObjectURL(te.outFile));let N;try{const z=Ns(await te.outFile.text());N=new File([await Vu(z)],te.outFile.name.replace(".off",".glb"))}catch(z){E("Failed to convert OFF to GLB: "+z),w(void 0);return}p&&URL.revokeObjectURL(p),S(URL.createObjectURL(N))}catch(V){E(V?.message||String(V))}finally{w(void 0)}},Pe=l.useCallback(be(!0),[B]),Fe=l.useCallback(be(!1),[B]),Le=go(Pe,1e3),et=async()=>{if(!Be.current)return;const U=await Be.current.getWebpScreenshot();if(!U){E("Failed to capture screenshot for publish.");return}ue(U),re(!0)},tt=async()=>{if(!(!r||!ye||!u)){re(!1),Re.current?.show({severity:"info",summary:"Uploading...",life:5e3});try{const V=await(await fetch(ye)).blob(),ne=new File([V],`${Date.now()}.webp`,{type:"image/webp"}),Ee=wn(ve());await en.uploadModel(ne,Ee,u),Re.current?.clear(),Re.current?.show({severity:"success",summary:"Published",detail:"Model published successfully!",life:3e3})}catch(U){Re.current?.clear(),Re.current?.show({severity:"error",summary:"Publish Failed",detail:U.message||String(U),life:4e3})}finally{re(!1),ue(null)}}},nt=()=>{re(!1),ue(null)},je=async()=>{let U=Ps;const V=ve();if(m!=="new"&&(U=await en.fetchModelSource(m),U===void 0))throw new Error("Failed to fetch model source");sr(V,U,!0),Ie(ne=>ne+1)},it=l.useCallback(async()=>{if(console.debug("Fetching model details...",t),t){const U=await en.fetchModelById(t);return i(U),d({id:U?.id,title:U?.title??"Untitled Model",description:U?.description??""}),U}else{d({id:void 0,title:"Untitled Model",description:""});return}},[]);l.useEffect(()=>(Oe.current||(Oe.current=!0,(async()=>{const U=await it();await fi(!0),await _e(U),await Promise.all([Me(),Pe()]),j(!1)})()),()=>{p&&URL.revokeObjectURL(p),I&&URL.revokeObjectURL(I),P&&URL.revokeObjectURL(P)}),[Me,it,_e,Pe]);function ce(U,V){const ne=document.createElement("a");ne.href=U,ne.download=V,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)}const k=l.useCallback(async()=>{try{if(P&&URL.revokeObjectURL(P),!I)throw new Error("No OFF file to convert");const U=await(await fetch(I)).text(),V=Ns(U),ne=await Hu(V),Ee=q()+".stl",rt=URL.createObjectURL(ne);ce(rt,Ee),setTimeout(()=>URL.revokeObjectURL(rt),1e3),T(void 0)}catch(U){console.error(U)}},[I]);l.useEffect(()=>{const U=V=>{V.key==="F4"?(V.preventDefault(),Me()):V.key==="F5"?(V.preventDefault(),Pe()):V.key==="F6"?(V.preventDefault(),Fe()):V.key==="F7"?(V.preventDefault(),k()):V.key==="F8"&&(V.preventDefault(),et())};return window.addEventListener("keydown",U),()=>{window.removeEventListener("keydown",U)}},[I]);function q(){return a?.title??u?.title??"Untitled Model"}async function Q(){$(!0),await Promise.all([Me(),n.autoPreview?Pe():Promise.resolve()])}const de=!o&&(a===void 0||a?.owner_id===r?.id)&&u!==void 0;return _.jsxs(_.Fragment,{children:[_.jsxs("div",{className:lt.editorPageContainer,style:{flexDirection:c?"column":void 0},children:[_.jsxs("div",{className:lt.sidebar,children:[_.jsxs("div",{className:lt.modelViewerContainer,children:[_.jsx("div",{className:lt.modelViewer,children:p?_.jsx(aa,{ref:Be,lightMode:y,style:{width:"100%",height:"100%"},modelUri:p}):_.jsx(Bt,{text:"Waiting for model to render"})}),_.jsx(Vr,{model:[c?{label:"Smaller Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-minimize",command:()=>h(!1)}:{label:"Larger Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-maximize",command:()=>h(!0)},y?{label:"Dark Mode",icon:"pi pi-moon",command:()=>v(!1)}:{label:"Light Mode",icon:"pi pi-sun",command:()=>v(!0)},{label:"Download",icon:"pi pi-download",items:[{label:"GLB",icon:"pi pi-download",disabled:!p,command:()=>{p&&ce(p,q()+".glb")}},{label:"OFF",icon:"pi pi-download",disabled:!I,command:()=>{I&&ce(I,q()+".off")}},{label:"STL (F7)",icon:"pi pi-download",disabled:!I,command:k}]}]})]}),de?_.jsx(wt,{children:_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"max-content 1fr",gap:12,alignItems:"center",marginBottom:8},children:[_.jsx("label",{htmlFor:"edit-title",style:{whiteSpace:"nowrap"},children:_.jsx("b",{children:"Title"})}),_.jsx(_s,{id:"edit-title",maxLength:100,value:u.title,onChange:U=>d(V=>({...V,title:U.target.value})),placeholder:"Enter model title"}),_.jsx("label",{htmlFor:"edit-description",style:{whiteSpace:"nowrap"},children:_.jsx("b",{children:"Description"})}),_.jsx($r,{id:"edit-description",maxLength:2e3,value:u.description,onChange:U=>d(V=>({...V,description:U.target.value})),placeholder:"Enter model description",style:{resize:"vertical"}})]})}):a!==void 0?_.jsx(wt,{toggleable:!0,header:a.title,children:_.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[_.jsx("div",{dangerouslySetInnerHTML:{__html:ks(a.description)}}),_.jsxs("span",{children:["by ",_.jsx("a",{href:"#/user/"+a.username,children:a.username})," on"," ",a.created_at]}),_.jsx("span",{children:_.jsx(vi,{model:a})})]})}):_.jsx(_.Fragment,{}),a?_.jsx(il,{modelId:a?.id,collapsed:!n.commentsPanelExpanded,onToggle:U=>s({commentsPanelExpanded:!U.value})}):""]}),_.jsxs("div",{className:lt.main,children:[_.jsxs("div",{className:lt.mainSub,children:[_.jsx(wt,{toggleable:!0,header:"Customizer",children:_.jsx(Ja,{parameterSet:A,parameterValues:B,onChange:(U,V)=>{K(ne=>({...ne,[U]:V})),n.autoPreview&&Le()}})}),_.jsxs(wt,{className:lt.panelLogs,toggleable:!0,header:"Logs & Errors",collapsed:!n.logsPanelExpanded,onToggle:U=>s({logsPanelExpanded:!U.value}),children:[g&&_.jsx("pre",{style:{color:"var(--color-danger)"},children:g}),b&&_.jsx("pre",{children:b}),!g&&!b&&_.jsx("pre",{children:"No logs or errors yet."})]})]}),_.jsxs(wt,{className:lt.panelEditor,children:[_.jsx(Vr,{style:{width:"100%"},model:[{label:"Preview (F5)",icon:"pi pi-play",command:Pe,disabled:f!==void 0},{label:"Render (F6)",icon:"pi pi-play",command:Fe,disabled:f!==void 0},{label:"Publish (F8)",icon:"pi pi-upload",command:et,disabled:f!==void 0||r?.id===void 0,visible:a===void 0||a?.owner_id===r?.id},{label:"Overwrite with remote source",icon:"pi pi-download color-danger",command:je,disabled:f!==void 0,visible:F},{icon:n.autoPreview?"pi pi-check-square":"pi pi-stop",label:"Auto-Preview",disabled:!1,command:()=>{s({autoPreview:!n.autoPreview})}}],end:_.jsx("div",{style:{display:"flex",gap:8},children:f!==void 0&&_.jsxs(_.Fragment,{children:[_.jsx("div",{style:{flex:1,alignContent:"center"},children:f}),_.jsx(si,{style:{width:40,height:40},strokeWidth:"8"})]})})}),_.jsx(eu,{isInitializing:O,path:ve(),homeFileProp:ve(),hideTopBar:!0,markers:R,onSave:U=>Q(),reloadKey:me})]})]})]}),_.jsx(xi,{header:"Publish Model",visible:G,onHide:nt,footer:_.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[_.jsx(sn,{label:"Cancel",icon:"pi pi-times",onClick:nt,className:"p-button-text"}),_.jsx(sn,{label:"Publish",icon:"pi pi-upload",onClick:tt,autoFocus:!0})]}),closable:!1,modal:!0,children:u!==void 0&&_.jsx(bi,{model:{id:"",title:u.title,preview_url:ye??"",owner_id:r?.id||"",username:r?.user_metadata?.user_name||r?.user_metadata?.name||r?.email||"Unknown User",description:u.description,created_at:ur(new Date),updated_at:ur(new Date),likes:0,comments:0}})}),_.jsx(kr,{ref:Re,position:"top-right"})]})}export{ff as default};
