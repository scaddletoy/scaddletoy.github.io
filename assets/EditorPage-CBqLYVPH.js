import{r as l,R as Ze,I as Nr,u as nt,P as it,C as dt,a as pt,b as Et,Z as Qe,c as ke,d as Pr,e as Ar,O as se,f as ae,g as Yi,h as et,i as As,k as hn,D as J,j,l as Bt,m as gn,U as Wn,T as _r,n as En,o as _s,K as er,p as js,q as qi,s as Fs,t as Ji,v as Xi,w as Zi,E as Qi,_ as Br,x as eo,M as Vr,y as to}from"../index.js";import{A as jr,t as Ls,s as ks,f as ur,a as no,m as zr,g as ro,h as so}from"./utils-DRB1n_X_.js";import{SupabaseService as en}from"./SupabaseService-BE7KA2gQ.js";import{M as $s,j as tr,T as io,e as xt,r as nr,s as Hr,w as rr,m as Kr,u as Gr,a as oo,f as ao,b as sr,c as wn,d as lo}from"./tree.esm-C0rBb9X2.js";import{_ as co,a as uo,b as fo,T as Wr,C as yn,c as Ds,d as po,S as mo}from"./index.esm-CmZmguR4.js";import{T as fr,D as Yr,I as qr,O as Us}from"./dropdown.esm-C9sUfc1U.js";import{P as Bs}from"./index.esm-0dnXiuBX.js";import{B as sn}from"./button.esm-DOFW5kJr.js";import{z as ho}from"./index.esm-DyIK9W92.js";import{M as go,a as yo}from"./ModelCard-CWpoSSPQ.js";import{D as vo}from"./dialog.esm-D7RQG_45.js";function bo(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fr(t,e){var n=function(i){return e&&l.isValidElement(i)?e(i):i},s=Object.create(null);return t&&l.Children.map(t,function(r){return r}).forEach(function(r){s[r.key]=n(r)}),s}function xo(t,e){t=t||{},e=e||{};function n(m){return m in e?e[m]:t[m]}var s=Object.create(null),r=[];for(var i in t)i in e?r.length&&(s[i]=r,r=[]):r.push(i);var a,o={};for(var u in e){if(s[u])for(a=0;a<s[u].length;a++){var p=s[u][a];o[s[u][a]]=n(p)}o[u]=n(u)}for(a=0;a<r.length;a++)o[r[a]]=n(r[a]);return o}function Rt(t,e,n){return n[e]!=null?n[e]:t.props[e]}function Eo(t,e){return Fr(t.children,function(n){return l.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:Rt(n,"appear",t),enter:Rt(n,"enter",t),exit:Rt(n,"exit",t)})})}function wo(t,e,n){var s=Fr(t.children),r=xo(e,s);return Object.keys(r).forEach(function(i){var a=r[i];if(l.isValidElement(a)){var o=i in e,u=i in s,p=e[i],m=l.isValidElement(p)&&!p.props.in;u&&(!o||m)?r[i]=l.cloneElement(a,{onExited:n.bind(null,a),in:!0,exit:Rt(a,"exit",t),enter:Rt(a,"enter",t)}):!u&&o&&!m?r[i]=l.cloneElement(a,{in:!1}):u&&o&&l.isValidElement(p)&&(r[i]=l.cloneElement(a,{onExited:n.bind(null,a),in:p.props.in,exit:Rt(a,"exit",t),enter:Rt(a,"enter",t)}))}}),r}var So=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},To={component:"div",childFactory:function(e){return e}},Lr=(function(t){co(e,t);function e(s,r){var i;i=t.call(this,s,r)||this;var a=i.handleExited.bind(bo(i));return i.state={contextValue:{isMounting:!0},handleExited:a,firstRender:!0},i}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(r,i){var a=i.children,o=i.handleExited,u=i.firstRender;return{children:u?Eo(r,o):wo(r,a,o),firstRender:!1}},n.handleExited=function(r,i){var a=Fr(this.props.children);r.key in a||(r.props.onExited&&r.props.onExited(i),this.mounted&&this.setState(function(o){var u=uo({},o.children);return delete u[r.key],{children:u}}))},n.render=function(){var r=this.props,i=r.component,a=r.childFactory,o=fo(r,["component","childFactory"]),u=this.state.contextValue,p=So(this.state.children).map(a);return delete o.appear,delete o.enter,delete o.exit,i===null?Ze.createElement(Wr.Provider,{value:u},p):Ze.createElement(Wr.Provider,{value:u},Ze.createElement(i,o,p))},e})(Ze.Component);Lr.propTypes={};Lr.defaultProps=To;function Vs(t,e){let n;t.id="WORKER."+t.taskName+"."+Math.random().toString(36).substring(2)+" |";function s(){n&&(n.terminate(),n=null)}return jr((r,i)=>(n=new Worker(new URL("/assets/openscad-worker-CLMFiw7W.js",import.meta.url),{type:"module"}),n.onmessage=a=>{"result"in a.data?(r(a.data.result),s()):e(a.data)},n.postMessage(t),()=>{s()}))}const Ro=new Set(["Could not initialize localization."]),zs=(t,e)=>({logText:Io(t),markers:Co(t,e)});function Io(t,e){const n=[];for(const{stderr:s,stdout:r,error:i}of t){const a=s??r??`EXCEPTION: ${i}`;Ro.has(a)||n.push(a)}return n.join(`
`)}function Co(t,e){let n=[];const s=[];let r=0,i=0;const a=(p,m,d)=>{s.push({startLineNumber:Number(d),startColumn:1,endLineNumber:Number(d),endColumn:1e3,message:p,severity:8})},o=e.shiftSourceLines&&e.shiftSourceLines.sourcePath,u=(p,m)=>{const d=Number(m);return o&&p.endsWith(o)?d-e.shiftSourceLines.skipLines:d};for(const{stderr:p,stdout:m,error:d}of t){if(p){p.startsWith("ERROR:")&&i++,p.startsWith("WARNING:")&&r++;let S=/^ERROR: Parser error in file "([^"]+)", line (\d+): (.*)$/.exec(p);if(S){const[P,N,O,R]=S;a(R,N,u(N,O));continue}if(S=/^ERROR: Parser error: (.*?) in file ([^",]+), line (\d+)$/.exec(p),S){const[P,N,O,R]=S;a(N,O,u(O,R));continue}if(S=/^WARNING: (.*?),? in file ([^,]+), line (\d+)\.?/.exec(p),S){const[P,N,O,R]=S;s.push({startLineNumber:u(O,R),startColumn:1,endLineNumber:u(O,R),endColumn:1e3,message:N,severity:4});continue}}n.push(p??m??`EXCEPTION: ${d}`)}return(i||r)&&(n=[`${i} errors, ${r} warnings!`,"",...n]),s}const Oo=300,Mo=Ls(Oo,t=>{const{activePath:e,sources:n}=t;""+n[0].content;const s="out.json",r=Vs({taskName:"checkSyntax",mountArchives:!0,files:n,args:[e,"-o",s,"--export-format=param"],outputPaths:[s]},i=>{});return jr((i,a)=>((async()=>{try{const o=await r;let u;if(o.outputs&&o.outputs.length==1){const[[,p]]=o.outputs;try{u=JSON.parse(p)}catch(m){console.error(`Error while parsing parameter set: ${m}
${p}`)}}else console.error("No output from runner!");i({...zs(o.mergedOutputs,{}),parameterSet:u})}catch(o){console.error(o),a(o)}})(),()=>r.kill()))}),No=1e3;function Hs(t){return typeof t=="string"?`"${t}"`:t instanceof Array?`[${t.map(Hs).join(", ")}]`:`${t}`}const Po=Ls(No,t=>{const{scadPath:e,sources:n,isPreview:s,mountArchives:r,vars:i,features:a,extraArgs:o,renderFormat:u,streamsCallback:p}=t,m=[];if(s&&m.push("$preview=true;"),!e.endsWith(".scad"))throw new Error("First source must be a .scad file, got "+n[0].path+" instead");const d=n.filter(w=>w.path===e)[0];if(!d)throw new Error("Active path not found in sources!");if(d.content==null)throw new Error("Source content is null!");const S=[...m,d.content].join(`
`),P=u=="glb"||u=="3mf"?"off":u,O=`${e.replace(/\.scad$/,"").split("/").pop()}.${P}`,R=[e,"-o",O,"--backend=manifold","--export-format="+(P=="stl"?"binstl":P),...Object.entries(i??{}).flatMap(([w,g])=>[`-D${w}=${Hs(g)}`]),...(a??[]).map(w=>`--enable=${w}`),...o??[]],f=Vs({taskName:s?"preview":"render",mountArchives:r,files:n.map(w=>w.path===e?{path:w.path,content:S}:w),args:R,outputPaths:[O]},p);return jr((w,g)=>((async()=>{try{const x=await f,{logText:E,markers:b}=zs(x.mergedOutputs,{shiftSourceLines:{sourcePath:d.path,skipLines:m.length}});x.error&&g(x.error);const[c]=x.outputs??[];if(!c){g(new Error("No output from runner!"));return}const[h,y]=c,v=h.split("/"),C=v[v.length-1],F=h.endsWith(".svg")?"image/svg+xml":"application/octet-stream",L=new Blob([y]),D=new File([L],C,{type:F});w({outFile:D,logText:E,markers:b,elapsedMillis:x.elapsedMillis})}catch(x){console.error(x),g(x)}})(),()=>f.kill()))});function dr(){return dr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},dr.apply(null,arguments)}var Ks=l.memo(l.forwardRef(function(t,e){var n=Nr.getPTI(t);return l.createElement("svg",dr({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),l.createElement("path",{d:"M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z",fill:"currentColor"}),l.createElement("path",{d:"M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z",fill:"currentColor"}),l.createElement("path",{d:"M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z",fill:"currentColor"}))}));Ks.displayName="ExclamationTriangleIcon";function pr(){return pr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},pr.apply(null,arguments)}var Gs=l.memo(l.forwardRef(function(t,e){var n=Nr.getPTI(t);return l.createElement("svg",pr({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z",fill:"currentColor"}))}));Gs.displayName="InfoCircleIcon";function mr(){return mr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},mr.apply(null,arguments)}var Ws=l.memo(l.forwardRef(function(t,e){var n=Nr.getPTI(t);return l.createElement("svg",mr({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z",fill:"currentColor"}))}));Ws.displayName="TimesCircleIcon";function hr(){return hr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},hr.apply(null,arguments)}function gr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Ao(t){if(Array.isArray(t))return gr(t)}function _o(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ys(t,e){if(t){if(typeof t=="string")return gr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gr(t,e):void 0}}function jo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ir(t){return Ao(t)||_o(t)||Ys(t)||jo()}function Fo(t){if(Array.isArray(t))return t}function Lo(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function ko(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yr(t,e){return Fo(t)||Lo(t,e)||Ys(t,e)||ko()}function on(t){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(t)}function $o(t,e){if(on(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(on(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Do(t){var e=$o(t,"string");return on(e)=="symbol"?e:e+""}function qs(t,e,n){return(e=Do(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Uo=`
@layer primereact {
    .p-toast {
        width: calc(100% - var(--toast-indent, 0px));
        max-width: 25rem;
    }
    
    .p-toast-message-icon {
        flex-shrink: 0;
    }
    
    .p-toast-message-content {
        display: flex;
        align-items: flex-start;
    }
    
    .p-toast-message-text {
        flex: 1 1 auto;
    }
    
    .p-toast-summary {
        overflow-wrap: anywhere;
    }
    
    .p-toast-detail {
        overflow-wrap: anywhere;
    }
    
    .p-toast-top-center {
        transform: translateX(-50%);
    }
    
    .p-toast-bottom-center {
        transform: translateX(-50%);
    }
    
    .p-toast-center {
        min-width: 20vw;
        transform: translate(-50%, -50%);
    }
    
    .p-toast-icon-close {
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }
    
    .p-toast-icon-close.p-link {
        cursor: pointer;
    }
    
    /* Animations */
    .p-toast-message-enter {
        opacity: 0;
        transform: translateY(50%);
    }
    
    .p-toast-message-enter-active {
        opacity: 1;
        transform: translateY(0);
        transition: transform 0.3s, opacity 0.3s;
    }
    
    .p-toast-message-enter-done {
        transform: none;
    }
    
    .p-toast-message-exit {
        opacity: 1;
        max-height: 1000px;
    }
    
    .p-toast .p-toast-message.p-toast-message-exit-active {
        opacity: 0;
        max-height: 0;
        margin-bottom: 0;
        overflow: hidden;
        transition: max-height 0.45s cubic-bezier(0, 1, 0, 1), opacity 0.3s, margin-bottom 0.3s;
    }
}
`,Bo={root:function(e){var n=e.props,s=e.context;return ae("p-toast p-component p-toast-"+n.position,n.className,{"p-input-filled":s&&s.inputStyle==="filled"||ke.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||ke.ripple===!1})},message:{message:function(e){var n=e.severity;return ae("p-toast-message",qs({},"p-toast-message-".concat(n),n))},content:"p-toast-message-content",buttonicon:"p-toast-icon-close-icon",closeButton:"p-toast-icon-close p-link",icon:"p-toast-message-icon",text:"p-toast-message-text",summary:"p-toast-summary",detail:"p-toast-detail"},transition:"p-toast-message"},Vo={root:function(e){var n=e.props;return{position:"fixed",top:n.position==="top-right"||n.position==="top-left"||n.position==="top-center"?"20px":n.position==="center"?"50%":null,right:(n.position==="top-right"||n.position==="bottom-right")&&"20px",bottom:(n.position==="bottom-left"||n.position==="bottom-right"||n.position==="bottom-center")&&"20px",left:n.position==="top-left"||n.position==="bottom-left"?"20px":n.position==="center"||n.position==="top-center"||n.position==="bottom-center"?"50%":null}}},Sn=dt.extend({defaultProps:{__TYPE:"Toast",id:null,className:null,content:null,style:null,baseZIndex:0,position:"top-right",transitionOptions:null,appendTo:"self",onClick:null,onRemove:null,onShow:null,onHide:null,onMouseEnter:null,onMouseLeave:null,children:void 0},css:{classes:Bo,styles:Uo,inlineStyles:Vo}});function Jr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ve(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Jr(Object(n),!0).forEach(function(s){qs(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Js=l.memo(l.forwardRef(function(t,e){var n=nt(),s=t.messageInfo,r=t.metaData,i=t.ptCallbacks,a=i.ptm,o=i.ptmo,u=i.cx,p=t.index,m=s.message,d=m.severity,S=m.content,P=m.summary,N=m.detail,O=m.closable,R=m.life,f=m.sticky,w=m.className,g=m.style,x=m.contentClassName,E=m.contentStyle,b=m.icon,c=m.closeIcon,h=m.pt,y={index:p},v=ve(ve({},r),y),C=l.useState(!1),F=yr(C,2),L=F[0],D=F[1],_=Yi(function(){V()},R||3e3,!f&&!L),B=yr(_,1),T=B[0],M=function(ie,Ee){return a(ie,ve({hostName:t.hostName},Ee))},V=function(){T(),t.onClose&&t.onClose(s)},z=function(ie){t.onClick&&!(J.hasClass(ie.target,"p-toast-icon-close")||J.hasClass(ie.target,"p-toast-icon-close-icon"))&&t.onClick(s.message)},K=function(ie){t.onMouseEnter&&t.onMouseEnter(ie),!ie.defaultPrevented&&(f||(T(),D(!0)))},ee=function(ie){t.onMouseLeave&&t.onMouseLeave(ie),!ie.defaultPrevented&&(f||D(!1))},be=function(){var ie=n({className:u("message.buttonicon")},M("buttonicon",v),o(h,"buttonicon",ve(ve({},y),{},{hostName:t.hostName}))),Ee=c||l.createElement(fr,ie),we=et.getJSXIcon(Ee,ve({},ie),{props:t}),Pe=n({type:"button",className:u("message.closeButton"),onClick:V,"aria-label":t.ariaCloseLabel||As("close")},M("closeButton",v),o(h,"closeButton",ve(ve({},y),{},{hostName:t.hostName})));return O!==!1?l.createElement("div",null,l.createElement("button",Pe,we,l.createElement(hn,null))):null},pe=function(){if(s){var ie=se.getJSXElement(S,{message:s.message,onClick:z,onClose:V}),Ee=n({className:u("message.icon")},M("icon",v),o(h,"icon",ve(ve({},y),{},{hostName:t.hostName}))),we=b;if(!b)switch(d){case"info":we=l.createElement(Gs,Ee);break;case"warn":we=l.createElement(Ks,Ee);break;case"error":we=l.createElement(Ws,Ee);break;case"success":we=l.createElement(Ds,Ee);break}var Pe=et.getJSXIcon(we,ve({},Ee),{props:t}),Ie=n({className:u("message.text")},M("text",v),o(h,"text",ve(ve({},y),{},{hostName:t.hostName}))),ye=n({className:u("message.summary")},M("summary",v),o(h,"summary",ve(ve({},y),{},{hostName:t.hostName}))),He=n({className:u("message.detail")},M("detail",v),o(h,"detail",ve(ve({},y),{},{hostName:t.hostName})));return ie||l.createElement(l.Fragment,null,Pe,l.createElement("div",Ie,l.createElement("span",ye,P),N&&l.createElement("div",He,N)))}return null},X=pe(),te=be(),je=n({ref:e,className:ae(w,u("message.message",{severity:d})),style:g,role:"alert","aria-live":"assertive","aria-atomic":"true",onClick:z,onMouseEnter:K,onMouseLeave:ee},M("message",v),o(h,"root",ve(ve({},y),{},{hostName:t.hostName}))),qe=n({className:ae(x,u("message.content")),style:E},M("content",v),o(h,"content",ve(ve({},y),{},{hostName:t.hostName})));return l.createElement("div",je,l.createElement("div",qe,X,te))}));Js.displayName="ToastMessage";var Xr=0,kr=l.memo(l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=Sn.getProps(t,s),i=l.useState([]),a=yr(i,2),o=a[0],u=a[1],p=l.useRef(null),m={props:r,state:{messages:o}},d=Sn.setMetaData(m);pt(Sn.css.styles,d.isUnstyled,{name:"toast"});var S=function(c){c&&u(function(h){return P(h,c,!0)})},P=function(c,h,y){var v;if(Array.isArray(h)){var C=h.reduce(function(L,D){return L.push({_pId:Xr++,message:D}),L},[]);y?v=c?[].concat(ir(c),ir(C)):C:v=C}else{var F={_pId:Xr++,message:h};y?v=c?[].concat(ir(c),[F]):[F]:v=[F]}return v},N=function(){Qe.clear(p.current),u([])},O=function(c){u(function(h){return P(h,c,!1)})},R=function(c){var h=se.isNotEmpty(c._pId)?c._pId:c.message||c;u(function(y){return y.filter(function(v){return v._pId!==c._pId&&!se.deepEquals(v.message,h)})}),r.onRemove&&r.onRemove(c.message||h)},f=function(c){R(c)},w=function(){r.onShow&&r.onShow()},g=function(){o.length===1&&Qe.clear(p.current),r.onHide&&r.onHide()};Et(function(){Qe.set("toast",p.current,s&&s.autoZIndex||ke.autoZIndex,r.baseZIndex||s&&s.zIndex.toast||ke.zIndex.toast)},[o,r.baseZIndex]),Pr(function(){Qe.clear(p.current)}),l.useImperativeHandle(e,function(){return{props:r,show:S,replace:O,remove:R,clear:N,getElement:function(){return p.current}}});var x=function(){var c=n({ref:p,id:r.id,className:d.cx("root",{context:s}),style:d.sx("root")},Sn.getOtherProps(r),d.ptm("root")),h=n({classNames:d.cx("transition"),timeout:{enter:300,exit:300},options:r.transitionOptions,unmountOnExit:!0,onEntered:w,onExited:g},d.ptm("transition"));return l.createElement("div",c,l.createElement(Lr,null,o&&o.map(function(y,v){var C=l.createRef();return l.createElement(yn,hr({nodeRef:C,key:y._pId},h),t.content?se.getJSXElement(t.content,{message:y.message}):l.createElement(Js,{hostName:"Toast",ref:C,messageInfo:y,index:v,onClick:r.onClick,onClose:f,onMouseEnter:r.onMouseEnter,onMouseLeave:r.onMouseLeave,closeIcon:r.closeIcon,ptCallbacks:d,metaData:m}))})))},E=x();return l.createElement(Ar,{element:E,appendTo:r.appendTo})}));kr.displayName="Toast";var Xs=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Zt=t=>{let e=0;for(let n=0;n<t.length;n++){let s=t[n],r=Xs.indexOf(s);e=e*83+r}return e},Wt=(t,e)=>{var n="";for(let s=1;s<=e;s++){let r=Math.floor(t)/Math.pow(83,e-s)%83;n+=Xs[Math.floor(r)]}return n},$t=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},Dt=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},zo=t=>t<0?-1:1,Ut=(t,e)=>zo(t)*Math.pow(Math.abs(t),e),Dn=class extends Error{constructor(t){super(t),this.name="ValidationError",this.message=t}},Ho=t=>{if(!t||t.length<6)throw new Dn("The blurhash string must be at least 6 characters");let e=Zt(t[0]),n=Math.floor(e/9)+1,s=e%9+1;if(t.length!==4+2*s*n)throw new Dn(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*s*n}`)},Ko=t=>{let e=t>>16,n=t>>8&255,s=t&255;return[$t(e),$t(n),$t(s)]},Go=(t,e)=>{let n=Math.floor(t/361),s=Math.floor(t/19)%19,r=t%19;return[Ut((n-9)/9,2)*e,Ut((s-9)/9,2)*e,Ut((r-9)/9,2)*e]},Wo=(t,e,n,s)=>{Ho(t),s=s|1;let r=Zt(t[0]),i=Math.floor(r/9)+1,a=r%9+1,o=(Zt(t[1])+1)/166,u=new Array(a*i);for(let d=0;d<u.length;d++)if(d===0){let S=Zt(t.substring(2,6));u[d]=Ko(S)}else{let S=Zt(t.substring(4+d*2,6+d*2));u[d]=Go(S,o*s)}let p=e*4,m=new Uint8ClampedArray(p*n);for(let d=0;d<n;d++)for(let S=0;S<e;S++){let P=0,N=0,O=0;for(let g=0;g<i;g++)for(let x=0;x<a;x++){let E=Math.cos(Math.PI*S*x/e)*Math.cos(Math.PI*d*g/n),b=u[x+g*a];P+=b[0]*E,N+=b[1]*E,O+=b[2]*E}let R=Dt(P),f=Dt(N),w=Dt(O);m[4*S+0+d*p]=R,m[4*S+1+d*p]=f,m[4*S+2+d*p]=w,m[4*S+3+d*p]=255}return m},Yo=Wo,Zr=4,qo=(t,e,n,s)=>{let r=0,i=0,a=0,o=e*Zr;for(let p=0;p<e;p++){let m=Zr*p;for(let d=0;d<n;d++){let S=m+d*o,P=s(p,d);r+=P*$t(t[S]),i+=P*$t(t[S+1]),a+=P*$t(t[S+2])}}let u=1/(e*n);return[r*u,i*u,a*u]},Jo=t=>{let e=Dt(t[0]),n=Dt(t[1]),s=Dt(t[2]);return(e<<16)+(n<<8)+s},Xo=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(Ut(t[0]/e,.5)*9+9.5)))),s=Math.floor(Math.max(0,Math.min(18,Math.floor(Ut(t[1]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(Ut(t[2]/e,.5)*9+9.5))));return n*19*19+s*19+r},Zo=(t,e,n,s,r)=>{if(s<1||s>9||r<1||r>9)throw new Dn("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new Dn("Width and height must match the pixels array");let i=[];for(let d=0;d<r;d++)for(let S=0;S<s;S++){let P=S==0&&d==0?1:2,N=qo(t,e,n,(O,R)=>P*Math.cos(Math.PI*S*O/e)*Math.cos(Math.PI*d*R/n));i.push(N)}let a=i[0],o=i.slice(1),u="",p=s-1+(r-1)*9;u+=Wt(p,1);let m;if(o.length>0){let d=Math.max(...o.map(P=>Math.max(...P))),S=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));m=(S+1)/166,u+=Wt(S,1)}else m=1,u+=Wt(0,1);return u+=Wt(Jo(a),4),o.forEach(d=>{u+=Wt(Xo(d,m),2)}),u},Qo=Zo;async function ea(t){return new Promise((e,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=(...r)=>n(r),s.src=t})}async function ta(t){const{rgba:e,w:n,h:s}=await ra(t,{maxSize:100,opaque:!0}),r=9;return Qo(new Uint8ClampedArray(e),n,s,r,r)}function na(t,e,n){const s=Yo(t,e,n),r=document.createElement("canvas");r.width=e,r.height=n;const i=r.getContext("2d"),a=i.createImageData(e,n);return a.data.set(s),i.putImageData(a,0,0),r.toDataURL("image/png")}async function ra(t,{maxSize:e,opaque:n}){const s=await ea(t),r=s.width,i=s.height,a=Math.min(e/r,e/i),o=Math.floor(r*a),u=Math.floor(i*a),p=document.createElement("canvas");p.width=o,p.height=u;const m=p.getContext("2d");if(!m)throw new Error("Could not get canvas context");m.fillStyle="white",m.fillRect(0,0,o,u),m.drawImage(s,0,0,o,u);const d=m.getImageData(0,0,o,u);return{rgba:new Uint8Array(d.data.buffer),w:o,h:u}}const an=[["Diagonal",Math.PI/4,Math.PI/4],["Front",0,Math.PI/2],["Right",Math.PI/2,Math.PI/2],["Back",Math.PI,Math.PI/2],["Left",-Math.PI/2,Math.PI/2],["Top",0,0],["Bottom",0,Math.PI]];function vr(t,e){return[Math.cos(t)*Math.sin(e),Math.sin(t)*Math.sin(e),Math.cos(e)]}function Zs(t,e){const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+s*s+r*r)}const Qr=(t,e)=>Math.min(Math.abs(t-e),Math.abs(t-e+2*Math.PI),Math.abs(t-e-2*Math.PI));function sa(t,e){const n=vr(t,e),r=an.map(([u,p,m])=>vr(p,m)).map(u=>Zs(n,u)),i=an.map(([u,p,m])=>Math.max(Qr(t,p),Qr(e,m))),[a,o]=r.reduce((u,p,m)=>p<u[1]?[m,p]:u,[0,1/0]);return[a,o,i[a]]}const Tn=(([t,e,n])=>`${e}rad ${n}rad auto`)(an[0]),ia=l.forwardRef(function(e,n){const[s,r]=l.useState("none"),i=l.useRef(null),a=l.useRef(null),o=l.useRef(null),[u,p]=l.useState(),[m,d]=l.useState(void 0),S=u===e.modelUri;if(e?.preview){let{hash:R,uri:f}=m??{hash:""};e.preview.blurhash&&R!==e.preview.blurhash&&(R=e.preview.blurhash,f=na(R,100,100),d({hash:R,uri:f}))}else m&&d(void 0);const P=l.useCallback(async R=>{if(p(e.modelUri),!i.current)return;const f=await i.current.toDataURL("image/png",.5);await ta(f)},[e.modelUri,p,i.current]);l.useEffect(()=>{if(!i.current)return;const R=i.current;return R.addEventListener("load",P),()=>R.removeEventListener("load",P)},[i.current,P]);for(const R of[i,a]){const f=R===i?a:i;l.useEffect(()=>{if(!R.current)return;function w(x){if(f.current&&x.detail.source==="user-interaction"){const E=R.current.getCameraOrbit();E.radius=f.current.getCameraOrbit().radius,f.current.cameraOrbit=E.toString()}}const g=R.current;return g.addEventListener("camera-change",w),()=>g.removeEventListener("camera-change",w)},[R.current,f.current])}l.useEffect(()=>{let R;function f(){const x=a.current.getCameraOrbit();return vr(x.theta,x.phi)}function w(x){x.target===a.current&&(R=f())}function g(x){if(x.target===a.current){const c=f();if((R?Zs(c,R):1/0)>.01)return;const y=a.current.getCameraOrbit(),v=i.current.getCameraOrbit(),[C,F,L]=sa(y.theta,y.phi),D=F<.01&&L<.1?(C+1)%an.length:C,[_,B,T]=an[D];Object.assign(v,{theta:B,phi:T}),i.current.cameraOrbit=a.current.cameraOrbit=v.toString(),o.current?.show({severity:"info",detail:`${_} view`,life:1e3}),r("none")}}return window.addEventListener("mousedown",w),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousedown",w),window.removeEventListener("mouseup",g)}});async function N(){if(!i.current)return null;const R=await i.current.toDataURL("image/png",1),f=new window.Image;f.src=R,await new Promise(x=>{f.onload=x});const w=document.createElement("canvas");w.width=500,w.height=500;const g=w.getContext("2d");return g?(g.drawImage(f,0,0,500,500),w.toDataURL("image/webp",.9)):null}function O(){!i.current||!a.current||(i.current.cameraOrbit=Tn,a.current.cameraOrbit=Tn)}return l.useImperativeHandle(n,()=>({getWebpScreenshot:N,resetView:O}),[N,O]),j.jsxs("div",{className:e.className,style:{display:"flex",flexDirection:"column",position:"relative",flex:1,width:"100%",background:e.lightMode?"#eee":"#111",...e.style??{}},children:[j.jsx(kr,{ref:o,position:"top-right"}),j.jsx("style",{children:`
          @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 0.7; }
            100% { opacity: 0.4; }
          }
        `}),S?j.jsx(j.Fragment,{}):m?j.jsx("img",{src:m.uri,style:{animation:"pulse 1.5s ease-in-out infinite",position:"absolute",pointerEvents:"none",width:"100%",height:"100%"}}):j.jsx(Bt,{text:"Loading model"}),j.jsx("model-viewer",{orientation:"0deg -90deg 0deg",class:"main-viewer",src:e.modelUri,style:{transition:"opacity 0.5s",position:"absolute",width:"100%",height:"100%"},"camera-orbit":Tn,"interaction-prompt":s,"environment-image":"./skybox-lights.jpg",exposure:2,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","camera-controls":!0,ar:!0,ref:i,children:j.jsx("span",{slot:"progress-bar"})}),j.jsx("model-viewer",{orientation:"0deg -90deg 0deg",src:"./axes.glb",style:{position:"absolute",bottom:0,left:0,zIndex:10,height:"100px",width:"100px"},loading:"eager","camera-orbit":Tn,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","orbit-sensitivity":"5","interaction-prompt":"none","camera-controls":"false","disable-zoom":!0,"disable-tap":!0,"disable-pan":!0,ref:a,children:j.jsx("span",{slot:"progress-bar"})})]})});function Un(){return Un=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Un.apply(null,arguments)}function oa(t){if(Array.isArray(t))return t}function aa(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function es(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function la(t,e){if(t){if(typeof t=="string")return es(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?es(t,e):void 0}}function ca(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ts(t,e){return oa(t)||aa(t,e)||la(t,e)||ca()}var Rn=dt.extend({defaultProps:{__TYPE:"Fieldset",id:null,legend:null,className:null,style:null,toggleable:null,collapsed:null,collapseIcon:null,transitionOptions:null,expandIcon:null,onExpand:null,onCollapse:null,onToggle:null,onClick:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return ae("p-fieldset p-component",{"p-fieldset-toggleable":n.toggleable})},toggleableContent:"p-toggleable-content",togglericon:"p-fieldset-toggler",legendTitle:"p-fieldset-legend-text",legend:"p-fieldset-legend p-unselectable-text",content:"p-fieldset-content",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-fieldset-legend > a,
            .p-fieldset-legend > span {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .p-fieldset-toggleable .p-fieldset-legend a {
                cursor: pointer;
                user-select: none;
                overflow: hidden;
                position: relative;
                text-decoration: none;
            }
            
            .p-fieldset-legend-text {
                line-height: 1;
            }
        }
        `}}),Qs=l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=Rn.getProps(t,s),i=l.useState(r.id),a=ts(i,2),o=a[0],u=a[1],p=l.useState(r.collapsed),m=ts(p,2),d=m[0],S=m[1],P=r.toggleable?r.onToggle?r.collapsed:d:!1,N=l.useRef(null),O=l.useRef(null),R=o+"_header",f=o+"_content",w=Rn.setMetaData({props:r,state:{id:o,collapsed:P}}),g=w.ptm,x=w.cx,E=w.isUnstyled;pt(Rn.css.styles,E,{name:"fieldset"});var b=function(M){r.toggleable&&(P?c(M):h(M),r.onToggle&&r.onToggle({originalEvent:M,value:!P})),M.preventDefault()},c=function(M){r.onToggle||S(!1),r.onExpand&&r.onExpand(M)},h=function(M){r.onToggle||S(!0),r.onCollapse&&r.onCollapse(M)};gn(function(){r.id||u(Wn())});var y=function(M){(M.code==="Enter"||M.code==="NumpadEnter"||M.code==="Space")&&(b(M),M.preventDefault())},v=function(){var M=n({className:x("content")},g("content")),V=n({ref:O,id:f,role:"region","aria-labelledby":R,className:x("toggleableContent")},g("toggleableContent")),z=n({classNames:x("transition"),timeout:{enter:1e3,exit:450},in:!P,unmountOnExit:!0,options:r.transitionOptions},g("transition"));return l.createElement(yn,Un({nodeRef:O},z),l.createElement("div",V,l.createElement("div",M,r.children)))},C=function(){if(r.toggleable){var M=n({className:x("togglericon")},g("togglericon")),V=P?r.expandIcon||l.createElement(Bs,M):r.collapseIcon||l.createElement($s,M),z=et.getJSXIcon(V,M,{props:r});return z}return null},F=function(){var M=n({className:x("legendTitle")},g("legendTitle")),V=n({id:R,role:"button","aria-expanded":!P,"aria-controls":f,onKeyDown:y,onClick:b,"aria-label":r.legend,tabIndex:0},g("toggler"));if(r.toggleable){var z=C();return l.createElement("a",V,z,l.createElement("span",M,r.legend),l.createElement(hn,null))}return l.createElement("span",Un({},M,{id:R}),r.legend)},L=function(){var M=n({className:x("legend")},g("legend"));if(r.legend!=null||r.toggleable){var V=F();return l.createElement("legend",M,V)}};l.useImperativeHandle(e,function(){return{props:r,getElement:function(){return N.current},getContent:function(){return O.current}}});var D=n({id:o,ref:N,style:r.style,className:ae(r.className,x("root")),onClick:r.onClick},Rn.getOtherProps(r),g("root")),_=L(),B=v();return l.createElement("fieldset",D,_,B)});Qs.displayName="Fieldset";function tn(){return tn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},tn.apply(null,arguments)}function ln(t){"@babel/helpers - typeof";return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(t)}function ua(t,e){if(ln(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(ln(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function fa(t){var e=ua(t,"string");return ln(e)=="symbol"?e:e+""}function da(t,e,n){return(e=fa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pa(t){if(Array.isArray(t))return t}function ma(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function ns(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ha(t,e){if(t){if(typeof t=="string")return ns(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ns(t,e):void 0}}function ga(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ya(t,e){return pa(t)||ma(t,e)||ha(t,e)||ga()}var va={box:"p-checkbox-box",input:"p-checkbox-input",icon:"p-checkbox-icon",root:function(e){var n=e.props,s=e.checked,r=e.context;return ae("p-checkbox p-component",{"p-highlight":s,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled"})}},In=dt.extend({defaultProps:{__TYPE:"Checkbox",autoFocus:!1,checked:!1,className:null,disabled:!1,falseValue:!1,icon:null,id:null,inputId:null,inputRef:null,invalid:!1,variant:null,name:null,onChange:null,onContextMenu:null,onMouseDown:null,readOnly:!1,required:!1,style:null,tabIndex:null,tooltip:null,tooltipOptions:null,trueValue:!0,value:null,children:void 0},css:{classes:va}});function rs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ss(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rs(Object(n),!0).forEach(function(s){da(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var ei=l.memo(l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=In.getProps(t,s),i=l.useState(!1),a=ya(i,2),o=a[0],u=a[1],p=In.setMetaData({props:r,state:{focused:o},context:{checked:r.checked===r.trueValue,disabled:r.disabled}}),m=p.ptm,d=p.cx,S=p.isUnstyled;pt(In.css.styles,S,{name:"checkbox"});var P=l.useRef(null),N=l.useRef(r.inputRef),O=function(){return r.checked===r.trueValue},R=function(v){if(!(r.disabled||r.readOnly)&&r.onChange){var C,F=O(),L=F?r.falseValue:r.trueValue,D={originalEvent:v,value:r.value,checked:L,stopPropagation:function(){v?.stopPropagation()},preventDefault:function(){v?.preventDefault()},target:{type:"checkbox",name:r.name,id:r.id,value:r.value,checked:L}};if(r==null||(C=r.onChange)===null||C===void 0||C.call(r,D),v.defaultPrevented)return;J.focus(N.current)}},f=function(v){var C;u(!0),r==null||(C=r.onFocus)===null||C===void 0||C.call(r,v)},w=function(v){var C;u(!1),r==null||(C=r.onBlur)===null||C===void 0||C.call(r,v)};l.useImperativeHandle(e,function(){return{props:r,focus:function(){return J.focus(N.current)},getElement:function(){return P.current},getInput:function(){return N.current}}}),l.useEffect(function(){se.combinedRefs(N,r.inputRef)},[N,r.inputRef]),Et(function(){N.current.checked=O()},[r.checked,r.trueValue]),gn(function(){r.autoFocus&&J.focus(N.current,r.autoFocus)});var g=O(),x=se.isNotEmpty(r.tooltip),E=In.getOtherProps(r),b=n({id:r.id,className:ae(r.className,d("root",{checked:g,context:s})),style:r.style,"data-p-highlight":g,"data-p-disabled":r.disabled,onContextMenu:r.onContextMenu,onMouseDown:r.onMouseDown},E,m("root")),c=function(){var v=se.reduceKeys(E,J.ARIA_PROPS),C=n(ss({id:r.inputId,type:"checkbox",className:d("input"),name:r.name,tabIndex:r.tabIndex,onFocus:function(L){return f(L)},onBlur:function(L){return w(L)},onChange:function(L){return R(L)},disabled:r.disabled,readOnly:r.readOnly,required:r.required,"aria-invalid":r.invalid,checked:g},v),m("input"));return l.createElement("input",tn({ref:N},C))},h=function(){var v=n({className:d("icon")},m("icon")),C=n({className:d("box",{checked:g}),"data-p-highlight":g,"data-p-disabled":r.disabled},m("box")),F=g?r.icon||l.createElement(Ds,v):null,L=et.getJSXIcon(F,ss({},v),{props:r,checked:g});return l.createElement("div",C,L)};return l.createElement(l.Fragment,null,l.createElement("div",tn({ref:P},b),c(),h()),x&&l.createElement(_r,tn({target:P,content:r.tooltip,pt:m("tooltip")},r.tooltipOptions)))}));ei.displayName="Checkbox";function br(){return br=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},br.apply(null,arguments)}function cn(t){"@babel/helpers - typeof";return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}function ba(t,e){if(cn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(cn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function xa(t){var e=ba(t,"string");return cn(e)=="symbol"?e:e+""}function Ea(t,e,n){return(e=xa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function wa(t){if(Array.isArray(t))return xr(t)}function Sa(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function ti(t,e){if(t){if(typeof t=="string")return xr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xr(t,e):void 0}}function Ta(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ra(t){return wa(t)||Sa(t)||ti(t)||Ta()}function Ia(t){if(Array.isArray(t))return t}function Ca(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Oa(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cn(t,e){return Ia(t)||Ca(t,e)||ti(t,e)||Oa()}var Ma={handle:function(e){var n=e.index,s=e.handleIndex;return ae("p-slider-handle",{"p-slider-handle-start":n===0,"p-slider-handle-end":n===1,"p-slider-handle-active":s.current===n})},range:"p-slider-range",root:function(e){var n=e.props,s=e.vertical,r=e.horizontal;return ae("p-slider p-component",{"p-disabled":n.disabled,"p-slider-horizontal":r,"p-slider-vertical":s})}},Na=`
@layer primereact {
    .p-slider {
        position: relative;
    }
    
    .p-slider .p-slider-handle {
        position: absolute;
        cursor: grab;
        touch-action: none;
        display: block;
        z-index: 1;
    }
    
    .p-slider .p-slider-handle.p-slider-handle-active {
        z-index: 2;
    }
    
    .p-slider-range {
        position: absolute;
        display: block;
    }
    
    .p-slider-horizontal .p-slider-range {
        top: 0;
        left: 0;
        height: 100%;
    }
    
    .p-slider-horizontal .p-slider-handle {
        top: 50%;
    }
    
    .p-slider-vertical {
        height: 100px;
    }
    
    .p-slider-vertical .p-slider-handle {
        left: 50%;
    }
    
    .p-slider-vertical .p-slider-range {
        bottom: 0;
        left: 0;
        width: 100%;
    }
}
`,Pa={handle:{position:"absolute"},range:{position:"absolute"}},Yt=dt.extend({defaultProps:{__TYPE:"Slider",id:null,value:null,min:0,max:100,orientation:"horizontal",step:null,range:!1,style:null,className:null,disabled:!1,tabIndex:0,onChange:null,onSlideEnd:null,children:void 0},css:{classes:Ma,styles:Na,inlineStyles:Pa}});function is(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?is(Object(n),!0).forEach(function(s){Ea(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):is(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var ni=l.memo(l.forwardRef(function(t,e){var n,s,r,i=nt(),a=l.useContext(it),o=Yt.getProps(t,a),u=l.useRef(null),p=l.useRef(0),m=l.useRef(!1),d=l.useRef(!1),S=l.useRef(0),P=l.useRef(0),N=l.useRef(0),O=l.useRef(0),R=l.useRef(),f=o.range?(n=o.value)!==null&&n!==void 0?n:[o.min,o.max]:(s=(r=o.value)!==null&&r!==void 0?r:o.min)!==null&&s!==void 0?s:0,w=o.orientation==="horizontal",g=o.orientation==="vertical",x=En({type:"mousemove",listener:function($){return je($)}}),E=Cn(x,2),b=E[0],c=E[1],h=En({type:"mouseup",listener:function($){return qe($)}}),y=Cn(h,2),v=y[0],C=y[1],F=En({type:"touchmove",listener:function($){return je($)}}),L=Cn(F,2),D=L[0],_=L[1],B=En({type:"touchend",listener:function($){return qe($)}}),T=Cn(B,2),M=T[0],V=T[1],z=Yt.setMetaData({props:o}),K=z.ptm,ee=z.cx,be=z.sx,pe=z.isUnstyled;pt(Yt.css.styles,pe,{name:"slider"});var X=function($,k){var U=o.range?f[p.current]:f,Z=(o.step||1)*k;He($,U+Z),$.preventDefault()},te=function($,k){o.disabled||(d.current=!0,Pe(),m.current=!0,o.range&&f[0]===o.max?p.current=0:p.current=k,$.preventDefault())},je=function($){d.current&&(ye($),$.preventDefault())},qe=function($){if(d.current){d.current=!1;var k=ye($);o.onSlideEnd&&o.onSlideEnd({originalEvent:$,value:k}),R.current=void 0,c(),C(),_(),V()}},Ne=function($,k){b(),v(),te($,k)},ie=function($,k){$.changedTouches&&$.changedTouches[0]&&(R.current=$.changedTouches[0].identifier),D(),M(),te($,k)},Ee=function($,k){if(!o.disabled){p.current=k;var U=$.key;switch(U){case"ArrowRight":case"ArrowUp":X($,1);break;case"ArrowLeft":case"ArrowDown":X($,-1);break;case"PageUp":X($,10),$.preventDefault();break;case"PageDown":X($,-10),$.preventDefault();break;case"Home":X($,-f),$.preventDefault();break;case"End":X($,o.max),$.preventDefault();break}}},we=function($){if(!o.disabled){if(!m.current){Pe();var k=ye($);o.onSlideEnd&&o.onSlideEnd({originalEvent:$,value:k})}m.current=!1}},Pe=function(){var $=u.current.getBoundingClientRect();S.current=$.left+J.getWindowScrollLeft(),P.current=$.top+J.getWindowScrollTop(),N.current=u.current.offsetWidth,O.current=u.current.offsetHeight},Ie=function($){var k,U=Array.from((k=$.changedTouches)!==null&&k!==void 0?k:[]).find(function(Z){return Z.identifier===R.current})||$;return{pageX:U.pageX,pageY:U.pageY}},ye=function($){var k,U=Ie($),Z=U.pageX,ue=U.pageY;if(!(!Z||!ue)){w?k=(Z-S.current)*100/N.current:k=(P.current+O.current-ue)*100/O.current;var he=(o.max-o.min)*(k/100)+o.min;if(o.step){var ge=o.range?f[p.current]:f,Ke=he-ge;Ke<0?he=ge+Math.ceil(he/o.step-ge/o.step)*o.step:Ke>0&&(he=ge+Math.floor(he/o.step-ge/o.step)*o.step)}else he=Math.floor(he);return He($,he)}},He=function($,k){var U=parseFloat(k.toFixed(10)),Z=U;return o.range?(p.current===0?U<o.min?U=o.min:U>o.max&&(U=o.max):U>o.max?U=o.max:U<o.min&&(U=o.min),Z=Ra(f),Z[p.current]=U,o.onChange&&o.onChange({originalEvent:$,value:Z})):(U<o.min?U=o.min:U>o.max&&(U=o.max),Z=U,o.onChange&&o.onChange({originalEvent:$,value:Z})),Z},De=function($,k,U){$=se.isEmpty($)?null:$,k=se.isEmpty(k)?null:k;var Z={transition:d.current?"none":null,left:$!=null?$+"%":null,bottom:k!=null?k+"%":null},ue=i(bt({className:ee("handle",{index:U,handleIndex:p}),style:bt(bt({},be("handle",{dragging:d,leftValue:$,bottomValue:k})),Z),tabIndex:o.tabIndex,role:"slider",onMouseDown:function(ge){return Ne(ge,U)},onTouchStart:function(ge){return ie(ge,U)},onKeyDown:function(ge){return Ee(ge,U)},"aria-valuemin":o.min,"aria-valuemax":o.max,"aria-valuenow":$||k||0,"aria-orientation":o.orientation},Xe),K("handle"));return l.createElement("span",ue)},Ae=function(){var $=(f[0]<o.min?o.min:f[0]-o.min)*100/(o.max-o.min),k=(f[1]>o.max?o.max:f[1]-o.min)*100/(o.max-o.min),U=w?De($,null,0):De(null,$,0),Z=w?De(k,null,1):De(null,k,1),ue=k>$?k-$:$-k,he=k>$?$:k,ge=w?{left:he+"%",width:ue+"%"}:{bottom:he+"%",height:ue+"%"},Ke=i({className:ee("range"),style:bt(bt({},be("range")),ge)},K("range"));return l.createElement(l.Fragment,null,l.createElement("span",Ke),U,Z)},ot=function(){var $;f<o.min?$=o.min:f>o.max?$=o.max:$=(f-o.min)*100/(o.max-o.min);var k=w?{width:$+"%"}:{height:$+"%"},U=w?De($,null,null):De(null,$,null),Z=i({className:ee("range"),style:bt(bt({},be("range")),k)},K("range"));return l.createElement(l.Fragment,null,l.createElement("span",Z),U)};l.useImperativeHandle(e,function(){return{props:o,getElement:function(){return u.current}}});var Je=Yt.getOtherProps(o),Xe=se.reduceKeys(Je,J.ARIA_PROPS),Ce=o.range?Ae():ot(),rt=i({style:o.style,className:ae(o.className,ee("root",{vertical:g,horizontal:w})),onClick:we},Yt.getOtherProps(o),K("root"));return l.createElement("div",br({id:o.id,ref:u},rt),Ce)}));ni.displayName="Slider";const Aa="customizerRoot_CustomizerPanel",_a="customizerFieldset_CustomizerPanel",ja="parameterInput_CustomizerPanel",Fa="parameterInputRow_CustomizerPanel",La="parameterInputLeft_CustomizerPanel",ka="parameterInputLabel_CustomizerPanel",$a="parameterInputReset_CustomizerPanel",Da="parameterInputResetHidden_CustomizerPanel",Ua="parameterInputResetVisible_CustomizerPanel",Ba="parameterInputCaption_CustomizerPanel",Va="parameterInputRight_CustomizerPanel",za="parameterInputDropdown_CustomizerPanel",Ha="parameterInputNumber_CustomizerPanel",Ka="parameterInputText_CustomizerPanel",Ga="parameterInputArrayRow_CustomizerPanel",Wa="parameterInputSlider_CustomizerPanel",Te={customizerRoot:Aa,customizerFieldset:_a,parameterInput:ja,parameterInputRow:Fa,parameterInputLeft:La,parameterInputLabel:ka,parameterInputReset:$a,parameterInputResetHidden:Da,parameterInputResetVisible:Ua,parameterInputCaption:Ba,parameterInputRight:Va,parameterInputDropdown:za,parameterInputNumber:Ha,parameterInputText:Ka,parameterInputArrayRow:Ga,parameterInputSlider:Wa};function Ya(t){const e=(t.parameterSet?.parameters??[]).reduce((r,i)=>(r[i.group]||(r[i.group]=[]),r[i.group].push(i),r),{}),n=Object.entries(e),s=n.length===1;return t.parameterSet?j.jsx("div",{className:Te.customizerRoot+(t.className?" "+t.className:""),style:t.style,children:n.map(([r,i])=>s?j.jsx(j.Fragment,{children:i.map(a=>j.jsx(os,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))}):j.jsx(Qs,{className:Te.customizerFieldset,legend:r,toggleable:!0,children:i.map(a=>j.jsx(os,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))},r))}):j.jsx(Bt,{text:"Waiting for customizer to run"})}function os({param:t,value:e,style:n,handleChange:s}){const r=e!==void 0&&JSON.stringify(e)!==JSON.stringify(t.initial);return j.jsxs("div",{className:Te.parameterInput,style:n,children:[j.jsxs("div",{className:Te.parameterInputRow,children:[j.jsxs("div",{className:Te.parameterInputLeft,children:[j.jsxs("label",{className:Te.parameterInputLabel,children:[j.jsx("b",{children:t.name}),j.jsx("i",{className:"pi pi-refresh "+Te.parameterInputReset+" "+(r?Te.parameterInputResetVisible:Te.parameterInputResetHidden),onClick:()=>s(t.name,t.initial)})]}),j.jsx("div",{className:Te.parameterInputCaption,children:t.caption})]}),j.jsxs("div",{className:Te.parameterInputRight,children:[t.type==="number"&&"options"in t&&j.jsx(Yr,{className:Te.parameterInputDropdown,value:e||t.initial,options:t.options,onChange:i=>s(t.name,i.value),optionLabel:"name",optionValue:"value"}),t.type==="string"&&t.options&&j.jsx(Yr,{className:Te.parameterInputDropdown,value:e||t.initial,options:t.options,onChange:i=>s(t.name,i.value),optionLabel:"name",optionValue:"value"}),t.type==="boolean"&&j.jsx(ei,{checked:e??t.initial,onChange:i=>s(t.name,i.checked)}),!Array.isArray(t.initial)&&t.type==="number"&&!("options"in t)&&j.jsx(qr,{className:Te.parameterInputNumber,value:e||t.initial,showButtons:!0,size:5,onValueChange:i=>s(t.name,i.value)}),t.type==="string"&&!t.options&&j.jsx(_s,{className:Te.parameterInputText,value:e||t.initial,onChange:i=>s(t.name,i.target.value)}),Array.isArray(t.initial)&&"min"in t&&j.jsx("div",{className:Te.parameterInputArrayRow,children:t.initial.map((i,a)=>j.jsx(qr,{className:Te.parameterInputNumber,value:e?.[a]??t.initial[a],min:t.min,max:t.max,showButtons:!0,size:5,step:t.step,onValueChange:o=>{const u=[...e??t.initial];u[a]=o.value,s(t.name,u)}},a))})]})]}),!Array.isArray(t.initial)&&t.type==="number"&&t.min!==void 0&&j.jsx(ni,{className:Te.parameterInputSlider,value:e||t.initial,min:t.min,max:t.max,step:t.step,onChange:i=>s(t.name,i.value)})]})}function Er(){return Er=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Er.apply(null,arguments)}function un(t){"@babel/helpers - typeof";return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(t)}function qa(t,e){if(un(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(un(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ja(t){var e=qa(t,"string");return un(e)=="symbol"?e:e+""}function Xa(t,e,n){return(e=Ja(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Za={root:function(e){var n=e.props,s=e.context,r=e.isFilled;return ae("p-inputtextarea p-inputtext p-component",{"p-disabled":n.disabled,"p-filled":r,"p-inputtextarea-resizable":n.autoResize,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":s&&s.inputStyle==="filled"})}},Qa=`
@layer primereact {
    .p-inputtextarea-resizable {
        overflow: hidden;
        resize: none;
    }
    
    .p-fluid .p-inputtextarea {
        width: 100%;
    }
}
`,On=dt.extend({defaultProps:{__TYPE:"InputTextarea",__parentMetadata:null,autoResize:!1,invalid:!1,variant:null,keyfilter:null,onBlur:null,onFocus:null,onBeforeInput:null,onInput:null,onKeyDown:null,onKeyUp:null,onPaste:null,tooltip:null,tooltipOptions:null,validateOnly:!1,children:void 0,className:null},css:{classes:Za,styles:Qa}});function as(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ls(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?as(Object(n),!0).forEach(function(s){Xa(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):as(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var $r=l.memo(l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=On.getProps(t,s),i=l.useRef(e),a=l.useRef(0),o=On.setMetaData(ls(ls({props:r},r.__parentMetadata),{},{context:{disabled:r.disabled}})),u=o.ptm,p=o.cx,m=o.isUnstyled;pt(On.css.styles,m,{name:"inputtextarea"});var d=function(h){r.autoResize&&w(),r.onFocus&&r.onFocus(h)},S=function(h){r.autoResize&&w(),r.onBlur&&r.onBlur(h)},P=function(h){r.autoResize&&w(),r.onKeyUp&&r.onKeyUp(h)},N=function(h){r.onKeyDown&&r.onKeyDown(h),r.keyfilter&&er.onKeyPress(h,r.keyfilter,r.validateOnly)},O=function(h){r.onBeforeInput&&r.onBeforeInput(h),r.keyfilter&&er.onBeforeInput(h,r.keyfilter,r.validateOnly)},R=function(h){r.onPaste&&r.onPaste(h),r.keyfilter&&er.onPaste(h,r.keyfilter,r.validateOnly)},f=function(h){var y=h.target;r.autoResize&&w(se.isEmpty(y.value)),r.onInput&&r.onInput(h),se.isNotEmpty(y.value)?J.addClass(y,"p-filled"):J.removeClass(y,"p-filled")},w=function(h){var y=i.current;y&&g()&&(a.current||(a.current=y.scrollHeight,y.style.overflow="hidden"),(a.current!==y.scrollHeight||h)&&(y.style.height="",y.style.height=y.scrollHeight+"px",parseFloat(y.style.height)>=parseFloat(y.style.maxHeight)?(y.style.overflowY="scroll",y.style.height=y.style.maxHeight):y.style.overflow="hidden",a.current=y.scrollHeight))},g=function(){if(J.isVisible(i.current)){var h=i.current.getBoundingClientRect();return h.width>0&&h.height>0}return!1};l.useEffect(function(){se.combinedRefs(i,e)},[i,e]),l.useEffect(function(){r.autoResize&&w(!0)},[r.autoResize,r.value]);var x=l.useMemo(function(){return se.isNotEmpty(r.value)||se.isNotEmpty(r.defaultValue)},[r.value,r.defaultValue]),E=se.isNotEmpty(r.tooltip),b=n({ref:i,className:ae(r.className,p("root",{context:s,isFilled:x})),onFocus:d,onBlur:S,onKeyUp:P,onKeyDown:N,onBeforeInput:O,onInput:f,onPaste:R},On.getOtherProps(r),u("root"));return l.createElement(l.Fragment,null,l.createElement("textarea",b),E&&l.createElement(_r,Er({target:i,content:r.tooltip,pt:u("tooltip")},r.tooltipOptions)))}));$r.displayName="InputTextarea";function wr(){return wr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},wr.apply(null,arguments)}function el(t){if(Array.isArray(t))return t}function tl(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function cs(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function nl(t,e){if(t){if(typeof t=="string")return cs(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cs(t,e):void 0}}function rl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function us(t,e){return el(t)||tl(t,e)||nl(t,e)||rl()}var Mn=dt.extend({defaultProps:{__TYPE:"Panel",id:null,header:null,headerTemplate:null,footer:null,footerTemplate:null,toggleable:null,style:null,className:null,collapsed:null,expandIcon:null,collapseIcon:null,icons:null,transitionOptions:null,onExpand:null,onCollapse:null,onToggle:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return ae("p-panel p-component",{"p-panel-toggleable":n.toggleable})},header:"p-panel-header",title:"p-panel-title",icons:"p-panel-icons",toggler:"p-panel-header-icon p-panel-toggler p-link",togglerIcon:"p-panel-header-icon p-panel-toggler p-link",toggleableContent:"p-toggleable-content",content:"p-panel-content",footer:"p-panel-footer",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-panel-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
            }
            
            .p-panel-title {
              line-height: 1;
            }
            
            .p-panel-header-icon {
              display: inline-flex;
              justify-content: center;
              align-items: center;
              cursor: pointer;
              text-decoration: none;
              overflow: hidden;
              position: relative;
            }
        }
        `}}),wt=l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=Mn.getProps(t,s),i=l.useState(r.id),a=us(i,2),o=a[0],u=a[1],p=l.useState(r.collapsed),m=us(p,2),d=m[0],S=m[1],P=l.useRef(null),N=l.useRef(null),O=r.toggleable?r.onToggle?r.collapsed:d:!1,R=o+"_header",f=o+"_content",w=Mn.setMetaData({props:r,state:{id:o,collapsed:O}}),g=w.ptm,x=w.cx,E=w.isUnstyled;pt(Mn.css.styles,E,{name:"panel"});var b=function(M){r.toggleable&&(O?c(M):h(M),M&&(r.onToggle&&r.onToggle({originalEvent:M,value:!O}),M.preventDefault()))},c=function(M){r.onToggle||S(!1),r.onExpand&&M&&r.onExpand(M)},h=function(M){r.onToggle||S(!0),r.onCollapse&&M&&r.onCollapse(M)};l.useImperativeHandle(e,function(){return{props:r,toggle:b,expand:c,collapse:h,getElement:function(){return P.current},getContent:function(){return N.current}}}),gn(function(){o||u(Wn())});var y=function(){if(r.toggleable){var M=o+"_label",V=n({className:x("toggler"),onClick:b,id:M,"aria-controls":f,"aria-expanded":!O,type:"button",role:"button","aria-label":r.header},g("toggler")),z=n(g("togglericon")),K=O?r.expandIcon||l.createElement(Bs,z):r.collapseIcon||l.createElement($s,z),ee=et.getJSXIcon(K,z,{props:r,collapsed:O});return l.createElement("button",V,ee,l.createElement(hn,null))}return null},v=function(){var M=se.getJSXElement(r.header,r),V=se.getJSXElement(r.icons,r),z=y(),K=n({id:R,className:x("title")},g("title")),ee=l.createElement("span",K,M),be=n({className:x("icons")},g("icons")),pe=l.createElement("div",be,V,z),X=n({className:x("header")},g("header")),te=l.createElement("div",X,ee,pe);if(r.headerTemplate){var je={className:"p-panel-header",titleClassName:"p-panel-title",iconsClassName:"p-panel-icons",togglerClassName:"p-panel-header-icon p-panel-toggler p-link",onTogglerClick:b,titleElement:ee,iconsElement:pe,togglerElement:z,element:te,id:o+"_header",props:r,collapsed:O};return se.getJSXElement(r.headerTemplate,je)}else if(r.header||r.toggleable)return te;return null},C=function(){var M=se.getJSXElement(r.footer,r),V=n({className:x("footer")},g("footer")),z=l.createElement("div",V,M);if(r.footerTemplate){var K={className:x("footer"),element:z,props:r};return se.getJSXElement(r.footerTemplate,K)}else if(r.footer)return z;return null},F=function(){var M=n({ref:N,className:x("toggleableContent"),"aria-hidden":O,role:"region",id:f,"aria-labelledby":R},g("toggleablecontent")),V=n({className:x("content")},g("content")),z=n({classNames:x("transition"),timeout:{enter:1e3,exit:450},in:!O,unmountOnExit:!0,options:r.transitionOptions},g("transition"));return l.createElement(yn,wr({nodeRef:N},z),l.createElement("div",M,l.createElement("div",V,r.children)))},L=n({id:o,ref:P,style:r.style,className:ae(r.className,x("root"))},Mn.getOtherProps(r),g("root")),D=v(),_=F(),B=C();return l.createElement("div",L,D,_,B)});wt.displayName="Panel";const sl=({modelId:t})=>{const e=js(),[n,s]=l.useState([]),[r,i]=l.useState(""),[a,o]=l.useState(!0),[u,p]=l.useState(!1),[m,d]=l.useState(null),S=async()=>{o(!0),d(null);try{const N=await en.fetchModelComments(t);s(N)}catch{d("Failed to load comments.")}finally{o(!1)}};l.useEffect(()=>{S()},[t]);const P=async()=>{if(r.trim())try{await en.addModelComment(t,r),s(N=>[{id:"temp-"+no(),model_id:t,user_id:e.user.id,username:e.username,body:r,created_at:ur(new Date)},...N]),i("")}catch{d("Failed to post comment.")}finally{p(!1)}};return j.jsx(wt,{toggleable:!0,header:"Comments",style:{flex:1},className:"panel-comments",children:a?j.jsx(Bt,{text:"Loading comments"}):j.jsxs(j.Fragment,{children:[e.user?j.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8},children:[j.jsx($r,{style:{flex:1,resize:"vertical"},maxLength:2e3,placeholder:"Add a comment...",value:r,onChange:N=>i(N.target.value),disabled:u}),j.jsx(sn,{label:"Post",icon:"pi pi-send",outlined:!0,onClick:P,loading:u})]}):j.jsx("div",{children:"You need to be logged in to post comments."}),m&&j.jsx("div",{style:{color:"red",marginBottom:8},children:m}),n.length===0?j.jsx("div",{children:"No comments yet."}):n.map(N=>j.jsxs("div",{children:[j.jsxs("b",{children:[j.jsx("a",{href:`#/user/${N.username}`,children:N.username})," - ",N.created_at]}),j.jsx("p",{dangerouslySetInnerHTML:{__html:ks(N.body)}})]},N.id))]})})},Sr=t=>t.replaceAll(/\/\*(.|[\s\S])*?\*\/|\/\/.*?$/gm,"");function il(t,e,n){const s=Sr(e),r=[],i={},a={},o=[],u=[];for(const p of s.matchAll(/(use|include)\s*<([^>]+)>/g))(p[1]=="use"?u:o).push(p[2]);for(const p of s.matchAll(/(?:^|[{};])\s*([$\w]+)\s*=/g))r.push(p[1]);for(const p of s.matchAll(/(function|module)\s+([$\w]+)\s*\(([^)]*)\)(?:\s*(?:=\s*)?(\{\}|[^{}]+?;))?/gm)){const m=p[1],d=p[2];if(n&&d.startsWith("_"))continue;const S=p[3],P=p[4],N=[];if(/^(\s*([$\w]+(\s*=[^,()[]+)?(\s*,\s*[$\w]+(\s*=[^,()[]+)?)*)?\s*)$/m.test(S))for(const O of S.split(",")){const R=/^\s*([$\w]+)(?:\s*=([^,()[]+))?\s*$/.exec(O);if(R){const f=R[1],w=R[2];N.push({name:f,defaultValue:w})}}(m=="function"?i:a)[d]={path:t,name:d,signature:`${d}(${S.replaceAll(/[\s]+/gm," ").replaceAll(/\b | \b/g,"")})`,params:N,referencesChildren:P!=null?P.indexOf("children()")>=0:null}}return{vars:r,functions:i,modules:a,includes:o,uses:u}}const ol=`
  $fa=undef;
  $fs=undef;
  $fn=undef;
  $t=undef;

  $preview=undef;

  // shows rotation
  $vpr=undef;
  // shows translation (i.e. won't be affected by rotate and zoom)
  $vpt=undef;
  // shows the FOV of the view [Note: Requires version 2021.01]
  $vpf=undef;
  // shows the camera distance [Note: Requires version 2015.03]
  $vpd=undef;

  PI=undef;

  function abs(x) = x;
  function acos(x) = x;
  function asin(x) = x;
  function atan(x) = x;
  function atan2(y, x) = x;
  function ceil(x) = x;
  function chr(x) = 0;
  function len(assignments) = $children;
  function let(x) = x;
  function ln(x) = x;
  function log(x) = x;
  function lookup(key, array) = x;
  function max(values) = x;
  function min(values) = x;
  function sqrt(x) = x;
  function tan(degrees) = x;
  function rands(min_value, max_value, value_count, seed_value=undef) = x;
  function search(match_value, string_or_vector, num_returns_per_match=1, index_col_num=0) = x;
  function ord(x) = x;
  function round(x) = x;
  function sign(x) = x;
  function sin(degrees) = x;
  function str(values) = x;
  function norm(x) = x;
  function pow(base, exponent) = x;
  function concat(values) = x;
  function cos(degrees) = x;
  function cross(a, b) = x;
  function floor(x) = x;
  function exp(x) = x;
  function chr(x) = x;
  function is_undef(x) = x;
  function is_list(x) = x;
  function is_num(x) = x;
  function is_bool(x) = x;
  function is_string(x) = x;
  function is_function(x) = x;

  function version() = '';
  function version_num() = 0;

  $parent_modules=0;
  module parent_module(n) {}

  module children() {}

  module render(convexity=undef) {}
  module surface(file, center=false, invert=false, convexity=undef) {}

  function assert(condition, message=undef) = children();
  module assert(condition, message=undef) children();

  module cube(size, center=false) {}
  module sphere(r, d=undef, $fa, $fs, $fn) {}
  module cylinder(h, r, r1=undef, r2, d, d1, d2, center=false, $fa, $fs, $fn) {}
  module polyhedron(points, faces, convexity=undef) {}

  module square(size, center=false) {}
  module circle(r, d=undef, $fa, $fs, $fn) {}
  module polygon(points, paths, convexity=undef) {}
  module linear_extrude(height, center=false, twist=undef, slices=undef, scale=undef, convexity=undef) children();
  module rotate_extrude(degrees, convexity=undef, $fa, $fs, $fn) children();

  module scale(v) children();
  module resize(newsize, auto=false) children();
  module rotate(a, v=undef) children();
  module translate(v) children();
  module mirror(v) children();
  module multmatrix(m) children();

  module color(c, alpha) children();

  module offset(r, delta=undef, chamfer) children();

  module minkowski() children();
  module union() children();
  module difference() children();
  module intersection() children();
  module hull() children();

  module children() {}

  // module for(i=undef) children();

  module import(file, convexity=undef, $fn, $fa, $fs) {}
`,al=["abs","acos","asin","atan","atan2","ceil","len","let","ln","log","lookup","max","min","sqrt","tan","rands","search","sign","sin","str","norm","pow","concat","cos","cross","floor","exp","chr"],ll=["children","circle","color","cube","cylinder","diameter","difference","echo","extrude","for","function","hull","if","include","intersection_for","intersection","linear","minkowski","mirror","module","multmatrix","offset","polyhedron","projection","radius","render","resize","rotate","round","scale","sphere","square","surface","translate","union","use","value","version"],cl=["false","true","PI","undef","$children","$fa","$fn","$fs","$t","$vpd","$vpr","$vpt"],ul=t=>({colorizedBracketPairs:[["{","}"],["(",")"],["[","]"]],wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:t.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:t.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:t.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:t.languages.IndentAction.None,removeText:1}}],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string","comment"]},{open:"/**",close:" */",notIn:["string"]}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}}),fl={defaultToken:"invalid",tokenPostfix:".js",keywords:[...al,...ll,...cl,"each"],typeKeywords:[],operators:["<=",">=","==","!=","=>","+","-","*","/","%","<<",">>",">>>","&","|","^","!","&&","||","?",":","="],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\[abfnrtv\\"']/,digits:/\d+/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},ri={getConf:ul,language:fl};function fs(t,e,n){const s=[],r=[];let i=!0,a=0;for(const u of n.params??[]){if(i)if(u.defaultValue!=null)i=!1;else{s.push(`${u.name.replaceAll("$","\\$")}=${"${"+ ++a+":"+u.name+"}"}`);continue}r.push(u.name)}r.length&&s.push(`${"${"+ ++a+":"+r.join("|")+"=}"}`);let o=`${e.replaceAll("$","\\$")}(${s.join(", ")})`;return n.referencesChildren!==null&&(o+=n.referencesChildren?" ${"+ ++a+":children}":";"),{label:n.signature,kind:t.languages.CompletionItemKind.Function,insertText:o,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}}const dl=t=>[...[!0,!1].map(e=>({label:`${e}`,kind:t.languages.CompletionItemKind.Value,insertText:`${e}`,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...ri.language.keywords.map(e=>({label:e,kind:t.languages.CompletionItemKind.Function,insertText:e,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))],pl=["for(${1:variable}=[${2:start}:${3:end}) ${4:body}","for(${1:variable}=[${2:start}:${3:increment}:${4:end}) ${5:body}",`if (\${1:condition}) {
	$0
} else {
	
}`];function ml(t){return t.replaceAll(/\$\{\d+:([$\w]+)\}/g,"$1").replaceAll(/\$\d+/g,"").replaceAll(/\s+/g," ").trim()}async function hl(t,e,n,s){const r={},i=d=>d.startsWith("/")?d:`${n}/${d}`,a={};for(const[d,{deployed:S,symlinks:P}]of Object.entries(s))if(d!="fonts"&&S!==!1)for(const N in P)a[N]=`${d}/${P[N]}`;async function o(d){d in a&&(d=a[d]),d=i(d);try{const S=e.readFileSync(d);return new TextDecoder("utf-8").decode(S)}catch(S){throw S}}const u="<builtins>";let p;function m(d,S,{skipPrivates:P,addBuiltins:N}){return r[d]??=new Promise(async(O,R)=>{S==null&&(S=await o(d));const f={functions:{},modules:{},vars:[],includes:[],uses:[]},w=(b,c)=>{f.functions={...f.functions,...c.functions},f.modules={...f.modules,...c.modules},b||(f.vars=[...f.vars,...c.vars])},g=(d.split("/").slice(0,-1).join("/")||".")+"/",x=async(b,c)=>{let h=!1;for(const y of[`/libraries/${c}`,`${g}/${c}`,c])try{const v=await o(y),C=await m(c,v,{skipPrivates:!0,addBuiltins:!1});w(b,C),h=!0;break}catch(v){console.warn(`Failed to read file option ${y} for ${c} ${b?"used":"included"} by ${d}`,v)}h||console.error("Failed to find ",c,"(context imported in ",d,")")};N&&d!=u&&w(!1,p);const E=il(d,S,P);await Promise.all([...(E.uses??[]).map(b=>[b,!0]),...(E.includes??[]).map(b=>[b,!1])].map(([b,c])=>x(c,b))),w(!1,E),O(f)})}return p=await m(u,ol,{skipPrivates:!1,addBuiltins:!1}),{triggerCharacters:["<","/"],provideCompletionItems:(async(d,S,P,N)=>{try{const{word:O}=d.getWordUntilPosition(S),R=d.getOffsetAt(S),f=d.getValue();let w=f.substring(0,R);const g=w.lastIndexOf(`
`);w=w.substring(g+1);const x=/\b(include|use)\s*<([^<>\n"]*)$/.exec(w);if(x){const F=x[2];let L,D,_;const B=F.lastIndexOf("/");B<0?(_="",D=F):(_=F.substring(0,B),D=F.substring(B+1));const T=_==""?"":"/"+_;let M=null;for(const z of[tr("/libraries",T),tr(n,T)]){M=_==""?[...Object.keys(a)]:[];try{M=[...e.readdirSync(z)??[],...M];break}catch{}}const V=[];if(!M)console.warn("Failed to find folder named "+T);else for(const z of M){if(D!=""&&!z.startsWith(D)||/^(LICENSE.*|fonts)$/.test(z)||_==""&&z in s&&s[z].symlinks)continue;const K=!z.endsWith(".scad"),ee=z+(K?"":`>
`);V.push({label:z,kind:K?t.languages.CompletionItemKind.Folder:t.languages.CompletionItemKind.File,insertText:ee})}return V.sort(),{suggestions:V}}const E=tr(n,"foo.scad");delete r[E];const b=await m(E,f,{skipPrivates:!1,addBuiltins:!0}),c=Sr(w),h=/(^|.*?[{});]|>\s*\n)\s*([$\w]*)$/m.exec(c);if(h){const F=h[1],L=[...dl(t),...zr(b.modules??{},(D,_)=>fs(t,D,_),D=>D.indexOf(O)>=0),...(b.vars??[]).filter(D=>D.indexOf(O)>=0).map(D=>({label:D,kind:t.languages.CompletionItemKind.Variable,insertText:D.replaceAll("$","\\$"),insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...pl.map(D=>({label:ml(D).replaceAll(/ body/g,""),kind:t.languages.CompletionItemKind.Keyword,insertText:D,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))];return L.sort((D,_)=>D.insertText.indexOf(F)-_.insertText.indexOf(F)),{suggestions:L}}const y=Sr(f),v=[...zr(b.functions??{},(F,L)=>[F,fs(t,F,L)],F=>F.indexOf(O)>=0)];return v.sort(([F],[L])=>F.indexOf(O)-L.indexOf(O)),{suggestions:v.map(([F,L])=>L)}}catch(O){return console.error(O),{suggestions:[]}}})}}async function gl(t,e,n,s){t.languages.register({id:"openscad",extensions:[".scad"],mimetypes:["text/openscad"]});const{getConf:r,language:i}=ri;t.languages.setLanguageConfiguration("openscad",r(t)),t.languages.setMonarchTokensProvider("openscad",i),t.languages.registerCompletionItemProvider("openscad",await hl(t,e,n,s))}function ds(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function yl(t){if(Array.isArray(t))return t}function vl(t,e,n){return(e=Rl(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bl(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function xl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ps(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ms(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ps(Object(n),!0).forEach(function(s){vl(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ps(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function El(t,e){if(t==null)return{};var n,s,r=wl(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)n=i[s],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function wl(t,e){if(t==null)return{};var n={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(e.indexOf(s)!==-1)continue;n[s]=t[s]}return n}function Sl(t,e){return yl(t)||bl(t,e)||Il(t,e)||xl()}function Tl(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Rl(t){var e=Tl(t,"string");return typeof e=="symbol"?e:e+""}function Il(t,e){if(t){if(typeof t=="string")return ds(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ds(t,e):void 0}}function Cl(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function gs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hs(Object(n),!0).forEach(function(s){Cl(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Ol(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(s){return e.reduceRight(function(r,i){return i(r)},s)}}function Qt(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];return e.apply(n,[].concat(r,o))}}}function Bn(t){return{}.toString.call(t).includes("Object")}function Ml(t){return!Object.keys(t).length}function fn(t){return typeof t=="function"}function Nl(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Pl(t,e){return Bn(e)||ut("changeType"),Object.keys(e).some(function(n){return!Nl(t,n)})&&ut("changeField"),e}function Al(t){fn(t)||ut("selectorType")}function _l(t){fn(t)||Bn(t)||ut("handlerType"),Bn(t)&&Object.values(t).some(function(e){return!fn(e)})&&ut("handlersType")}function jl(t){t||ut("initialIsRequired"),Bn(t)||ut("initialType"),Ml(t)&&ut("initialContent")}function Fl(t,e){throw new Error(t[e]||t.default)}var Ll={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ut=Qt(Fl)(Ll),Nn={changes:Pl,selector:Al,handler:_l,initial:jl};function kl(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Nn.initial(t),Nn.handler(e);var n={current:t},s=Qt(Ul)(n,e),r=Qt(Dl)(n),i=Qt(Nn.changes)(t),a=Qt($l)(n);function o(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(m){return m};return Nn.selector(p),p(n.current)}function u(p){Ol(s,r,i,a)(p)}return[o,u]}function $l(t,e){return fn(e)?e(t.current):e}function Dl(t,e){return t.current=gs(gs({},t.current),e),e}function Ul(t,e,n){return fn(e)?e(t.current):Object.keys(n).forEach(function(s){var r;return(r=e[s])===null||r===void 0?void 0:r.call(e,t.current[s])}),n}var Bl={create:kl},Vl={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function zl(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];return e.apply(n,[].concat(r,o))}}}function Hl(t){return{}.toString.call(t).includes("Object")}function Kl(t){return t||ys("configIsRequired"),Hl(t)||ys("configType"),t.urls?(Gl(),{paths:{vs:t.urls.monacoBase}}):t}function Gl(){console.warn(si.deprecation)}function Wl(t,e){throw new Error(t[e]||t.default)}var si={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},ys=zl(Wl)(si),Yl={config:Kl},ql=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return function(r){return n.reduceRight(function(i,a){return a(i)},r)}};function ii(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],ii(t[n],e[n]))}),ms(ms({},t),e)}var Jl={type:"cancelation",msg:"operation is manually canceled"};function or(t){var e=!1,n=new Promise(function(s,r){t.then(function(i){return e?r(Jl):s(i)}),t.catch(r)});return n.cancel=function(){return e=!0},n}var Xl=["monaco"],Zl=Bl.create({config:Vl,isInitialized:!1,resolve:null,reject:null,monaco:null}),oi=Sl(Zl,2),vn=oi[0],Yn=oi[1];function Ql(t){var e=Yl.config(t),n=e.monaco,s=El(e,Xl);Yn(function(r){return{config:ii(r.config,s),monaco:n}})}function ec(){var t=vn(function(e){var n=e.monaco,s=e.isInitialized,r=e.resolve;return{monaco:n,isInitialized:s,resolve:r}});if(!t.isInitialized){if(Yn({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),or(ar);if(window.monaco&&window.monaco.editor)return ai(window.monaco),t.resolve(window.monaco),or(ar);ql(tc,rc)(sc)}return or(ar)}function tc(t){return document.body.appendChild(t)}function nc(t){var e=document.createElement("script");return t&&(e.src=t),e}function rc(t){var e=vn(function(s){var r=s.config,i=s.reject;return{config:r,reject:i}}),n=nc("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function sc(){var t=vn(function(n){var s=n.config,r=n.resolve,i=n.reject;return{config:s,resolve:r,reject:i}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){var s=n.m||n;ai(s),t.resolve(s)},function(n){t.reject(n)})}function ai(t){vn().monaco||Yn({monaco:t})}function ic(){return vn(function(t){var e=t.monaco;return e})}var ar=new Promise(function(t,e){return Yn({resolve:t,reject:e})}),li={config:Ql,init:ec,__getMonacoInstance:ic},oc={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},lr=oc,ac={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},lc=ac;function cc({children:t}){return Ze.createElement("div",{style:lc.container},t)}var uc=cc,fc=uc;function dc({width:t,height:e,isEditorReady:n,loading:s,_ref:r,className:i,wrapperProps:a}){return Ze.createElement("section",{style:{...lr.wrapper,width:t,height:e},...a},!n&&Ze.createElement(fc,null,s),Ze.createElement("div",{ref:r,style:{...lr.fullWidth,...!n&&lr.hide},className:i}))}var pc=dc,ci=l.memo(pc);function mc(t){l.useEffect(t,[])}var ui=mc;function hc(t,e,n=!0){let s=l.useRef(!0);l.useEffect(s.current||!n?()=>{s.current=!1}:t,e)}var Le=hc;function nn(){}function Lt(t,e,n,s){return gc(t,s)||yc(t,e,n,s)}function gc(t,e){return t.editor.getModel(fi(t,e))}function yc(t,e,n,s){return t.editor.createModel(e,n,s?fi(t,s):void 0)}function fi(t,e){return t.Uri.parse(e)}function vc({original:t,modified:e,language:n,originalLanguage:s,modifiedLanguage:r,originalModelPath:i,modifiedModelPath:a,keepCurrentOriginalModel:o=!1,keepCurrentModifiedModel:u=!1,theme:p="light",loading:m="Loading...",options:d={},height:S="100%",width:P="100%",className:N,wrapperProps:O={},beforeMount:R=nn,onMount:f=nn}){let[w,g]=l.useState(!1),[x,E]=l.useState(!0),b=l.useRef(null),c=l.useRef(null),h=l.useRef(null),y=l.useRef(f),v=l.useRef(R),C=l.useRef(!1);ui(()=>{let _=li.init();return _.then(B=>(c.current=B)&&E(!1)).catch(B=>B?.type!=="cancelation"&&console.error("Monaco initialization: error:",B)),()=>b.current?D():_.cancel()}),Le(()=>{if(b.current&&c.current){let _=b.current.getOriginalEditor(),B=Lt(c.current,t||"",s||n||"text",i||"");B!==_.getModel()&&_.setModel(B)}},[i],w),Le(()=>{if(b.current&&c.current){let _=b.current.getModifiedEditor(),B=Lt(c.current,e||"",r||n||"text",a||"");B!==_.getModel()&&_.setModel(B)}},[a],w),Le(()=>{let _=b.current.getModifiedEditor();_.getOption(c.current.editor.EditorOption.readOnly)?_.setValue(e||""):e!==_.getValue()&&(_.executeEdits("",[{range:_.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),_.pushUndoStop())},[e],w),Le(()=>{b.current?.getModel()?.original.setValue(t||"")},[t],w),Le(()=>{let{original:_,modified:B}=b.current.getModel();c.current.editor.setModelLanguage(_,s||n||"text"),c.current.editor.setModelLanguage(B,r||n||"text")},[n,s,r],w),Le(()=>{c.current?.editor.setTheme(p)},[p],w),Le(()=>{b.current?.updateOptions(d)},[d],w);let F=l.useCallback(()=>{if(!c.current)return;v.current(c.current);let _=Lt(c.current,t||"",s||n||"text",i||""),B=Lt(c.current,e||"",r||n||"text",a||"");b.current?.setModel({original:_,modified:B})},[n,e,r,t,s,i,a]),L=l.useCallback(()=>{!C.current&&h.current&&(b.current=c.current.editor.createDiffEditor(h.current,{automaticLayout:!0,...d}),F(),c.current?.editor.setTheme(p),g(!0),C.current=!0)},[d,p,F]);l.useEffect(()=>{w&&y.current(b.current,c.current)},[w]),l.useEffect(()=>{!x&&!w&&L()},[x,w,L]);function D(){let _=b.current?.getModel();o||_?.original?.dispose(),u||_?.modified?.dispose(),b.current?.dispose()}return Ze.createElement(ci,{width:P,height:S,isEditorReady:w,loading:m,_ref:h,className:N,wrapperProps:O})}var bc=vc;l.memo(bc);function xc(t){let e=l.useRef();return l.useEffect(()=>{e.current=t},[t]),e.current}var Ec=xc,Pn=new Map;function wc({defaultValue:t,defaultLanguage:e,defaultPath:n,value:s,language:r,path:i,theme:a="light",line:o,loading:u="Loading...",options:p={},overrideServices:m={},saveViewState:d=!0,keepCurrentModel:S=!1,width:P="100%",height:N="100%",className:O,wrapperProps:R={},beforeMount:f=nn,onMount:w=nn,onChange:g,onValidate:x=nn}){let[E,b]=l.useState(!1),[c,h]=l.useState(!0),y=l.useRef(null),v=l.useRef(null),C=l.useRef(null),F=l.useRef(w),L=l.useRef(f),D=l.useRef(void 0),_=l.useRef(s),B=Ec(i),T=l.useRef(!1),M=l.useRef(!1);ui(()=>{let K=li.init();return K.then(ee=>(y.current=ee)&&h(!1)).catch(ee=>ee?.type!=="cancelation"&&console.error("Monaco initialization: error:",ee)),()=>v.current?z():K.cancel()}),Le(()=>{let K=Lt(y.current,t||s||"",e||r||"",i||n||"");K!==v.current?.getModel()&&(d&&Pn.set(B,v.current?.saveViewState()),v.current?.setModel(K),d&&v.current?.restoreViewState(Pn.get(i)))},[i],E),Le(()=>{v.current?.updateOptions(p)},[p],E),Le(()=>{!v.current||s===void 0||(v.current.getOption(y.current.editor.EditorOption.readOnly)?v.current.setValue(s):s!==v.current.getValue()&&(M.current=!0,v.current.executeEdits("",[{range:v.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),v.current.pushUndoStop(),M.current=!1))},[s],E),Le(()=>{let K=v.current?.getModel();E&&K&&r&&y.current?.editor.setModelLanguage(K,r)},[r,E],E),Le(()=>{o!==void 0&&v.current?.revealLine(o)},[o],E),Le(()=>{y.current?.editor.setTheme(a)},[a],E);let V=l.useCallback(()=>{if(!(!C.current||!y.current)&&!T.current){L.current(y.current);let K=i||n,ee=Lt(y.current,s||t||"",e||r||"",K||"");v.current=y.current?.editor.create(C.current,{model:ee,automaticLayout:!0,...p},m),d&&v.current.restoreViewState(Pn.get(K)),y.current.editor.setTheme(a),o!==void 0&&v.current.revealLine(o),b(!0),T.current=!0}},[t,e,n,s,r,i,p,m,d,a,o]);l.useEffect(()=>{E&&F.current(v.current,y.current)},[E]),l.useEffect(()=>{!c&&!E&&V()},[c,E,V]),_.current=s,l.useEffect(()=>{E&&g&&(D.current?.dispose(),D.current=v.current?.onDidChangeModelContent(K=>{M.current||g(v.current.getValue(),K)}))},[E,g]),l.useEffect(()=>{if(E){let K=y.current.editor.onDidChangeMarkers(ee=>{let be=v.current.getModel()?.uri;if(be&&ee.find(pe=>pe.path===be.path)){let pe=y.current.editor.getModelMarkers({resource:be});x?.(pe)}});return()=>{K?.dispose()}}return()=>{}},[E,x]);function z(){D.current?.dispose(),S?d&&Pn.set(i,v.current.saveViewState()):v.current.getModel()?.dispose(),v.current.dispose(),v.current=null,T.current=!1,b(!1)}return Ze.createElement(ci,{width:P,height:N,isEditorReady:E,loading:u,_ref:C,className:O,wrapperProps:R})}var Sc=wc,Tc=l.memo(Sc),Rc=Tc;function Ct(){return Ct=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ct.apply(null,arguments)}function Tr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Ic(t){if(Array.isArray(t))return Tr(t)}function Cc(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function di(t,e){if(t){if(typeof t=="string")return Tr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tr(t,e):void 0}}function Oc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mc(t){return Ic(t)||Cc(t)||di(t)||Oc()}function dn(t){"@babel/helpers - typeof";return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(t)}function Nc(t,e){if(dn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(dn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Pc(t){var e=Nc(t,"string");return dn(e)=="symbol"?e:e+""}function Vn(t,e,n){return(e=Pc(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ac(t){if(Array.isArray(t))return t}function _c(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function jc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qt(t,e){return Ac(t)||_c(t,e)||di(t,e)||jc()}var Fc={root:function(e){var n=e.props,s=e.focusedState,r=e.context,i=e.overlayVisibleState,a=e.isValueEmpty;return ae("p-treeselect p-component p-inputwrapper",{"p-treeselect-chip":n.display==="chip","p-treeselect-clearable":n.showClear&&!n.disabled,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-focus":s,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled","p-inputwrapper-filled":!a,"p-inputwrapper-focus":s||i})},label:function(e){var n=e.props,s=e.isValueEmpty,r=e.getLabel;return ae("p-treeselect-label",{"p-placeholder":r()===n.placeholder,"p-treeselect-label-empty":!n.placeholder&&s})},panel:function(e){var n=e.panelProps,s=e.context;return ae("p-treeselect-panel p-component",n.panelClassName,{"p-input-filled":s&&s.inputStyle==="filled"||ke.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||ke.ripple===!1})},labelContainer:"p-treeselect-label-container",tokenLabel:"p-treeselect-token-label",token:"p-treeselect-token",trigger:"p-treeselect-trigger",triggerIcon:"p-treeselect-trigger-icon p-clickable",emptyMessage:"p-treeselect-empty-message",filterContainer:"p-treeselect-filter-container",filter:"p-treeselect-filter p-inputtext p-component",filterIcon:"p-treeselect-filter-icon",closeIcon:"p-treeselect-close-icon",clearIcon:"p-treeselect-clear-icon p-clickable",closeButton:"p-treeselect-close p-link",header:"p-treeselect-header",wrapper:"p-treeselect-items-wrapper",transition:"p-connected-overlay"},Lc=`
@layer primereact {
    .p-treeselect {
        display: inline-flex;
        cursor: pointer;
        position: relative;
        user-select: none;
    }

    .p-treeselect-trigger {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .p-treeselect-label-container {
        overflow: hidden;
        flex: 1 1 auto;
        cursor: pointer;
    }

    .p-treeselect-label  {
        display: block;
        white-space: nowrap;
        cursor: pointer;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .p-treeselect-label-empty {
        overflow: hidden;
        visibility: hidden;
    }

    .p-treeselect-token {
        cursor: default;
        display: inline-flex;
        align-items: center;
        flex: 0 0 auto;
    }

    .p-treeselect .p-treeselect-panel {
        min-width: 100%;
    }

    .p-treeselect-items-wrapper {
        overflow: auto;
    }

    .p-treeselect-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .p-treeselect-filter-container {
        position: relative;
        flex: 1 1 auto;
    }

    .p-treeselect-filter-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-treeselect-filter-container .p-inputtext {
        width: 100%;
    }

    .p-treeselect-close {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
        position: relative;
        margin-left: auto;
    }

    .p-treeselect-clear-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-fluid .p-treeselect {
        display: flex;
}
}
`,Jt=dt.extend({defaultProps:{__TYPE:"TreeSelect",appendTo:null,ariaLabel:null,ariaLabelledBy:null,className:null,closeIcon:null,clearIcon:null,disabled:!1,display:"comma",dropdownIcon:null,emptyMessage:null,expandedKeys:null,filter:!1,filterBy:"label",filterDelay:300,filterIcon:null,filterInputAutoFocus:!0,filterLocale:void 0,filterMode:"lenient",filterPlaceholder:null,filterTemplate:null,filterValue:null,inputId:null,inputRef:null,invalid:!1,variant:null,metaKeySelection:!1,name:null,nodeTemplate:null,onChange:null,onFocus:null,onBlur:null,onFilterValueChange:null,onHide:null,onNodeClick:null,onNodeCollapse:null,onNodeDoubleClick:null,onNodeExpand:null,onNodeSelect:null,onNodeUnselect:null,onShow:null,options:null,panelClassName:null,panelFooterTemplate:null,panelHeaderTemplate:null,panelStyle:null,placeholder:null,resetFilterOnHide:!1,scrollHeight:"400px",selectionMode:"single",showClear:!1,style:null,tabIndex:null,togglerTemplate:null,transitionOptions:null,value:null,valueTemplate:null,children:void 0},css:{classes:Fc,styles:Lc}});function vs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function kc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vs(Object(n),!0).forEach(function(s){Vn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var pi=l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=t.ptm,i=t.cx,a=function(d,S){return r(d,kc({hostName:t.hostName},S))},o=function(d){d.key==="Escape"&&(d.preventDefault(),t.hide())},u=function(){var d={maxHeight:t.scrollHeight||"auto"},S=n({className:i("panel",{panelProps:t,context:s}),style:t.panelStyle,onKeyDown:o,onClick:t.onClick},a("panel")),P=n({className:i("wrapper"),style:d},a("wrapper")),N=n({classNames:i("transition"),in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},a("transition"));return l.createElement(yn,Ct({nodeRef:e},N),l.createElement("div",Ct({ref:e},S),t.firstHiddenFocusableElementOnOverlay,t.header,l.createElement("div",P,t.children),t.footer,t.lastHiddenFocusableElementOnOverlay))},p=u();return l.createElement(Ar,{element:p,appendTo:t.appendTo})});pi.displayName="TreeSelectPanel";function bs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bs(Object(n),!0).forEach(function(s){Vn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Xt(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=$c(t))||e){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(p){throw p},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var p=n.next();return a=p.done,p},e:function(p){o=!0,i=p},f:function(){try{a||n.return==null||n.return()}finally{if(o)throw i}}}}function $c(t,e){if(t){if(typeof t=="string")return xs(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xs(t,e):void 0}}function xs(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}var mi=l.memo(l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=Jt.getProps(t,s),i=l.useState(!1),a=qt(i,2),o=a[0],u=a[1],p=l.useState(!1),m=qt(p,2),d=m[0],S=m[1],P=l.useState(r.expandedKeys),N=qt(P,2),O=N[0],R=N[1],f=qi("",r.filterDelay||0),w=qt(f,3),g=w[0],x=w[1],E=w[2],b=l.useRef(null),c=l.useRef(null),h=l.useRef(null),y=l.useRef(r.inputRef),v=l.useRef(null),C=l.useRef(null),F=l.useRef(null),L=l.useRef(null),D=l.useRef(null),_=l.useRef(!1),B=l.useRef(""),T=r.onToggle?r.expandedKeys:O,M=r.onFilterValueChange?r.filterValue:x,V=se.isEmpty(r.value),z=r.selectionMode==="single",K=r.selectionMode==="checkbox",ee=se.isNotEmpty(r.tooltip),be={props:r,state:{focused:o,overlayVisible:d,expandedKeys:T,filterValue:M}},pe=Jt.setMetaData(be),X=pe.ptm,te=pe.cx,je=pe.isUnstyled;pt(Jt.css.styles,je,{name:"treeselect"});var qe={filter:function(I){return Y(I)},reset:function(){return ne()}},Ne=Fs({target:b,overlay:c,listener:function(I,G){var le=G.valid,fe=G.type;le&&(fe==="outside"||s.hideOverlaysOnDocumentScrolling?ye():J.isDocument(I.target)||ht())},when:d}),ie=qt(Ne,2),Ee=ie[0],we=ie[1],Pe=function(){return Gt.length?Gt.map(function(I){return I.label}).join(", "):r.placeholder},Ie=function(){S(!0)},ye=function(){S(!1),y.current&&J.focus(y.current)},He=function(){u(!0),r.onFocus&&r.onFocus()},De=function(){u(!1),r.onBlur&&r.onBlur()},Ae=function(I){!r.disabled&&(!c.current||!c.current.contains(I.target))&&!J.isAttributeEquals(I.target,"data-pc-section","closebutton")&&(J.focus(y.current),d?ye():Ie())},ot=function(I){r.onChange&&(C.current=!0,r.onChange({originalEvent:I.originalEvent,value:I.value,stopPropagation:function(){I.originalEvent.stopPropagation()},preventDefault:function(){I.originalEvent.preventDefault()},target:{name:r.name,id:r.id,value:I.value}}))},Je=function(I){r.onChange&&(C.current=!0,r.onChange({originalEvent:I,value:void 0,stopPropagation:function(){I?.stopPropagation()},preventDefault:function(){I?.preventDefault()},target:{name:r.name,id:r.id,value:void 0}}))},Xe=function(I){(I.key==="Enter"||I.code==="Space")&&(Je(I),I.preventDefault())},Ce=function(I){r.onNodeSelect&&r.onNodeSelect(I),z&&ye()},rt=function(I){r.onNodeUnselect&&r.onNodeUnselect(I),K&&I.originalEvent.stopPropagation()},ce=function(I){r.onToggle?r.onToggle(I):R(I.value)},$=function(I){E(I.value)},k=function(I){Us.emit("overlay-click",{originalEvent:I,target:b.current})},U=function(I){var G=I.relatedTarget===y.current?J.getFirstFocusableElement(c.current,':not([data-p-hidden-focusable="true"])'):y.current;J.focus(G)},Z=function(I){var G=I.relatedTarget===y.current?J.getLastFocusableElement(c.current,':not([data-p-hidden-focusable="true"])'):y.current;J.focus(G)},ue=function(I,G){switch(I.code){case"ArrowDown":I.preventDefault(),jt();break;case"ArrowUp":I.preventDefault(),y.current&&J.focus(y.current);break;case"Enter":case"NumpadEnter":I.preventDefault(),G&&ye();break;case"Escape":_e(I);break}},he=function(I){switch(I.code){case"ArrowDown":ge(I);break;case"Space":case"Enter":case"NumpadEnter":Ke(I);break;case"Escape":_e(I);break;case"Tab":d&&(I.preventDefault(),I.shiftKey?jt():Q(I));break}},ge=function(I){d||(_.current=!0,Ie(),I.preventDefault())},Ke=function(I){d?ye():ge(I),I.preventDefault()},_e=function(I){d&&(ye(),I.preventDefault())},Q=function(I){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;G||d&&A()&&(J.focus(L.current),I.preventDefault())},A=function(){return J.getFocusableElements(c.current,':not([data-p-hidden-focusable="true"])').length>0},Y=function(I){var G=I.target.value;r.onFilterValueChange?r.onFilterValueChange({originalEvent:I,value:G}):E(G)},ne=function(){E("")},xe=function(){Qe.set("overlay",c.current,s&&s.autoZIndex||ke.autoZIndex,s&&s.zIndex.overlay||ke.zIndex.overlay),J.addStyles(c.current,{position:"absolute",top:"0",left:"0"}),jt(),ht(),Xn()},_t=function(){Ee(),r.filter&&r.filterInputAutoFocus&&J.focus(h.current,r.filterInputAutoFocus),r.onShow&&r.onShow()},mt=function(){we()},zt=function(){r.filter&&r.resetFilterOnHide&&ne(),Qe.clear(c.current),r.onHide&&r.onHide()},ht=function(){J.alignOverlay(c.current,v.current.parentElement,r.appendTo||s&&s.appendTo||ke.appendTo)},Xn=function(){var I=J.findSingle(c.current,'[data-pc-section="content"][data-p-highlight="true"]');I&&I.scrollIntoView&&I.scrollIntoView({block:"nearest",inline:"start"})},Ht=function(I,G,le){if(I){if(Ue(I,G)&&(le.push(I),delete G[I.key]),Object.keys(G).length&&I.children){var fe=Xt(I.children),Re;try{for(fe.s();!(Re=fe.n()).done;){var Be=Re.value;Ht(Be,G,le)}}catch(Ve){fe.e(Ve)}finally{fe.f()}}}else{var Se=Xt(r.options),Ge;try{for(Se.s();!(Ge=Se.n()).done;){var vt=Ge.value;Ht(vt,G,le)}}catch(Ve){Se.e(Ve)}finally{Se.f()}}},Ue=function(I,G){return K?G[I.key]&&G[I.key].checked:G[I.key]},Kt=function(){var I=z?Vn({},"".concat(r.value),!0):at({},r.value);R({}),I&&r.options&&gt(null,null,I)},jt=function(){var I,G=J.find((I=F.current)===null||I===void 0?void 0:I.getElement(),'[data-pc-section="node"]'),le=Mc(G).find(function(fe){return fe.getAttribute("tabindex")==="0"});J.focus(le)},gt=function(I,G,le){if(I){if(Ue(I,le)&&(Zn(G),delete le[I.key]),Object.keys(le).length&&I.children){var fe=Xt(I.children),Re;try{for(fe.s();!(Re=fe.n()).done;){var Be=Re.value;G.push(I.key),gt(Be,G,le)}}catch(Ve){fe.e(Ve)}finally{fe.f()}}}else{var Se=Xt(r.options),Ge;try{for(Se.s();!(Ge=Se.n()).done;){var vt=Ge.value;gt(vt,[],le)}}catch(Ve){Se.e(Ve)}finally{Se.f()}}},Zn=function(I){if(I.length>0){var G=at({},O||{}),le=Xt(I),fe;try{for(le.s();!(fe=le.n()).done;){var Re=fe.value;G[Re]=!0}}catch(Be){le.e(Be)}finally{le.f()}R(G)}},Qn=function(){var I=[];if(se.isNotEmpty(r.value)&&r.options){var G=z?Vn({},"".concat(r.value),!0):at({},r.value);Ht(null,G,I)}return I};l.useImperativeHandle(e,function(){return{props:r,clear:Je,show:Ie,hide:ye,focus:function(){return J.focus(y.current)},getElement:function(){return b.current}}}),l.useEffect(function(){se.combinedRefs(y,r.inputRef)},[y,r.inputRef]),gn(function(){Kt(),B.current=Wn()+"_list",r.autoFocus&&J.focus(y.current,r.autoFocus),ht()}),Et(function(){d&&r.filter&&ht()}),Et(function(){Kt()},[r.options]),Et(function(){_.current&&d&&(_.current=!1,jt())},[d]),Et(function(){d&&O&&ht()},[O]),Et(function(){d&&(C.current||Kt(),C.current=!1)},[r.value]),Pr(function(){Qe.clear(c.current)});var yt=function(){var I=n({className:"p-hidden-accessible"},X("hiddenInputWrapper")),G=n(at({ref:y,role:"listbox",id:r.inputId,type:"text","aria-expanded":d,"aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-haspopup":"tree","aria-controls":B.current,onFocus:He,onBlur:De,onKeyDown:he,disabled:r.disabled,tabIndex:r.tabIndex},Li),X("hiddenInput"));return l.createElement("div",I,l.createElement("input",Ct({},G,{readOnly:!0})))},Fe=function(){var I=n({className:te("token")},X("token")),G=n({className:te("tokenLabel")},X("tokenLabel")),le=n({className:te("labelContainer")},X("labelContainer")),fe=n({className:te("label",{isValueEmpty:V,getLabel:Pe})},X("label")),Re=null;return r.valueTemplate?Re=se.getJSXElement(r.valueTemplate,Gt,r):r.display==="comma"?Re=Pe()||"empty":r.display==="chip"&&(Re=l.createElement(l.Fragment,null,Gt&&Gt.map(function(Be,Se){return l.createElement("div",Ct({},I,{key:"".concat(Be.key,"_").concat(Se)}),l.createElement("span",G,Be.label))}),V&&(r.placeholder||"empty"))),l.createElement("div",le,l.createElement("div",fe,Re))},Mi=function(){var I=n({ref:v,className:te("trigger"),role:"button","aria-haspopup":"tree","aria-expanded":d},X("trigger")),G=n({className:te("triggerIcon")},X("triggerIcon")),le=r.dropdownIcon||l.createElement(po,G),fe=et.getJSXIcon(le,at({},G),{props:r});return l.createElement("div",I,fe)},Ni=function(){if(r.value!=null&&r.showClear&&!r.disabled){var I=n({className:te("clearIcon"),onPointerUp:Je,tabIndex:r.tabIndex||"0",onKeyDown:Xe,"aria-label":Ji("clear")},X("clearIcon")),G=r.clearIcon||l.createElement(fr,I);return et.getJSXIcon(G,at({},I),{props:r})}return null},Pi=function(){return l.createElement(io,{ref:F,id:B.current,emptyMessage:r.emptyMessage,expandedKeys:T,filter:r.filter,filterBy:r.filterBy,filterDelay:r.filterDelay,filterLocale:r.filterLocale,filterMode:r.filterMode,filterPlaceholder:r.filterPlaceholder,filterValue:M,metaKeySelection:r.metaKeySelection,nodeTemplate:r.nodeTemplate,onCollapse:r.onNodeCollapse,onExpand:r.onNodeExpand,onFilterValueChange:$,onNodeClick:r.onNodeClick,onNodeDoubleClick:r.onNodeDoubleClick,onSelect:Ce,onSelectionChange:ot,onToggle:ce,onUnselect:rt,selectionKeys:r.value,selectionMode:r.selectionMode,showHeader:!1,togglerTemplate:r.togglerTemplate,value:r.options,pt:X("tree"),__parentMetadata:{parent:be}})},Ai=function(){if(r.filter){var I=r.onFilterValueChange?r.filterValue:g;I=se.isNotEmpty(I)?I:"";var G=n({className:te("filterContainer")},X("filterContainer")),le=n({ref:h,type:"text",value:I,autoComplete:"off",className:te("filter"),placeholder:r.filterPlaceholder,onKeyDown:function(Ve){return ue(Ve,!1)},onChange:Y,disabled:r.disabled},X("filter")),fe=n({className:te("filterIcon")},X("filterIcon")),Re=r.filterIcon||l.createElement(mo,fe),Be=et.getJSXIcon(Re,at({},fe),{props:r}),Se=l.createElement("div",G,l.createElement("input",le),Be);if(r.filterTemplate){var Ge={className:"p-treeselect-filter-container",element:Se,filterOptions:qe,filterInputKeyDown:function(Ve){return ue(Ve,function(){})},filterInputChange:Y,filterIconClassName:"p-dropdown-filter-icon",props:r};Se=se.getJSXElement(r.filterTemplate,Ge)}return l.createElement(l.Fragment,null,Se)}},_i=function(){var I=Ai(),G=n({className:te("closeIcon"),"aria-hidden":!0},X("closeIcon")),le=r.closeIcon||l.createElement(fr,G),fe=et.getJSXIcon(le,at({},G),{props:r}),Re=n({type:"button",className:te("closeButton"),onKeyDown:function(Wi){return ue(Wi,!0)},onClick:ye,"aria-label":As("close")},X("closeButton")),Be=n({className:te("header")},X("header")),Se=l.createElement("button",Re,fe,l.createElement(hn,null)),Ge=l.createElement("div",Be,I,Se);if(r.panelHeaderTemplate){var vt={className:"p-treeselect-header",filterElement:I,closeElement:Se,closeElementClassName:"p-treeselect-close p-link",closeIconClassName:"p-treeselect-close-icon",onCloseClick:ye,element:Ge,props:r};return l.createElement("div",null,Ge,se.getJSXElement(r.panelHeaderTemplate,vt))}return Ge},ji=function(){return se.getJSXElement(r.panelFooterTemplate,r)},Gt=Qn(),Fi=Jt.getOtherProps(r),Li=se.reduceKeys(Fi,J.ARIA_PROPS),ki=n({ref:L,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:U,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},X("firstHiddenFocusableElementOnOverlay")),$i=n({ref:D,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:Z,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},X("lastHiddenFocusableElementOnOverlay")),Di=n({ref:b,className:ae(r.className,te("root",{context:s,focusedState:o,overlayVisibleState:d,isValueEmpty:V})),style:r.style,onClick:Ae},Jt.getOtherProps(r),X("root")),Ui=yt(),Bi=Fe(),Vi=Mi(),zi=Ni(),Hi=Pi(),Ki=_i(),Gi=ji();return l.createElement("div",Di,Ui,Bi,zi,Vi,l.createElement(pi,{hostName:"TreeSelect",ref:c,appendTo:r.appendTo,panelStyle:r.panelStyle,panelClassName:r.panelClassName,scrollHeight:r.scrollHeight,onClick:k,header:Ki,hide:ye,footer:Gi,firstHiddenFocusableElementOnOverlay:l.createElement("span",ki),lastHiddenFocusableElementOnOverlay:l.createElement("span",$i),transitionOptions:r.transitionOptions,in:d,onEnter:xe,onEntered:_t,onExit:mt,onExited:zt,ptm:X,cx:te},Hi),ee&&l.createElement(_r,Ct({target:b,content:r.tooltip,pt:X("tooltip")},r.tooltipOptions)))}));mi.displayName="TreeSelect";function Dc(t,e=500){const n=l.useRef(null);return l.useCallback(s=>{n.current&&clearTimeout(n.current),n.current=window.setTimeout(()=>{t(s)},e)},[t,e])}function pn(t){"@babel/helpers - typeof";return pn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pn(t)}function Uc(t,e){if(pn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(pn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Bc(t){var e=Uc(t,"string");return pn(e)=="symbol"?e:e+""}function Vc(t,e,n){return(e=Bc(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function St(){return St=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},St.apply(null,arguments)}function Rr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function zc(t){if(Array.isArray(t))return Rr(t)}function Hc(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function hi(t,e){if(t){if(typeof t=="string")return Rr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rr(t,e):void 0}}function Kc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Es(t){return zc(t)||Hc(t)||hi(t)||Kc()}function Gc(t){if(Array.isArray(t))return t}function Wc(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],u=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(u=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);u=!0);}catch(m){p=!0,r=m}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Yc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ft(t,e){return Gc(t)||Wc(t,e)||hi(t,e)||Yc()}var qc=`
@layer primereact {
    .p-menu-overlay {
        position: absolute;
        /* Github #3122: Prevent animation flickering  */
        top: -9999px;
        left: -9999px;
    }

    .p-menu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-menu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-menu .p-menuitem-text {
        line-height: 1;
    }
}
`,Jc={root:function(e){var n=e.props,s=e.context;return ae("p-menu p-component",{"p-menu-overlay":n.popup,"p-input-filled":s&&s.inputStyle==="filled"||ke.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||ke.ripple===!1})},menu:"p-menu-list p-reset",content:function(e){var n=e.item;return ae("p-menuitem-content",{"p-disabled":n.disabled})},action:function(e){var n=e.item;return ae("p-menuitem-link",{"p-disabled":n.disabled})},menuitem:function(e){var n=e.focused;return ae("p-menuitem",{"p-focus":n})},submenuHeader:function(e){var n=e.submenu;return ae("p-submenu-header",{"p-disabled":n.disabled})},separator:"p-menu-separator",label:"p-menuitem-text",icon:"p-menuitem-icon",transition:"p-connected-overlay"},Xc={submenuHeader:function(e){var n=e.submenu;return n.style},menuitem:function(e){var n=e.item;return n.style}},An=dt.extend({defaultProps:{__TYPE:"Menu",id:null,ariaLabel:null,ariaLabelledBy:null,tabIndex:0,model:null,popup:!1,popupAlignment:"left",style:null,className:null,autoZIndex:!0,baseZIndex:0,appendTo:null,onFocus:null,onBlur:null,transitionOptions:null,onShow:null,onHide:null,children:void 0,closeOnEscape:!0},css:{classes:Jc,styles:qc,inlineStyles:Xc}});function ws(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Zc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ws(Object(n),!0).forEach(function(s){Vc(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ws(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var gi=l.memo(l.forwardRef(function(t,e){var n=nt(),s=l.useContext(it),r=An.getProps(t,s),i=l.useState(r.id),a=Ft(i,2),o=a[0],u=a[1],p=l.useState(!r.popup),m=Ft(p,2),d=m[0],S=m[1],P=l.useState(-1),N=Ft(P,2),O=N[0],R=N[1],f=l.useState(-1),w=Ft(f,2),g=w[0],x=w[1],E=l.useState(!1),b=Ft(E,2),c=b[0],h=b[1],y=An.setMetaData({props:r,state:{id:o,visible:d,focused:c}}),v=y.ptm,C=y.cx,F=y.sx,L=y.isUnstyled,D=function(A,Y){return v(A,{context:Y})};pt(An.css.styles,L,{name:"menu"});var _=l.useRef(null),B=l.useRef(null),T=l.useRef(null),M=!!(d&&r.popup&&r.closeOnEscape),V=Xi("menu",M);Zi({callback:function(A){Ce(A)},when:M&&V,priority:[Qi.MENU,V]});var z=Fs({target:T,overlay:_,listener:function(A,Y){var ne=Y.valid,xe=Y.type;ne&&(s.hideOverlaysOnDocumentScrolling||xe==="outside"?(Ce(A),R(-1)):J.isDocument(A.target)||J.absolutePosition(_.current,T.current,r.popupAlignment))},when:d}),K=Ft(z,2),ee=K[0],be=K[1],pe=function(A){r.popup&&Us.emit("overlay-click",{originalEvent:A,target:T.current})},X=function(A,Y,ne){if(Y.disabled){A.preventDefault();return}Y.command&&Y.command({originalEvent:A,item:Y}),r.popup&&Ce(A),!r.popup&&O!==ne&&R(ne),Y.url||(A.preventDefault(),A.stopPropagation())},te=function(A,Y){A&&r.popup&&O!==Y&&R(Y)},je=function(A){h(!0),r.popup||(g!==-1?(Ae(g),x(-1)):Ae(0)),r.onFocus&&r.onFocus(A)},qe=function(A){var Y=A.currentTarget,ne=A.relatedTarget;ne&&Y.contains(ne)||(h(!1),R(-1),r.onBlur&&r.onBlur(A))},Ne=function(A){switch(A.code){case"ArrowDown":ie(A);break;case"ArrowUp":Ee(A);break;case"Home":we(A);break;case"End":Pe(A);break;case"Enter":case"NumpadEnter":Ie(A);break;case"Space":ye(A);break;case"Escape":r.popup&&(J.focus(T.current),Ce(A));case"Tab":r.popup&&d&&Ce(A);break}},ie=function(A){var Y=He(O);Ae(Y),A.preventDefault()},Ee=function(A){if(A.altKey&&r.popup)J.focus(T.current),Ce(A),A.preventDefault();else{var Y=De(O);Ae(Y),A.preventDefault()}},we=function(A){Ae(0),A.preventDefault()},Pe=function(A){Ae(J.find(_.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]').length-1),A.preventDefault()},Ie=function(A){var Y=J.findSingle(_.current,'li[id="'.concat("".concat(O),'"]')),ne=Y&&J.findSingle(Y,'a[data-pc-section="action"]');r.popup&&J.focus(T.current),ne?ne.click():Y&&Y.click(),A.preventDefault()},ye=function(A){Ie(A)},He=function(A){var Y=J.find(_.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),ne=Es(Y).findIndex(function(xe){return xe.id===A});return ne>-1?ne+1:0},De=function(A){var Y=J.find(_.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),ne=Es(Y).findIndex(function(xe){return xe.id===A});return ne>-1?ne-1:0},Ae=function(A){var Y=J.find(_.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),ne=A>=Y.length?Y.length-1:A<0?0:A;ne>-1&&R(Y[ne].getAttribute("id"))},ot=function(){return O!==-1?O:null},Je=function(A){r.popup&&(d?Ce(A):Xe(A))},Xe=function(A){T.current=A.currentTarget,S(!0),r.onShow&&r.onShow(A)},Ce=function(A){T.current=A.currentTarget,S(!1),r.onHide&&r.onHide(A)},rt=function(){J.addStyles(_.current,{position:"absolute",top:"0",left:"0"}),Qe.set("menu",_.current,s&&s.autoZIndex||ke.autoZIndex,r.baseZIndex||s&&s.zIndex.menu||ke.zIndex.menu),J.absolutePosition(_.current,T.current,r.popupAlignment),r.popup&&(J.focus(B.current),Ae(0))},ce=function(){ee()},$=function(){T.current=null,be()},k=function(){Qe.clear(_.current)};gn(function(){o||u(Wn())}),Pr(function(){Qe.clear(_.current)}),l.useImperativeHandle(e,function(){return{props:r,toggle:Je,show:Xe,hide:Ce,getElement:function(){return _.current},getTarget:function(){return T.current}}});var U=function(A,Y){var ne=o+"_sub_"+Y,xe=A.items.map(function(mt,zt){return ue(mt,zt,ne)}),_t=n({id:ne,role:"none",className:ae(A.className,C("submenuHeader",{submenu:A})),style:F("submenuHeader",{submenu:A}),"data-p-disabled":A.disabled},v("submenuHeader"));return l.createElement(l.Fragment,{key:ne},l.createElement("li",St({},_t,{key:ne}),A.label),xe)},Z=function(A,Y){if(A.visible===!1)return null;var ne=o+"_separator_"+Y,xe=n({id:ne,className:ae(A.className,C("separator")),role:"separator"},v("separator"));return l.createElement("li",St({},xe,{key:ne}))},ue=function(A,Y){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(A.visible===!1)return null;var xe={item:A,index:Y,parentId:ne},_t=ae("p-menuitem-link",{"p-disabled":A.disabled}),mt=ae("p-menuitem-icon",A.icon),zt=n({className:C("icon")},D("icon",xe)),ht=et.getJSXIcon(A.icon,Zc({},zt),{props:r}),Xn=n({className:C("label")},D("label",xe)),Ht=A.label&&l.createElement("span",Xn,A.label),Ue=A.id||(ne||o)+"_"+Y,Kt=n({onClick:function(Fe){return X(Fe,A,Ue)},onMouseMove:function(Fe){return te(Fe,Ue)},className:C("content",{item:A})},D("content",xe)),jt=n({href:A.url||"#",className:C("action",{item:A}),onFocus:function(Fe){return Fe.stopPropagation()},target:A.target,tabIndex:"-1","aria-label":A.label,"aria-disabled":A.disabled,"data-p-disabled":A.disabled},D("action",xe)),gt=l.createElement("div",Kt,l.createElement("a",jt,ht,Ht,l.createElement(hn,null)));if(A.template){var Zn={onClick:function(Fe){return X(Fe,A,Ue)},onMouseMove:function(Fe){return te(Fe,Ue)},className:_t,tabIndex:"-1",labelClassName:"p-menuitem-text",iconClassName:mt,element:gt,props:r};gt=se.getJSXElement(A.template,A,Zn)}var Qn=n({id:Ue,className:ae(A.className,C("menuitem",{focused:O===Ue})),onClick:function(Fe){return X(Fe,A,Ue)},style:F("menuitem",{item:A}),role:"menuitem","aria-label":A.label,"aria-disabled":A.disabled,"data-p-focused":ot()===Ue,"data-p-disabled":A.disabled||!1},D("menuitem",xe));return l.createElement("li",St({},Qn,{key:Ue}),gt)},he=function(A,Y){return A.visible===!1?null:A.separator?Z(A,Y):A.items?U(A,Y):ue(A,Y)},ge=function(){return r.model.map(he)},Ke=function(){if(r.model){var A=ge(),Y=n({className:ae(r.className,C("root",{context:s})),style:r.style,onClick:function(mt){return pe(mt)}},An.getOtherProps(r),v("root")),ne=n({ref:B,className:C("menu"),id:o+"_list",tabIndex:r.tabIndex||"0",role:"menu","aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-activedescendant":c?ot():void 0,onFocus:je,onKeyDown:Ne,onBlur:qe},v("menu")),xe=n({classNames:C("transition"),in:d,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:rt,onEntered:ce,onExit:$,onExited:k},v("transition"));return l.createElement(yn,St({nodeRef:_},xe),l.createElement("div",St({id:r.id,ref:_},Y),l.createElement("ul",ne,A)))}return null},_e=Ke();return r.popup?l.createElement(Ar,{element:_e,appendTo:r.appendTo}):_e}));gi.displayName="Menu";const Qc=function(e){const[n,s]=l.useState(null),[r,i]=l.useState(null),[a,o]=l.useState([]),[u,p]=l.useState(e.path),[m,d]=l.useState(!0),[S,P]=l.useState(""),[N,O]=l.useState({}),[R,f]=l.useState(e.homeFileProp??""),w=l.useRef(null),g=l.useRef(null),[x,E]=l.useState(!1),b=(T,M)=>alert(`${T}: ${M}`);function c(T="/"){const M=[];try{const V=oo(T);V.sort();for(const z of V){const K=T==="/"?`/${z}`:`${T}/${z}`;xt(K)&&Hr(K).isDirectory()?M.push({key:K,label:z+"/",data:K,selectable:!1,children:c(K),icon:"pi pi-folder"}):M.push({key:K,label:z,data:K,selectable:!0,icon:"pi pi-file"})}}catch(V){b("Failed to build tree",V)}return M}const h=()=>{if(!e.hideTopBar)try{const T=c("/");o(T),!u&&T.length&&p(R)}catch(T){b("Failed to list files",T)}},y=()=>{const T=prompt("Enter new file name (with extension):","/newfile.scad");if(T&&T.startsWith("/"))try{xt(T)?alert("File already exists!"):(Kr(T.substring(0,T.lastIndexOf("/")),{recursive:!0}),rr(T,""),p(T),h())}catch(M){b("Failed to create file",M)}},v=()=>{const T=prompt("Enter new name for current file:",u);if(T&&T.startsWith("/"))try{xt(T)?alert("File already exists!"):(Kr(T.substring(0,T.lastIndexOf("/")),{recursive:!0}),rr(T,nr(u,"utf-8")),Gr(u),p(T),h())}catch(M){b("Failed to rename file",M)}},C=()=>{if(window.confirm(`Delete ${u}?`))try{Gr(u),h(),p("")}catch(T){b("Failed to delete file",T)}},F=Dc(T=>{if(!(m||!u))try{if(console.debug("ZenMonacoPrime",`Saving ${u}`),rr(u,T??""),T==S)return;e.onSave?.(T)}catch(M){b("Failed to save file",M)}},1e3),L=l.useCallback(T=>{T&&F(T)},[F]),D=(T,M)=>{M.editor.addEditorAction({id:"openscad-save-do-nothing",label:"Save (disabled)",keybindings:[M.KeyMod.CtrlCmd|M.KeyCode.KeyS],run:()=>{}}),M.editor.addKeybindingRules([{keybinding:M.KeyMod.CtrlCmd|M.KeyCode.KeyD,command:"monaco.editor.action.deleteLines"},{keybinding:M.KeyMod.CtrlCmd|M.KeyMod.Shift|M.KeyCode.KeyD,command:"monaco.editor.action.copyLinesDownAction"},{keybinding:M.KeyMod.CtrlCmd|M.KeyCode.KeyK,command:"monaco.editor.action.quickCommand"},{keybinding:M.KeyCode.F8,command:void 0}]),gl(M,ao,"/",ho),s(T),i(M)};l.useEffect(()=>{if(!n||!r)return;const T=n.getModel();T&&r.editor.setModelMarkers(T,"openscad",e.markers??[])},[e.markers]),l.useEffect(()=>{e.isInitializing||!u||S!=""||(async()=>{try{if(console.debug("ZenMonacoPrime",`Loading ${u}`),xt(u)){const T=nr(u,"utf-8");T!=S&&P(T)}else P("");h(),d(!1)}catch(T){b("Failed to read file",T),P("")}})()},[e.isInitializing,u,h]),l.useEffect(()=>{if(e.reloadKey!==void 0&&e.reloadKey>0&&(console.debug("ZenMonacoPrime",`Reloading ${u}`),xt(u))){const T=nr(u,"utf-8");n?.setValue(T),d(!1)}},[e.reloadKey]),l.useEffect(()=>{const T=()=>{g.current&&E(g.current.offsetWidth<600)};return window.addEventListener("resize",T),T(),()=>window.removeEventListener("resize",T)},[]);const _=u||null,B=[{label:"New File",icon:"pi pi-plus",command:y},{label:"Rename",icon:"pi pi-pencil",command:v},{label:"Delete",icon:"pi pi-trash",command:C},{separator:!0},{label:"Set as Home",icon:"pi pi-home",command:()=>f(u)}];return j.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",...e.style},children:[!e.hideTopBar&&j.jsxs("div",{style:{flex:0,display:"flex",alignItems:"center",gap:"8px",padding:"8px",background:"#222"},children:[j.jsxs("div",{style:{position:"relative",flex:0},children:[j.jsx(gi,{model:B,popup:!0,ref:w}),j.jsx(sn,{"aria-label":"Editor menu",style:{minWidth:48,minHeight:48},title:"Menu",onClick:T=>w.current&&w.current.toggle(T),disabled:m,icon:"pi pi-bars",text:!0})]}),j.jsx("div",{style:{position:"relative",flex:1,display:"flex",alignItems:"center"},children:j.jsx(mi,{value:_,options:a,expandedKeys:N,onToggle:T=>O(T.value),onChange:T=>{const M=T.value;typeof M=="string"&&xt(M)&&!Hr(M).isDirectory()&&p(M)},selectionMode:"single",filter:!0,placeholder:"Select a file",className:"w-full",style:{minWidth:300},disabled:m,panelStyle:{maxHeight:600,overflowY:"auto"}})}),j.jsx("div",{style:{position:"relative",flex:0},children:j.jsx(sn,{"aria-label":"Go to HomePage",title:"Go to HomePage",style:{minWidth:48,minHeight:48,color:R?"#fff":"#888"},disabled:!R,onClick:()=>R&&p(R),icon:"pi pi-home",text:!0})})]}),j.jsx("div",{ref:g,style:{flex:1},children:m?j.jsx(Bt,{text:"Loading filesystem"}):j.jsx(Rc,{width:"100%",height:"100%",defaultLanguage:"openscad",value:S,path:u,onChange:L,theme:"vs-dark",onMount:D,options:{automaticLayout:!0,fontSize:16,lineNumbers:x?"off":"on",minimap:{enabled:!x},scrollBeyondLastLine:!1,tabSize:2,insertSpaces:!0,detectIndentation:!0,maxTokenizationLineLength:2e3,lineNumbersMinChars:4},loading:j.jsx(Bt,{text:"Loading monaco editor"})})})]})};class yi{constructor(){this._listeners={}}addEventListener(e,n){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(n)===-1&&s[e].push(n),this}removeEventListener(e,n){const r=this._listeners[e];if(r!==void 0){const i=r.indexOf(n);i!==-1&&r.splice(i,1)}return this}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){const r=s.slice(0);for(let i=0,a=r.length;i<a;i++)r[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class kt{constructor(e,n,s,r={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=n,this._child=s,this._attributes=r,!n.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class eu extends yi{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const n=new Set;for(const s of this.listParentEdges(e))n.add(s.getParent());return Array.from(n)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const n=new Set;for(const s of this.listChildEdges(e))n.add(s.getChild());return Array.from(n)}disconnectParents(e,n){for(const s of this.listParentEdges(e))(!n||n(s.getParent()))&&s.dispose();return this}_createEdge(e,n,s,r){const i=new kt(e,n,s,r);this._edges.add(i);const a=i.getParent();this._parentEdges.has(a)||this._parentEdges.set(a,new Set),this._parentEdges.get(a).add(i);const o=i.getChild();return this._childEdges.has(o)||this._childEdges.set(o,new Set),this._childEdges.get(o).add(i),i}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function rn(){return rn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},rn.apply(this,arguments)}class ct{constructor(e){if(this.list=[],e)for(const n of e)this.list.push(n)}add(e){this.list.push(e)}remove(e){const n=this.list.indexOf(e);n>=0&&this.list.splice(n,1)}removeChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);for(const s of n)this.remove(s);return n}listRefsByChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);return n}values(){return this.list}}class de{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const n of e)this.add(n)}add(e){const n=e.getChild();this.removeChild(n),this.set.add(e),this.map.set(n,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const n=this.map.get(e)||null;return n&&this.remove(n),n}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class tt{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,n){this.map[e]=n}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const oe=Symbol("attributes"),Tt=Symbol("immutableKeys");class Dr extends yi{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[oe]=void 0,this[Tt]=void 0,this.graph=e,this[Tt]=new Set,this[oe]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),n={};for(const s in e){const r=e[s];if(r instanceof Dr){const i=this.graph._createEdge(s,this,r);this[Tt].add(s),n[s]=i}else n[s]=r}return n}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,n){for(const s in this[oe]){const r=this[oe][s];if(r instanceof kt){const i=r;i.getChild()===e&&this.setRef(s,n,i.getAttributes())}else if(r instanceof ct)for(const i of r.listRefsByChild(e)){const a=i.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}else if(r instanceof de){const i=r.getRefByChild(e);if(i){const a=i.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}}else if(r instanceof tt)for(const i of r.keys()){const a=r.get(i);a.getChild()===e&&this.setRefMap(s,i,n,a.getAttributes())}}return this}get(e){return this[oe][e]}set(e,n){return this[oe][e]=n,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const n=this[oe][e];return n?n.getChild():null}setRef(e,n,s){if(this[Tt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[oe][e];if(r&&r.dispose(),!n)return this;const i=this.graph._createEdge(e,this,n,s);return this[oe][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(s=>s.getChild())}addRef(e,n,s){const r=this.graph._createEdge(e,this,n,s);return this.assertRefList(e).add(r),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,n){const s=this.assertRefList(e);if(s instanceof ct)for(const r of s.listRefsByChild(n))r.dispose();else{const r=s.getRefByChild(n);r&&r.dispose()}return this}assertRefList(e){const n=this[oe][e];if(n instanceof ct||n instanceof de)return n;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(n=>n.getChild())}getRefMap(e,n){const r=this.assertRefMap(e).get(n);return r?r.getChild():null}setRefMap(e,n,s,r){const i=this.assertRefMap(e),a=i.get(n);if(a&&a.dispose(),!s)return this;r=Object.assign(r||{},{key:n});const o=this.graph._createEdge(e,this,s,rn({},r,{key:n}));return i.set(n,o),this.dispatchEvent({type:"change",attribute:e,key:n})}assertRefMap(e){const n=this[oe][e];if(n instanceof tt)return n;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(rn({},e,{target:this})),this.graph.dispatchEvent(rn({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const n=e.getName();if(this[oe][n]===e)this[oe][n]=null,this[Tt].has(n)&&e.getChild().dispose();else if(this[oe][n]instanceof ct)this[oe][n].remove(e);else if(this[oe][n]instanceof de)this[oe][n].remove(e);else if(this[oe][n]instanceof tt){const s=this[oe][n];for(const r of s.keys())s.get(r)===e&&s.delete(r)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:n})}}const vi="v4.2.1",zn="@glb.bin";var H;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(H||(H={}));var Hn;(function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"})(Hn||(Hn={}));var $e;(function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"})($e||($e={}));var Ir;(function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"})(Ir||(Ir={}));var st;(function(t){t.GLTF="GLTF",t.GLB="GLB"})(st||(st={}));const qn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class re{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const n=atob(e.split(",")[1]),s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}else{const n=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(n,s?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let n=0;for(const i of e)n+=i.byteLength;const s=new Uint8Array(n);let r=0;for(const i of e)s.set(i,r),r+=i.byteLength;return s}static pad(e,n=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const r=new Uint8Array(s);if(r.set(e),n!==0)for(let i=e.byteLength;i<s;i++)r[i]=n;return r}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,n){if(e===n)return!0;if(e.byteLength!==n.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==n[s])return!1;return!0}static toView(e,n=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+n,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class tu{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let n=new DataView(e.buffer,e.byteOffset+4),s,r;for(;n.byteLength;){if(s=n.getUint16(0,!1),nu(n,s),r=n.getUint8(s+1),r===192||r===193||r===194)return[n.getUint16(s+7,!1),n.getUint16(s+5,!1)];n=new DataView(e.buffer,n.byteOffset+s+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class Jn{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const n=new DataView(e.buffer,e.byteOffset);return re.decodeText(e.slice(12,16))===Jn.PNG_FRIED_CHUNK_NAME?[n.getUint32(32,!1),n.getUint32(36,!1)]:[n.getUint32(16,!1),n.getUint32(20,!1)]}getChannels(e){return 4}}Jn.PNG_FRIED_CHUNK_NAME="CgBI";class Ot{static registerFormat(e,n){this.impls[e]=n}static getMimeType(e){for(const n in this.impls)if(this.impls[n].match(e))return n;return null}static getSize(e,n){return this.impls[n]?this.impls[n].getSize(e):null}static getChannels(e,n){return this.impls[n]?this.impls[n].getChannels(e):null}static getVRAMByteLength(e,n){if(!this.impls[n])return null;if(this.impls[n].getVRAMByteLength)return this.impls[n].getVRAMByteLength(e);let s=0;const r=4,i=this.getSize(e,n);if(!i)return null;for(;i[0]>1||i[1]>1;)s+=i[0]*i[1]*r,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return s+=1*r,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Ot.impls={"image/jpeg":new tu,"image/png":new Jn};function nu(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}class Nt{static basename(e){const n=e.split(/[\\/]/).pop();return n.substring(0,n.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const n=e.match(/data:(image\/\w+)/)[1];return Ot.mimeTypeToExtension(n)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Cr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function ru(){var t=new Cr(3);return Cr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function cr(t){var e=t[0],n=t[1],s=t[2];return Math.hypot(e,n,s)}(function(){var t=ru();return function(e,n,s,r,i,a){var o,u;for(n||(n=3),s||(s=0),r?u=Math.min(r*n+s,e.length):u=e.length,o=s;o<u;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();const Ss="https://null.example";class We{static dirname(e){const n=e.lastIndexOf("/");return n===-1?"./":e.substring(0,n+1)}static basename(e){return Nt.basename(new URL(e,Ss).pathname)}static extension(e){return Nt.extension(new URL(e,Ss).pathname)}static resolve(e,n){if(!this.isRelativePath(n))return n;const s=e.split("/"),r=n.split("/");s.pop();for(let i=0;i<r.length;i++)r[i]!=="."&&(r[i]===".."?s.pop():s.push(r[i]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}We.DEFAULT_INIT={};We.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Ts(t){return Object.prototype.toString.call(t)==="[object Object]"}function It(t){if(Ts(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(Ts(n)===!1||Object.hasOwn(n,"isPrototypeOf")===!1)}var Or,Mr;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(Mr||(Mr={}));class ze{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=ze.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=ze.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=ze.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=ze.Verbosity.ERROR&&console.error(e)}}Or=ze;ze.Verbosity=Mr;ze.DEFAULT_INSTANCE=new Or(Or.Verbosity.INFO);function su(t){var e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],a=t[5],o=t[6],u=t[7],p=t[8],m=t[9],d=t[10],S=t[11],P=t[12],N=t[13],O=t[14],R=t[15],f=e*a-n*i,w=e*o-s*i,g=e*u-r*i,x=n*o-s*a,E=n*u-r*a,b=s*u-r*o,c=p*N-m*P,h=p*O-d*P,y=p*R-S*P,v=m*O-d*N,C=m*R-S*N,F=d*R-S*O;return f*F-w*C+g*v+x*y-E*h+b*c}function iu(t,e,n){var s=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],p=e[6],m=e[7],d=e[8],S=e[9],P=e[10],N=e[11],O=e[12],R=e[13],f=e[14],w=e[15],g=n[0],x=n[1],E=n[2],b=n[3];return t[0]=g*s+x*o+E*d+b*O,t[1]=g*r+x*u+E*S+b*R,t[2]=g*i+x*p+E*P+b*f,t[3]=g*a+x*m+E*N+b*w,g=n[4],x=n[5],E=n[6],b=n[7],t[4]=g*s+x*o+E*d+b*O,t[5]=g*r+x*u+E*S+b*R,t[6]=g*i+x*p+E*P+b*f,t[7]=g*a+x*m+E*N+b*w,g=n[8],x=n[9],E=n[10],b=n[11],t[8]=g*s+x*o+E*d+b*O,t[9]=g*r+x*u+E*S+b*R,t[10]=g*i+x*p+E*P+b*f,t[11]=g*a+x*m+E*N+b*w,g=n[12],x=n[13],E=n[14],b=n[15],t[12]=g*s+x*o+E*d+b*O,t[13]=g*r+x*u+E*S+b*R,t[14]=g*i+x*p+E*P+b*f,t[15]=g*a+x*m+E*N+b*w,t}function ou(t,e){var n=e[0],s=e[1],r=e[2],i=e[4],a=e[5],o=e[6],u=e[8],p=e[9],m=e[10];return t[0]=Math.hypot(n,s,r),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(u,p,m),t}function au(t,e){var n=new Cr(3);ou(n,e);var s=1/n[0],r=1/n[1],i=1/n[2],a=e[0]*s,o=e[1]*r,u=e[2]*i,p=e[4]*s,m=e[5]*r,d=e[6]*i,S=e[8]*s,P=e[9]*r,N=e[10]*i,O=a+m+N,R=0;return O>0?(R=Math.sqrt(O+1)*2,t[3]=.25*R,t[0]=(d-P)/R,t[1]=(S-u)/R,t[2]=(o-p)/R):a>m&&a>N?(R=Math.sqrt(1+a-m-N)*2,t[3]=(d-P)/R,t[0]=.25*R,t[1]=(o+p)/R,t[2]=(S+u)/R):m>N?(R=Math.sqrt(1+m-a-N)*2,t[3]=(S-u)/R,t[0]=(o+p)/R,t[1]=.25*R,t[2]=(d+P)/R):(R=Math.sqrt(1+N-a-m)*2,t[3]=(o-p)/R,t[0]=(S+u)/R,t[1]=(d+P)/R,t[2]=.25*R),t}class me{static identity(e){return e}static eq(e,n,s=1e-5){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-n[r])>s)return!1;return!0}static clamp(e,n,s){return e<n?n:e>s?s:e}static decodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return Math.round(me.clamp(e,0,1)*65535);case 5121:return Math.round(me.clamp(e,0,1)*255);case 5122:return Math.round(me.clamp(e,-1,1)*32767);case 5120:return Math.round(me.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,n,s,r){let i=cr([e[0],e[1],e[2]]);const a=cr([e[4],e[5],e[6]]),o=cr([e[8],e[9],e[10]]);su(e)<0&&(i=-i),n[0]=e[12],n[1]=e[13],n[2]=e[14];const p=e.slice(),m=1/i,d=1/a,S=1/o;p[0]*=m,p[1]*=m,p[2]*=m,p[4]*=d,p[5]*=d,p[6]*=d,p[8]*=S,p[9]*=S,p[10]*=S,au(s,p),r[0]=i,r[1]=a,r[2]=o}static compose(e,n,s,r){const i=r,a=n[0],o=n[1],u=n[2],p=n[3],m=a+a,d=o+o,S=u+u,P=a*m,N=a*d,O=a*S,R=o*d,f=o*S,w=u*S,g=p*m,x=p*d,E=p*S,b=s[0],c=s[1],h=s[2];return i[0]=(1-(R+w))*b,i[1]=(N+E)*b,i[2]=(O-x)*b,i[3]=0,i[4]=(N-E)*c,i[5]=(1-(P+w))*c,i[6]=(f+g)*c,i[7]=0,i[8]=(O+x)*h,i[9]=(f-g)*h,i[10]=(1-(P+R))*h,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function lu(t,e){if(!!t!=!!e)return!1;const n=t.getChild(),s=e.getChild();return n===s||n.equals(s)}function cu(t,e){if(!!t!=!!e)return!1;const n=t.values(),s=e.values();if(n.length!==s.length)return!1;for(let r=0;r<n.length;r++){const i=n[r],a=s[r];if(i.getChild()!==a.getChild()&&!i.getChild().equals(a.getChild()))return!1}return!0}function uu(t,e){if(!!t!=!!e)return!1;const n=t.keys(),s=e.keys();if(n.length!==s.length)return!1;for(const r of n){const i=t.get(r),a=e.get(r);if(!!i!=!!a)return!1;const o=i.getChild(),u=a.getChild();if(o!==u&&!o.equals(u))return!1}return!0}function bi(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function xi(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!It(t)||!It(e))return t===e;const n=t,s=e;let r=0,i=0,a;for(a in n)r++;for(a in s)i++;if(r!==i)return!1;for(a in n){const o=n[a],u=s[a];if(Kn(o)&&Kn(u)){if(!bi(o,u))return!1}else if(It(o)&&It(u)){if(!xi(o,u))return!1}else if(o!==u)return!1}return!0}function Kn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Rs="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",fu=999,du=6,Is=new Set,pu=function(){let e="";for(let n=0;n<du;n++)e+=Rs.charAt(Math.floor(Math.random()*Rs.length));return e},mu=function(){for(let e=0;e<fu;e++){const n=pu();if(!Is.has(n))return Is.add(n),n}return""},ft=t=>t,hu=new Set;class Ur extends Dr{constructor(e,n=""){super(e),this[oe].name=n,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,n){return Array.isArray(n)&&(n=n.slice()),super.set(e,n)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,ft)}copy(e,n=ft){for(const s in this[oe]){const r=this[oe][s];if(r instanceof kt)this[Tt].has(s)||r.dispose();else if(r instanceof ct||r instanceof de)for(const i of r.values())i.dispose();else if(r instanceof tt)for(const i of r.values())i.dispose()}for(const s in e[oe]){const r=this[oe][s],i=e[oe][s];if(i instanceof kt)this[Tt].has(s)?r.getChild().copy(n(i.getChild()),n):this.setRef(s,n(i.getChild()),i.getAttributes());else if(i instanceof de||i instanceof ct)for(const a of i.values())this.addRef(s,n(a.getChild()),a.getAttributes());else if(i instanceof tt)for(const a of i.keys()){const o=i.get(a);this.setRefMap(s,a,n(o.getChild()),o.getAttributes())}else It(i)?this[oe][s]=JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?this[oe][s]=i.slice():this[oe][s]=i}return this}equals(e,n=hu){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[oe]){if(n.has(s))continue;const r=this[oe][s],i=e[oe][s];if(r instanceof kt||i instanceof kt){if(!lu(r,i))return!1}else if(r instanceof de||i instanceof de||r instanceof ct||i instanceof ct){if(!cu(r,i))return!1}else if(r instanceof tt||i instanceof tt){if(!uu(r,i))return!1}else if(It(r)||It(i)){if(!xi(r,i))return!1}else if(Kn(r)||Kn(i)){if(!bi(r,i))return!1}else if(r!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Me extends Ur{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new tt})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,n){return n&&n._validateParent(this),this.setRefMap("extensions",e,n)}listExtensions(){return this.listRefMapValues("extensions")}}class q extends Me{init(){this.propertyType=H.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:q.Type.SCALAR,componentType:q.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case q.Type.SCALAR:return 1;case q.Type.VEC2:return 2;case q.Type.VEC3:return 3;case q.Type.VEC4:return 4;case q.Type.MAT2:return 4;case q.Type.MAT3:return 9;case q.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case q.ComponentType.BYTE:return 1;case q.ComponentType.UNSIGNED_BYTE:return 1;case q.ComponentType.SHORT:return 2;case q.ComponentType.UNSIGNED_SHORT:return 2;case q.ComponentType.UNSIGNED_INT:return 4;case q.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMin(e),n)for(let i=0;i<s;i++)e[i]=me.decodeNormalizedInt(e[i],r);return e}getMin(e){const n=this.getArray(),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)e[i]=1/0;for(let i=0;i<s*r;i+=r)for(let a=0;a<r;a++){const o=n[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMax(e),n)for(let i=0;i<s;i++)e[i]=me.decodeNormalizedInt(e[i],r);return e}getMax(e){const n=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)e[i]=-1/0;for(let i=0;i<s*r;i+=r)for(let a=0;a<r;a++){const o=n[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return q.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const n=this.getElementSize(),s=this.getComponentType(),r=this.getArray();return this.getNormalized()?me.decodeNormalizedInt(r[e*n],s):r[e*n]}setScalar(e,n){const s=this.getElementSize(),r=this.getComponentType(),i=this.getArray();return this.getNormalized()?i[e*s]=me.encodeNormalizedInt(n,r):i[e*s]=n,this}getElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<r;o++)s?n[o]=me.decodeNormalizedInt(a[e*r+o],i):n[o]=a[e*r+o];return n}setElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<r;o++)s?a[e*r+o]=me.encodeNormalizedInt(n[o],i):a[e*r+o]=n[o];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?gu(e):q.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}q.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};q.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function gu(t){switch(t.constructor){case Float32Array:return q.ComponentType.FLOAT;case Uint32Array:return q.ComponentType.UNSIGNED_INT;case Uint16Array:return q.ComponentType.UNSIGNED_SHORT;case Uint8Array:return q.ComponentType.UNSIGNED_BYTE;case Int16Array:return q.ComponentType.SHORT;case Int8Array:return q.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class Ei extends Me{init(){this.propertyType=H.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new de,samplers:new de})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class wi extends Me{init(){this.propertyType=H.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}wi.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class bn extends Me{init(){this.propertyType=H.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:bn.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:$e.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:$e.OTHER})}}bn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Si extends Me{init(){this.propertyType=H.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class At extends Me{init(){this.propertyType=H.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:At.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}At.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class yu extends Ur{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}yu.EXTENSION_NAME=void 0;class Ye extends Me{init(){this.propertyType=H.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ye.WrapMode.REPEAT,wrapT:Ye.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ye.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Ye.MagFilter={NEAREST:9728,LINEAR:9729};Ye.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:_n,G:jn,B:Fn,A:vu}=Ir;class Pt extends Me{init(){this.propertyType=H.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Pt.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ye(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ye(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ye(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ye(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ye(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const n=this.get("baseColorFactor").slice();return n[3]=e,this.set("baseColorFactor",n)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:_n|jn|Fn|vu,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:_n|jn|Fn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:_n|jn|Fn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:_n})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:jn|Fn})}}Pt.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Ti extends Me{init(){this.propertyType=H.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new de})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class Ri extends Me{init(){this.propertyType=H.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new de})}copy(e,n=ft){if(n===ft)throw new Error("Node cannot be copied.");return super.copy(e,n)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return me.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const n=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return me.decompose(e,n,s,r),this.set("translation",n).set("rotation",s).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return me.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return me.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return me.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r!=null;r=r.getParentNode())e.push(r);let n;const s=e.pop().getMatrix();for(;n=e.pop();)iu(s,s,n.getMatrix());return s}addChild(e){const n=e.getParentNode();n&&n.removeChild(e);for(const s of e.listParents())s.propertyType===H.SCENE&&s.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===H.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const n of this.listChildren())n.traverse(e);return this}}class xn extends Me{init(){this.propertyType=H.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:xn.Mode.TRIANGLES,material:null,indices:null,attributes:new tt,targets:new de})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:$e.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:$e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}xn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class bu extends Ur{init(){this.propertyType=H.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new tt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:$e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Oe(){return Oe=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Oe.apply(null,arguments)}class Ii extends Me{init(){this.propertyType=H.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new de})}copy(e,n=ft){if(n===ft)throw new Error("Scene cannot be copied.");return super.copy(e,n)}addChild(e){const n=e.getParentNode();return n&&n.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const n of this.listChildren())n.traverse(e);return this}}class Ci extends Me{init(){this.propertyType=H.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new de})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:$e.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Oi extends Me{init(){this.propertyType=H.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Ot.extensionToMimeType(Nt.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const n=Ot.extensionToMimeType(Nt.extension(e));return n&&this.set("mimeType",n),this}getImage(){return this.get("image")}setImage(e){return this.set("image",re.assertView(e))}getSize(){const e=this.get("image");return e?Ot.getSize(e,this.getMimeType()):null}}class xu extends Me{init(){this.propertyType=H.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${vi}`,version:"2.0"},defaultScene:null,accessors:new de,animations:new de,buffers:new de,cameras:new de,materials:new de,meshes:new de,nodes:new de,scenes:new de,skins:new de,textures:new de})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",n=>{this._addChildOfRoot(n.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,n=ft){if(n===ft)throw new Error("Root cannot be copied.");this.set("asset",Oe({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Oe({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?n(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const r=e.getExtension(s);this.setExtension(s,n(r))}return this}_addChildOfRoot(e){return e instanceof Ii?this.addRef("scenes",e):e instanceof Ri?this.addRef("nodes",e):e instanceof At?this.addRef("cameras",e):e instanceof Ci?this.addRef("skins",e):e instanceof Ti?this.addRef("meshes",e):e instanceof Pt?this.addRef("materials",e):e instanceof Oi?this.addRef("textures",e):e instanceof Ei?this.addRef("animations",e):e instanceof q?this.addRef("accessors",e):e instanceof Si&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Vt{static fromGraph(e){return Vt._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new eu,this._root=new xu(this._graph),this._logger=ze.DEFAULT_INSTANCE,Vt._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const n=e.map(s=>s.name);for(const s of e)await s(this,{stack:n});return this}createExtension(e){const n=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(r=>r.extensionName===n)||new e(this)}createScene(e=""){return new Ii(this._graph,e)}createNode(e=""){return new Ri(this._graph,e)}createCamera(e=""){return new At(this._graph,e)}createSkin(e=""){return new Ci(this._graph,e)}createMesh(e=""){return new Ti(this._graph,e)}createPrimitive(){return new xn(this._graph)}createPrimitiveTarget(e=""){return new bu(this._graph,e)}createMaterial(e=""){return new Pt(this._graph,e)}createTexture(e=""){return new Oi(this._graph,e)}createAnimation(e=""){return new Ei(this._graph,e)}createAnimationChannel(e=""){return new wi(this._graph,e)}createAnimationSampler(e=""){return new bn(this._graph,e)}createAccessor(e="",n=null){return n||(n=this.getRoot().listBuffers()[0]),new q(this._graph,e).setBuffer(n)}createBuffer(e=""){return new Si(this._graph,e)}}Vt._GRAPH_DOCUMENTS=new WeakMap;class Eu{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,n){this.textureInfos.set(e,n),n.texCoord!==void 0&&e.setTexCoord(n.texCoord),n.extras!==void 0&&e.setExtras(n.extras);const s=this.jsonDoc.json.textures[n.index];if(s.sampler===void 0)return;const r=this.jsonDoc.json.samplers[s.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const Cs={logger:ze.DEFAULT_INSTANCE,extensions:[],dependencies:{}},wu=new Set([H.BUFFER,H.TEXTURE,H.MATERIAL,H.MESH,H.PRIMITIVE,H.NODE,H.SCENE]);class Su{static read(e,n=Cs){const s=Oe({},Cs,n),{json:r}=e,i=new Vt().setLogger(s.logger);this.validate(e,s);const a=new Eu(e),o=r.asset,u=i.getRoot().getAsset();o.copyright&&(u.copyright=o.copyright),o.extras&&(u.extras=o.extras),r.extras!==void 0&&i.getRoot().setExtras(Oe({},r.extras));const p=r.extensionsUsed||[],m=r.extensionsRequired||[];s.extensions.sort((c,h)=>c.EXTENSION_NAME>h.EXTENSION_NAME?1:-1);for(const c of s.extensions)if(p.includes(c.EXTENSION_NAME)){const h=i.createExtension(c).setRequired(m.includes(c.EXTENSION_NAME)),y=h.prereadTypes.filter(v=>!wu.has(v));y.length&&s.logger.warn(`Preread hooks for some types (${y.join()}), requested by extension ${h.extensionName}, are unsupported. Please file an issue or a PR.`);for(const v of h.readDependencies)h.install(v,s.dependencies[v])}const d=r.buffers||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.BUFFER)).forEach(c=>c.preread(a,H.BUFFER)),a.buffers=d.map(c=>{const h=i.createBuffer(c.name);return c.extras&&h.setExtras(c.extras),c.uri&&c.uri.indexOf("__")!==0&&h.setURI(c.uri),h});const S=r.bufferViews||[];a.bufferViewBuffers=S.map((c,h)=>{if(!a.bufferViews[h]){const y=e.json.buffers[c.buffer],v=y.uri?e.resources[y.uri]:e.resources[zn],C=c.byteOffset||0;a.bufferViews[h]=re.toView(v,C,c.byteLength)}return a.buffers[c.buffer]});const P=r.accessors||[];a.accessors=P.map(c=>{const h=a.bufferViewBuffers[c.bufferView],y=i.createAccessor(c.name,h).setType(c.type);return c.extras&&y.setExtras(c.extras),c.normalized!==void 0&&y.setNormalized(c.normalized),c.bufferView===void 0||y.setArray($n(c,a)),y});const N=r.images||[],O=r.textures||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.TEXTURE)).forEach(c=>c.preread(a,H.TEXTURE)),a.textures=N.map(c=>{const h=i.createTexture(c.name);if(c.extras&&h.setExtras(c.extras),c.bufferView!==void 0){const y=r.bufferViews[c.bufferView],v=e.json.buffers[y.buffer],C=v.uri?e.resources[v.uri]:e.resources[zn],F=y.byteOffset||0,L=y.byteLength,D=C.slice(F,F+L);h.setImage(D)}else c.uri!==void 0&&(h.setImage(e.resources[c.uri]),c.uri.indexOf("__")!==0&&h.setURI(c.uri));if(c.mimeType!==void 0)h.setMimeType(c.mimeType);else if(c.uri){const y=Nt.extension(c.uri);h.setMimeType(Ot.extensionToMimeType(y))}return h}),i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.MATERIAL)).forEach(c=>c.preread(a,H.MATERIAL));const R=r.materials||[];a.materials=R.map(c=>{const h=i.createMaterial(c.name);c.extras&&h.setExtras(c.extras),c.alphaMode!==void 0&&h.setAlphaMode(c.alphaMode),c.alphaCutoff!==void 0&&h.setAlphaCutoff(c.alphaCutoff),c.doubleSided!==void 0&&h.setDoubleSided(c.doubleSided);const y=c.pbrMetallicRoughness||{};if(y.baseColorFactor!==void 0&&h.setBaseColorFactor(y.baseColorFactor),c.emissiveFactor!==void 0&&h.setEmissiveFactor(c.emissiveFactor),y.metallicFactor!==void 0&&h.setMetallicFactor(y.metallicFactor),y.roughnessFactor!==void 0&&h.setRoughnessFactor(y.roughnessFactor),y.baseColorTexture!==void 0){const v=y.baseColorTexture,C=a.textures[O[v.index].source];h.setBaseColorTexture(C),a.setTextureInfo(h.getBaseColorTextureInfo(),v)}if(c.emissiveTexture!==void 0){const v=c.emissiveTexture,C=a.textures[O[v.index].source];h.setEmissiveTexture(C),a.setTextureInfo(h.getEmissiveTextureInfo(),v)}if(c.normalTexture!==void 0){const v=c.normalTexture,C=a.textures[O[v.index].source];h.setNormalTexture(C),a.setTextureInfo(h.getNormalTextureInfo(),v),c.normalTexture.scale!==void 0&&h.setNormalScale(c.normalTexture.scale)}if(c.occlusionTexture!==void 0){const v=c.occlusionTexture,C=a.textures[O[v.index].source];h.setOcclusionTexture(C),a.setTextureInfo(h.getOcclusionTextureInfo(),v),c.occlusionTexture.strength!==void 0&&h.setOcclusionStrength(c.occlusionTexture.strength)}if(y.metallicRoughnessTexture!==void 0){const v=y.metallicRoughnessTexture,C=a.textures[O[v.index].source];h.setMetallicRoughnessTexture(C),a.setTextureInfo(h.getMetallicRoughnessTextureInfo(),v)}return h}),i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.MESH)).forEach(c=>c.preread(a,H.MESH));const f=r.meshes||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.PRIMITIVE)).forEach(c=>c.preread(a,H.PRIMITIVE)),a.meshes=f.map(c=>{const h=i.createMesh(c.name);return c.extras&&h.setExtras(c.extras),c.weights!==void 0&&h.setWeights(c.weights),(c.primitives||[]).forEach(v=>{const C=i.createPrimitive();v.extras&&C.setExtras(v.extras),v.material!==void 0&&C.setMaterial(a.materials[v.material]),v.mode!==void 0&&C.setMode(v.mode);for(const[D,_]of Object.entries(v.attributes||{}))C.setAttribute(D,a.accessors[_]);v.indices!==void 0&&C.setIndices(a.accessors[v.indices]);const F=c.extras&&c.extras.targetNames||[];(v.targets||[]).forEach((D,_)=>{const B=F[_]||_.toString(),T=i.createPrimitiveTarget(B);for(const[M,V]of Object.entries(D))T.setAttribute(M,a.accessors[V]);C.addTarget(T)}),h.addPrimitive(C)}),h});const w=r.cameras||[];a.cameras=w.map(c=>{const h=i.createCamera(c.name).setType(c.type);if(c.extras&&h.setExtras(c.extras),c.type===At.Type.PERSPECTIVE){const y=c.perspective;h.setYFov(y.yfov),h.setZNear(y.znear),y.zfar!==void 0&&h.setZFar(y.zfar),y.aspectRatio!==void 0&&h.setAspectRatio(y.aspectRatio)}else{const y=c.orthographic;h.setZNear(y.znear).setZFar(y.zfar).setXMag(y.xmag).setYMag(y.ymag)}return h});const g=r.nodes||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.NODE)).forEach(c=>c.preread(a,H.NODE)),a.nodes=g.map(c=>{const h=i.createNode(c.name);if(c.extras&&h.setExtras(c.extras),c.translation!==void 0&&h.setTranslation(c.translation),c.rotation!==void 0&&h.setRotation(c.rotation),c.scale!==void 0&&h.setScale(c.scale),c.matrix!==void 0){const y=[0,0,0],v=[0,0,0,1],C=[1,1,1];me.decompose(c.matrix,y,v,C),h.setTranslation(y),h.setRotation(v),h.setScale(C)}return c.weights!==void 0&&h.setWeights(c.weights),h});const x=r.skins||[];a.skins=x.map(c=>{const h=i.createSkin(c.name);c.extras&&h.setExtras(c.extras),c.inverseBindMatrices!==void 0&&h.setInverseBindMatrices(a.accessors[c.inverseBindMatrices]),c.skeleton!==void 0&&h.setSkeleton(a.nodes[c.skeleton]);for(const y of c.joints)h.addJoint(a.nodes[y]);return h}),g.map((c,h)=>{const y=a.nodes[h];(c.children||[]).forEach(C=>y.addChild(a.nodes[C])),c.mesh!==void 0&&y.setMesh(a.meshes[c.mesh]),c.camera!==void 0&&y.setCamera(a.cameras[c.camera]),c.skin!==void 0&&y.setSkin(a.skins[c.skin])});const E=r.animations||[];a.animations=E.map(c=>{const h=i.createAnimation(c.name);c.extras&&h.setExtras(c.extras);const v=(c.samplers||[]).map(F=>{const L=i.createAnimationSampler().setInput(a.accessors[F.input]).setOutput(a.accessors[F.output]).setInterpolation(F.interpolation||bn.Interpolation.LINEAR);return F.extras&&L.setExtras(F.extras),h.addSampler(L),L});return(c.channels||[]).forEach(F=>{const L=i.createAnimationChannel().setSampler(v[F.sampler]).setTargetPath(F.target.path);F.target.node!==void 0&&L.setTargetNode(a.nodes[F.target.node]),F.extras&&L.setExtras(F.extras),h.addChannel(L)}),h});const b=r.scenes||[];return i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(H.SCENE)).forEach(c=>c.preread(a,H.SCENE)),a.scenes=b.map(c=>{const h=i.createScene(c.name);return c.extras&&h.setExtras(c.extras),(c.nodes||[]).map(v=>a.nodes[v]).forEach(v=>h.addChild(v)),h}),r.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[r.scene]),i.getRoot().listExtensionsUsed().forEach(c=>c.read(a)),P.forEach((c,h)=>{const y=a.accessors[h],v=!!c.sparse,C=!c.bufferView&&!y.getArray();(v||C)&&y.setSparse(!0).setArray(Ru(c,a))}),i}static validate(e,n){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const r of s.extensionsRequired)if(!n.extensions.find(i=>i.EXTENSION_NAME===r))throw new Error(`Missing required extension, "${r}".`)}if(s.extensionsUsed)for(const r of s.extensionsUsed)n.extensions.find(i=>i.EXTENSION_NAME===r)||n.logger.warn(`Missing optional extension, "${r}".`)}}function Tu(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],i=qn[t.componentType],a=q.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,u=t.byteOffset||0,p=new i(t.count*a),m=new DataView(s.buffer,s.byteOffset,s.byteLength),d=r.byteStride;for(let S=0;S<t.count;S++)for(let P=0;P<a;P++){const N=u+S*d+P*o;let O;switch(t.componentType){case q.ComponentType.FLOAT:O=m.getFloat32(N,!0);break;case q.ComponentType.UNSIGNED_INT:O=m.getUint32(N,!0);break;case q.ComponentType.UNSIGNED_SHORT:O=m.getUint16(N,!0);break;case q.ComponentType.UNSIGNED_BYTE:O=m.getUint8(N);break;case q.ComponentType.SHORT:O=m.getInt16(N,!0);break;case q.ComponentType.BYTE:O=m.getInt8(N);break;default:throw new Error(`Unexpected componentType "${t.componentType}".`)}p[S*a+P]=O}return p}function $n(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],i=qn[t.componentType],a=q.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,u=a*o;if(r.byteStride!==void 0&&r.byteStride!==u)return Tu(t,e);const p=s.byteOffset+(t.byteOffset||0),m=t.count*a*o;return new i(s.buffer.slice(p,p+m))}function Ru(t,e){const n=qn[t.componentType],s=q.getElementSize(t.type);let r;t.bufferView!==void 0?r=$n(t,e):r=new n(t.count*s);const i=t.sparse;if(!i)return r;const a=i.count,o=Oe({},t,i.indices,{count:a,type:"SCALAR"}),u=Oe({},t,i.values,{count:a}),p=$n(o,e),m=$n(u,e);for(let d=0;d<o.count;d++)for(let S=0;S<s;S++)r[p[d]*s+S]=m[d*s+S];return r}var mn;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(mn||(mn={}));class Mt{constructor(e,n,s){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=n,this.options=s;const r=e.getRoot(),i=r.listBuffers().length,a=r.listTextures().length;this.bufferURIGenerator=new Os(i>1,()=>s.basename||"buffer"),this.imageURIGenerator=new Os(a>1,o=>Iu(e,o)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,n){const s={magFilter:n.getMagFilter()||void 0,minFilter:n.getMinFilter()||void 0,wrapS:n.getWrapS(),wrapT:n.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return n.getTexCoord()!==0&&(o.texCoord=n.getTexCoord()),Object.keys(n.getExtras()).length>0&&(o.extras=n.getExtras()),this.textureInfoDefMap.set(n,o),o}createPropertyDef(e){const n={};return e.getName()&&(n.name=e.getName()),Object.keys(e.getExtras()).length>0&&(n.extras=e.getExtras()),n}createAccessorDef(e){const n=this.createPropertyDef(e);return n.type=e.getType(),n.componentType=e.getComponentType(),n.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(r=>r.getName()==="attributes"&&r.getAttributes().key==="POSITION"||r.getName()==="input")&&(n.max=e.getMax([]).map(Math.fround),n.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(n.normalized=e.getNormalized()),n}createImageData(e,n,s){if(this.options.format===st.GLB)this.imageBufferViews.push(n),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:n.byteLength});else{const r=Ot.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.assignResourceURI(e.uri,n,!1)}}assignResourceURI(e,n,s){const r=this.jsonDoc.resources;if(!(e in r)){r[e]=n;return}if(n===r[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const i=`Resource URI "${e}" already assigned to different data.`;if(!s){this.logger.warn(i);return}throw new Error(i)}getAccessorUsage(e){const n=this._accessorUsageMap.get(e);if(n)return n;if(e.getSparse())return $e.SPARSE;for(const s of this._doc.getGraph().listParentEdges(e)){const{usage:r}=s.getAttributes();if(r)return r;s.getParent().propertyType!==H.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return $e.OTHER}addAccessorToUsageGroup(e,n){const s=this._accessorUsageMap.get(e);if(s&&s!==n)throw new Error(`Accessor with usage "${s}" cannot be reused as "${n}".`);return this._accessorUsageMap.set(e,n),this}}Mt.BufferViewTarget=mn;Mt.BufferViewUsage=$e;Mt.USAGE_TO_TARGET={[$e.ARRAY_BUFFER]:mn.ARRAY_BUFFER,[$e.ELEMENT_ARRAY_BUFFER]:mn.ELEMENT_ARRAY_BUFFER};class Os{constructor(e,n){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=n}createURI(e,n){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${n}`}else return`${this.basename(e)}.${n}`}}function Iu(t,e){const n=t.getGraph().listParentEdges(e).find(s=>s.getParent()!==t.getRoot());return n?n.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Ln}=Mt,{UNSIGNED_INT:Cu,UNSIGNED_SHORT:Ou,UNSIGNED_BYTE:Mu}=q.ComponentType,Nu=new Set([H.ACCESSOR,H.BUFFER,H.MATERIAL,H.MESH]);class Pu{static write(e,n){const s=e.getGraph(),r=e.getRoot(),i={asset:Oe({generator:`glTF-Transform ${vi}`},r.getAsset()),extras:Oe({},r.getExtras())},a={json:i,resources:{}},o=new Mt(e,a,n),u=n.logger||ze.DEFAULT_INSTANCE,p=new Set(n.extensions.map(f=>f.EXTENSION_NAME)),m=e.getRoot().listExtensionsUsed().filter(f=>p.has(f.extensionName)).sort((f,w)=>f.extensionName>w.extensionName?1:-1),d=e.getRoot().listExtensionsRequired().filter(f=>p.has(f.extensionName)).sort((f,w)=>f.extensionName>w.extensionName?1:-1);m.length<e.getRoot().listExtensionsUsed().length&&u.warn("Some extensions were not registered for I/O, and will not be written.");for(const f of m){const w=f.prewriteTypes.filter(g=>!Nu.has(g));w.length&&u.warn(`Prewrite hooks for some types (${w.join()}), requested by extension ${f.extensionName}, are unsupported. Please file an issue or a PR.`);for(const g of f.writeDependencies)f.install(g,n.dependencies[g])}function S(f,w,g,x){const E=[];let b=0;for(const y of f){const v=o.createAccessorDef(y);v.bufferView=i.bufferViews.length;const C=y.getArray(),F=re.pad(re.toView(C));v.byteOffset=b,b+=F.byteLength,E.push(F),o.accessorIndexMap.set(y,i.accessors.length),i.accessors.push(v)}const c=re.concat(E),h={buffer:w,byteOffset:g,byteLength:c.byteLength};return x&&(h.target=x),i.bufferViews.push(h),{buffers:E,byteLength:b}}function P(f,w,g){const x=f[0].getCount();let E=0;for(const v of f){const C=o.createAccessorDef(v);C.bufferView=i.bufferViews.length,C.byteOffset=E;const F=v.getElementSize(),L=v.getComponentSize();E+=re.padNumber(F*L),o.accessorIndexMap.set(v,i.accessors.length),i.accessors.push(C)}const b=x*E,c=new ArrayBuffer(b),h=new DataView(c);for(let v=0;v<x;v++){let C=0;for(const F of f){const L=F.getElementSize(),D=F.getComponentSize(),_=F.getComponentType(),B=F.getArray();for(let T=0;T<L;T++){const M=v*E+C+T*D,V=B[v*L+T];switch(_){case q.ComponentType.FLOAT:h.setFloat32(M,V,!0);break;case q.ComponentType.BYTE:h.setInt8(M,V);break;case q.ComponentType.SHORT:h.setInt16(M,V,!0);break;case q.ComponentType.UNSIGNED_BYTE:h.setUint8(M,V);break;case q.ComponentType.UNSIGNED_SHORT:h.setUint16(M,V,!0);break;case q.ComponentType.UNSIGNED_INT:h.setUint32(M,V,!0);break;default:throw new Error("Unexpected component type: "+_)}}C+=re.padNumber(L*D)}}const y={buffer:w,byteOffset:g,byteLength:b,byteStride:E,target:Mt.BufferViewTarget.ARRAY_BUFFER};return i.bufferViews.push(y),{byteLength:b,buffers:[new Uint8Array(c)]}}function N(f,w,g){const x=[];let E=0;const b=new Map;let c=-1/0,h=!1;for(const _ of f){const B=o.createAccessorDef(_);i.accessors.push(B),o.accessorIndexMap.set(_,i.accessors.length-1);const T=[],M=[],V=[],z=new Array(_.getElementSize()).fill(0);for(let pe=0,X=_.getCount();pe<X;pe++)if(_.getElement(pe,V),!me.eq(V,z,0)){c=Math.max(pe,c),T.push(pe);for(let te=0;te<V.length;te++)M.push(V[te])}const K=T.length,ee={accessorDef:B,count:K};if(b.set(_,ee),K===0)continue;K>_.getCount()/2&&(h=!0);const be=qn[_.getComponentType()];ee.indices=T,ee.values=new be(M)}if(!Number.isFinite(c))return{buffers:x,byteLength:E};h&&u.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const y=c<255?Uint8Array:c<65535?Uint16Array:Uint32Array,v=c<255?Mu:c<65535?Ou:Cu,C={buffer:w,byteOffset:g+E,byteLength:0};for(const _ of f){const B=b.get(_);if(B.count===0)continue;B.indicesByteOffset=C.byteLength;const T=re.pad(re.toView(new y(B.indices)));x.push(T),E+=T.byteLength,C.byteLength+=T.byteLength}i.bufferViews.push(C);const F=i.bufferViews.length-1,L={buffer:w,byteOffset:g+E,byteLength:0};for(const _ of f){const B=b.get(_);if(B.count===0)continue;B.valuesByteOffset=L.byteLength;const T=re.pad(re.toView(B.values));x.push(T),E+=T.byteLength,L.byteLength+=T.byteLength}i.bufferViews.push(L);const D=i.bufferViews.length-1;for(const _ of f){const B=b.get(_);B.count!==0&&(B.accessorDef.sparse={count:B.count,indices:{bufferView:F,byteOffset:B.indicesByteOffset,componentType:v},values:{bufferView:D,byteOffset:B.valuesByteOffset}})}return{buffers:x,byteLength:E}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=r.listTextures().map((f,w)=>{const g=o.createPropertyDef(f);f.getMimeType()&&(g.mimeType=f.getMimeType());const x=f.getImage();return x&&o.createImageData(g,x,f),o.imageIndexMap.set(f,w),g}),m.filter(f=>f.prewriteTypes.includes(H.ACCESSOR)).forEach(f=>f.prewrite(o,H.ACCESSOR)),r.listAccessors().forEach(f=>{const w=o.accessorUsageGroupedByParent,g=o.accessorParents;if(o.accessorIndexMap.has(f))return;const x=o.getAccessorUsage(f);if(o.addAccessorToUsageGroup(f,x),w.has(x)){const E=s.listParents(f).find(b=>b.propertyType!==H.ROOT);g.set(f,E)}}),m.filter(f=>f.prewriteTypes.includes(H.BUFFER)).forEach(f=>f.prewrite(o,H.BUFFER)),(r.listAccessors().length>0||o.otherBufferViews.size>0||r.listTextures().length>0&&n.format===st.GLB)&&r.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],r.listBuffers().forEach((f,w)=>{const g=o.createPropertyDef(f),x=o.accessorUsageGroupedByParent,E=f.listParents().filter(L=>L instanceof q),b=new Set(E.map(L=>o.accessorParents.get(L))),c=new Map(Array.from(b).map((L,D)=>[L,D])),h={};for(const L of E){var y;if(o.accessorIndexMap.has(L))continue;const D=o.getAccessorUsage(L);let _=D;if(x.has(D)){const B=o.accessorParents.get(L);_+=`:${c.get(B)}`}h[y=_]||(h[y]={usage:D,accessors:[]}),h[_].accessors.push(L)}const v=[],C=i.buffers.length;let F=0;for(const{usage:L,accessors:D}of Object.values(h))if(L===Ln.ARRAY_BUFFER&&n.vertexLayout===Hn.INTERLEAVED){const _=P(D,C,F);F+=_.byteLength;for(const B of _.buffers)v.push(B)}else if(L===Ln.ARRAY_BUFFER)for(const _ of D){const B=P([_],C,F);F+=B.byteLength;for(const T of B.buffers)v.push(T)}else if(L===Ln.SPARSE){const _=N(D,C,F);F+=_.byteLength;for(const B of _.buffers)v.push(B)}else if(L===Ln.ELEMENT_ARRAY_BUFFER){const _=Mt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,B=S(D,C,F,_);F+=B.byteLength;for(const T of B.buffers)v.push(T)}else{const _=S(D,C,F);F+=_.byteLength;for(const B of _.buffers)v.push(B)}if(o.imageBufferViews.length&&w===0){for(let L=0;L<o.imageBufferViews.length;L++)if(i.bufferViews[i.images[L].bufferView].byteOffset=F,F+=o.imageBufferViews[L].byteLength,v.push(o.imageBufferViews[L]),F%8){const D=8-F%8;F+=D,v.push(new Uint8Array(D))}}if(o.otherBufferViews.has(f))for(const L of o.otherBufferViews.get(f))i.bufferViews.push({buffer:C,byteOffset:F,byteLength:L.byteLength}),o.otherBufferViewsIndexMap.set(L,i.bufferViews.length-1),F+=L.byteLength,v.push(L);if(F){let L;n.format===st.GLB?L=zn:(L=o.bufferURIGenerator.createURI(f,"bin"),g.uri=L),g.byteLength=F,o.assignResourceURI(L,re.concat(v),!0)}i.buffers.push(g),o.bufferIndexMap.set(f,w)}),r.listAccessors().find(f=>!f.getBuffer())&&u.warn("Skipped writing one or more Accessors: no Buffer assigned."),m.filter(f=>f.prewriteTypes.includes(H.MATERIAL)).forEach(f=>f.prewrite(o,H.MATERIAL)),i.materials=r.listMaterials().map((f,w)=>{const g=o.createPropertyDef(f);if(f.getAlphaMode()!==Pt.AlphaMode.OPAQUE&&(g.alphaMode=f.getAlphaMode()),f.getAlphaMode()===Pt.AlphaMode.MASK&&(g.alphaCutoff=f.getAlphaCutoff()),f.getDoubleSided()&&(g.doubleSided=!0),g.pbrMetallicRoughness={},me.eq(f.getBaseColorFactor(),[1,1,1,1])||(g.pbrMetallicRoughness.baseColorFactor=f.getBaseColorFactor()),me.eq(f.getEmissiveFactor(),[0,0,0])||(g.emissiveFactor=f.getEmissiveFactor()),f.getRoughnessFactor()!==1&&(g.pbrMetallicRoughness.roughnessFactor=f.getRoughnessFactor()),f.getMetallicFactor()!==1&&(g.pbrMetallicRoughness.metallicFactor=f.getMetallicFactor()),f.getBaseColorTexture()){const x=f.getBaseColorTexture(),E=f.getBaseColorTextureInfo();g.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(x,E)}if(f.getEmissiveTexture()){const x=f.getEmissiveTexture(),E=f.getEmissiveTextureInfo();g.emissiveTexture=o.createTextureInfoDef(x,E)}if(f.getNormalTexture()){const x=f.getNormalTexture(),E=f.getNormalTextureInfo(),b=o.createTextureInfoDef(x,E);f.getNormalScale()!==1&&(b.scale=f.getNormalScale()),g.normalTexture=b}if(f.getOcclusionTexture()){const x=f.getOcclusionTexture(),E=f.getOcclusionTextureInfo(),b=o.createTextureInfoDef(x,E);f.getOcclusionStrength()!==1&&(b.strength=f.getOcclusionStrength()),g.occlusionTexture=b}if(f.getMetallicRoughnessTexture()){const x=f.getMetallicRoughnessTexture(),E=f.getMetallicRoughnessTextureInfo();g.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(x,E)}return o.materialIndexMap.set(f,w),g}),m.filter(f=>f.prewriteTypes.includes(H.MESH)).forEach(f=>f.prewrite(o,H.MESH)),i.meshes=r.listMeshes().map((f,w)=>{const g=o.createPropertyDef(f);let x=null;return g.primitives=f.listPrimitives().map(E=>{const b={attributes:{}};b.mode=E.getMode();const c=E.getMaterial();c&&(b.material=o.materialIndexMap.get(c)),Object.keys(E.getExtras()).length&&(b.extras=E.getExtras());const h=E.getIndices();h&&(b.indices=o.accessorIndexMap.get(h));for(const y of E.listSemantics())b.attributes[y]=o.accessorIndexMap.get(E.getAttribute(y));for(const y of E.listTargets()){const v={};for(const C of y.listSemantics())v[C]=o.accessorIndexMap.get(y.getAttribute(C));b.targets=b.targets||[],b.targets.push(v)}return E.listTargets().length&&!x&&(x=E.listTargets().map(y=>y.getName())),b}),f.getWeights().length&&(g.weights=f.getWeights()),x&&(g.extras=g.extras||{},g.extras.targetNames=x),o.meshIndexMap.set(f,w),g}),i.cameras=r.listCameras().map((f,w)=>{const g=o.createPropertyDef(f);if(g.type=f.getType(),g.type===At.Type.PERSPECTIVE){g.perspective={znear:f.getZNear(),zfar:f.getZFar(),yfov:f.getYFov()};const x=f.getAspectRatio();x!==null&&(g.perspective.aspectRatio=x)}else g.orthographic={znear:f.getZNear(),zfar:f.getZFar(),xmag:f.getXMag(),ymag:f.getYMag()};return o.cameraIndexMap.set(f,w),g}),i.nodes=r.listNodes().map((f,w)=>{const g=o.createPropertyDef(f);return me.eq(f.getTranslation(),[0,0,0])||(g.translation=f.getTranslation()),me.eq(f.getRotation(),[0,0,0,1])||(g.rotation=f.getRotation()),me.eq(f.getScale(),[1,1,1])||(g.scale=f.getScale()),f.getWeights().length&&(g.weights=f.getWeights()),o.nodeIndexMap.set(f,w),g}),i.skins=r.listSkins().map((f,w)=>{const g=o.createPropertyDef(f),x=f.getInverseBindMatrices();x&&(g.inverseBindMatrices=o.accessorIndexMap.get(x));const E=f.getSkeleton();return E&&(g.skeleton=o.nodeIndexMap.get(E)),g.joints=f.listJoints().map(b=>o.nodeIndexMap.get(b)),o.skinIndexMap.set(f,w),g}),r.listNodes().forEach((f,w)=>{const g=i.nodes[w],x=f.getMesh();x&&(g.mesh=o.meshIndexMap.get(x));const E=f.getCamera();E&&(g.camera=o.cameraIndexMap.get(E));const b=f.getSkin();b&&(g.skin=o.skinIndexMap.get(b)),f.listChildren().length>0&&(g.children=f.listChildren().map(c=>o.nodeIndexMap.get(c)))}),i.animations=r.listAnimations().map((f,w)=>{const g=o.createPropertyDef(f),x=new Map;return g.samplers=f.listSamplers().map((E,b)=>{const c=o.createPropertyDef(E);return c.input=o.accessorIndexMap.get(E.getInput()),c.output=o.accessorIndexMap.get(E.getOutput()),c.interpolation=E.getInterpolation(),x.set(E,b),c}),g.channels=f.listChannels().map(E=>{const b=o.createPropertyDef(E);return b.sampler=x.get(E.getSampler()),b.target={node:o.nodeIndexMap.get(E.getTargetNode()),path:E.getTargetPath()},b}),o.animationIndexMap.set(f,w),g}),i.scenes=r.listScenes().map((f,w)=>{const g=o.createPropertyDef(f);return g.nodes=f.listChildren().map(x=>o.nodeIndexMap.get(x)),o.sceneIndexMap.set(f,w),g});const R=r.getDefaultScene();return R&&(i.scene=r.listScenes().indexOf(R)),i.extensionsUsed=m.map(f=>f.extensionName),i.extensionsRequired=d.map(f=>f.extensionName),m.forEach(f=>f.write(o)),Au(i),a}}function Au(t){const e=[];for(const n in t){const s=t[n];(Array.isArray(s)&&s.length===0||s===null||s===""||s&&typeof s=="object"&&Object.keys(s).length===0)&&e.push(n)}for(const n of e)delete t[n]}var Gn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Gn||(Gn={}));class _u{constructor(){this._logger=ze.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=Hn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const n of e)this._extensions.add(n),n.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const n=await this.readURI(e,"view");this.lastReadBytes=n.byteLength;const s=Ms(n)?this._binaryToJSON(n):{json:JSON.parse(re.decodeText(n)),resources:{}};return await this._readResourcesExternal(s,this.dirname(e)),this._readResourcesInternal(s),s}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Su.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const n=this._binaryToJSON(re.assertView(e));this._readResourcesInternal(n);const s=n.json;if(s.buffers&&s.buffers.some(r=>ju(n,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(r=>Fu(n,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return n}async readBinary(e){return this.readJSON(await this.binaryToJSON(re.assertView(e)))}async writeJSON(e,n={}){if(n.format===st.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Pu.write(e,{format:n.format||st.GLTF,basename:n.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:Oe({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:n,resources:s}=await this.writeJSON(e,{format:st.GLB}),r=new Uint32Array([1179937895,2,12]),i=JSON.stringify(n),a=re.pad(re.encodeText(i),32),o=re.toView(new Uint32Array([a.byteLength,1313821514])),u=re.concat([o,a]);r[r.length-1]+=u.byteLength;const p=Object.values(s)[0];if(!p||!p.byteLength)return re.concat([re.toView(r),u]);const m=re.pad(p,0),d=re.toView(new Uint32Array([m.byteLength,5130562])),S=re.concat([d,m]);return r[r.length-1]+=S.byteLength,re.concat([re.toView(r),u,S])}async _readResourcesExternal(e,n){var s=this;const r=e.json.images||[],i=e.json.buffers||[],a=[...r,...i].map(async function(o){const u=o.uri;if(!u||u.match(/data:/))return Promise.resolve();e.resources[u]=await s.readURI(s.resolve(n,u),"view"),s.lastReadBytes+=e.resources[u].byteLength});await Promise.all(a)}_readResourcesInternal(e){function n(i){if(i.uri){if(i.uri in e.resources){re.assertView(e.resources[i.uri]);return}if(i.uri.match(/data:/)){const a=`__${mu()}.${Nt.extension(i.uri)}`;e.resources[a]=re.createBufferFromDataURI(i.uri),i.uri=a}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");n(i)}),(e.json.buffers||[]).forEach(n)}_copyJSON(e){const{images:n,buffers:s}=e.json;return e={json:Oe({},e.json),resources:Oe({},e.resources)},n&&(e.json.images=n.map(r=>Oe({},r))),s&&(e.json.buffers=s.map(r=>Oe({},r))),e}_binaryToJSON(e){if(!Ms(e))throw new Error("Invalid glTF 2.0 binary.");const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==Gn.JSON)throw new Error("Missing required GLB JSON chunk.");const s=20,r=n[0],i=re.decodeText(re.toView(e,s,r)),a=JSON.parse(i),o=s+r;if(e.byteLength<=o)return{json:a,resources:{}};const u=new Uint32Array(e.buffer,e.byteOffset+o,2);if(u[1]!==Gn.BIN)return{json:a,resources:{}};const p=u[0],m=re.toView(e,o+8,p);return{json:a,resources:{[zn]:m}}}}function ju(t,e){return e.uri!==void 0&&!(e.uri in t.resources)}function Fu(t,e){return e.uri!==void 0&&!(e.uri in t.resources)&&e.bufferView===void 0}function Ms(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Lu extends _u{constructor(e=null,n=We.DEFAULT_INIT){super(),this._fetch=void 0,this._fetchConfig=void 0,this._init=void 0,this._fetchEnabled=!1,this._fetch=e,this._fetchConfig=n,this._init=this.init()}async init(){return this._init?this._init:Promise.all([Br(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),Br(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])]).then(([e,n])=>{this._fs=e.promises,this._path=n})}setAllowNetwork(e){if(e&&!this._fetch)throw new Error("NodeIO requires a Fetch API implementation for HTTP requests.");return this._fetchEnabled=e,this}async readURI(e,n){if(await this.init(),We.isAbsoluteURL(e)){if(!this._fetchEnabled||!this._fetch)throw new Error("Network request blocked. Allow HTTP requests explicitly, if needed.");const s=await this._fetch(e,this._fetchConfig);switch(n){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}else switch(n){case"view":return this._fs.readFile(e);case"text":return this._fs.readFile(e,"utf8")}}resolve(e,n){return We.isAbsoluteURL(e)||We.isAbsoluteURL(n)?We.resolve(e,n):this._path.resolve(e,decodeURIComponent(n))}dirname(e){return We.isAbsoluteURL(e)?We.dirname(e):this._path.dirname(e)}async write(e,n){await this.init(),await(!!e.match(/\.glb$/)?this._writeGLB(e,n):this._writeGLTF(e,n))}async _writeGLTF(e,n){var s=this;this.lastWriteBytes=0;const{json:r,resources:i}=await this.writeJSON(n,{format:st.GLTF,basename:Nt.basename(e)}),{_fs:a,_path:o}=this,u=o.dirname(e),p=JSON.stringify(r,null,2);await a.writeFile(e,p),this.lastWriteBytes+=p.length;for(const m of ku(Object.keys(i),10))await Promise.all(m.map(async function(d){if(We.isAbsoluteURL(d)){if(We.extension(d)==="bin")throw new Error(`Cannot write buffer to path "${d}".`);return}const S=o.join(u,decodeURIComponent(d));await a.mkdir(o.dirname(S),{recursive:!0}),await a.writeFile(S,i[d]),s.lastWriteBytes+=i[d].byteLength}))}async _writeGLB(e,n){const s=await this.writeBinary(n);await this._fs.writeFile(e,s),this.lastWriteBytes=s.byteLength}}function ku(t,e){const n=[];for(let s=0,r=t.length;s<r;s+=e){const i=[];for(let a=0;a<e&&s+a<r;a++)i.push(t[s+a]);n.push(i)}return n}const $u=[79/255,209/255,197/255,1];function kn(t,e=1){let n=t.replace(/^#/,"");n.length===3?n=n.split("").map(o=>o+o).join(""):n.length===4&&(n=n.split("").map(o=>o+o).join(""));let s=0,r=0,i=0,a=e;if(n.length===6)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255;else if(n.length===8)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255,a=parseInt(n.slice(6,8),16)/255;else throw new Error("Invalid hex color format");return[s,r,i,a]}function Du(t,e,{positions:n,indices:s,colors:r}){const i=t.createPrimitive().setMode(xn.Mode.TRIANGLES).setMaterial(t.createMaterial().setDoubleSided(!0).setAlphaMode(e[3]<1?"BLEND":"OPAQUE").setMetallicFactor(0).setRoughnessFactor(.8).setBaseColorFactor(e)).setAttribute("POSITION",t.createAccessor().setType(q.Type.VEC3).setArray(n)).setIndices(t.createAccessor().setType(q.Type.SCALAR).setArray(s));return r&&i.setAttribute("COLOR_0",t.createAccessor().setType(q.Type.VEC3).setArray(r)),i}function Uu(t){const e=new Float32Array(t.vertices.length*3),n=new Uint32Array(t.faces.length*3),s=new Map;let r=0;const i=a=>{let o=s.get(a);if(o===void 0){const u=r*3,p=t.vertices[a];e[u]=p.x,e[u+1]=p.y,e[u+2]=p.z,o=r++,s.set(a,o)}return o};return t.faces.forEach((a,o)=>{const{vertices:u}=a;if(u.length<3)throw new Error("Face must have at least 3 vertices");const p=o*3;n[p]=i(u[0]),n[p+1]=i(u[1]),n[p+2]=i(u[2])}),{positions:e.slice(0,r*3),indices:n}}async function Bu(t,e=!1){const n=[[.615686274509804,.796078431372549,.3176470588235294,1],[.9764705882352941,.8431372549019608,.17254901960784313,1]],s=e?[kn("#322"),kn("#222")]:[kn("#efdfdf"),kn("#fff")],r=t.colors.map(m=>{for(let d=0;d<n.length;++d)if(m.length===4&&Math.abs(m[0]-n[d][0])<1e-6&&Math.abs(m[1]-n[d][1])<1e-6&&Math.abs(m[2]-n[d][2])<1e-6&&Math.abs(m[3]-n[d][3])<1e-6)return s[d];return m}),i=new Vt;i.createBuffer();const a=i.createScene(),o=i.createMesh(),u=new Map;t.faces.forEach(m=>{let d=u.get(m.colorIndex);d||u.set(m.colorIndex,d=[]),d.push(m)});for(const[m,d]of u.entries()){const S=r[m];o.addPrimitive(Du(i,S,Uu({vertices:t.vertices,faces:d})))}a.addChild(i.createNode().setMesh(o));const p=await new Lu().writeBinary(i);return new Blob([p],{type:"model/gltf-binary"})}const Ns=`
/* [Meta] */
title = "OpenSCAD Demo";
show_text = true;
debug = true;

/* [Plate Settings] */
// Plate size (mm)
plate_size = 40;          // [20:1:80]
// Plate thickness
thickness  = 6;           // [2:0.5:20]
// Corner rounding
fillet     = 3;           // [0:0.5:10]

/* [Holes] */
// Number of holes
hole_count   = 6;         // [0:1:12]
// Hole diameter
hole_d       = 4;         // [2:0.5:10]
// Hole pattern
hole_pattern = "circle";  // ["circle", "grid"]

/* [Quality] */
$fs = $preview ? 1   : 0.2;
$fa = $preview ? 15  : 5;


/* ---------- Helpers ---------- */

module label(txt) {
    if (show_text)
        color("pink")
            translate([0, -plate_size/2 - 8, thickness])
                linear_extrude(1)
                    text(txt, size=6, halign="center");
}


/* ---------- Geometry ---------- */

module holes_2d() {
    if (hole_pattern == "circle")
        for (i = [0 : hole_count - 1])
            rotate(360 / hole_count * i)
                translate([plate_size / 3, 0])
                    circle(d = hole_d);
    else
        for (x = [-1, 0, 1], y = [-1, 0, 1])
            translate([x * plate_size / 4, y * plate_size / 4])
                circle(d = hole_d);
}

module plate_2d() {
    difference() {
        offset(r = fillet)
            square(plate_size - 2 * fillet, center = true);
        holes_2d();
    }
}


/* ---------- Output ---------- */

color("steelblue")
difference() {
    linear_extrude(thickness)
        plate_2d();

    // Debug cutaway
    if (debug)
        translate([0, 0, thickness/2])
            cube([plate_size, plate_size/2, thickness+1], center=true);
}

label(title);

`;function Ps(t){const e=t.split(`
`).map(m=>m.trim()).filter(m=>m.length>0&&!m.startsWith("#"));if(e.length===0)throw new Error("Empty OFF file");let n,s=0;if(e[0].match(/^OFF(\s|$)/))n=e[0].substring(3).trim(),s=1;else if(e[s]==="OFF"&&e.length>1)n=e[1],s=2;else throw new Error("Invalid OFF file: missing OFF header");const[r,i]=n.split(/\s+/).map(Number);if(isNaN(r)||isNaN(i))throw new Error("Invalid OFF file: invalid vertex or face counts");if(s+r+i>e.length)throw new Error("Invalid OFF file: not enough lines");const a=[];for(let m=0;m<r;m++){const d=e[s+m].split(/\s+/).map(Number);if(d.length<3||d.some(isNaN))throw new Error(`Invalid OFF file: invalid vertex at line ${s+m+1}`);a.push({x:d[0],y:d[1],z:d[2]})}s+=r;const o=[],u=new Map,p=[];for(let m=0;m<i;m++){const d=e[s+m].split(/\s+/).map(Number),S=d[0],P=d.slice(1,S+1),N=d.length>=S+4?d.slice(S+1,S+5).map(f=>f/255):$u;if(P.length<3)throw new Error(`Invalid OFF file: face at line ${s+m+1} must have at least 3 vertices`);const O=N?N.join(","):"";let R=u.get(O);if(R==null){R=o.length;const[f,w,g,x]=N;o.push([f,w,g,x??1]),u.set(O,R)}if(P.length==3)p.push({vertices:P,colorIndex:R});else for(let f=1;f<P.length-1;f++)p.push({vertices:[P[0],P[f],P[f+1]],colorIndex:R})}return{vertices:a,faces:p,colors:o}}function Vu(t,e,n){const s=e.x-t.x,r=e.y-t.y,i=e.z-t.z,a=n.x-t.x,o=n.y-t.y,u=n.z-t.z;return{x:r*u-i*o,y:i*a-s*u,z:s*o-r*a}}async function zu(t){let e=`solid polyhedron
`;for(const n of t.faces){const[s,r,i]=n.vertices,a=t.vertices[s],o=t.vertices[r],u=t.vertices[i],p=Vu(a,o,u);e+=`  facet normal ${p.x} ${p.y} ${p.z}
`,e+=`    outer loop
`,e+=`      vertex ${a.x} ${a.y} ${a.z}
`,e+=`      vertex ${o.x} ${o.y} ${o.z}
`,e+=`      vertex ${u.x} ${u.y} ${u.z}
`,e+=`    endloop
`,e+=`  endfacet
`}return e+=`endsolid polyhedron
`,new Blob([e],{type:"model/stl"})}const Hu="editor-page-container_EditorPage",Ku="sidebar_EditorPage",Gu="main_EditorPage",Wu="main-sub_EditorPage",Yu="panel-editor_EditorPage",qu="panel-logs_EditorPage",Ju="model-viewer-container_EditorPage",Xu="model-viewer_EditorPage",lt={editorPageContainer:Hu,sidebar:Ku,main:Gu,mainSub:Wu,panelEditor:Yu,panelLogs:qu,modelViewerContainer:Ju,modelViewer:Xu};function uf({viewModelId:t}){const{modelId:e}=eo();e&&(t=e);const{user:n}=js(),s=ro("readonly")!==null,[r,i]=l.useState(void 0),[a,o]=l.useState(void 0),u=t??"new",[p,m]=l.useState(void 0),[d,S]=l.useState(void 0),[P,N]=l.useState(void 0),[O,R]=l.useState(void 0),[f,w]=l.useState(void 0),[g,x]=l.useState(void 0),[E,b]=l.useState(!1),[c,h]=l.useState(!1),[y,v]=l.useState(!0),[C,F]=l.useState(!1),[L,D]=l.useState(void 0),[_,B]=l.useState(void 0),[T,M]=l.useState({}),[V,z]=l.useState(!1),[K,ee]=l.useState(null),[be,pe]=l.useState(t!==void 0?0:1),X=l.useRef(null),te=l.useRef(null),je=l.useRef(!1),[qe,Ne]=l.useState(0),ie=l.useCallback(()=>`/src/${u}/index.scad`,[u]),Ee=l.useCallback(async k=>{try{const U=ie();if(u=="new")sr(U,Ns,!1);else if(!xt(U)&&k!==void 0)sr(U,k.source_code,!0);else if(k!==void 0){const Z=wn(U);await so(Z)!=k.source_code_hash&&F(!0)}}catch(U){console.error(U)}},[u,ie]),we=l.useCallback(async()=>{R("Checking Syntax...");try{const k=ie(),U=wn(k),ue=await Mo({activePath:k,sources:[{path:k,content:U}]})({now:!0});ue.parameterSet&&D(ue.parameterSet),ue.markers&&B(ue.markers)}catch(k){w(k?.message||String(k))}finally{R(void 0)}},[]),Pe=k=>async()=>{R(k?"Previewing...":"Rendering..."),w(void 0),x(void 0);try{const U=ie();let Z=wn(U);const ge=await Po({scadPath:U,sources:[{path:U,content:Z}],vars:T,isPreview:k,mountArchives:!0,renderFormat:"off",streamsCallback:_e=>{"stderr"in _e&&x(Q=>(Q?Q+`
`:"")+_e.stderr),"stdout"in _e&&x(Q=>(Q?Q+`
`:"")+_e.stdout)}})({now:!0});d&&URL.revokeObjectURL(d),S(URL.createObjectURL(ge.outFile));let Ke;try{const _e=Ps(await ge.outFile.text());Ke=new File([await Bu(_e)],ge.outFile.name.replace(".off",".glb"))}catch(_e){w("Failed to convert OFF to GLB: "+_e),R(void 0);return}p&&URL.revokeObjectURL(p),m(URL.createObjectURL(Ke))}catch(U){w(U?.message||String(U))}finally{R(void 0)}},Ie=l.useCallback(Pe(!0),[T]),ye=l.useCallback(Pe(!1),[T]),He=async()=>{if(!te.current)return;const k=await te.current.getWebpScreenshot();if(!k){w("Failed to capture screenshot for publish.");return}ee(k),z(!0)},De=async()=>{if(!(!n||!K||!a)){z(!1),X.current?.show({severity:"info",summary:"Uploading...",life:5e3});try{const U=await(await fetch(K)).blob(),Z=new File([U],`${Date.now()}.webp`,{type:"image/webp"}),ue=wn(ie());await en.uploadModel(Z,ue,a),X.current?.clear(),X.current?.show({severity:"success",summary:"Published",detail:"Model published successfully!",life:3e3})}catch(k){X.current?.clear(),X.current?.show({severity:"error",summary:"Publish Failed",detail:k.message||String(k),life:4e3})}finally{z(!1),ee(null)}}},Ae=()=>{z(!1),ee(null)},ot=async()=>{let k=Ns;const U=ie();if(u!=="new"&&(k=await en.fetchModelSource(u),k===void 0))throw new Error("Failed to fetch model source");sr(U,k,!0),Ne(Z=>Z+1)},Je=l.useCallback(async()=>{if(console.debug("Fetching model details...",t),t){const k=await en.fetchModelById(t);return i(k),o({id:k?.id,title:k?.title??"Untitled Model",description:k?.description??""}),k}else{o({id:void 0,title:"Untitled Model",description:""});return}},[]);l.useEffect(()=>(je.current||(je.current=!0,(async()=>{const k=await Je();await lo(!0),await Ee(k),await Promise.all([we(),Ie()]),v(!1)})()),()=>{p&&URL.revokeObjectURL(p),d&&URL.revokeObjectURL(d),P&&URL.revokeObjectURL(P)}),[we,Je,Ee,Ie]);function Xe(k,U){const Z=document.createElement("a");Z.href=k,Z.download=U,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z)}const Ce=l.useCallback(async()=>{try{if(P&&URL.revokeObjectURL(P),!d)throw new Error("No OFF file to convert");const k=await(await fetch(d)).text(),U=Ps(k),Z=await zu(U),ue=rt()+".stl",he=URL.createObjectURL(Z);Xe(he,ue),setTimeout(()=>URL.revokeObjectURL(he),1e3),N(void 0)}catch(k){console.error(k)}},[d]);l.useEffect(()=>{const k=U=>{U.key==="F4"?(U.preventDefault(),we()):U.key==="F5"?(U.preventDefault(),Ie()):U.key==="F6"?(U.preventDefault(),ye()):U.key==="F7"?(U.preventDefault(),Ce()):U.key==="F8"&&(U.preventDefault(),He())};return window.addEventListener("keydown",k),()=>{window.removeEventListener("keydown",k)}},[d]);function rt(){return r?.title??a?.title??"Untitled Model"}function ce(){return F(!0),we()}const $=!s&&(r===void 0||r?.owner_id===n?.id)&&a!==void 0;return j.jsxs(j.Fragment,{children:[j.jsxs("div",{className:lt.editorPageContainer,style:{flexDirection:E?"column":void 0},children:[j.jsxs("div",{className:lt.sidebar,children:[j.jsxs("div",{className:lt.modelViewerContainer,children:[j.jsx("div",{className:lt.modelViewer,children:p?j.jsx(ia,{ref:te,lightMode:c,style:{width:"100%",height:"100%"},modelUri:p}):j.jsx(Bt,{text:"Waiting for model to render"})}),j.jsx(Vr,{model:[E?{label:"Smaller Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-minimize",command:()=>b(!1)}:{label:"Larger Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-maximize",command:()=>b(!0)},c?{label:"Dark Mode",icon:"pi pi-moon",command:()=>h(!1)}:{label:"Light Mode",icon:"pi pi-sun",command:()=>h(!0)},{label:"Reset View",icon:"pi pi-refresh",command:()=>{te.current?.resetView()}},{label:"Download",icon:"pi pi-download",items:[{label:"GLB",icon:"pi pi-download",disabled:!p,command:()=>{p&&Xe(p,rt()+".glb")}},{label:"OFF",icon:"pi pi-download",disabled:!d,command:()=>{d&&Xe(d,rt()+".off")}},{label:"STL (F7)",icon:"pi pi-download",disabled:!d,command:Ce}]}]})]}),$?j.jsx(wt,{children:j.jsxs("div",{style:{display:"grid",gridTemplateColumns:"max-content 1fr",gap:12,alignItems:"center",marginBottom:8},children:[j.jsx("label",{htmlFor:"edit-title",style:{whiteSpace:"nowrap"},children:j.jsx("b",{children:"Title"})}),j.jsx(_s,{id:"edit-title",maxLength:100,value:a.title,onChange:k=>o(U=>({...U,title:k.target.value})),placeholder:"Enter model title"}),j.jsx("label",{htmlFor:"edit-description",style:{whiteSpace:"nowrap"},children:j.jsx("b",{children:"Description"})}),j.jsx($r,{id:"edit-description",maxLength:2e3,value:a.description,onChange:k=>o(U=>({...U,description:k.target.value})),placeholder:"Enter model description",style:{resize:"vertical"}})]})}):r!==void 0?j.jsx(wt,{toggleable:!0,header:r.title,children:j.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[j.jsx("div",{dangerouslySetInnerHTML:{__html:ks(r.description)}}),j.jsxs("span",{children:["by ",j.jsx("a",{href:"#/user/"+r.username,children:r.username})," on"," ",r.created_at]}),j.jsx("span",{children:j.jsx(go,{model:r})})]})}):j.jsx(j.Fragment,{}),r?j.jsx(sl,{modelId:r?.id}):""]}),j.jsxs("div",{className:lt.main,children:[j.jsxs("div",{className:lt.mainSub,children:[j.jsx(wt,{toggleable:!0,header:"Customizer",children:j.jsx(Ya,{parameterSet:L,parameterValues:T,onChange:(k,U)=>M(Z=>({...Z,[k]:U}))})}),j.jsxs(wt,{className:lt.panelLogs,toggleable:!0,header:"Logs & Errors",children:[f&&j.jsx("pre",{style:{color:"var(--color-danger)"},children:f}),g&&j.jsx("pre",{children:g}),!f&&!g&&j.jsx("pre",{children:"No logs or errors yet."})]})]}),j.jsxs(wt,{className:lt.panelEditor,children:[j.jsx(Vr,{style:{width:"100%"},model:[{label:"Preview (F5)",icon:"pi pi-play",command:Ie,disabled:O!==void 0},{label:"Render (F6)",icon:"pi pi-play",command:ye,disabled:O!==void 0},{label:"Publish (F8)",icon:"pi pi-upload",command:He,disabled:O!==void 0||n?.id===void 0,visible:r===void 0||r?.owner_id===n?.id},{label:"Overwrite with remote source",icon:"pi pi-download color-danger",command:ot,disabled:O!==void 0,visible:C}],end:j.jsx("div",{style:{display:"flex",gap:8},children:O!==void 0&&j.jsxs(j.Fragment,{children:[j.jsx("div",{style:{flex:1,alignContent:"center"},children:O}),j.jsx(to,{style:{width:40,height:40},strokeWidth:"8"})]})})}),j.jsx(Qc,{isInitializing:y,path:ie(),homeFileProp:ie(),hideTopBar:!0,markers:_,onSave:k=>ce(),reloadKey:qe})]})]})]}),j.jsx(vo,{header:"Publish Model",visible:V,onHide:Ae,footer:j.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[j.jsx(sn,{label:"Cancel",icon:"pi pi-times",onClick:Ae,className:"p-button-text"}),j.jsx(sn,{label:"Publish",icon:"pi pi-upload",onClick:De,autoFocus:!0})]}),closable:!1,modal:!0,children:a!==void 0&&j.jsx(yo,{model:{id:"",title:a.title,preview_url:K??"",owner_id:n?.id||"",username:n?.user_metadata?.user_name||n?.user_metadata?.name||n?.email||"Unknown User",description:a.description,created_at:ur(new Date),updated_at:ur(new Date),likes:0,comments:0}})}),j.jsx(kr,{ref:X,position:"top-right"})]})}export{uf as default};
