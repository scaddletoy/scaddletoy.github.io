import{r as l,j as _,T as us,C as Dt,u as it,P as ot,a as Rt,b as It,c as fn,U as zn,d as ue,e as Vn,R as Hn,I as tt,D as Z,O as oe,f as At,g as yr,h as xi,i as gn,k as fs,K as Xn,l as ds,m as Ft,n as Ei,o as ps,p as hs,Z as jt,q as Ge,s as wi,t as Er,v as Si,w as gs,x as Ti,y as Ri,E as Ii,_ as wr,z as Oi,A as Ci,M as Sr,B as Mi}from"../index.js";import{s as ms}from"./openscad-runner-CarBj6qw.js";import{SupabaseService as _n}from"./SupabaseService-CnFb_Wi5.js";import{M as ys,j as Zn,T as Pi,w as An,e as gt,r as Qn,s as Tr,m as Rr,a as Ir,u as Or,b as Ai,f as Ni,c as mn,d as _i}from"./tree.esm-DIlyOHl9.js";import{s as vs,f as sr,a as Fi,m as Cr,g as ji,h as Li,l as ki}from"./utils-CKaYmvp5.js";import{D as Mr,I as Pr,O as bs}from"./dropdown.esm-CoEZyfAG.js";import{P as xs}from"./index.esm-BEZXvJxF.js";import{B as tn}from"./button.esm-iOg5UvVS.js";import{z as $i}from"./index.esm-CgPSL6hs.js";import{C as Di,S as Ui}from"./index.esm-BHvanpNW.js";import{M as Bi,a as zi}from"./ModelCard-DbVTjNbq.js";import{D as Vi}from"./dialog.esm-DA0i4VJI.js";const Hi=new Set(["Could not initialize localization."]),Es=(t,e)=>({logText:Ki(t),markers:Gi(t,e)});function Ki(t,e){const n=[];for(const{stderr:s,stdout:r,error:i}of t){const a=s??r??`EXCEPTION: ${i}`;Hi.has(a)||n.push(a)}return n.join(`
`)}function Gi(t,e){let n=[];const s=[];let r=0,i=0;const a=(p,h,d)=>{s.push({startLineNumber:Number(d),startColumn:1,endLineNumber:Number(d),endColumn:1e3,message:p,severity:8})},o=e.shiftSourceLines&&e.shiftSourceLines.sourcePath,f=(p,h)=>{const d=Number(h);return o&&p.endsWith(o)?d-e.shiftSourceLines.skipLines:d};for(const{stderr:p,stdout:h,error:d}of t){if(p){p.startsWith("ERROR:")&&i++,p.startsWith("WARNING:")&&r++;let x=/^ERROR: Parser error in file "([^"]+)", line (\d+): (.*)$/.exec(p);if(x){const[C,j,M,S]=x;a(S,j,f(j,M));continue}if(x=/^ERROR: Parser error: (.*?) in file ([^",]+), line (\d+)$/.exec(p),x){const[C,j,M,S]=x;a(j,M,f(M,S));continue}if(x=/^WARNING: (.*?),? in file ([^,]+), line (\d+)\.?/.exec(p),x){const[C,j,M,S]=x;s.push({startLineNumber:f(M,S),startColumn:1,endLineNumber:f(M,S),endColumn:1e3,message:j,severity:4});continue}}n.push(p??h??`EXCEPTION: ${d}`)}return(i||r)&&(n=[`${i} errors, ${r} warnings!`,"",...n]),s}async function Wi(t){const{sources:e}=t,n=ms({taskName:"checkSyntax",mountArchives:!0,files:e,isPreview:!1,exportFormat:"param"},()=>{});try{const s=await n;let r;if(s.outputs&&s.outputs.length==1){const[[,i]]=s.outputs;try{r=JSON.parse(i)}catch(a){console.error(`Error while parsing parameter set: ${a}
${i}`)}}else console.error("No output from runner!");return{...Es(s.mergedOutputs,{}),parameterSet:r}}catch(s){throw console.error(s),s}}async function qi(t){const{scadPath:e,sources:n,isPreview:s,mountArchives:r,vars:i,features:a,extraArgs:o,renderFormat:f,streamsCallback:p}=t;if(!e.endsWith(".scad"))throw new Error("First source must be a .scad file, got "+n[0].path+" instead");const h=n.filter(x=>x.path===e)[0];if(!h)throw new Error("Active path not found in sources!");const d=ms({taskName:s?"preview":"render",mountArchives:r,files:n.map(x=>x.path===e?{path:x.path,content:x.content}:x),isPreview:s,exportFormat:f=="stl"?"binstl":f,vars:i,features:a,extraArgs:o},p);try{const x=await d,{logText:C,markers:j}=Es(x.mergedOutputs,{shiftSourceLines:{sourcePath:h.path,skipLines:s?1:0}});if(x.error)throw x.error;const[M]=x.outputs??[];if(!M)throw new Error("No output from runner!");const[S,u]=M,T=S.split("/"),m=T[T.length-1],w=S.endsWith(".svg")?"image/svg+xml":"application/octet-stream",y=new Blob([u]);return{outFile:new File([y],m,{type:w}),logText:C,markers:j,elapsedMillis:x.elapsedMillis}}catch(x){throw console.error(x),x}}var ws=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Jt=t=>{let e=0;for(let n=0;n<t.length;n++){let s=t[n],r=ws.indexOf(s);e=e*83+r}return e},Kt=(t,e)=>{var n="";for(let s=1;s<=e;s++){let r=Math.floor(t)/Math.pow(83,e-s)%83;n+=ws[Math.floor(r)]}return n},Lt=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},kt=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},Yi=t=>t<0?-1:1,$t=(t,e)=>Yi(t)*Math.pow(Math.abs(t),e),Fn=class extends Error{constructor(t){super(t),this.name="ValidationError",this.message=t}},Ji=t=>{if(!t||t.length<6)throw new Fn("The blurhash string must be at least 6 characters");let e=Jt(t[0]),n=Math.floor(e/9)+1,s=e%9+1;if(t.length!==4+2*s*n)throw new Fn(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*s*n}`)},Xi=t=>{let e=t>>16,n=t>>8&255,s=t&255;return[Lt(e),Lt(n),Lt(s)]},Zi=(t,e)=>{let n=Math.floor(t/361),s=Math.floor(t/19)%19,r=t%19;return[$t((n-9)/9,2)*e,$t((s-9)/9,2)*e,$t((r-9)/9,2)*e]},Qi=(t,e,n,s)=>{Ji(t),s=s|1;let r=Jt(t[0]),i=Math.floor(r/9)+1,a=r%9+1,o=(Jt(t[1])+1)/166,f=new Array(a*i);for(let d=0;d<f.length;d++)if(d===0){let x=Jt(t.substring(2,6));f[d]=Xi(x)}else{let x=Jt(t.substring(4+d*2,6+d*2));f[d]=Zi(x,o*s)}let p=e*4,h=new Uint8ClampedArray(p*n);for(let d=0;d<n;d++)for(let x=0;x<e;x++){let C=0,j=0,M=0;for(let m=0;m<i;m++)for(let w=0;w<a;w++){let y=Math.cos(Math.PI*x*w/e)*Math.cos(Math.PI*d*m/n),E=f[w+m*a];C+=E[0]*y,j+=E[1]*y,M+=E[2]*y}let S=kt(C),u=kt(j),T=kt(M);h[4*x+0+d*p]=S,h[4*x+1+d*p]=u,h[4*x+2+d*p]=T,h[4*x+3+d*p]=255}return h},eo=Qi,Ar=4,to=(t,e,n,s)=>{let r=0,i=0,a=0,o=e*Ar;for(let p=0;p<e;p++){let h=Ar*p;for(let d=0;d<n;d++){let x=h+d*o,C=s(p,d);r+=C*Lt(t[x]),i+=C*Lt(t[x+1]),a+=C*Lt(t[x+2])}}let f=1/(e*n);return[r*f,i*f,a*f]},no=t=>{let e=kt(t[0]),n=kt(t[1]),s=kt(t[2]);return(e<<16)+(n<<8)+s},ro=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor($t(t[0]/e,.5)*9+9.5)))),s=Math.floor(Math.max(0,Math.min(18,Math.floor($t(t[1]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor($t(t[2]/e,.5)*9+9.5))));return n*19*19+s*19+r},so=(t,e,n,s,r)=>{if(s<1||s>9||r<1||r>9)throw new Fn("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new Fn("Width and height must match the pixels array");let i=[];for(let d=0;d<r;d++)for(let x=0;x<s;x++){let C=x==0&&d==0?1:2,j=to(t,e,n,(M,S)=>C*Math.cos(Math.PI*x*M/e)*Math.cos(Math.PI*d*S/n));i.push(j)}let a=i[0],o=i.slice(1),f="",p=s-1+(r-1)*9;f+=Kt(p,1);let h;if(o.length>0){let d=Math.max(...o.map(C=>Math.max(...C))),x=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));h=(x+1)/166,f+=Kt(x,1)}else h=1,f+=Kt(0,1);return f+=Kt(no(a),4),o.forEach(d=>{f+=Kt(ro(d,h),2)}),f},io=so;async function oo(t){return new Promise((e,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=(...r)=>n(r),s.src=t})}async function ao(t){const{rgba:e,w:n,h:s}=await co(t,{maxSize:100,opaque:!0}),r=9;return io(new Uint8ClampedArray(e),n,s,r,r)}function lo(t,e,n){const s=eo(t,e,n),r=document.createElement("canvas");r.width=e,r.height=n;const i=r.getContext("2d"),a=i.createImageData(e,n);return a.data.set(s),i.putImageData(a,0,0),r.toDataURL("image/png")}async function co(t,{maxSize:e,opaque:n}){const s=await oo(t),r=s.width,i=s.height,a=Math.min(e/r,e/i),o=Math.floor(r*a),f=Math.floor(i*a),p=document.createElement("canvas");p.width=o,p.height=f;const h=p.getContext("2d");if(!h)throw new Error("Could not get canvas context");h.fillStyle="white",h.fillRect(0,0,o,f),h.drawImage(s,0,0,o,f);const d=h.getImageData(0,0,o,f);return{rgba:new Uint8Array(d.data.buffer),w:o,h:f}}const nn=[["Diagonal",Math.PI/4,Math.PI/4],["Front",0,Math.PI/2],["Right",Math.PI/2,Math.PI/2],["Back",Math.PI,Math.PI/2],["Left",-Math.PI/2,Math.PI/2],["Top",0,0],["Bottom",0,Math.PI]];function ir(t,e){return[Math.cos(t)*Math.sin(e),Math.sin(t)*Math.sin(e),Math.cos(e)]}function Ss(t,e){const n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+s*s+r*r)}const Nr=(t,e)=>Math.min(Math.abs(t-e),Math.abs(t-e+2*Math.PI),Math.abs(t-e-2*Math.PI));function uo(t,e){const n=ir(t,e),r=nn.map(([f,p,h])=>ir(p,h)).map(f=>Ss(n,f)),i=nn.map(([f,p,h])=>Math.max(Nr(t,p),Nr(e,h))),[a,o]=r.reduce((f,p,h)=>p<f[1]?[h,p]:f,[0,1/0]);return[a,o,i[a]]}const yn=(([t,e,n])=>`${e}rad ${n}rad auto`)(nn[0]),fo=l.forwardRef(function(e,n){const[s,r]=l.useState("none"),i=l.useRef(null),a=l.useRef(null),o=l.useRef(null),[f,p]=l.useState(),[h,d]=l.useState(void 0),x=f===e.modelUri;if(e?.preview){let{hash:S,uri:u}=h??{hash:""};e.preview.blurhash&&S!==e.preview.blurhash&&(S=e.preview.blurhash,u=lo(S,100,100),d({hash:S,uri:u}))}else h&&d(void 0);const C=l.useCallback(async S=>{if(p(e.modelUri),!i.current)return;const u=await i.current.toDataURL("image/png",.5);await ao(u)},[e.modelUri,p,i.current]);l.useEffect(()=>{if(!i.current)return;const S=i.current;return S.addEventListener("load",C),()=>S.removeEventListener("load",C)},[i.current,C]);for(const S of[i,a]){const u=S===i?a:i;l.useEffect(()=>{if(!S.current)return;function T(w){if(u.current&&w.detail.source==="user-interaction"){const y=S.current.getCameraOrbit();y.radius=u.current.getCameraOrbit().radius,u.current.cameraOrbit=y.toString()}}const m=S.current;return m.addEventListener("camera-change",T),()=>m.removeEventListener("camera-change",T)},[S.current,u.current])}l.useEffect(()=>{let S;function u(){const y=a.current.getCameraOrbit();return ir(y.theta,y.phi)}function T(y){y.target===a.current&&(S=u())}function m(y){if(y.target===a.current){const g=u();if((S?Ss(g,S):1/0)>.01)return;const b=a.current.getCameraOrbit(),N=i.current.getCameraOrbit(),[F,L,D]=uo(b.theta,b.phi),P=y.button==2?0:L<.01&&D<.1?(F+1)%nn.length:F,[U,R,A]=nn[P];Object.assign(N,{theta:R,phi:A}),i.current.cameraOrbit=a.current.cameraOrbit=N.toString(),r("none"),y.stopPropagation(),y.preventDefault()}}function w(y){y.target===a.current&&y.preventDefault()}return window.addEventListener("mousedown",T),window.addEventListener("mouseup",m),window.addEventListener("contextmenu",w),()=>{window.removeEventListener("mousedown",T),window.removeEventListener("mouseup",m),window.removeEventListener("contextmenu",w)}});async function j(){if(!i.current)return null;const S=await i.current.toDataURL("image/png",1),u=new window.Image;u.src=S,await new Promise(w=>{u.onload=w});const T=document.createElement("canvas");T.width=500,T.height=500;const m=T.getContext("2d");return m?(m.drawImage(u,0,0,500,500),T.toDataURL("image/webp",.9)):null}function M(){!i.current||!a.current||(i.current.cameraOrbit=yn,a.current.cameraOrbit=yn)}return l.useImperativeHandle(n,()=>({getWebpScreenshot:j,resetView:M}),[j,M]),_.jsxs("div",{className:e.className,style:{display:"flex",flexDirection:"column",position:"relative",flex:1,width:"100%",background:e.lightMode?"#eee":"#111",...e.style??{}},children:[_.jsx(us,{ref:o,position:"top-right"}),_.jsx("style",{children:`
          @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 0.7; }
            100% { opacity: 0.4; }
          }
        `}),x?_.jsx(_.Fragment,{}):h?_.jsx("img",{src:h.uri,style:{animation:"pulse 1.5s ease-in-out infinite",position:"absolute",pointerEvents:"none",width:"100%",height:"100%"}}):_.jsx(Dt,{text:"Loading model"}),_.jsx("model-viewer",{orientation:"0deg -90deg 0deg",class:"main-viewer",src:e.modelUri,style:{transition:"opacity 0.5s",position:"absolute",width:"100%",height:"100%"},"camera-orbit":yn,"interaction-prompt":s,"environment-image":"./skybox-lights.jpg",exposure:2,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","camera-controls":!0,ar:!0,ref:i,children:_.jsx("span",{slot:"progress-bar"})}),_.jsx("model-viewer",{orientation:"0deg -90deg 0deg",src:"./axes.glb",style:{position:"absolute",bottom:0,left:0,zIndex:10,height:"100px",width:"100px"},loading:"eager","camera-orbit":yn,"max-camera-orbit":"auto 180deg auto","min-camera-orbit":"auto 0deg auto","orbit-sensitivity":"5","interaction-prompt":"none","camera-controls":"false","disable-zoom":!0,"disable-tap":!0,"disable-pan":!0,ref:a,children:_.jsx("span",{slot:"progress-bar"})})]})});function jn(){return jn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},jn.apply(null,arguments)}function po(t){if(Array.isArray(t))return t}function ho(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function _r(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function go(t,e){if(t){if(typeof t=="string")return _r(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_r(t,e):void 0}}function mo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fr(t,e){return po(t)||ho(t,e)||go(t,e)||mo()}var vn=Rt.extend({defaultProps:{__TYPE:"Fieldset",id:null,legend:null,className:null,style:null,toggleable:null,collapsed:null,collapseIcon:null,transitionOptions:null,expandIcon:null,onExpand:null,onCollapse:null,onToggle:null,onClick:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return ue("p-fieldset p-component",{"p-fieldset-toggleable":n.toggleable})},toggleableContent:"p-toggleable-content",togglericon:"p-fieldset-toggler",legendTitle:"p-fieldset-legend-text",legend:"p-fieldset-legend p-unselectable-text",content:"p-fieldset-content",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-fieldset-legend > a,
            .p-fieldset-legend > span {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .p-fieldset-toggleable .p-fieldset-legend a {
                cursor: pointer;
                user-select: none;
                overflow: hidden;
                position: relative;
                text-decoration: none;
            }
            
            .p-fieldset-legend-text {
                line-height: 1;
            }
        }
        `}}),Ts=l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=vn.getProps(t,s),i=l.useState(r.id),a=Fr(i,2),o=a[0],f=a[1],p=l.useState(r.collapsed),h=Fr(p,2),d=h[0],x=h[1],C=r.toggleable?r.onToggle?r.collapsed:d:!1,j=l.useRef(null),M=l.useRef(null),S=o+"_header",u=o+"_content",T=vn.setMetaData({props:r,state:{id:o,collapsed:C}}),m=T.ptm,w=T.cx,y=T.isUnstyled;It(vn.css.styles,y,{name:"fieldset"});var E=function(A){r.toggleable&&(C?c(A):g(A),r.onToggle&&r.onToggle({originalEvent:A,value:!C})),A.preventDefault()},c=function(A){r.onToggle||x(!1),r.onExpand&&r.onExpand(A)},g=function(A){r.onToggle||x(!0),r.onCollapse&&r.onCollapse(A)};fn(function(){r.id||f(zn())});var v=function(A){(A.code==="Enter"||A.code==="NumpadEnter"||A.code==="Space")&&(E(A),A.preventDefault())},b=function(){var A=n({className:w("content")},m("content")),z=n({ref:M,id:u,role:"region","aria-labelledby":S,className:w("toggleableContent")},m("toggleableContent")),G=n({classNames:w("transition"),timeout:{enter:1e3,exit:450},in:!C,unmountOnExit:!0,options:r.transitionOptions},m("transition"));return l.createElement(Vn,jn({nodeRef:M},G),l.createElement("div",z,l.createElement("div",A,r.children)))},N=function(){if(r.toggleable){var A=n({className:w("togglericon")},m("togglericon")),z=C?r.expandIcon||l.createElement(xs,A):r.collapseIcon||l.createElement(ys,A),G=tt.getJSXIcon(z,A,{props:r});return G}return null},F=function(){var A=n({className:w("legendTitle")},m("legendTitle")),z=n({id:S,role:"button","aria-expanded":!C,"aria-controls":u,onKeyDown:v,onClick:E,"aria-label":r.legend,tabIndex:0},m("toggler"));if(r.toggleable){var G=N();return l.createElement("a",z,G,l.createElement("span",A,r.legend),l.createElement(Hn,null))}return l.createElement("span",jn({},A,{id:S}),r.legend)},L=function(){var A=n({className:w("legend")},m("legend"));if(r.legend!=null||r.toggleable){var z=F();return l.createElement("legend",A,z)}};l.useImperativeHandle(e,function(){return{props:r,getElement:function(){return j.current},getContent:function(){return M.current}}});var D=n({id:o,ref:j,style:r.style,className:ue(r.className,w("root")),onClick:r.onClick},vn.getOtherProps(r),m("root")),P=L(),U=b();return l.createElement("fieldset",D,P,U)});Ts.displayName="Fieldset";function Zt(){return Zt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Zt.apply(null,arguments)}function rn(t){"@babel/helpers - typeof";return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rn(t)}function yo(t,e){if(rn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(rn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vo(t){var e=yo(t,"string");return rn(e)=="symbol"?e:e+""}function bo(t,e,n){return(e=vo(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xo(t){if(Array.isArray(t))return t}function Eo(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function jr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function wo(t,e){if(t){if(typeof t=="string")return jr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jr(t,e):void 0}}function So(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function To(t,e){return xo(t)||Eo(t,e)||wo(t,e)||So()}var Ro={box:"p-checkbox-box",input:"p-checkbox-input",icon:"p-checkbox-icon",root:function(e){var n=e.props,s=e.checked,r=e.context;return ue("p-checkbox p-component",{"p-highlight":s,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled"})}},bn=Rt.extend({defaultProps:{__TYPE:"Checkbox",autoFocus:!1,checked:!1,className:null,disabled:!1,falseValue:!1,icon:null,id:null,inputId:null,inputRef:null,invalid:!1,variant:null,name:null,onChange:null,onContextMenu:null,onMouseDown:null,readOnly:!1,required:!1,style:null,tabIndex:null,tooltip:null,tooltipOptions:null,trueValue:!0,value:null,children:void 0},css:{classes:Ro}});function Lr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function kr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Lr(Object(n),!0).forEach(function(s){bo(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Rs=l.memo(l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=bn.getProps(t,s),i=l.useState(!1),a=To(i,2),o=a[0],f=a[1],p=bn.setMetaData({props:r,state:{focused:o},context:{checked:r.checked===r.trueValue,disabled:r.disabled}}),h=p.ptm,d=p.cx,x=p.isUnstyled;It(bn.css.styles,x,{name:"checkbox"});var C=l.useRef(null),j=l.useRef(r.inputRef),M=function(){return r.checked===r.trueValue},S=function(b){if(!(r.disabled||r.readOnly)&&r.onChange){var N,F=M(),L=F?r.falseValue:r.trueValue,D={originalEvent:b,value:r.value,checked:L,stopPropagation:function(){b?.stopPropagation()},preventDefault:function(){b?.preventDefault()},target:{type:"checkbox",name:r.name,id:r.id,value:r.value,checked:L}};if(r==null||(N=r.onChange)===null||N===void 0||N.call(r,D),b.defaultPrevented)return;Z.focus(j.current)}},u=function(b){var N;f(!0),r==null||(N=r.onFocus)===null||N===void 0||N.call(r,b)},T=function(b){var N;f(!1),r==null||(N=r.onBlur)===null||N===void 0||N.call(r,b)};l.useImperativeHandle(e,function(){return{props:r,focus:function(){return Z.focus(j.current)},getElement:function(){return C.current},getInput:function(){return j.current}}}),l.useEffect(function(){oe.combinedRefs(j,r.inputRef)},[j,r.inputRef]),At(function(){j.current.checked=M()},[r.checked,r.trueValue]),fn(function(){r.autoFocus&&Z.focus(j.current,r.autoFocus)});var m=M(),w=oe.isNotEmpty(r.tooltip),y=bn.getOtherProps(r),E=n({id:r.id,className:ue(r.className,d("root",{checked:m,context:s})),style:r.style,"data-p-highlight":m,"data-p-disabled":r.disabled,onContextMenu:r.onContextMenu,onMouseDown:r.onMouseDown},y,h("root")),c=function(){var b=oe.reduceKeys(y,Z.ARIA_PROPS),N=n(kr({id:r.inputId,type:"checkbox",className:d("input"),name:r.name,tabIndex:r.tabIndex,onFocus:function(L){return u(L)},onBlur:function(L){return T(L)},onChange:function(L){return S(L)},disabled:r.disabled,readOnly:r.readOnly,required:r.required,"aria-invalid":r.invalid,checked:m},b),h("input"));return l.createElement("input",Zt({ref:j},N))},g=function(){var b=n({className:d("icon")},h("icon")),N=n({className:d("box",{checked:m}),"data-p-highlight":m,"data-p-disabled":r.disabled},h("box")),F=m?r.icon||l.createElement(xi,b):null,L=tt.getJSXIcon(F,kr({},b),{props:r,checked:m});return l.createElement("div",N,L)};return l.createElement(l.Fragment,null,l.createElement("div",Zt({ref:C},E),c(),g()),w&&l.createElement(yr,Zt({target:C,content:r.tooltip,pt:h("tooltip")},r.tooltipOptions)))}));Rs.displayName="Checkbox";function or(){return or=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},or.apply(null,arguments)}function sn(t){"@babel/helpers - typeof";return sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sn(t)}function Io(t,e){if(sn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(sn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Oo(t){var e=Io(t,"string");return sn(e)=="symbol"?e:e+""}function Co(t,e,n){return(e=Oo(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ar(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Mo(t){if(Array.isArray(t))return ar(t)}function Po(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Is(t,e){if(t){if(typeof t=="string")return ar(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ar(t,e):void 0}}function Ao(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function No(t){return Mo(t)||Po(t)||Is(t)||Ao()}function _o(t){if(Array.isArray(t))return t}function Fo(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function jo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xn(t,e){return _o(t)||Fo(t,e)||Is(t,e)||jo()}var Lo={handle:function(e){var n=e.index,s=e.handleIndex;return ue("p-slider-handle",{"p-slider-handle-start":n===0,"p-slider-handle-end":n===1,"p-slider-handle-active":s.current===n})},range:"p-slider-range",root:function(e){var n=e.props,s=e.vertical,r=e.horizontal;return ue("p-slider p-component",{"p-disabled":n.disabled,"p-slider-horizontal":r,"p-slider-vertical":s})}},ko=`
@layer primereact {
    .p-slider {
        position: relative;
    }
    
    .p-slider .p-slider-handle {
        position: absolute;
        cursor: grab;
        touch-action: none;
        display: block;
        z-index: 1;
    }
    
    .p-slider .p-slider-handle.p-slider-handle-active {
        z-index: 2;
    }
    
    .p-slider-range {
        position: absolute;
        display: block;
    }
    
    .p-slider-horizontal .p-slider-range {
        top: 0;
        left: 0;
        height: 100%;
    }
    
    .p-slider-horizontal .p-slider-handle {
        top: 50%;
    }
    
    .p-slider-vertical {
        height: 100px;
    }
    
    .p-slider-vertical .p-slider-handle {
        left: 50%;
    }
    
    .p-slider-vertical .p-slider-range {
        bottom: 0;
        left: 0;
        width: 100%;
    }
}
`,$o={handle:{position:"absolute"},range:{position:"absolute"}},Gt=Rt.extend({defaultProps:{__TYPE:"Slider",id:null,value:null,min:0,max:100,orientation:"horizontal",step:null,range:!1,style:null,className:null,disabled:!1,tabIndex:0,onChange:null,onSlideEnd:null,children:void 0},css:{classes:Lo,styles:ko,inlineStyles:$o}});function $r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$r(Object(n),!0).forEach(function(s){Co(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$r(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var Os=l.memo(l.forwardRef(function(t,e){var n,s,r,i=it(),a=l.useContext(ot),o=Gt.getProps(t,a),f=l.useRef(null),p=l.useRef(0),h=l.useRef(!1),d=l.useRef(!1),x=l.useRef(0),C=l.useRef(0),j=l.useRef(0),M=l.useRef(0),S=l.useRef(),u=o.range?(n=o.value)!==null&&n!==void 0?n:[o.min,o.max]:(s=(r=o.value)!==null&&r!==void 0?r:o.min)!==null&&s!==void 0?s:0,T=o.orientation==="horizontal",m=o.orientation==="vertical",w=gn({type:"mousemove",listener:function(k){return Ie(k)}}),y=xn(w,2),E=y[0],c=y[1],g=gn({type:"mouseup",listener:function(k){return ze(k)}}),v=xn(g,2),b=v[0],N=v[1],F=gn({type:"touchmove",listener:function(k){return Ie(k)}}),L=xn(F,2),D=L[0],P=L[1],U=gn({type:"touchend",listener:function(k){return ze(k)}}),R=xn(U,2),A=R[0],z=R[1],G=Gt.setMetaData({props:o}),W=G.ptm,ne=G.cx,ve=G.sx,he=G.isUnstyled;It(Gt.css.styles,he,{name:"slider"});var te=function(k,Y){var Q=o.range?u[p.current]:u,fe=(o.step||1)*Y;Ke(k,Q+fe),k.preventDefault()},ie=function(k,Y){o.disabled||(d.current=!0,Se(),h.current=!0,o.range&&u[0]===o.max?p.current=0:p.current=Y,k.preventDefault())},Ie=function(k){d.current&&(ye(k),k.preventDefault())},ze=function(k){if(d.current){d.current=!1;var Y=ye(k);o.onSlideEnd&&o.onSlideEnd({originalEvent:k,value:Y}),S.current=void 0,c(),N(),P(),z()}},qe=function(k,Y){E(),b(),ie(k,Y)},Ye=function(k,Y){k.changedTouches&&k.changedTouches[0]&&(S.current=k.changedTouches[0].identifier),D(),A(),ie(k,Y)},at=function(k,Y){if(!o.disabled){p.current=Y;var Q=k.key;switch(Q){case"ArrowRight":case"ArrowUp":te(k,1);break;case"ArrowLeft":case"ArrowDown":te(k,-1);break;case"PageUp":te(k,10),k.preventDefault();break;case"PageDown":te(k,-10),k.preventDefault();break;case"Home":te(k,-u),k.preventDefault();break;case"End":te(k,o.max),k.preventDefault();break}}},Je=function(k){if(!o.disabled){if(!h.current){Se();var Y=ye(k);o.onSlideEnd&&o.onSlideEnd({originalEvent:k,value:Y})}h.current=!1}},Se=function(){var k=f.current.getBoundingClientRect();x.current=k.left+Z.getWindowScrollLeft(),C.current=k.top+Z.getWindowScrollTop(),j.current=f.current.offsetWidth,M.current=f.current.offsetHeight},$e=function(k){var Y,Q=Array.from((Y=k.changedTouches)!==null&&Y!==void 0?Y:[]).find(function(fe){return fe.identifier===S.current})||k;return{pageX:Q.pageX,pageY:Q.pageY}},ye=function(k){var Y,Q=$e(k),fe=Q.pageX,Te=Q.pageY;if(!(!fe||!Te)){T?Y=(fe-x.current)*100/j.current:Y=(C.current+M.current-Te)*100/M.current;var $=(o.max-o.min)*(Y/100)+o.min;if(o.step){var B=o.range?u[p.current]:u,le=$-B;le<0?$=B+Math.ceil($/o.step-B/o.step)*o.step:le>0&&($=B+Math.floor($/o.step-B/o.step)*o.step)}else $=Math.floor($);return Ke(k,$)}},Ke=function(k,Y){var Q=parseFloat(Y.toFixed(10)),fe=Q;return o.range?(p.current===0?Q<o.min?Q=o.min:Q>o.max&&(Q=o.max):Q>o.max?Q=o.max:Q<o.min&&(Q=o.min),fe=No(u),fe[p.current]=Q,o.onChange&&o.onChange({originalEvent:k,value:fe})):(Q<o.min?Q=o.min:Q>o.max&&(Q=o.max),fe=Q,o.onChange&&o.onChange({originalEvent:k,value:fe})),fe},we=function(k,Y,Q){k=oe.isEmpty(k)?null:k,Y=oe.isEmpty(Y)?null:Y;var fe={transition:d.current?"none":null,left:k!=null?k+"%":null,bottom:Y!=null?Y+"%":null},Te=i(ht({className:ne("handle",{index:Q,handleIndex:p}),style:ht(ht({},ve("handle",{dragging:d,leftValue:k,bottomValue:Y})),fe),tabIndex:o.tabIndex,role:"slider",onMouseDown:function(B){return qe(B,Q)},onTouchStart:function(B){return Ye(B,Q)},onKeyDown:function(B){return at(B,Q)},"aria-valuemin":o.min,"aria-valuemax":o.max,"aria-valuenow":k||Y||0,"aria-orientation":o.orientation},Ze),W("handle"));return l.createElement("span",Te)},Pe=function(){var k=(u[0]<o.min?o.min:u[0]-o.min)*100/(o.max-o.min),Y=(u[1]>o.max?o.max:u[1]-o.min)*100/(o.max-o.min),Q=T?we(k,null,0):we(null,k,0),fe=T?we(Y,null,1):we(null,Y,1),Te=Y>k?Y-k:k-Y,$=Y>k?k:Y,B=T?{left:$+"%",width:Te+"%"}:{bottom:$+"%",height:Te+"%"},le=i({className:ne("range"),style:ht(ht({},ve("range")),B)},W("range"));return l.createElement(l.Fragment,null,l.createElement("span",le),Q,fe)},Xe=function(){var k;u<o.min?k=o.min:u>o.max?k=o.max:k=(u-o.min)*100/(o.max-o.min);var Y=T?{width:k+"%"}:{height:k+"%"},Q=T?we(k,null,null):we(null,k,null),fe=i({className:ne("range"),style:ht(ht({},ve("range")),Y)},W("range"));return l.createElement(l.Fragment,null,l.createElement("span",fe),Q)};l.useImperativeHandle(e,function(){return{props:o,getElement:function(){return f.current}}});var Ve=Gt.getOtherProps(o),Ze=oe.reduceKeys(Ve,Z.ARIA_PROPS),Oe=o.range?Pe():Xe(),lt=i({style:o.style,className:ue(o.className,ne("root",{vertical:m,horizontal:T})),onClick:Je},Gt.getOtherProps(o),W("root"));return l.createElement("div",or({id:o.id,ref:f},lt),Oe)}));Os.displayName="Slider";const Do="customizerRoot_CustomizerPanel",Uo="customizerFieldset_CustomizerPanel",Bo="parameterInput_CustomizerPanel",zo="parameterInputRow_CustomizerPanel",Vo="parameterInputLeft_CustomizerPanel",Ho="parameterInputLabel_CustomizerPanel",Ko="parameterInputReset_CustomizerPanel",Go="parameterInputResetHidden_CustomizerPanel",Wo="parameterInputResetVisible_CustomizerPanel",qo="parameterInputCaption_CustomizerPanel",Yo="parameterInputRight_CustomizerPanel",Jo="parameterInputDropdown_CustomizerPanel",Xo="parameterInputNumber_CustomizerPanel",Zo="parameterInputText_CustomizerPanel",Qo="parameterInputCheckbox_CustomizerPanel",ea="parameterInputArrayRow_CustomizerPanel",ta="parameterInputSlider_CustomizerPanel",xe={customizerRoot:Do,customizerFieldset:Uo,parameterInput:Bo,parameterInputRow:zo,parameterInputLeft:Vo,parameterInputLabel:Ho,parameterInputReset:Ko,parameterInputResetHidden:Go,parameterInputResetVisible:Wo,parameterInputCaption:qo,parameterInputRight:Yo,parameterInputDropdown:Jo,parameterInputNumber:Xo,parameterInputText:Zo,parameterInputCheckbox:Qo,parameterInputArrayRow:ea,parameterInputSlider:ta};function na(t){const e=(t.parameterSet?.parameters??[]).reduce((r,i)=>(r[i.group]||(r[i.group]=[]),r[i.group].push(i),r),{}),n=Object.entries(e),s=n.length===1;return t.parameterSet?_.jsx("div",{className:xe.customizerRoot+(t.className?" "+t.className:""),style:t.style,children:n.map(([r,i])=>s?_.jsx("div",{children:i.map(a=>_.jsx(Dr,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))},r):_.jsx(Ts,{className:xe.customizerFieldset,legend:r,toggleable:!0,children:i.map(a=>_.jsx(Dr,{value:t.parameterValues[a.name],param:a,handleChange:t.onChange},a.name))},r))}):_.jsx(Dt,{text:"Waiting for customizer to run"},"spinner")}function Dr({param:t,value:e,style:n,handleChange:s}){const r=e!==void 0&&JSON.stringify(e)!==JSON.stringify(t.initial);return _.jsxs("div",{className:xe.parameterInput,style:n,children:[_.jsxs("div",{className:xe.parameterInputRow,children:[_.jsxs("div",{className:xe.parameterInputLeft,children:[_.jsxs("label",{className:xe.parameterInputLabel,children:[_.jsx("b",{children:t.name}),_.jsx("i",{className:"pi pi-refresh "+xe.parameterInputReset+" "+(r?xe.parameterInputResetVisible:xe.parameterInputResetHidden),onClick:()=>s(t.name,t.initial)})]}),_.jsx("div",{className:xe.parameterInputCaption,children:t.caption})]}),_.jsxs("div",{className:xe.parameterInputRight,children:[t.type==="number"&&"options"in t&&_.jsx(Mr,{className:xe.parameterInputDropdown,value:e??t.initial,options:t.options,onChange:i=>s(t.name,i.value),optionLabel:"name",optionValue:"value"},t.name),t.type==="string"&&t.options&&_.jsx(Mr,{className:xe.parameterInputDropdown,value:e??t.initial,options:t.options,onChange:i=>s(t.name,i.value),optionLabel:"name",optionValue:"value"},t.name),t.type==="boolean"&&_.jsx(Rs,{className:xe.parameterInputCheckbox,checked:e??t.initial,onChange:i=>s(t.name,i.checked)},t.name),!Array.isArray(t.initial)&&t.type==="number"&&!("options"in t)&&_.jsx(Pr,{className:xe.parameterInputNumber,value:e??t.initial,showButtons:!0,size:5,onValueChange:i=>s(t.name,i.value)},t.name),t.type==="string"&&!t.options&&_.jsx(fs,{className:xe.parameterInputText,value:e??t.initial,onChange:i=>s(t.name,i.target.value)},t.name),Array.isArray(t.initial)&&"min"in t&&_.jsx("div",{className:xe.parameterInputArrayRow,children:t.initial.map((i,a)=>_.jsx(Pr,{className:xe.parameterInputNumber,value:e?.[a]!==void 0&&e?.[a]!==null?e[a]:t.initial[a],min:t.min,max:t.max,showButtons:!0,size:5,step:t.step,onValueChange:o=>{const f=[...e??t.initial];f[a]=o.value,s(t.name,f)}},a))})]})]}),!Array.isArray(t.initial)&&t.type==="number"&&t.min!==void 0&&_.jsx(Os,{className:xe.parameterInputSlider,value:e??t.initial,min:t.min,max:t.max,step:t.step,onChange:i=>s(t.name,i.value)},t.name)]})}function lr(){return lr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},lr.apply(null,arguments)}function on(t){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(t)}function ra(t,e){if(on(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(on(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function sa(t){var e=ra(t,"string");return on(e)=="symbol"?e:e+""}function ia(t,e,n){return(e=sa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var oa={root:function(e){var n=e.props,s=e.context,r=e.isFilled;return ue("p-inputtextarea p-inputtext p-component",{"p-disabled":n.disabled,"p-filled":r,"p-inputtextarea-resizable":n.autoResize,"p-invalid":n.invalid,"p-variant-filled":n.variant?n.variant==="filled":s&&s.inputStyle==="filled"})}},aa=`
@layer primereact {
    .p-inputtextarea-resizable {
        overflow: hidden;
        resize: none;
    }
    
    .p-fluid .p-inputtextarea {
        width: 100%;
    }
}
`,En=Rt.extend({defaultProps:{__TYPE:"InputTextarea",__parentMetadata:null,autoResize:!1,invalid:!1,variant:null,keyfilter:null,onBlur:null,onFocus:null,onBeforeInput:null,onInput:null,onKeyDown:null,onKeyUp:null,onPaste:null,tooltip:null,tooltipOptions:null,validateOnly:!1,children:void 0,className:null},css:{classes:oa,styles:aa}});function Ur(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Br(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ur(Object(n),!0).forEach(function(s){ia(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ur(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var vr=l.memo(l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=En.getProps(t,s),i=l.useRef(e),a=l.useRef(0),o=En.setMetaData(Br(Br({props:r},r.__parentMetadata),{},{context:{disabled:r.disabled}})),f=o.ptm,p=o.cx,h=o.isUnstyled;It(En.css.styles,h,{name:"inputtextarea"});var d=function(g){r.autoResize&&T(),r.onFocus&&r.onFocus(g)},x=function(g){r.autoResize&&T(),r.onBlur&&r.onBlur(g)},C=function(g){r.autoResize&&T(),r.onKeyUp&&r.onKeyUp(g)},j=function(g){r.onKeyDown&&r.onKeyDown(g),r.keyfilter&&Xn.onKeyPress(g,r.keyfilter,r.validateOnly)},M=function(g){r.onBeforeInput&&r.onBeforeInput(g),r.keyfilter&&Xn.onBeforeInput(g,r.keyfilter,r.validateOnly)},S=function(g){r.onPaste&&r.onPaste(g),r.keyfilter&&Xn.onPaste(g,r.keyfilter,r.validateOnly)},u=function(g){var v=g.target;r.autoResize&&T(oe.isEmpty(v.value)),r.onInput&&r.onInput(g),oe.isNotEmpty(v.value)?Z.addClass(v,"p-filled"):Z.removeClass(v,"p-filled")},T=function(g){var v=i.current;v&&m()&&(a.current||(a.current=v.scrollHeight,v.style.overflow="hidden"),(a.current!==v.scrollHeight||g)&&(v.style.height="",v.style.height=v.scrollHeight+"px",parseFloat(v.style.height)>=parseFloat(v.style.maxHeight)?(v.style.overflowY="scroll",v.style.height=v.style.maxHeight):v.style.overflow="hidden",a.current=v.scrollHeight))},m=function(){if(Z.isVisible(i.current)){var g=i.current.getBoundingClientRect();return g.width>0&&g.height>0}return!1};l.useEffect(function(){oe.combinedRefs(i,e)},[i,e]),l.useEffect(function(){r.autoResize&&T(!0)},[r.autoResize,r.value]);var w=l.useMemo(function(){return oe.isNotEmpty(r.value)||oe.isNotEmpty(r.defaultValue)},[r.value,r.defaultValue]),y=oe.isNotEmpty(r.tooltip),E=n({ref:i,className:ue(r.className,p("root",{context:s,isFilled:w})),onFocus:d,onBlur:x,onKeyUp:C,onKeyDown:j,onBeforeInput:M,onInput:u,onPaste:S},En.getOtherProps(r),f("root"));return l.createElement(l.Fragment,null,l.createElement("textarea",E),y&&l.createElement(yr,lr({target:i,content:r.tooltip,pt:f("tooltip")},r.tooltipOptions)))}));vr.displayName="InputTextarea";function cr(){return cr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},cr.apply(null,arguments)}function la(t){if(Array.isArray(t))return t}function ca(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function zr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function ua(t,e){if(t){if(typeof t=="string")return zr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zr(t,e):void 0}}function fa(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vr(t,e){return la(t)||ca(t,e)||ua(t,e)||fa()}var wn=Rt.extend({defaultProps:{__TYPE:"Panel",id:null,header:null,headerTemplate:null,footer:null,footerTemplate:null,toggleable:null,style:null,className:null,collapsed:null,expandIcon:null,collapseIcon:null,icons:null,transitionOptions:null,onExpand:null,onCollapse:null,onToggle:null,children:void 0},css:{classes:{root:function(e){var n=e.props;return ue("p-panel p-component",{"p-panel-toggleable":n.toggleable})},header:"p-panel-header",title:"p-panel-title",icons:"p-panel-icons",toggler:"p-panel-header-icon p-panel-toggler p-link",togglerIcon:"p-panel-header-icon p-panel-toggler p-link",toggleableContent:"p-toggleable-content",content:"p-panel-content",footer:"p-panel-footer",transition:"p-toggleable-content"},styles:`
        @layer primereact {
            .p-panel-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
            }
            
            .p-panel-title {
              line-height: 1;
            }
            
            .p-panel-header-icon {
              display: inline-flex;
              justify-content: center;
              align-items: center;
              cursor: pointer;
              text-decoration: none;
              overflow: hidden;
              position: relative;
            }
        }
        `}}),mt=l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=wn.getProps(t,s),i=l.useState(r.id),a=Vr(i,2),o=a[0],f=a[1],p=l.useState(r.collapsed),h=Vr(p,2),d=h[0],x=h[1],C=l.useRef(null),j=l.useRef(null),M=r.toggleable?r.onToggle?r.collapsed:d:!1,S=o+"_header",u=o+"_content",T=wn.setMetaData({props:r,state:{id:o,collapsed:M}}),m=T.ptm,w=T.cx,y=T.isUnstyled;It(wn.css.styles,y,{name:"panel"});var E=function(A){r.toggleable&&(M?c(A):g(A),A&&(r.onToggle&&r.onToggle({originalEvent:A,value:!M}),A.preventDefault()))},c=function(A){r.onToggle||x(!1),r.onExpand&&A&&r.onExpand(A)},g=function(A){r.onToggle||x(!0),r.onCollapse&&A&&r.onCollapse(A)};l.useImperativeHandle(e,function(){return{props:r,toggle:E,expand:c,collapse:g,getElement:function(){return C.current},getContent:function(){return j.current}}}),fn(function(){o||f(zn())});var v=function(){if(r.toggleable){var A=o+"_label",z=n({className:w("toggler"),onClick:E,id:A,"aria-controls":u,"aria-expanded":!M,type:"button",role:"button","aria-label":r.header},m("toggler")),G=n(m("togglericon")),W=M?r.expandIcon||l.createElement(xs,G):r.collapseIcon||l.createElement(ys,G),ne=tt.getJSXIcon(W,G,{props:r,collapsed:M});return l.createElement("button",z,ne,l.createElement(Hn,null))}return null},b=function(){var A=oe.getJSXElement(r.header,r),z=oe.getJSXElement(r.icons,r),G=v(),W=n({id:S,className:w("title")},m("title")),ne=l.createElement("span",W,A),ve=n({className:w("icons")},m("icons")),he=l.createElement("div",ve,z,G),te=n({className:w("header")},m("header")),ie=l.createElement("div",te,ne,he);if(r.headerTemplate){var Ie={className:"p-panel-header",titleClassName:"p-panel-title",iconsClassName:"p-panel-icons",togglerClassName:"p-panel-header-icon p-panel-toggler p-link",onTogglerClick:E,titleElement:ne,iconsElement:he,togglerElement:G,element:ie,id:o+"_header",props:r,collapsed:M};return oe.getJSXElement(r.headerTemplate,Ie)}else if(r.header||r.toggleable)return ie;return null},N=function(){var A=oe.getJSXElement(r.footer,r),z=n({className:w("footer")},m("footer")),G=l.createElement("div",z,A);if(r.footerTemplate){var W={className:w("footer"),element:G,props:r};return oe.getJSXElement(r.footerTemplate,W)}else if(r.footer)return G;return null},F=function(){var A=n({ref:j,className:w("toggleableContent"),"aria-hidden":M,role:"region",id:u,"aria-labelledby":S},m("toggleablecontent")),z=n({className:w("content")},m("content")),G=n({classNames:w("transition"),timeout:{enter:1e3,exit:450},in:!M,unmountOnExit:!0,options:r.transitionOptions},m("transition"));return l.createElement(Vn,cr({nodeRef:j},G),l.createElement("div",A,l.createElement("div",z,r.children)))},L=n({id:o,ref:C,style:r.style,className:ue(r.className,w("root"))},wn.getOtherProps(r),m("root")),D=b(),P=F(),U=N();return l.createElement("div",L,D,P,U)});mt.displayName="Panel";const da=({modelId:t,collapsed:e,onToggle:n})=>{const s=ds(),[r,i]=l.useState([]),[a,o]=l.useState(""),[f,p]=l.useState(!0),[h,d]=l.useState(!1),[x,C]=l.useState(null),j=async()=>{p(!0),C(null);try{const S=await _n.fetchModelComments(t);i(S)}catch{C("Failed to load comments.")}finally{p(!1)}};l.useEffect(()=>{j()},[t]);const M=async()=>{if(a.trim())try{await _n.addModelComment(t,a),i(S=>[{id:"temp-"+Fi(),model_id:t,user_id:s.user.id,username:s.username,body:a,created_at:sr(new Date)},...S]),o("")}catch{C("Failed to post comment.")}finally{d(!1)}};return _.jsx(mt,{toggleable:!0,header:"Comments",style:{flex:1},className:"panel-comments",collapsed:e,onToggle:n,children:f?_.jsx(Dt,{text:"Loading comments"}):_.jsxs(_.Fragment,{children:[s.user?_.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8},children:[_.jsx(vr,{style:{flex:1,resize:"vertical"},maxLength:2e3,placeholder:"Add a comment...",value:a,onChange:S=>o(S.target.value),disabled:h}),_.jsx(tn,{label:"Post",icon:"pi pi-send",outlined:!0,onClick:M,loading:h})]}):_.jsx("div",{children:"You need to be logged in to post comments."}),x&&_.jsx("div",{style:{color:"red",marginBottom:8},children:x}),r.length===0?_.jsx("div",{children:"No comments yet."}):r.map(S=>_.jsxs("div",{children:[_.jsxs("b",{children:[_.jsx("a",{href:`#/user/${S.username}`,children:S.username})," - ",S.created_at]}),_.jsx("p",{dangerouslySetInnerHTML:{__html:vs(S.body)}})]},S.id))]})})},ur=t=>t.replaceAll(/\/\*(.|[\s\S])*?\*\/|\/\/.*?$/gm,"");function pa(t,e,n){const s=ur(e),r=[],i={},a={},o=[],f=[];for(const p of s.matchAll(/(use|include)\s*<([^>]+)>/g))(p[1]=="use"?f:o).push(p[2]);for(const p of s.matchAll(/(?:^|[{};])\s*([$\w]+)\s*=/g))r.push(p[1]);for(const p of s.matchAll(/(function|module)\s+([$\w]+)\s*\(([^)]*)\)(?:\s*(?:=\s*)?(\{\}|[^{}]+?;))?/gm)){const h=p[1],d=p[2];if(n&&d.startsWith("_"))continue;const x=p[3],C=p[4],j=[];if(/^(\s*([$\w]+(\s*=[^,()[]+)?(\s*,\s*[$\w]+(\s*=[^,()[]+)?)*)?\s*)$/m.test(x))for(const M of x.split(",")){const S=/^\s*([$\w]+)(?:\s*=([^,()[]+))?\s*$/.exec(M);if(S){const u=S[1],T=S[2];j.push({name:u,defaultValue:T})}}(h=="function"?i:a)[d]={path:t,name:d,signature:`${d}(${x.replaceAll(/[\s]+/gm," ").replaceAll(/\b | \b/g,"")})`,params:j,referencesChildren:C!=null?C.indexOf("children()")>=0:null}}return{vars:r,functions:i,modules:a,includes:o,uses:f}}const ha=`
  $fa=undef;
  $fs=undef;
  $fn=undef;
  $t=undef;

  $preview=undef;

  // shows rotation
  $vpr=undef;
  // shows translation (i.e. won't be affected by rotate and zoom)
  $vpt=undef;
  // shows the FOV of the view [Note: Requires version 2021.01]
  $vpf=undef;
  // shows the camera distance [Note: Requires version 2015.03]
  $vpd=undef;

  PI=undef;

  function abs(x) = x;
  function acos(x) = x;
  function asin(x) = x;
  function atan(x) = x;
  function atan2(y, x) = x;
  function ceil(x) = x;
  function chr(x) = 0;
  function len(assignments) = $children;
  function let(x) = x;
  function ln(x) = x;
  function log(x) = x;
  function lookup(key, array) = x;
  function max(values) = x;
  function min(values) = x;
  function sqrt(x) = x;
  function tan(degrees) = x;
  function rands(min_value, max_value, value_count, seed_value=undef) = x;
  function search(match_value, string_or_vector, num_returns_per_match=1, index_col_num=0) = x;
  function ord(x) = x;
  function round(x) = x;
  function sign(x) = x;
  function sin(degrees) = x;
  function str(values) = x;
  function norm(x) = x;
  function pow(base, exponent) = x;
  function concat(values) = x;
  function cos(degrees) = x;
  function cross(a, b) = x;
  function floor(x) = x;
  function exp(x) = x;
  function chr(x) = x;
  function is_undef(x) = x;
  function is_list(x) = x;
  function is_num(x) = x;
  function is_bool(x) = x;
  function is_string(x) = x;
  function is_function(x) = x;

  function version() = '';
  function version_num() = 0;

  $parent_modules=0;
  module parent_module(n) {}

  module children() {}

  module render(convexity=undef) {}
  module surface(file, center=false, invert=false, convexity=undef) {}

  function assert(condition, message=undef) = children();
  module assert(condition, message=undef) children();

  module cube(size, center=false) {}
  module sphere(r, d=undef, $fa, $fs, $fn) {}
  module cylinder(h, r, r1=undef, r2, d, d1, d2, center=false, $fa, $fs, $fn) {}
  module polyhedron(points, faces, convexity=undef) {}

  module square(size, center=false) {}
  module circle(r, d=undef, $fa, $fs, $fn) {}
  module polygon(points, paths, convexity=undef) {}
  module linear_extrude(height, center=false, twist=undef, slices=undef, scale=undef, convexity=undef) children();
  module rotate_extrude(degrees, convexity=undef, $fa, $fs, $fn) children();

  module scale(v) children();
  module resize(newsize, auto=false) children();
  module rotate(a, v=undef) children();
  module translate(v) children();
  module mirror(v) children();
  module multmatrix(m) children();

  module color(c, alpha) children();

  module offset(r, delta=undef, chamfer) children();

  module minkowski() children();
  module union() children();
  module difference() children();
  module intersection() children();
  module hull() children();

  module children() {}

  // module for(i=undef) children();

  module import(file, convexity=undef, $fn, $fa, $fs) {}
`,ga=["abs","acos","asin","atan","atan2","ceil","len","let","ln","log","lookup","max","min","sqrt","tan","rands","search","sign","sin","str","norm","pow","concat","cos","cross","floor","exp","chr"],ma=["children","circle","color","cube","cylinder","diameter","difference","echo","extrude","for","function","hull","if","include","intersection_for","intersection","linear","minkowski","mirror","module","multmatrix","offset","polyhedron","projection","radius","render","resize","rotate","round","scale","sphere","square","surface","translate","union","use","value","version"],ya=["false","true","PI","undef","$children","$fa","$fn","$fs","$t","$vpd","$vpr","$vpt"],va=t=>({colorizedBracketPairs:[["{","}"],["(",")"],["[","]"]],wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:t.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:t.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:t.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:t.languages.IndentAction.None,removeText:1}}],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string","comment"]},{open:"/**",close:" */",notIn:["string"]}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}}),ba={defaultToken:"invalid",tokenPostfix:".js",keywords:[...ga,...ma,...ya,"each"],typeKeywords:[],operators:["<=",">=","==","!=","=>","+","-","*","/","%","<<",">>",">>>","&","|","^","!","&&","||","?",":","="],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\[abfnrtv\\"']/,digits:/\d+/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},Cs={getConf:va,language:ba};function Hr(t,e,n){const s=[],r=[];let i=!0,a=0;for(const f of n.params??[]){if(i)if(f.defaultValue!=null)i=!1;else{s.push(`${f.name.replaceAll("$","\\$")}=${"${"+ ++a+":"+f.name+"}"}`);continue}r.push(f.name)}r.length&&s.push(`${"${"+ ++a+":"+r.join("|")+"=}"}`);let o=`${e.replaceAll("$","\\$")}(${s.join(", ")})`;return n.referencesChildren!==null&&(o+=n.referencesChildren?" ${"+ ++a+":children}":";"),{label:n.signature,kind:t.languages.CompletionItemKind.Function,insertText:o,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}}const xa=t=>[...[!0,!1].map(e=>({label:`${e}`,kind:t.languages.CompletionItemKind.Value,insertText:`${e}`,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...Cs.language.keywords.map(e=>({label:e,kind:t.languages.CompletionItemKind.Function,insertText:e,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))],Ea=["for(${1:variable}=[${2:start}:${3:end}) ${4:body}","for(${1:variable}=[${2:start}:${3:increment}:${4:end}) ${5:body}",`if (\${1:condition}) {
	$0
} else {
	
}`];function wa(t){return t.replaceAll(/\$\{\d+:([$\w]+)\}/g,"$1").replaceAll(/\$\d+/g,"").replaceAll(/\s+/g," ").trim()}async function Sa(t,e,n,s){const r={},i=d=>d.startsWith("/")?d:`${n}/${d}`,a={};for(const[d,{deployed:x,symlinks:C}]of Object.entries(s))if(d!="fonts"&&x!==!1)for(const j in C)a[j]=`${d}/${C[j]}`;async function o(d){d in a&&(d=a[d]),d=i(d);try{const x=e.readFileSync(d);return new TextDecoder("utf-8").decode(x)}catch(x){throw x}}const f="<builtins>";let p;function h(d,x,{skipPrivates:C,addBuiltins:j}){return r[d]??=new Promise(async(M,S)=>{x==null&&(x=await o(d));const u={functions:{},modules:{},vars:[],includes:[],uses:[]},T=(E,c)=>{u.functions={...u.functions,...c.functions},u.modules={...u.modules,...c.modules},E||(u.vars=[...u.vars,...c.vars])},m=(d.split("/").slice(0,-1).join("/")||".")+"/",w=async(E,c)=>{let g=!1;for(const v of[`/libraries/${c}`,`${m}/${c}`,c])try{const b=await o(v),N=await h(c,b,{skipPrivates:!0,addBuiltins:!1});T(E,N),g=!0;break}catch(b){console.warn(`Failed to read file option ${v} for ${c} ${E?"used":"included"} by ${d}`,b)}g||console.error("Failed to find ",c,"(context imported in ",d,")")};j&&d!=f&&T(!1,p);const y=pa(d,x,C);await Promise.all([...(y.uses??[]).map(E=>[E,!0]),...(y.includes??[]).map(E=>[E,!1])].map(([E,c])=>w(c,E))),T(!1,y),M(u)})}return p=await h(f,ha,{skipPrivates:!1,addBuiltins:!1}),{triggerCharacters:["<","/"],provideCompletionItems:(async(d,x,C,j)=>{try{const{word:M}=d.getWordUntilPosition(x),S=d.getOffsetAt(x),u=d.getValue();let T=u.substring(0,S);const m=T.lastIndexOf(`
`);T=T.substring(m+1);const w=/\b(include|use)\s*<([^<>\n"]*)$/.exec(T);if(w){const F=w[2];let L,D,P;const U=F.lastIndexOf("/");U<0?(P="",D=F):(P=F.substring(0,U),D=F.substring(U+1));const R=P==""?"":"/"+P;let A=null;for(const G of[Zn("/libraries",R),Zn(n,R)]){A=P==""?[...Object.keys(a)]:[];try{A=[...e.readdirSync(G)??[],...A];break}catch{}}const z=[];if(!A)console.warn("Failed to find folder named "+R);else for(const G of A){if(D!=""&&!G.startsWith(D)||/^(LICENSE.*|fonts)$/.test(G)||P==""&&G in s&&s[G].symlinks)continue;const W=!G.endsWith(".scad"),ne=G+(W?"":`>
`);z.push({label:G,kind:W?t.languages.CompletionItemKind.Folder:t.languages.CompletionItemKind.File,insertText:ne})}return z.sort(),{suggestions:z}}const y=Zn(n,"foo.scad");delete r[y];const E=await h(y,u,{skipPrivates:!1,addBuiltins:!0}),c=ur(T),g=/(^|.*?[{});]|>\s*\n)\s*([$\w]*)$/m.exec(c);if(g){const F=g[1],L=[...xa(t),...Cr(E.modules??{},(D,P)=>Hr(t,D,P),D=>D.indexOf(M)>=0),...(E.vars??[]).filter(D=>D.indexOf(M)>=0).map(D=>({label:D,kind:t.languages.CompletionItemKind.Variable,insertText:D.replaceAll("$","\\$"),insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})),...Ea.map(D=>({label:wa(D).replaceAll(/ body/g,""),kind:t.languages.CompletionItemKind.Keyword,insertText:D,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet}))];return L.sort((D,P)=>D.insertText.indexOf(F)-P.insertText.indexOf(F)),{suggestions:L}}const v=ur(u),b=[...Cr(E.functions??{},(F,L)=>[F,Hr(t,F,L)],F=>F.indexOf(M)>=0)];return b.sort(([F],[L])=>F.indexOf(M)-L.indexOf(M)),{suggestions:b.map(([F,L])=>L)}}catch(M){return console.error(M),{suggestions:[]}}})}}async function Ta(t,e,n,s){t.languages.register({id:"openscad",extensions:[".scad"],mimetypes:["text/openscad"]});const{getConf:r,language:i}=Cs;t.languages.setLanguageConfiguration("openscad",r(t)),t.languages.setMonarchTokensProvider("openscad",i),t.languages.registerCompletionItemProvider("openscad",await Sa(t,e,n,s))}function Kr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Ra(t){if(Array.isArray(t))return t}function Ia(t,e,n){return(e=_a(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Oa(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function Ca(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Wr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Gr(Object(n),!0).forEach(function(s){Ia(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Ma(t,e){if(t==null)return{};var n,s,r=Pa(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)n=i[s],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Pa(t,e){if(t==null)return{};var n={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(e.indexOf(s)!==-1)continue;n[s]=t[s]}return n}function Aa(t,e){return Ra(t)||Oa(t,e)||Fa(t,e)||Ca()}function Na(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _a(t){var e=Na(t,"string");return typeof e=="symbol"?e:e+""}function Fa(t,e){if(t){if(typeof t=="string")return Kr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kr(t,e):void 0}}function ja(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Yr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qr(Object(n),!0).forEach(function(s){ja(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function La(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(s){return e.reduceRight(function(r,i){return i(r)},s)}}function Xt(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,o=new Array(a),f=0;f<a;f++)o[f]=arguments[f];return e.apply(n,[].concat(r,o))}}}function Ln(t){return{}.toString.call(t).includes("Object")}function ka(t){return!Object.keys(t).length}function an(t){return typeof t=="function"}function $a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Da(t,e){return Ln(e)||rt("changeType"),Object.keys(e).some(function(n){return!$a(t,n)})&&rt("changeField"),e}function Ua(t){an(t)||rt("selectorType")}function Ba(t){an(t)||Ln(t)||rt("handlerType"),Ln(t)&&Object.values(t).some(function(e){return!an(e)})&&rt("handlersType")}function za(t){t||rt("initialIsRequired"),Ln(t)||rt("initialType"),ka(t)&&rt("initialContent")}function Va(t,e){throw new Error(t[e]||t.default)}var Ha={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},rt=Xt(Va)(Ha),Sn={changes:Da,selector:Ua,handler:Ba,initial:za};function Ka(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Sn.initial(t),Sn.handler(e);var n={current:t},s=Xt(qa)(n,e),r=Xt(Wa)(n),i=Xt(Sn.changes)(t),a=Xt(Ga)(n);function o(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(h){return h};return Sn.selector(p),p(n.current)}function f(p){La(s,r,i,a)(p)}return[o,f]}function Ga(t,e){return an(e)?e(t.current):e}function Wa(t,e){return t.current=Yr(Yr({},t.current),e),e}function qa(t,e,n){return an(e)?e(t.current):Object.keys(n).forEach(function(s){var r;return(r=e[s])===null||r===void 0?void 0:r.call(e,t.current[s])}),n}var Ya={create:Ka},Ja={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function Xa(t){return function e(){for(var n=this,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length>=t.length?t.apply(this,r):function(){for(var a=arguments.length,o=new Array(a),f=0;f<a;f++)o[f]=arguments[f];return e.apply(n,[].concat(r,o))}}}function Za(t){return{}.toString.call(t).includes("Object")}function Qa(t){return t||Jr("configIsRequired"),Za(t)||Jr("configType"),t.urls?(el(),{paths:{vs:t.urls.monacoBase}}):t}function el(){console.warn(Ms.deprecation)}function tl(t,e){throw new Error(t[e]||t.default)}var Ms={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Jr=Xa(tl)(Ms),nl={config:Qa},rl=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return function(r){return n.reduceRight(function(i,a){return a(i)},r)}};function Ps(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],Ps(t[n],e[n]))}),Wr(Wr({},t),e)}var sl={type:"cancelation",msg:"operation is manually canceled"};function er(t){var e=!1,n=new Promise(function(s,r){t.then(function(i){return e?r(sl):s(i)}),t.catch(r)});return n.cancel=function(){return e=!0},n}var il=["monaco"],ol=Ya.create({config:Ja,isInitialized:!1,resolve:null,reject:null,monaco:null}),As=Aa(ol,2),dn=As[0],Kn=As[1];function al(t){var e=nl.config(t),n=e.monaco,s=Ma(e,il);Kn(function(r){return{config:Ps(r.config,s),monaco:n}})}function ll(){var t=dn(function(e){var n=e.monaco,s=e.isInitialized,r=e.resolve;return{monaco:n,isInitialized:s,resolve:r}});if(!t.isInitialized){if(Kn({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),er(tr);if(window.monaco&&window.monaco.editor)return Ns(window.monaco),t.resolve(window.monaco),er(tr);rl(cl,fl)(dl)}return er(tr)}function cl(t){return document.body.appendChild(t)}function ul(t){var e=document.createElement("script");return t&&(e.src=t),e}function fl(t){var e=dn(function(s){var r=s.config,i=s.reject;return{config:r,reject:i}}),n=ul("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function dl(){var t=dn(function(n){var s=n.config,r=n.resolve,i=n.reject;return{config:s,resolve:r,reject:i}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){var s=n.m||n;Ns(s),t.resolve(s)},function(n){t.reject(n)})}function Ns(t){dn().monaco||Kn({monaco:t})}function pl(){return dn(function(t){var e=t.monaco;return e})}var tr=new Promise(function(t,e){return Kn({resolve:t,reject:e})}),_s={config:al,init:ll,__getMonacoInstance:pl},hl={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},nr=hl,gl={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},ml=gl;function yl({children:t}){return Ft.createElement("div",{style:ml.container},t)}var vl=yl,bl=vl;function xl({width:t,height:e,isEditorReady:n,loading:s,_ref:r,className:i,wrapperProps:a}){return Ft.createElement("section",{style:{...nr.wrapper,width:t,height:e},...a},!n&&Ft.createElement(bl,null,s),Ft.createElement("div",{ref:r,style:{...nr.fullWidth,...!n&&nr.hide},className:i}))}var El=xl,Fs=l.memo(El);function wl(t){l.useEffect(t,[])}var js=wl;function Sl(t,e,n=!0){let s=l.useRef(!0);l.useEffect(s.current||!n?()=>{s.current=!1}:t,e)}var Ne=Sl;function Qt(){}function Nt(t,e,n,s){return Tl(t,s)||Rl(t,e,n,s)}function Tl(t,e){return t.editor.getModel(Ls(t,e))}function Rl(t,e,n,s){return t.editor.createModel(e,n,s?Ls(t,s):void 0)}function Ls(t,e){return t.Uri.parse(e)}function Il({original:t,modified:e,language:n,originalLanguage:s,modifiedLanguage:r,originalModelPath:i,modifiedModelPath:a,keepCurrentOriginalModel:o=!1,keepCurrentModifiedModel:f=!1,theme:p="light",loading:h="Loading...",options:d={},height:x="100%",width:C="100%",className:j,wrapperProps:M={},beforeMount:S=Qt,onMount:u=Qt}){let[T,m]=l.useState(!1),[w,y]=l.useState(!0),E=l.useRef(null),c=l.useRef(null),g=l.useRef(null),v=l.useRef(u),b=l.useRef(S),N=l.useRef(!1);js(()=>{let P=_s.init();return P.then(U=>(c.current=U)&&y(!1)).catch(U=>U?.type!=="cancelation"&&console.error("Monaco initialization: error:",U)),()=>E.current?D():P.cancel()}),Ne(()=>{if(E.current&&c.current){let P=E.current.getOriginalEditor(),U=Nt(c.current,t||"",s||n||"text",i||"");U!==P.getModel()&&P.setModel(U)}},[i],T),Ne(()=>{if(E.current&&c.current){let P=E.current.getModifiedEditor(),U=Nt(c.current,e||"",r||n||"text",a||"");U!==P.getModel()&&P.setModel(U)}},[a],T),Ne(()=>{let P=E.current.getModifiedEditor();P.getOption(c.current.editor.EditorOption.readOnly)?P.setValue(e||""):e!==P.getValue()&&(P.executeEdits("",[{range:P.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),P.pushUndoStop())},[e],T),Ne(()=>{E.current?.getModel()?.original.setValue(t||"")},[t],T),Ne(()=>{let{original:P,modified:U}=E.current.getModel();c.current.editor.setModelLanguage(P,s||n||"text"),c.current.editor.setModelLanguage(U,r||n||"text")},[n,s,r],T),Ne(()=>{c.current?.editor.setTheme(p)},[p],T),Ne(()=>{E.current?.updateOptions(d)},[d],T);let F=l.useCallback(()=>{if(!c.current)return;b.current(c.current);let P=Nt(c.current,t||"",s||n||"text",i||""),U=Nt(c.current,e||"",r||n||"text",a||"");E.current?.setModel({original:P,modified:U})},[n,e,r,t,s,i,a]),L=l.useCallback(()=>{!N.current&&g.current&&(E.current=c.current.editor.createDiffEditor(g.current,{automaticLayout:!0,...d}),F(),c.current?.editor.setTheme(p),m(!0),N.current=!0)},[d,p,F]);l.useEffect(()=>{T&&v.current(E.current,c.current)},[T]),l.useEffect(()=>{!w&&!T&&L()},[w,T,L]);function D(){let P=E.current?.getModel();o||P?.original?.dispose(),f||P?.modified?.dispose(),E.current?.dispose()}return Ft.createElement(Fs,{width:C,height:x,isEditorReady:T,loading:h,_ref:g,className:j,wrapperProps:M})}var Ol=Il;l.memo(Ol);function Cl(t){let e=l.useRef();return l.useEffect(()=>{e.current=t},[t]),e.current}var Ml=Cl,Tn=new Map;function Pl({defaultValue:t,defaultLanguage:e,defaultPath:n,value:s,language:r,path:i,theme:a="light",line:o,loading:f="Loading...",options:p={},overrideServices:h={},saveViewState:d=!0,keepCurrentModel:x=!1,width:C="100%",height:j="100%",className:M,wrapperProps:S={},beforeMount:u=Qt,onMount:T=Qt,onChange:m,onValidate:w=Qt}){let[y,E]=l.useState(!1),[c,g]=l.useState(!0),v=l.useRef(null),b=l.useRef(null),N=l.useRef(null),F=l.useRef(T),L=l.useRef(u),D=l.useRef(void 0),P=l.useRef(s),U=Ml(i),R=l.useRef(!1),A=l.useRef(!1);js(()=>{let W=_s.init();return W.then(ne=>(v.current=ne)&&g(!1)).catch(ne=>ne?.type!=="cancelation"&&console.error("Monaco initialization: error:",ne)),()=>b.current?G():W.cancel()}),Ne(()=>{let W=Nt(v.current,t||s||"",e||r||"",i||n||"");W!==b.current?.getModel()&&(d&&Tn.set(U,b.current?.saveViewState()),b.current?.setModel(W),d&&b.current?.restoreViewState(Tn.get(i)))},[i],y),Ne(()=>{b.current?.updateOptions(p)},[p],y),Ne(()=>{!b.current||s===void 0||(b.current.getOption(v.current.editor.EditorOption.readOnly)?b.current.setValue(s):s!==b.current.getValue()&&(A.current=!0,b.current.executeEdits("",[{range:b.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),b.current.pushUndoStop(),A.current=!1))},[s],y),Ne(()=>{let W=b.current?.getModel();y&&W&&r&&v.current?.editor.setModelLanguage(W,r)},[r,y],y),Ne(()=>{o!==void 0&&b.current?.revealLine(o)},[o],y),Ne(()=>{v.current?.editor.setTheme(a)},[a],y);let z=l.useCallback(()=>{if(!(!N.current||!v.current)&&!R.current){L.current(v.current);let W=i||n,ne=Nt(v.current,s||t||"",e||r||"",W||"");b.current=v.current?.editor.create(N.current,{model:ne,automaticLayout:!0,...p},h),d&&b.current.restoreViewState(Tn.get(W)),v.current.editor.setTheme(a),o!==void 0&&b.current.revealLine(o),E(!0),R.current=!0}},[t,e,n,s,r,i,p,h,d,a,o]);l.useEffect(()=>{y&&F.current(b.current,v.current)},[y]),l.useEffect(()=>{!c&&!y&&z()},[c,y,z]),P.current=s,l.useEffect(()=>{y&&m&&(D.current?.dispose(),D.current=b.current?.onDidChangeModelContent(W=>{A.current||m(b.current.getValue(),W)}))},[y,m]),l.useEffect(()=>{if(y){let W=v.current.editor.onDidChangeMarkers(ne=>{let ve=b.current.getModel()?.uri;if(ve&&ne.find(he=>he.path===ve.path)){let he=v.current.editor.getModelMarkers({resource:ve});w?.(he)}});return()=>{W?.dispose()}}return()=>{}},[y,w]);function G(){D.current?.dispose(),x?d&&Tn.set(i,b.current.saveViewState()):b.current.getModel()?.dispose(),b.current.dispose(),b.current=null,R.current=!1,E(!1)}return Ft.createElement(Fs,{width:C,height:j,isEditorReady:y,loading:f,_ref:N,className:M,wrapperProps:S})}var Al=Pl,Nl=l.memo(Al),_l=Nl;function xt(){return xt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},xt.apply(null,arguments)}function fr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Fl(t){if(Array.isArray(t))return fr(t)}function jl(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function ks(t,e){if(t){if(typeof t=="string")return fr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fr(t,e):void 0}}function Ll(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kl(t){return Fl(t)||jl(t)||ks(t)||Ll()}function ln(t){"@babel/helpers - typeof";return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(t)}function $l(t,e){if(ln(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(ln(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Dl(t){var e=$l(t,"string");return ln(e)=="symbol"?e:e+""}function kn(t,e,n){return(e=Dl(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ul(t){if(Array.isArray(t))return t}function Bl(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function zl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wt(t,e){return Ul(t)||Bl(t,e)||ks(t,e)||zl()}var Vl={root:function(e){var n=e.props,s=e.focusedState,r=e.context,i=e.overlayVisibleState,a=e.isValueEmpty;return ue("p-treeselect p-component p-inputwrapper",{"p-treeselect-chip":n.display==="chip","p-treeselect-clearable":n.showClear&&!n.disabled,"p-disabled":n.disabled,"p-invalid":n.invalid,"p-focus":s,"p-variant-filled":n.variant?n.variant==="filled":r&&r.inputStyle==="filled","p-inputwrapper-filled":!a,"p-inputwrapper-focus":s||i})},label:function(e){var n=e.props,s=e.isValueEmpty,r=e.getLabel;return ue("p-treeselect-label",{"p-placeholder":r()===n.placeholder,"p-treeselect-label-empty":!n.placeholder&&s})},panel:function(e){var n=e.panelProps,s=e.context;return ue("p-treeselect-panel p-component",n.panelClassName,{"p-input-filled":s&&s.inputStyle==="filled"||Ge.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||Ge.ripple===!1})},labelContainer:"p-treeselect-label-container",tokenLabel:"p-treeselect-token-label",token:"p-treeselect-token",trigger:"p-treeselect-trigger",triggerIcon:"p-treeselect-trigger-icon p-clickable",emptyMessage:"p-treeselect-empty-message",filterContainer:"p-treeselect-filter-container",filter:"p-treeselect-filter p-inputtext p-component",filterIcon:"p-treeselect-filter-icon",closeIcon:"p-treeselect-close-icon",clearIcon:"p-treeselect-clear-icon p-clickable",closeButton:"p-treeselect-close p-link",header:"p-treeselect-header",wrapper:"p-treeselect-items-wrapper",transition:"p-connected-overlay"},Hl=`
@layer primereact {
    .p-treeselect {
        display: inline-flex;
        cursor: pointer;
        position: relative;
        user-select: none;
    }

    .p-treeselect-trigger {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .p-treeselect-label-container {
        overflow: hidden;
        flex: 1 1 auto;
        cursor: pointer;
    }

    .p-treeselect-label  {
        display: block;
        white-space: nowrap;
        cursor: pointer;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .p-treeselect-label-empty {
        overflow: hidden;
        visibility: hidden;
    }

    .p-treeselect-token {
        cursor: default;
        display: inline-flex;
        align-items: center;
        flex: 0 0 auto;
    }

    .p-treeselect .p-treeselect-panel {
        min-width: 100%;
    }

    .p-treeselect-items-wrapper {
        overflow: auto;
    }

    .p-treeselect-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .p-treeselect-filter-container {
        position: relative;
        flex: 1 1 auto;
    }

    .p-treeselect-filter-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-treeselect-filter-container .p-inputtext {
        width: 100%;
    }

    .p-treeselect-close {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
        position: relative;
        margin-left: auto;
    }

    .p-treeselect-clear-icon {
        position: absolute;
        top: 50%;
        margin-top: -.5rem;
    }

    .p-fluid .p-treeselect {
        display: flex;
}
}
`,qt=Rt.extend({defaultProps:{__TYPE:"TreeSelect",appendTo:null,ariaLabel:null,ariaLabelledBy:null,className:null,closeIcon:null,clearIcon:null,disabled:!1,display:"comma",dropdownIcon:null,emptyMessage:null,expandedKeys:null,filter:!1,filterBy:"label",filterDelay:300,filterIcon:null,filterInputAutoFocus:!0,filterLocale:void 0,filterMode:"lenient",filterPlaceholder:null,filterTemplate:null,filterValue:null,inputId:null,inputRef:null,invalid:!1,variant:null,metaKeySelection:!1,name:null,nodeTemplate:null,onChange:null,onFocus:null,onBlur:null,onFilterValueChange:null,onHide:null,onNodeClick:null,onNodeCollapse:null,onNodeDoubleClick:null,onNodeExpand:null,onNodeSelect:null,onNodeUnselect:null,onShow:null,options:null,panelClassName:null,panelFooterTemplate:null,panelHeaderTemplate:null,panelStyle:null,placeholder:null,resetFilterOnHide:!1,scrollHeight:"400px",selectionMode:"single",showClear:!1,style:null,tabIndex:null,togglerTemplate:null,transitionOptions:null,value:null,valueTemplate:null,children:void 0},css:{classes:Vl,styles:Hl}});function Xr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Kl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xr(Object(n),!0).forEach(function(s){kn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var $s=l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=t.ptm,i=t.cx,a=function(d,x){return r(d,Kl({hostName:t.hostName},x))},o=function(d){d.key==="Escape"&&(d.preventDefault(),t.hide())},f=function(){var d={maxHeight:t.scrollHeight||"auto"},x=n({className:i("panel",{panelProps:t,context:s}),style:t.panelStyle,onKeyDown:o,onClick:t.onClick},a("panel")),C=n({className:i("wrapper"),style:d},a("wrapper")),j=n({classNames:i("transition"),in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},a("transition"));return l.createElement(Vn,xt({nodeRef:e},j),l.createElement("div",xt({ref:e},x),t.firstHiddenFocusableElementOnOverlay,t.header,l.createElement("div",C,t.children),t.footer,t.lastHiddenFocusableElementOnOverlay))},p=f();return l.createElement(gs,{element:p,appendTo:t.appendTo})});$s.displayName="TreeSelectPanel";function Zr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function Qe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Zr(Object(n),!0).forEach(function(s){kn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zr(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Yt(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Gl(t))||e){n&&(t=n);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(p){throw p},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var p=n.next();return a=p.done,p},e:function(p){o=!0,i=p},f:function(){try{a||n.return==null||n.return()}finally{if(o)throw i}}}}function Gl(t,e){if(t){if(typeof t=="string")return Qr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qr(t,e):void 0}}function Qr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}var Ds=l.memo(l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=qt.getProps(t,s),i=l.useState(!1),a=Wt(i,2),o=a[0],f=a[1],p=l.useState(!1),h=Wt(p,2),d=h[0],x=h[1],C=l.useState(r.expandedKeys),j=Wt(C,2),M=j[0],S=j[1],u=Ei("",r.filterDelay||0),T=Wt(u,3),m=T[0],w=T[1],y=T[2],E=l.useRef(null),c=l.useRef(null),g=l.useRef(null),v=l.useRef(r.inputRef),b=l.useRef(null),N=l.useRef(null),F=l.useRef(null),L=l.useRef(null),D=l.useRef(null),P=l.useRef(!1),U=l.useRef(""),R=r.onToggle?r.expandedKeys:M,A=r.onFilterValueChange?r.filterValue:w,z=oe.isEmpty(r.value),G=r.selectionMode==="single",W=r.selectionMode==="checkbox",ne=oe.isNotEmpty(r.tooltip),ve={props:r,state:{focused:o,overlayVisible:d,expandedKeys:R,filterValue:A}},he=qt.setMetaData(ve),te=he.ptm,ie=he.cx,Ie=he.isUnstyled;It(qt.css.styles,Ie,{name:"treeselect"});var ze={filter:function(I){return H(I)},reset:function(){return X()}},qe=ps({target:E,overlay:c,listener:function(I,K){var ce=K.valid,pe=K.type;ce&&(pe==="outside"||s.hideOverlaysOnDocumentScrolling?ye():Z.isDocument(I.target)||ut())},when:d}),Ye=Wt(qe,2),at=Ye[0],Je=Ye[1],Se=function(){return Ht.length?Ht.map(function(I){return I.label}).join(", "):r.placeholder},$e=function(){x(!0)},ye=function(){x(!1),v.current&&Z.focus(v.current)},Ke=function(){f(!0),r.onFocus&&r.onFocus()},we=function(){f(!1),r.onBlur&&r.onBlur()},Pe=function(I){!r.disabled&&(!c.current||!c.current.contains(I.target))&&!Z.isAttributeEquals(I.target,"data-pc-section","closebutton")&&(Z.focus(v.current),d?ye():$e())},Xe=function(I){r.onChange&&(N.current=!0,r.onChange({originalEvent:I.originalEvent,value:I.value,stopPropagation:function(){I.originalEvent.stopPropagation()},preventDefault:function(){I.originalEvent.preventDefault()},target:{name:r.name,id:r.id,value:I.value}}))},Ve=function(I){r.onChange&&(N.current=!0,r.onChange({originalEvent:I,value:void 0,stopPropagation:function(){I?.stopPropagation()},preventDefault:function(){I?.preventDefault()},target:{name:r.name,id:r.id,value:void 0}}))},Ze=function(I){(I.key==="Enter"||I.code==="Space")&&(Ve(I),I.preventDefault())},Oe=function(I){r.onNodeSelect&&r.onNodeSelect(I),G&&ye()},lt=function(I){r.onNodeUnselect&&r.onNodeUnselect(I),W&&I.originalEvent.stopPropagation()},ae=function(I){r.onToggle?r.onToggle(I):S(I.value)},k=function(I){y(I.value)},Y=function(I){bs.emit("overlay-click",{originalEvent:I,target:E.current})},Q=function(I){var K=I.relatedTarget===v.current?Z.getFirstFocusableElement(c.current,':not([data-p-hidden-focusable="true"])'):v.current;Z.focus(K)},fe=function(I){var K=I.relatedTarget===v.current?Z.getLastFocusableElement(c.current,':not([data-p-hidden-focusable="true"])'):v.current;Z.focus(K)},Te=function(I,K){switch(I.code){case"ArrowDown":I.preventDefault(),Mt();break;case"ArrowUp":I.preventDefault(),v.current&&Z.focus(v.current);break;case"Enter":case"NumpadEnter":I.preventDefault(),K&&ye();break;case"Escape":be(I);break}},$=function(I){switch(I.code){case"ArrowDown":B(I);break;case"Space":case"Enter":case"NumpadEnter":le(I);break;case"Escape":be(I);break;case"Tab":d&&(I.preventDefault(),I.shiftKey?Mt():ee(I));break}},B=function(I){d||(P.current=!0,$e(),I.preventDefault())},le=function(I){d?ye():B(I),I.preventDefault()},be=function(I){d&&(ye(),I.preventDefault())},ee=function(I){var K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;K||d&&O()&&(Z.focus(L.current),I.preventDefault())},O=function(){return Z.getFocusableElements(c.current,':not([data-p-hidden-focusable="true"])').length>0},H=function(I){var K=I.target.value;r.onFilterValueChange?r.onFilterValueChange({originalEvent:I,value:K}):y(K)},X=function(){y("")},de=function(){jt.set("overlay",c.current,s&&s.autoZIndex||Ge.autoZIndex,s&&s.zIndex.overlay||Ge.zIndex.overlay),Z.addStyles(c.current,{position:"absolute",top:"0",left:"0"}),Mt(),ut(),qn()},Ct=function(){at(),r.filter&&r.filterInputAutoFocus&&Z.focus(g.current,r.filterInputAutoFocus),r.onShow&&r.onShow()},ct=function(){Je()},Bt=function(){r.filter&&r.resetFilterOnHide&&X(),jt.clear(c.current),r.onHide&&r.onHide()},ut=function(){Z.alignOverlay(c.current,b.current.parentElement,r.appendTo||s&&s.appendTo||Ge.appendTo)},qn=function(){var I=Z.findSingle(c.current,'[data-pc-section="content"][data-p-highlight="true"]');I&&I.scrollIntoView&&I.scrollIntoView({block:"nearest",inline:"start"})},zt=function(I,K,ce){if(I){if(Fe(I,K)&&(ce.push(I),delete K[I.key]),Object.keys(K).length&&I.children){var pe=Yt(I.children),Re;try{for(pe.s();!(Re=pe.n()).done;){var je=Re.value;zt(je,K,ce)}}catch(Le){pe.e(Le)}finally{pe.f()}}}else{var Ee=Yt(r.options),De;try{for(Ee.s();!(De=Ee.n()).done;){var pt=De.value;zt(pt,K,ce)}}catch(Le){Ee.e(Le)}finally{Ee.f()}}},Fe=function(I,K){return W?K[I.key]&&K[I.key].checked:K[I.key]},Vt=function(){var I=G?kn({},"".concat(r.value),!0):Qe({},r.value);S({}),I&&r.options&&ft(null,null,I)},Mt=function(){var I,K=Z.find((I=F.current)===null||I===void 0?void 0:I.getElement(),'[data-pc-section="node"]'),ce=kl(K).find(function(pe){return pe.getAttribute("tabindex")==="0"});Z.focus(ce)},ft=function(I,K,ce){if(I){if(Fe(I,ce)&&(Yn(K),delete ce[I.key]),Object.keys(ce).length&&I.children){var pe=Yt(I.children),Re;try{for(pe.s();!(Re=pe.n()).done;){var je=Re.value;K.push(I.key),ft(je,K,ce)}}catch(Le){pe.e(Le)}finally{pe.f()}}}else{var Ee=Yt(r.options),De;try{for(Ee.s();!(De=Ee.n()).done;){var pt=De.value;ft(pt,[],ce)}}catch(Le){Ee.e(Le)}finally{Ee.f()}}},Yn=function(I){if(I.length>0){var K=Qe({},M||{}),ce=Yt(I),pe;try{for(ce.s();!(pe=ce.n()).done;){var Re=pe.value;K[Re]=!0}}catch(je){ce.e(je)}finally{ce.f()}S(K)}},Jn=function(){var I=[];if(oe.isNotEmpty(r.value)&&r.options){var K=G?kn({},"".concat(r.value),!0):Qe({},r.value);zt(null,K,I)}return I};l.useImperativeHandle(e,function(){return{props:r,clear:Ve,show:$e,hide:ye,focus:function(){return Z.focus(v.current)},getElement:function(){return E.current}}}),l.useEffect(function(){oe.combinedRefs(v,r.inputRef)},[v,r.inputRef]),fn(function(){Vt(),U.current=zn()+"_list",r.autoFocus&&Z.focus(v.current,r.autoFocus),ut()}),At(function(){d&&r.filter&&ut()}),At(function(){Vt()},[r.options]),At(function(){P.current&&d&&(P.current=!1,Mt())},[d]),At(function(){d&&M&&ut()},[M]),At(function(){d&&(N.current||Vt(),N.current=!1)},[r.value]),hs(function(){jt.clear(c.current)});var dt=function(){var I=n({className:"p-hidden-accessible"},te("hiddenInputWrapper")),K=n(Qe({ref:v,role:"listbox",id:r.inputId,type:"text","aria-expanded":d,"aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-haspopup":"tree","aria-controls":U.current,onFocus:Ke,onBlur:we,onKeyDown:$,disabled:r.disabled,tabIndex:r.tabIndex},li),te("hiddenInput"));return l.createElement("div",I,l.createElement("input",xt({},K,{readOnly:!0})))},Ae=function(){var I=n({className:ie("token")},te("token")),K=n({className:ie("tokenLabel")},te("tokenLabel")),ce=n({className:ie("labelContainer")},te("labelContainer")),pe=n({className:ie("label",{isValueEmpty:z,getLabel:Se})},te("label")),Re=null;return r.valueTemplate?Re=oe.getJSXElement(r.valueTemplate,Ht,r):r.display==="comma"?Re=Se()||"empty":r.display==="chip"&&(Re=l.createElement(l.Fragment,null,Ht&&Ht.map(function(je,Ee){return l.createElement("div",xt({},I,{key:"".concat(je.key,"_").concat(Ee)}),l.createElement("span",K,je.label))}),z&&(r.placeholder||"empty"))),l.createElement("div",ce,l.createElement("div",pe,Re))},ti=function(){var I=n({ref:b,className:ie("trigger"),role:"button","aria-haspopup":"tree","aria-expanded":d},te("trigger")),K=n({className:ie("triggerIcon")},te("triggerIcon")),ce=r.dropdownIcon||l.createElement(Di,K),pe=tt.getJSXIcon(ce,Qe({},K),{props:r});return l.createElement("div",I,pe)},ni=function(){if(r.value!=null&&r.showClear&&!r.disabled){var I=n({className:ie("clearIcon"),onPointerUp:Ve,tabIndex:r.tabIndex||"0",onKeyDown:Ze,"aria-label":wi("clear")},te("clearIcon")),K=r.clearIcon||l.createElement(Er,I);return tt.getJSXIcon(K,Qe({},I),{props:r})}return null},ri=function(){return l.createElement(Pi,{ref:F,id:U.current,emptyMessage:r.emptyMessage,expandedKeys:R,filter:r.filter,filterBy:r.filterBy,filterDelay:r.filterDelay,filterLocale:r.filterLocale,filterMode:r.filterMode,filterPlaceholder:r.filterPlaceholder,filterValue:A,metaKeySelection:r.metaKeySelection,nodeTemplate:r.nodeTemplate,onCollapse:r.onNodeCollapse,onExpand:r.onNodeExpand,onFilterValueChange:k,onNodeClick:r.onNodeClick,onNodeDoubleClick:r.onNodeDoubleClick,onSelect:Oe,onSelectionChange:Xe,onToggle:ae,onUnselect:lt,selectionKeys:r.value,selectionMode:r.selectionMode,showHeader:!1,togglerTemplate:r.togglerTemplate,value:r.options,pt:te("tree"),__parentMetadata:{parent:ve}})},si=function(){if(r.filter){var I=r.onFilterValueChange?r.filterValue:m;I=oe.isNotEmpty(I)?I:"";var K=n({className:ie("filterContainer")},te("filterContainer")),ce=n({ref:g,type:"text",value:I,autoComplete:"off",className:ie("filter"),placeholder:r.filterPlaceholder,onKeyDown:function(Le){return Te(Le,!1)},onChange:H,disabled:r.disabled},te("filter")),pe=n({className:ie("filterIcon")},te("filterIcon")),Re=r.filterIcon||l.createElement(Ui,pe),je=tt.getJSXIcon(Re,Qe({},pe),{props:r}),Ee=l.createElement("div",K,l.createElement("input",ce),je);if(r.filterTemplate){var De={className:"p-treeselect-filter-container",element:Ee,filterOptions:ze,filterInputKeyDown:function(Le){return Te(Le,function(){})},filterInputChange:H,filterIconClassName:"p-dropdown-filter-icon",props:r};Ee=oe.getJSXElement(r.filterTemplate,De)}return l.createElement(l.Fragment,null,Ee)}},ii=function(){var I=si(),K=n({className:ie("closeIcon"),"aria-hidden":!0},te("closeIcon")),ce=r.closeIcon||l.createElement(Er,K),pe=tt.getJSXIcon(ce,Qe({},K),{props:r}),Re=n({type:"button",className:ie("closeButton"),onKeyDown:function(bi){return Te(bi,!0)},onClick:ye,"aria-label":Si("close")},te("closeButton")),je=n({className:ie("header")},te("header")),Ee=l.createElement("button",Re,pe,l.createElement(Hn,null)),De=l.createElement("div",je,I,Ee);if(r.panelHeaderTemplate){var pt={className:"p-treeselect-header",filterElement:I,closeElement:Ee,closeElementClassName:"p-treeselect-close p-link",closeIconClassName:"p-treeselect-close-icon",onCloseClick:ye,element:De,props:r};return l.createElement("div",null,De,oe.getJSXElement(r.panelHeaderTemplate,pt))}return De},oi=function(){return oe.getJSXElement(r.panelFooterTemplate,r)},Ht=Jn(),ai=qt.getOtherProps(r),li=oe.reduceKeys(ai,Z.ARIA_PROPS),ci=n({ref:L,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:Q,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},te("firstHiddenFocusableElementOnOverlay")),ui=n({ref:D,role:"presentation",className:"p-hidden-accessible p-hidden-focusable",tabIndex:0,onFocus:fe,"aria-hidden":!0,"data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0},te("lastHiddenFocusableElementOnOverlay")),fi=n({ref:E,className:ue(r.className,ie("root",{context:s,focusedState:o,overlayVisibleState:d,isValueEmpty:z})),style:r.style,onClick:Pe},qt.getOtherProps(r),te("root")),di=dt(),pi=Ae(),hi=ti(),gi=ni(),mi=ri(),yi=ii(),vi=oi();return l.createElement("div",fi,di,pi,gi,hi,l.createElement($s,{hostName:"TreeSelect",ref:c,appendTo:r.appendTo,panelStyle:r.panelStyle,panelClassName:r.panelClassName,scrollHeight:r.scrollHeight,onClick:Y,header:yi,hide:ye,footer:vi,firstHiddenFocusableElementOnOverlay:l.createElement("span",ci),lastHiddenFocusableElementOnOverlay:l.createElement("span",ui),transitionOptions:r.transitionOptions,in:d,onEnter:de,onEntered:Ct,onExit:ct,onExited:Bt,ptm:te,cx:ie},mi),ne&&l.createElement(yr,xt({target:E,content:r.tooltip,pt:te("tooltip")},r.tooltipOptions)))}));Ds.displayName="TreeSelect";function Us(t,e=500){const n=l.useRef(null);return l.useCallback((...r)=>{n.current&&clearTimeout(n.current),n.current=window.setTimeout(()=>{t(...r)},e)},[t,e])}function cn(t){"@babel/helpers - typeof";return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}function Wl(t,e){if(cn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(cn(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ql(t){var e=Wl(t,"string");return cn(e)=="symbol"?e:e+""}function Yl(t,e,n){return(e=ql(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yt(){return yt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},yt.apply(null,arguments)}function dr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function Jl(t){if(Array.isArray(t))return dr(t)}function Xl(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Bs(t,e){if(t){if(typeof t=="string")return dr(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dr(t,e):void 0}}function Zl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function es(t){return Jl(t)||Xl(t)||Bs(t)||Zl()}function Ql(t){if(Array.isArray(t))return t}function ec(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,r,i,a,o=[],f=!0,p=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(f=(s=i.call(n)).done)&&(o.push(s.value),o.length!==e);f=!0);}catch(h){p=!0,r=h}finally{try{if(!f&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw r}}return o}}function tc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pt(t,e){return Ql(t)||ec(t,e)||Bs(t,e)||tc()}var nc=`
@layer primereact {
    .p-menu-overlay {
        position: absolute;
        /* Github #3122: Prevent animation flickering  */
        top: -9999px;
        left: -9999px;
    }

    .p-menu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-menu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-menu .p-menuitem-text {
        line-height: 1;
    }
}
`,rc={root:function(e){var n=e.props,s=e.context;return ue("p-menu p-component",{"p-menu-overlay":n.popup,"p-input-filled":s&&s.inputStyle==="filled"||Ge.inputStyle==="filled","p-ripple-disabled":s&&s.ripple===!1||Ge.ripple===!1})},menu:"p-menu-list p-reset",content:function(e){var n=e.item;return ue("p-menuitem-content",{"p-disabled":n.disabled})},action:function(e){var n=e.item;return ue("p-menuitem-link",{"p-disabled":n.disabled})},menuitem:function(e){var n=e.focused;return ue("p-menuitem",{"p-focus":n})},submenuHeader:function(e){var n=e.submenu;return ue("p-submenu-header",{"p-disabled":n.disabled})},separator:"p-menu-separator",label:"p-menuitem-text",icon:"p-menuitem-icon",transition:"p-connected-overlay"},sc={submenuHeader:function(e){var n=e.submenu;return n.style},menuitem:function(e){var n=e.item;return n.style}},Rn=Rt.extend({defaultProps:{__TYPE:"Menu",id:null,ariaLabel:null,ariaLabelledBy:null,tabIndex:0,model:null,popup:!1,popupAlignment:"left",style:null,className:null,autoZIndex:!0,baseZIndex:0,appendTo:null,onFocus:null,onBlur:null,transitionOptions:null,onShow:null,onHide:null,children:void 0,closeOnEscape:!0},css:{classes:rc,styles:nc,inlineStyles:sc}});function ts(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function ic(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ts(Object(n),!0).forEach(function(s){Yl(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ts(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}var zs=l.memo(l.forwardRef(function(t,e){var n=it(),s=l.useContext(ot),r=Rn.getProps(t,s),i=l.useState(r.id),a=Pt(i,2),o=a[0],f=a[1],p=l.useState(!r.popup),h=Pt(p,2),d=h[0],x=h[1],C=l.useState(-1),j=Pt(C,2),M=j[0],S=j[1],u=l.useState(-1),T=Pt(u,2),m=T[0],w=T[1],y=l.useState(!1),E=Pt(y,2),c=E[0],g=E[1],v=Rn.setMetaData({props:r,state:{id:o,visible:d,focused:c}}),b=v.ptm,N=v.cx,F=v.sx,L=v.isUnstyled,D=function(O,H){return b(O,{context:H})};It(Rn.css.styles,L,{name:"menu"});var P=l.useRef(null),U=l.useRef(null),R=l.useRef(null),A=!!(d&&r.popup&&r.closeOnEscape),z=Ti("menu",A);Ri({callback:function(O){Oe(O)},when:A&&z,priority:[Ii.MENU,z]});var G=ps({target:R,overlay:P,listener:function(O,H){var X=H.valid,de=H.type;X&&(s.hideOverlaysOnDocumentScrolling||de==="outside"?(Oe(O),S(-1)):Z.isDocument(O.target)||Z.absolutePosition(P.current,R.current,r.popupAlignment))},when:d}),W=Pt(G,2),ne=W[0],ve=W[1],he=function(O){r.popup&&bs.emit("overlay-click",{originalEvent:O,target:R.current})},te=function(O,H,X){if(H.disabled){O.preventDefault();return}H.command&&H.command({originalEvent:O,item:H}),r.popup&&Oe(O),!r.popup&&M!==X&&S(X),H.url||(O.preventDefault(),O.stopPropagation())},ie=function(O,H){O&&r.popup&&M!==H&&S(H)},Ie=function(O){g(!0),r.popup||(m!==-1?(Pe(m),w(-1)):Pe(0)),r.onFocus&&r.onFocus(O)},ze=function(O){var H=O.currentTarget,X=O.relatedTarget;X&&H.contains(X)||(g(!1),S(-1),r.onBlur&&r.onBlur(O))},qe=function(O){switch(O.code){case"ArrowDown":Ye(O);break;case"ArrowUp":at(O);break;case"Home":Je(O);break;case"End":Se(O);break;case"Enter":case"NumpadEnter":$e(O);break;case"Space":ye(O);break;case"Escape":r.popup&&(Z.focus(R.current),Oe(O));case"Tab":r.popup&&d&&Oe(O);break}},Ye=function(O){var H=Ke(M);Pe(H),O.preventDefault()},at=function(O){if(O.altKey&&r.popup)Z.focus(R.current),Oe(O),O.preventDefault();else{var H=we(M);Pe(H),O.preventDefault()}},Je=function(O){Pe(0),O.preventDefault()},Se=function(O){Pe(Z.find(P.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]').length-1),O.preventDefault()},$e=function(O){var H=Z.findSingle(P.current,'li[id="'.concat("".concat(M),'"]')),X=H&&Z.findSingle(H,'a[data-pc-section="action"]');r.popup&&Z.focus(R.current),X?X.click():H&&H.click(),O.preventDefault()},ye=function(O){$e(O)},Ke=function(O){var H=Z.find(P.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),X=es(H).findIndex(function(de){return de.id===O});return X>-1?X+1:0},we=function(O){var H=Z.find(P.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),X=es(H).findIndex(function(de){return de.id===O});return X>-1?X-1:0},Pe=function(O){var H=Z.find(P.current,'li[data-pc-section="menuitem"][data-p-disabled="false"]'),X=O>=H.length?H.length-1:O<0?0:O;X>-1&&S(H[X].getAttribute("id"))},Xe=function(){return M!==-1?M:null},Ve=function(O){r.popup&&(d?Oe(O):Ze(O))},Ze=function(O){R.current=O.currentTarget,x(!0),r.onShow&&r.onShow(O)},Oe=function(O){R.current=O.currentTarget,x(!1),r.onHide&&r.onHide(O)},lt=function(){Z.addStyles(P.current,{position:"absolute",top:"0",left:"0"}),jt.set("menu",P.current,s&&s.autoZIndex||Ge.autoZIndex,r.baseZIndex||s&&s.zIndex.menu||Ge.zIndex.menu),Z.absolutePosition(P.current,R.current,r.popupAlignment),r.popup&&(Z.focus(U.current),Pe(0))},ae=function(){ne()},k=function(){R.current=null,ve()},Y=function(){jt.clear(P.current)};fn(function(){o||f(zn())}),hs(function(){jt.clear(P.current)}),l.useImperativeHandle(e,function(){return{props:r,toggle:Ve,show:Ze,hide:Oe,getElement:function(){return P.current},getTarget:function(){return R.current}}});var Q=function(O,H){var X=o+"_sub_"+H,de=O.items.map(function(ct,Bt){return Te(ct,Bt,X)}),Ct=n({id:X,role:"none",className:ue(O.className,N("submenuHeader",{submenu:O})),style:F("submenuHeader",{submenu:O}),"data-p-disabled":O.disabled},b("submenuHeader"));return l.createElement(l.Fragment,{key:X},l.createElement("li",yt({},Ct,{key:X}),O.label),de)},fe=function(O,H){if(O.visible===!1)return null;var X=o+"_separator_"+H,de=n({id:X,className:ue(O.className,N("separator")),role:"separator"},b("separator"));return l.createElement("li",yt({},de,{key:X}))},Te=function(O,H){var X=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(O.visible===!1)return null;var de={item:O,index:H,parentId:X},Ct=ue("p-menuitem-link",{"p-disabled":O.disabled}),ct=ue("p-menuitem-icon",O.icon),Bt=n({className:N("icon")},D("icon",de)),ut=tt.getJSXIcon(O.icon,ic({},Bt),{props:r}),qn=n({className:N("label")},D("label",de)),zt=O.label&&l.createElement("span",qn,O.label),Fe=O.id||(X||o)+"_"+H,Vt=n({onClick:function(Ae){return te(Ae,O,Fe)},onMouseMove:function(Ae){return ie(Ae,Fe)},className:N("content",{item:O})},D("content",de)),Mt=n({href:O.url||"#",className:N("action",{item:O}),onFocus:function(Ae){return Ae.stopPropagation()},target:O.target,tabIndex:"-1","aria-label":O.label,"aria-disabled":O.disabled,"data-p-disabled":O.disabled},D("action",de)),ft=l.createElement("div",Vt,l.createElement("a",Mt,ut,zt,l.createElement(Hn,null)));if(O.template){var Yn={onClick:function(Ae){return te(Ae,O,Fe)},onMouseMove:function(Ae){return ie(Ae,Fe)},className:Ct,tabIndex:"-1",labelClassName:"p-menuitem-text",iconClassName:ct,element:ft,props:r};ft=oe.getJSXElement(O.template,O,Yn)}var Jn=n({id:Fe,className:ue(O.className,N("menuitem",{focused:M===Fe})),onClick:function(Ae){return te(Ae,O,Fe)},style:F("menuitem",{item:O}),role:"menuitem","aria-label":O.label,"aria-disabled":O.disabled,"data-p-focused":Xe()===Fe,"data-p-disabled":O.disabled||!1},D("menuitem",de));return l.createElement("li",yt({},Jn,{key:Fe}),ft)},$=function(O,H){return O.visible===!1?null:O.separator?fe(O,H):O.items?Q(O,H):Te(O,H)},B=function(){return r.model.map($)},le=function(){if(r.model){var O=B(),H=n({className:ue(r.className,N("root",{context:s})),style:r.style,onClick:function(ct){return he(ct)}},Rn.getOtherProps(r),b("root")),X=n({ref:U,className:N("menu"),id:o+"_list",tabIndex:r.tabIndex||"0",role:"menu","aria-label":r.ariaLabel,"aria-labelledby":r.ariaLabelledBy,"aria-activedescendant":c?Xe():void 0,onFocus:Ie,onKeyDown:qe,onBlur:ze},b("menu")),de=n({classNames:N("transition"),in:d,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:lt,onEntered:ae,onExit:k,onExited:Y},b("transition"));return l.createElement(Vn,yt({nodeRef:P},de),l.createElement("div",yt({id:r.id,ref:P},H),l.createElement("ul",X,O)))}return null},be=le();return r.popup?l.createElement(gs,{element:be,appendTo:r.appendTo}):be}));zs.displayName="Menu";const oc=function(e){const[n,s]=l.useState(null),[r,i]=l.useState(null),[a,o]=l.useState([]),[f,p]=l.useState(e.path),[h,d]=l.useState(!0),[x,C]=l.useState(""),[j,M]=l.useState({}),[S,u]=l.useState(e.homeFileProp??""),T=l.useRef(null),m=l.useRef(null),[w,y]=l.useState(!1),E=(R,A)=>alert(`${R}: ${A}`);function c(R="/"){const A=[];try{const z=Ai(R);z.sort();for(const G of z){const W=R==="/"?`/${G}`:`${R}/${G}`;gt(W)&&Tr(W).isDirectory()?A.push({key:W,label:G+"/",data:W,selectable:!1,children:c(W),icon:"pi pi-folder"}):A.push({key:W,label:G,data:W,selectable:!0,icon:"pi pi-file"})}}catch(z){E("Failed to build tree",z)}return A}const g=()=>{if(!e.hideTopBar)try{const R=c("/");o(R),!f&&R.length&&p(S)}catch(R){E("Failed to list files",R)}},v=()=>{const R=prompt("Enter new file name (with extension):","/newfile.scad");if(R&&R.startsWith("/"))try{gt(R)?alert("File already exists!"):(Rr(R.substring(0,R.lastIndexOf("/")),{recursive:!0}),Ir(R,""),p(R),g())}catch(A){E("Failed to create file",A)}},b=()=>{const R=prompt("Enter new name for current file:",f);if(R&&R.startsWith("/"))try{gt(R)?alert("File already exists!"):(Rr(R.substring(0,R.lastIndexOf("/")),{recursive:!0}),Ir(R,Qn(f,"utf-8")),Or(f),p(R),g())}catch(A){E("Failed to rename file",A)}},N=()=>{if(window.confirm(`Delete ${f}?`))try{Or(f),g(),p("")}catch(R){E("Failed to delete file",R)}},F=Us(R=>{if(!(h||!f))try{console.debug("ZenMonacoPrime",`Saving ${f}`),An(f,R,!0),e.onSave?.(R)}catch(A){E("Failed to save file",A)}},500),L=l.useCallback(R=>{R&&F(R)},[F]),D=(R,A)=>{A.editor.addEditorAction({id:"openscad-save-do-nothing",label:"Save (disabled)",keybindings:[A.KeyMod.CtrlCmd|A.KeyCode.KeyS],run:()=>{}}),A.editor.addKeybindingRules([{keybinding:A.KeyMod.CtrlCmd|A.KeyCode.KeyD,command:"monaco.editor.action.deleteLines"},{keybinding:A.KeyMod.CtrlCmd|A.KeyMod.Shift|A.KeyCode.KeyD,command:"monaco.editor.action.copyLinesDownAction"},{keybinding:A.KeyMod.CtrlCmd|A.KeyCode.KeyK,command:"monaco.editor.action.quickCommand"},{keybinding:A.KeyCode.F8,command:void 0}]),Ta(A,Ni,"/",$i),s(R),i(A)};l.useEffect(()=>{if(!n||!r)return;const R=n.getModel();R&&r.editor.setModelMarkers(R,"openscad",e.markers??[])},[n,r,e.markers]),l.useEffect(()=>{e.isInitializing||!f||x!=""||(async()=>{try{if(console.debug("ZenMonacoPrime",`Loading ${f}`),gt(f)){const R=Qn(f,"utf-8");R!=x&&C(R)}else C("");g(),d(!1)}catch(R){E("Failed to read file",R),C("")}})()},[e.isInitializing,f,g]),l.useEffect(()=>{if(e.reloadKey!==void 0&&e.reloadKey>0&&(console.debug("ZenMonacoPrime",`Reloading ${f}`),gt(f))){const R=Qn(f,"utf-8");n?.setValue(R),d(!1)}},[e.reloadKey]),l.useEffect(()=>{const R=()=>{m.current&&y(m.current.offsetWidth<600)};return window.addEventListener("resize",R),R(),()=>window.removeEventListener("resize",R)},[]);const P=f||null,U=[{label:"New File",icon:"pi pi-plus",command:v},{label:"Rename",icon:"pi pi-pencil",command:b},{label:"Delete",icon:"pi pi-trash",command:N},{separator:!0},{label:"Set as Home",icon:"pi pi-home",command:()=>u(f)}];return _.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",...e.style},children:[!e.hideTopBar&&_.jsxs("div",{style:{flex:0,display:"flex",alignItems:"center",gap:"8px",padding:"8px",background:"#222"},children:[_.jsxs("div",{style:{position:"relative",flex:0},children:[_.jsx(zs,{model:U,popup:!0,ref:T}),_.jsx(tn,{"aria-label":"Editor menu",style:{minWidth:48,minHeight:48},title:"Menu",onClick:R=>T.current&&T.current.toggle(R),disabled:h,icon:"pi pi-bars",text:!0})]}),_.jsx("div",{style:{position:"relative",flex:1,display:"flex",alignItems:"center"},children:_.jsx(Ds,{value:P,options:a,expandedKeys:j,onToggle:R=>M(R.value),onChange:R=>{const A=R.value;typeof A=="string"&&gt(A)&&!Tr(A).isDirectory()&&p(A)},selectionMode:"single",filter:!0,placeholder:"Select a file",className:"w-full",style:{minWidth:300},disabled:h,panelStyle:{maxHeight:600,overflowY:"auto"}})}),_.jsx("div",{style:{position:"relative",flex:0},children:_.jsx(tn,{"aria-label":"Go to HomePage",title:"Go to HomePage",style:{minWidth:48,minHeight:48,color:S?"#fff":"#888"},disabled:!S,onClick:()=>S&&p(S),icon:"pi pi-home",text:!0})})]}),_.jsx("div",{ref:m,style:{flex:1},children:h?_.jsx(Dt,{text:"Loading filesystem"}):_.jsx(_l,{width:"100%",height:"100%",defaultLanguage:"openscad",value:x,path:f,onChange:L,theme:"vs-dark",onMount:D,options:{automaticLayout:!0,fontSize:16,lineNumbers:w?"off":"on",minimap:{enabled:!w},scrollBeyondLastLine:!1,tabSize:2,insertSpaces:!0,detectIndentation:!0,maxTokenizationLineLength:2e3,lineNumbersMinChars:4},loading:_.jsx(Dt,{text:"Loading monaco editor"})})})]})};class Vs{constructor(){this._listeners={}}addEventListener(e,n){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(n)===-1&&s[e].push(n),this}removeEventListener(e,n){const r=this._listeners[e];if(r!==void 0){const i=r.indexOf(n);i!==-1&&r.splice(i,1)}return this}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){const r=s.slice(0);for(let i=0,a=r.length;i<a;i++)r[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class _t{constructor(e,n,s,r={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=n,this._child=s,this._attributes=r,!n.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class ac extends Vs{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const n=new Set;for(const s of this.listParentEdges(e))n.add(s.getParent());return Array.from(n)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const n=new Set;for(const s of this.listChildEdges(e))n.add(s.getChild());return Array.from(n)}disconnectParents(e,n){for(const s of this.listParentEdges(e))(!n||n(s.getParent()))&&s.dispose();return this}_createEdge(e,n,s,r){const i=new _t(e,n,s,r);this._edges.add(i);const a=i.getParent();this._parentEdges.has(a)||this._parentEdges.set(a,new Set),this._parentEdges.get(a).add(i);const o=i.getChild();return this._childEdges.has(o)||this._childEdges.set(o,new Set),this._childEdges.get(o).add(i),i}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function en(){return en=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},en.apply(this,arguments)}class nt{constructor(e){if(this.list=[],e)for(const n of e)this.list.push(n)}add(e){this.list.push(e)}remove(e){const n=this.list.indexOf(e);n>=0&&this.list.splice(n,1)}removeChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);for(const s of n)this.remove(s);return n}listRefsByChild(e){const n=[];for(const s of this.list)s.getChild()===e&&n.push(s);return n}values(){return this.list}}class ge{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const n of e)this.add(n)}add(e){const n=e.getChild();this.removeChild(n),this.set.add(e),this.map.set(n,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const n=this.map.get(e)||null;return n&&this.remove(n),n}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class He{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,n){this.map[e]=n}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const se=Symbol("attributes"),vt=Symbol("immutableKeys");class br extends Vs{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[se]=void 0,this[vt]=void 0,this.graph=e,this[vt]=new Set,this[se]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),n={};for(const s in e){const r=e[s];if(r instanceof br){const i=this.graph._createEdge(s,this,r);this[vt].add(s),n[s]=i}else n[s]=r}return n}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,n){for(const s in this[se]){const r=this[se][s];if(r instanceof _t){const i=r;i.getChild()===e&&this.setRef(s,n,i.getAttributes())}else if(r instanceof nt)for(const i of r.listRefsByChild(e)){const a=i.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}else if(r instanceof ge){const i=r.getRefByChild(e);if(i){const a=i.getAttributes();this.removeRef(s,e),this.addRef(s,n,a)}}else if(r instanceof He)for(const i of r.keys()){const a=r.get(i);a.getChild()===e&&this.setRefMap(s,i,n,a.getAttributes())}}return this}get(e){return this[se][e]}set(e,n){return this[se][e]=n,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const n=this[se][e];return n?n.getChild():null}setRef(e,n,s){if(this[vt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[se][e];if(r&&r.dispose(),!n)return this;const i=this.graph._createEdge(e,this,n,s);return this[se][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(s=>s.getChild())}addRef(e,n,s){const r=this.graph._createEdge(e,this,n,s);return this.assertRefList(e).add(r),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,n){const s=this.assertRefList(e);if(s instanceof nt)for(const r of s.listRefsByChild(n))r.dispose();else{const r=s.getRefByChild(n);r&&r.dispose()}return this}assertRefList(e){const n=this[se][e];if(n instanceof nt||n instanceof ge)return n;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(n=>n.getChild())}getRefMap(e,n){const r=this.assertRefMap(e).get(n);return r?r.getChild():null}setRefMap(e,n,s,r){const i=this.assertRefMap(e),a=i.get(n);if(a&&a.dispose(),!s)return this;r=Object.assign(r||{},{key:n});const o=this.graph._createEdge(e,this,s,en({},r,{key:n}));return i.set(n,o),this.dispatchEvent({type:"change",attribute:e,key:n})}assertRefMap(e){const n=this[se][e];if(n instanceof He)return n;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(en({},e,{target:this})),this.graph.dispatchEvent(en({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const n=e.getName();if(this[se][n]===e)this[se][n]=null,this[vt].has(n)&&e.getChild().dispose();else if(this[se][n]instanceof nt)this[se][n].remove(e);else if(this[se][n]instanceof ge)this[se][n].remove(e);else if(this[se][n]instanceof He){const s=this[se][n];for(const r of s.keys())s.get(r)===e&&s.delete(r)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:n})}}const Hs="v4.2.1",$n="@glb.bin";var V;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(V||(V={}));var Dn;(function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"})(Dn||(Dn={}));var _e;(function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"})(_e||(_e={}));var pr;(function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"})(pr||(pr={}));var We;(function(t){t.GLTF="GLTF",t.GLB="GLB"})(We||(We={}));const Gn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class re{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const n=atob(e.split(",")[1]),s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}else{const n=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(n,s?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let n=0;for(const i of e)n+=i.byteLength;const s=new Uint8Array(n);let r=0;for(const i of e)s.set(i,r),r+=i.byteLength;return s}static pad(e,n=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const r=new Uint8Array(s);if(r.set(e),n!==0)for(let i=e.byteLength;i<s;i++)r[i]=n;return r}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,n){if(e===n)return!0;if(e.byteLength!==n.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==n[s])return!1;return!0}static toView(e,n=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+n,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class lc{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let n=new DataView(e.buffer,e.byteOffset+4),s,r;for(;n.byteLength;){if(s=n.getUint16(0,!1),cc(n,s),r=n.getUint8(s+1),r===192||r===193||r===194)return[n.getUint16(s+7,!1),n.getUint16(s+5,!1)];n=new DataView(e.buffer,n.byteOffset+s+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class Wn{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const n=new DataView(e.buffer,e.byteOffset);return re.decodeText(e.slice(12,16))===Wn.PNG_FRIED_CHUNK_NAME?[n.getUint32(32,!1),n.getUint32(36,!1)]:[n.getUint32(16,!1),n.getUint32(20,!1)]}getChannels(e){return 4}}Wn.PNG_FRIED_CHUNK_NAME="CgBI";class Et{static registerFormat(e,n){this.impls[e]=n}static getMimeType(e){for(const n in this.impls)if(this.impls[n].match(e))return n;return null}static getSize(e,n){return this.impls[n]?this.impls[n].getSize(e):null}static getChannels(e,n){return this.impls[n]?this.impls[n].getChannels(e):null}static getVRAMByteLength(e,n){if(!this.impls[n])return null;if(this.impls[n].getVRAMByteLength)return this.impls[n].getVRAMByteLength(e);let s=0;const r=4,i=this.getSize(e,n);if(!i)return null;for(;i[0]>1||i[1]>1;)s+=i[0]*i[1]*r,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return s+=1*r,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Et.impls={"image/jpeg":new lc,"image/png":new Wn};function cc(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}class St{static basename(e){const n=e.split(/[\\/]/).pop();return n.substring(0,n.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const n=e.match(/data:(image\/\w+)/)[1];return Et.mimeTypeToExtension(n)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var hr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function uc(){var t=new hr(3);return hr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function rr(t){var e=t[0],n=t[1],s=t[2];return Math.hypot(e,n,s)}(function(){var t=uc();return function(e,n,s,r,i,a){var o,f;for(n||(n=3),s||(s=0),r?f=Math.min(r*n+s,e.length):f=e.length,o=s;o<f;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();const ns="https://null.example";class Ue{static dirname(e){const n=e.lastIndexOf("/");return n===-1?"./":e.substring(0,n+1)}static basename(e){return St.basename(new URL(e,ns).pathname)}static extension(e){return St.extension(new URL(e,ns).pathname)}static resolve(e,n){if(!this.isRelativePath(n))return n;const s=e.split("/"),r=n.split("/");s.pop();for(let i=0;i<r.length;i++)r[i]!=="."&&(r[i]===".."?s.pop():s.push(r[i]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Ue.DEFAULT_INIT={};Ue.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function rs(t){return Object.prototype.toString.call(t)==="[object Object]"}function bt(t){if(rs(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(rs(n)===!1||Object.hasOwn(n,"isPrototypeOf")===!1)}var gr,mr;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(mr||(mr={}));class ke{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=ke.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=ke.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=ke.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=ke.Verbosity.ERROR&&console.error(e)}}gr=ke;ke.Verbosity=mr;ke.DEFAULT_INSTANCE=new gr(gr.Verbosity.INFO);function fc(t){var e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],a=t[5],o=t[6],f=t[7],p=t[8],h=t[9],d=t[10],x=t[11],C=t[12],j=t[13],M=t[14],S=t[15],u=e*a-n*i,T=e*o-s*i,m=e*f-r*i,w=n*o-s*a,y=n*f-r*a,E=s*f-r*o,c=p*j-h*C,g=p*M-d*C,v=p*S-x*C,b=h*M-d*j,N=h*S-x*j,F=d*S-x*M;return u*F-T*N+m*b+w*v-y*g+E*c}function dc(t,e,n){var s=e[0],r=e[1],i=e[2],a=e[3],o=e[4],f=e[5],p=e[6],h=e[7],d=e[8],x=e[9],C=e[10],j=e[11],M=e[12],S=e[13],u=e[14],T=e[15],m=n[0],w=n[1],y=n[2],E=n[3];return t[0]=m*s+w*o+y*d+E*M,t[1]=m*r+w*f+y*x+E*S,t[2]=m*i+w*p+y*C+E*u,t[3]=m*a+w*h+y*j+E*T,m=n[4],w=n[5],y=n[6],E=n[7],t[4]=m*s+w*o+y*d+E*M,t[5]=m*r+w*f+y*x+E*S,t[6]=m*i+w*p+y*C+E*u,t[7]=m*a+w*h+y*j+E*T,m=n[8],w=n[9],y=n[10],E=n[11],t[8]=m*s+w*o+y*d+E*M,t[9]=m*r+w*f+y*x+E*S,t[10]=m*i+w*p+y*C+E*u,t[11]=m*a+w*h+y*j+E*T,m=n[12],w=n[13],y=n[14],E=n[15],t[12]=m*s+w*o+y*d+E*M,t[13]=m*r+w*f+y*x+E*S,t[14]=m*i+w*p+y*C+E*u,t[15]=m*a+w*h+y*j+E*T,t}function pc(t,e){var n=e[0],s=e[1],r=e[2],i=e[4],a=e[5],o=e[6],f=e[8],p=e[9],h=e[10];return t[0]=Math.hypot(n,s,r),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(f,p,h),t}function hc(t,e){var n=new hr(3);pc(n,e);var s=1/n[0],r=1/n[1],i=1/n[2],a=e[0]*s,o=e[1]*r,f=e[2]*i,p=e[4]*s,h=e[5]*r,d=e[6]*i,x=e[8]*s,C=e[9]*r,j=e[10]*i,M=a+h+j,S=0;return M>0?(S=Math.sqrt(M+1)*2,t[3]=.25*S,t[0]=(d-C)/S,t[1]=(x-f)/S,t[2]=(o-p)/S):a>h&&a>j?(S=Math.sqrt(1+a-h-j)*2,t[3]=(d-C)/S,t[0]=.25*S,t[1]=(o+p)/S,t[2]=(x+f)/S):h>j?(S=Math.sqrt(1+h-a-j)*2,t[3]=(x-f)/S,t[0]=(o+p)/S,t[1]=.25*S,t[2]=(d+C)/S):(S=Math.sqrt(1+j-a-h)*2,t[3]=(o-p)/S,t[0]=(x+f)/S,t[1]=(d+C)/S,t[2]=.25*S),t}class me{static identity(e){return e}static eq(e,n,s=1e-5){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-n[r])>s)return!1;return!0}static clamp(e,n,s){return e<n?n:e>s?s:e}static decodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,n){switch(n){case 5126:return e;case 5123:return Math.round(me.clamp(e,0,1)*65535);case 5121:return Math.round(me.clamp(e,0,1)*255);case 5122:return Math.round(me.clamp(e,-1,1)*32767);case 5120:return Math.round(me.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,n,s,r){let i=rr([e[0],e[1],e[2]]);const a=rr([e[4],e[5],e[6]]),o=rr([e[8],e[9],e[10]]);fc(e)<0&&(i=-i),n[0]=e[12],n[1]=e[13],n[2]=e[14];const p=e.slice(),h=1/i,d=1/a,x=1/o;p[0]*=h,p[1]*=h,p[2]*=h,p[4]*=d,p[5]*=d,p[6]*=d,p[8]*=x,p[9]*=x,p[10]*=x,hc(s,p),r[0]=i,r[1]=a,r[2]=o}static compose(e,n,s,r){const i=r,a=n[0],o=n[1],f=n[2],p=n[3],h=a+a,d=o+o,x=f+f,C=a*h,j=a*d,M=a*x,S=o*d,u=o*x,T=f*x,m=p*h,w=p*d,y=p*x,E=s[0],c=s[1],g=s[2];return i[0]=(1-(S+T))*E,i[1]=(j+y)*E,i[2]=(M-w)*E,i[3]=0,i[4]=(j-y)*c,i[5]=(1-(C+T))*c,i[6]=(u+m)*c,i[7]=0,i[8]=(M+w)*g,i[9]=(u-m)*g,i[10]=(1-(C+S))*g,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function gc(t,e){if(!!t!=!!e)return!1;const n=t.getChild(),s=e.getChild();return n===s||n.equals(s)}function mc(t,e){if(!!t!=!!e)return!1;const n=t.values(),s=e.values();if(n.length!==s.length)return!1;for(let r=0;r<n.length;r++){const i=n[r],a=s[r];if(i.getChild()!==a.getChild()&&!i.getChild().equals(a.getChild()))return!1}return!0}function yc(t,e){if(!!t!=!!e)return!1;const n=t.keys(),s=e.keys();if(n.length!==s.length)return!1;for(const r of n){const i=t.get(r),a=e.get(r);if(!!i!=!!a)return!1;const o=i.getChild(),f=a.getChild();if(o!==f&&!o.equals(f))return!1}return!0}function Ks(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Gs(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!bt(t)||!bt(e))return t===e;const n=t,s=e;let r=0,i=0,a;for(a in n)r++;for(a in s)i++;if(r!==i)return!1;for(a in n){const o=n[a],f=s[a];if(Un(o)&&Un(f)){if(!Ks(o,f))return!1}else if(bt(o)&&bt(f)){if(!Gs(o,f))return!1}else if(o!==f)return!1}return!0}function Un(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const ss="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",vc=999,bc=6,is=new Set,xc=function(){let e="";for(let n=0;n<bc;n++)e+=ss.charAt(Math.floor(Math.random()*ss.length));return e},Ec=function(){for(let e=0;e<vc;e++){const n=xc();if(!is.has(n))return is.add(n),n}return""},st=t=>t,wc=new Set;class xr extends br{constructor(e,n=""){super(e),this[se].name=n,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,n){return Array.isArray(n)&&(n=n.slice()),super.set(e,n)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,st)}copy(e,n=st){for(const s in this[se]){const r=this[se][s];if(r instanceof _t)this[vt].has(s)||r.dispose();else if(r instanceof nt||r instanceof ge)for(const i of r.values())i.dispose();else if(r instanceof He)for(const i of r.values())i.dispose()}for(const s in e[se]){const r=this[se][s],i=e[se][s];if(i instanceof _t)this[vt].has(s)?r.getChild().copy(n(i.getChild()),n):this.setRef(s,n(i.getChild()),i.getAttributes());else if(i instanceof ge||i instanceof nt)for(const a of i.values())this.addRef(s,n(a.getChild()),a.getAttributes());else if(i instanceof He)for(const a of i.keys()){const o=i.get(a);this.setRefMap(s,a,n(o.getChild()),o.getAttributes())}else bt(i)?this[se][s]=JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?this[se][s]=i.slice():this[se][s]=i}return this}equals(e,n=wc){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[se]){if(n.has(s))continue;const r=this[se][s],i=e[se][s];if(r instanceof _t||i instanceof _t){if(!gc(r,i))return!1}else if(r instanceof ge||i instanceof ge||r instanceof nt||i instanceof nt){if(!mc(r,i))return!1}else if(r instanceof He||i instanceof He){if(!yc(r,i))return!1}else if(bt(r)||bt(i)){if(!Gs(r,i))return!1}else if(Un(r)||Un(i)){if(!Ks(r,i))return!1}else if(r!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Me extends xr{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new He})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,n){return n&&n._validateParent(this),this.setRefMap("extensions",e,n)}listExtensions(){return this.listRefMapValues("extensions")}}class J extends Me{init(){this.propertyType=V.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:J.Type.SCALAR,componentType:J.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case J.Type.SCALAR:return 1;case J.Type.VEC2:return 2;case J.Type.VEC3:return 3;case J.Type.VEC4:return 4;case J.Type.MAT2:return 4;case J.Type.MAT3:return 9;case J.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case J.ComponentType.BYTE:return 1;case J.ComponentType.UNSIGNED_BYTE:return 1;case J.ComponentType.SHORT:return 2;case J.ComponentType.UNSIGNED_SHORT:return 2;case J.ComponentType.UNSIGNED_INT:return 4;case J.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMin(e),n)for(let i=0;i<s;i++)e[i]=me.decodeNormalizedInt(e[i],r);return e}getMin(e){const n=this.getArray(),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)e[i]=1/0;for(let i=0;i<s*r;i+=r)for(let a=0;a<r;a++){const o=n[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const n=this.getNormalized(),s=this.getElementSize(),r=this.getComponentType();if(this.getMax(e),n)for(let i=0;i<s;i++)e[i]=me.decodeNormalizedInt(e[i],r);return e}getMax(e){const n=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)e[i]=-1/0;for(let i=0;i<s*r;i+=r)for(let a=0;a<r;a++){const o=n[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return J.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const n=this.getElementSize(),s=this.getComponentType(),r=this.getArray();return this.getNormalized()?me.decodeNormalizedInt(r[e*n],s):r[e*n]}setScalar(e,n){const s=this.getElementSize(),r=this.getComponentType(),i=this.getArray();return this.getNormalized()?i[e*s]=me.encodeNormalizedInt(n,r):i[e*s]=n,this}getElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<r;o++)s?n[o]=me.decodeNormalizedInt(a[e*r+o],i):n[o]=a[e*r+o];return n}setElement(e,n){const s=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<r;o++)s?a[e*r+o]=me.encodeNormalizedInt(n[o],i):a[e*r+o]=n[o];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?Sc(e):J.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}J.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};J.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function Sc(t){switch(t.constructor){case Float32Array:return J.ComponentType.FLOAT;case Uint32Array:return J.ComponentType.UNSIGNED_INT;case Uint16Array:return J.ComponentType.UNSIGNED_SHORT;case Uint8Array:return J.ComponentType.UNSIGNED_BYTE;case Int16Array:return J.ComponentType.SHORT;case Int8Array:return J.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class Ws extends Me{init(){this.propertyType=V.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new ge,samplers:new ge})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class qs extends Me{init(){this.propertyType=V.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}qs.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class pn extends Me{init(){this.propertyType=V.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:pn.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:_e.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:_e.OTHER})}}pn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Ys extends Me{init(){this.propertyType=V.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Ot extends Me{init(){this.propertyType=V.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Ot.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Ot.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Tc extends xr{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Tc.EXTENSION_NAME=void 0;class Be extends Me{init(){this.propertyType=V.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Be.WrapMode.REPEAT,wrapT:Be.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Be.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Be.MagFilter={NEAREST:9728,LINEAR:9729};Be.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:In,G:On,B:Cn,A:Rc}=pr;class Tt extends Me{init(){this.propertyType=V.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Tt.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Be(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Be(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Be(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Be(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Be(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const n=this.get("baseColorFactor").slice();return n[3]=e,this.set("baseColorFactor",n)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:In|On|Cn|Rc,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:In|On|Cn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:In|On|Cn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:In})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:On|Cn})}}Tt.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Js extends Me{init(){this.propertyType=V.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new ge})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class Xs extends Me{init(){this.propertyType=V.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new ge})}copy(e,n=st){if(n===st)throw new Error("Node cannot be copied.");return super.copy(e,n)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return me.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const n=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return me.decompose(e,n,s,r),this.set("translation",n).set("rotation",s).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return me.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return me.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return me.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r!=null;r=r.getParentNode())e.push(r);let n;const s=e.pop().getMatrix();for(;n=e.pop();)dc(s,s,n.getMatrix());return s}addChild(e){const n=e.getParentNode();n&&n.removeChild(e);for(const s of e.listParents())s.propertyType===V.SCENE&&s.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===V.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const n of this.listChildren())n.traverse(e);return this}}class hn extends Me{init(){this.propertyType=V.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:hn.Mode.TRIANGLES,material:null,indices:null,attributes:new He,targets:new ge})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:_e.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:_e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}hn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Ic extends xr{init(){this.propertyType=V.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new He})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,n){return this.setRefMap("attributes",e,n,{usage:_e.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Ce(){return Ce=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ce.apply(null,arguments)}class Zs extends Me{init(){this.propertyType=V.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new ge})}copy(e,n=st){if(n===st)throw new Error("Scene cannot be copied.");return super.copy(e,n)}addChild(e){const n=e.getParentNode();return n&&n.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const n of this.listChildren())n.traverse(e);return this}}class Qs extends Me{init(){this.propertyType=V.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new ge})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:_e.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class ei extends Me{init(){this.propertyType=V.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Et.extensionToMimeType(St.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const n=Et.extensionToMimeType(St.extension(e));return n&&this.set("mimeType",n),this}getImage(){return this.get("image")}setImage(e){return this.set("image",re.assertView(e))}getSize(){const e=this.get("image");return e?Et.getSize(e,this.getMimeType()):null}}class Oc extends Me{init(){this.propertyType=V.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Hs}`,version:"2.0"},defaultScene:null,accessors:new ge,animations:new ge,buffers:new ge,cameras:new ge,materials:new ge,meshes:new ge,nodes:new ge,scenes:new ge,skins:new ge,textures:new ge})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",n=>{this._addChildOfRoot(n.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,n=st){if(n===st)throw new Error("Root cannot be copied.");this.set("asset",Ce({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ce({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?n(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const r=e.getExtension(s);this.setExtension(s,n(r))}return this}_addChildOfRoot(e){return e instanceof Zs?this.addRef("scenes",e):e instanceof Xs?this.addRef("nodes",e):e instanceof Ot?this.addRef("cameras",e):e instanceof Qs?this.addRef("skins",e):e instanceof Js?this.addRef("meshes",e):e instanceof Tt?this.addRef("materials",e):e instanceof ei?this.addRef("textures",e):e instanceof Ws?this.addRef("animations",e):e instanceof J?this.addRef("accessors",e):e instanceof Ys&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Ut{static fromGraph(e){return Ut._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new ac,this._root=new Oc(this._graph),this._logger=ke.DEFAULT_INSTANCE,Ut._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const n=e.map(s=>s.name);for(const s of e)await s(this,{stack:n});return this}createExtension(e){const n=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(r=>r.extensionName===n)||new e(this)}createScene(e=""){return new Zs(this._graph,e)}createNode(e=""){return new Xs(this._graph,e)}createCamera(e=""){return new Ot(this._graph,e)}createSkin(e=""){return new Qs(this._graph,e)}createMesh(e=""){return new Js(this._graph,e)}createPrimitive(){return new hn(this._graph)}createPrimitiveTarget(e=""){return new Ic(this._graph,e)}createMaterial(e=""){return new Tt(this._graph,e)}createTexture(e=""){return new ei(this._graph,e)}createAnimation(e=""){return new Ws(this._graph,e)}createAnimationChannel(e=""){return new qs(this._graph,e)}createAnimationSampler(e=""){return new pn(this._graph,e)}createAccessor(e="",n=null){return n||(n=this.getRoot().listBuffers()[0]),new J(this._graph,e).setBuffer(n)}createBuffer(e=""){return new Ys(this._graph,e)}}Ut._GRAPH_DOCUMENTS=new WeakMap;class Cc{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,n){this.textureInfos.set(e,n),n.texCoord!==void 0&&e.setTexCoord(n.texCoord),n.extras!==void 0&&e.setExtras(n.extras);const s=this.jsonDoc.json.textures[n.index];if(s.sampler===void 0)return;const r=this.jsonDoc.json.samplers[s.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const os={logger:ke.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Mc=new Set([V.BUFFER,V.TEXTURE,V.MATERIAL,V.MESH,V.PRIMITIVE,V.NODE,V.SCENE]);class Pc{static read(e,n=os){const s=Ce({},os,n),{json:r}=e,i=new Ut().setLogger(s.logger);this.validate(e,s);const a=new Cc(e),o=r.asset,f=i.getRoot().getAsset();o.copyright&&(f.copyright=o.copyright),o.extras&&(f.extras=o.extras),r.extras!==void 0&&i.getRoot().setExtras(Ce({},r.extras));const p=r.extensionsUsed||[],h=r.extensionsRequired||[];s.extensions.sort((c,g)=>c.EXTENSION_NAME>g.EXTENSION_NAME?1:-1);for(const c of s.extensions)if(p.includes(c.EXTENSION_NAME)){const g=i.createExtension(c).setRequired(h.includes(c.EXTENSION_NAME)),v=g.prereadTypes.filter(b=>!Mc.has(b));v.length&&s.logger.warn(`Preread hooks for some types (${v.join()}), requested by extension ${g.extensionName}, are unsupported. Please file an issue or a PR.`);for(const b of g.readDependencies)g.install(b,s.dependencies[b])}const d=r.buffers||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.BUFFER)).forEach(c=>c.preread(a,V.BUFFER)),a.buffers=d.map(c=>{const g=i.createBuffer(c.name);return c.extras&&g.setExtras(c.extras),c.uri&&c.uri.indexOf("__")!==0&&g.setURI(c.uri),g});const x=r.bufferViews||[];a.bufferViewBuffers=x.map((c,g)=>{if(!a.bufferViews[g]){const v=e.json.buffers[c.buffer],b=v.uri?e.resources[v.uri]:e.resources[$n],N=c.byteOffset||0;a.bufferViews[g]=re.toView(b,N,c.byteLength)}return a.buffers[c.buffer]});const C=r.accessors||[];a.accessors=C.map(c=>{const g=a.bufferViewBuffers[c.bufferView],v=i.createAccessor(c.name,g).setType(c.type);return c.extras&&v.setExtras(c.extras),c.normalized!==void 0&&v.setNormalized(c.normalized),c.bufferView===void 0||v.setArray(Nn(c,a)),v});const j=r.images||[],M=r.textures||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.TEXTURE)).forEach(c=>c.preread(a,V.TEXTURE)),a.textures=j.map(c=>{const g=i.createTexture(c.name);if(c.extras&&g.setExtras(c.extras),c.bufferView!==void 0){const v=r.bufferViews[c.bufferView],b=e.json.buffers[v.buffer],N=b.uri?e.resources[b.uri]:e.resources[$n],F=v.byteOffset||0,L=v.byteLength,D=N.slice(F,F+L);g.setImage(D)}else c.uri!==void 0&&(g.setImage(e.resources[c.uri]),c.uri.indexOf("__")!==0&&g.setURI(c.uri));if(c.mimeType!==void 0)g.setMimeType(c.mimeType);else if(c.uri){const v=St.extension(c.uri);g.setMimeType(Et.extensionToMimeType(v))}return g}),i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.MATERIAL)).forEach(c=>c.preread(a,V.MATERIAL));const S=r.materials||[];a.materials=S.map(c=>{const g=i.createMaterial(c.name);c.extras&&g.setExtras(c.extras),c.alphaMode!==void 0&&g.setAlphaMode(c.alphaMode),c.alphaCutoff!==void 0&&g.setAlphaCutoff(c.alphaCutoff),c.doubleSided!==void 0&&g.setDoubleSided(c.doubleSided);const v=c.pbrMetallicRoughness||{};if(v.baseColorFactor!==void 0&&g.setBaseColorFactor(v.baseColorFactor),c.emissiveFactor!==void 0&&g.setEmissiveFactor(c.emissiveFactor),v.metallicFactor!==void 0&&g.setMetallicFactor(v.metallicFactor),v.roughnessFactor!==void 0&&g.setRoughnessFactor(v.roughnessFactor),v.baseColorTexture!==void 0){const b=v.baseColorTexture,N=a.textures[M[b.index].source];g.setBaseColorTexture(N),a.setTextureInfo(g.getBaseColorTextureInfo(),b)}if(c.emissiveTexture!==void 0){const b=c.emissiveTexture,N=a.textures[M[b.index].source];g.setEmissiveTexture(N),a.setTextureInfo(g.getEmissiveTextureInfo(),b)}if(c.normalTexture!==void 0){const b=c.normalTexture,N=a.textures[M[b.index].source];g.setNormalTexture(N),a.setTextureInfo(g.getNormalTextureInfo(),b),c.normalTexture.scale!==void 0&&g.setNormalScale(c.normalTexture.scale)}if(c.occlusionTexture!==void 0){const b=c.occlusionTexture,N=a.textures[M[b.index].source];g.setOcclusionTexture(N),a.setTextureInfo(g.getOcclusionTextureInfo(),b),c.occlusionTexture.strength!==void 0&&g.setOcclusionStrength(c.occlusionTexture.strength)}if(v.metallicRoughnessTexture!==void 0){const b=v.metallicRoughnessTexture,N=a.textures[M[b.index].source];g.setMetallicRoughnessTexture(N),a.setTextureInfo(g.getMetallicRoughnessTextureInfo(),b)}return g}),i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.MESH)).forEach(c=>c.preread(a,V.MESH));const u=r.meshes||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.PRIMITIVE)).forEach(c=>c.preread(a,V.PRIMITIVE)),a.meshes=u.map(c=>{const g=i.createMesh(c.name);return c.extras&&g.setExtras(c.extras),c.weights!==void 0&&g.setWeights(c.weights),(c.primitives||[]).forEach(b=>{const N=i.createPrimitive();b.extras&&N.setExtras(b.extras),b.material!==void 0&&N.setMaterial(a.materials[b.material]),b.mode!==void 0&&N.setMode(b.mode);for(const[D,P]of Object.entries(b.attributes||{}))N.setAttribute(D,a.accessors[P]);b.indices!==void 0&&N.setIndices(a.accessors[b.indices]);const F=c.extras&&c.extras.targetNames||[];(b.targets||[]).forEach((D,P)=>{const U=F[P]||P.toString(),R=i.createPrimitiveTarget(U);for(const[A,z]of Object.entries(D))R.setAttribute(A,a.accessors[z]);N.addTarget(R)}),g.addPrimitive(N)}),g});const T=r.cameras||[];a.cameras=T.map(c=>{const g=i.createCamera(c.name).setType(c.type);if(c.extras&&g.setExtras(c.extras),c.type===Ot.Type.PERSPECTIVE){const v=c.perspective;g.setYFov(v.yfov),g.setZNear(v.znear),v.zfar!==void 0&&g.setZFar(v.zfar),v.aspectRatio!==void 0&&g.setAspectRatio(v.aspectRatio)}else{const v=c.orthographic;g.setZNear(v.znear).setZFar(v.zfar).setXMag(v.xmag).setYMag(v.ymag)}return g});const m=r.nodes||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.NODE)).forEach(c=>c.preread(a,V.NODE)),a.nodes=m.map(c=>{const g=i.createNode(c.name);if(c.extras&&g.setExtras(c.extras),c.translation!==void 0&&g.setTranslation(c.translation),c.rotation!==void 0&&g.setRotation(c.rotation),c.scale!==void 0&&g.setScale(c.scale),c.matrix!==void 0){const v=[0,0,0],b=[0,0,0,1],N=[1,1,1];me.decompose(c.matrix,v,b,N),g.setTranslation(v),g.setRotation(b),g.setScale(N)}return c.weights!==void 0&&g.setWeights(c.weights),g});const w=r.skins||[];a.skins=w.map(c=>{const g=i.createSkin(c.name);c.extras&&g.setExtras(c.extras),c.inverseBindMatrices!==void 0&&g.setInverseBindMatrices(a.accessors[c.inverseBindMatrices]),c.skeleton!==void 0&&g.setSkeleton(a.nodes[c.skeleton]);for(const v of c.joints)g.addJoint(a.nodes[v]);return g}),m.map((c,g)=>{const v=a.nodes[g];(c.children||[]).forEach(N=>v.addChild(a.nodes[N])),c.mesh!==void 0&&v.setMesh(a.meshes[c.mesh]),c.camera!==void 0&&v.setCamera(a.cameras[c.camera]),c.skin!==void 0&&v.setSkin(a.skins[c.skin])});const y=r.animations||[];a.animations=y.map(c=>{const g=i.createAnimation(c.name);c.extras&&g.setExtras(c.extras);const b=(c.samplers||[]).map(F=>{const L=i.createAnimationSampler().setInput(a.accessors[F.input]).setOutput(a.accessors[F.output]).setInterpolation(F.interpolation||pn.Interpolation.LINEAR);return F.extras&&L.setExtras(F.extras),g.addSampler(L),L});return(c.channels||[]).forEach(F=>{const L=i.createAnimationChannel().setSampler(b[F.sampler]).setTargetPath(F.target.path);F.target.node!==void 0&&L.setTargetNode(a.nodes[F.target.node]),F.extras&&L.setExtras(F.extras),g.addChannel(L)}),g});const E=r.scenes||[];return i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(V.SCENE)).forEach(c=>c.preread(a,V.SCENE)),a.scenes=E.map(c=>{const g=i.createScene(c.name);return c.extras&&g.setExtras(c.extras),(c.nodes||[]).map(b=>a.nodes[b]).forEach(b=>g.addChild(b)),g}),r.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[r.scene]),i.getRoot().listExtensionsUsed().forEach(c=>c.read(a)),C.forEach((c,g)=>{const v=a.accessors[g],b=!!c.sparse,N=!c.bufferView&&!v.getArray();(b||N)&&v.setSparse(!0).setArray(Nc(c,a))}),i}static validate(e,n){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const r of s.extensionsRequired)if(!n.extensions.find(i=>i.EXTENSION_NAME===r))throw new Error(`Missing required extension, "${r}".`)}if(s.extensionsUsed)for(const r of s.extensionsUsed)n.extensions.find(i=>i.EXTENSION_NAME===r)||n.logger.warn(`Missing optional extension, "${r}".`)}}function Ac(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],i=Gn[t.componentType],a=J.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,f=t.byteOffset||0,p=new i(t.count*a),h=new DataView(s.buffer,s.byteOffset,s.byteLength),d=r.byteStride;for(let x=0;x<t.count;x++)for(let C=0;C<a;C++){const j=f+x*d+C*o;let M;switch(t.componentType){case J.ComponentType.FLOAT:M=h.getFloat32(j,!0);break;case J.ComponentType.UNSIGNED_INT:M=h.getUint32(j,!0);break;case J.ComponentType.UNSIGNED_SHORT:M=h.getUint16(j,!0);break;case J.ComponentType.UNSIGNED_BYTE:M=h.getUint8(j);break;case J.ComponentType.SHORT:M=h.getInt16(j,!0);break;case J.ComponentType.BYTE:M=h.getInt8(j);break;default:throw new Error(`Unexpected componentType "${t.componentType}".`)}p[x*a+C]=M}return p}function Nn(t,e){const n=e.jsonDoc,s=e.bufferViews[t.bufferView],r=n.json.bufferViews[t.bufferView],i=Gn[t.componentType],a=J.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,f=a*o;if(r.byteStride!==void 0&&r.byteStride!==f)return Ac(t,e);const p=s.byteOffset+(t.byteOffset||0),h=t.count*a*o;return new i(s.buffer.slice(p,p+h))}function Nc(t,e){const n=Gn[t.componentType],s=J.getElementSize(t.type);let r;t.bufferView!==void 0?r=Nn(t,e):r=new n(t.count*s);const i=t.sparse;if(!i)return r;const a=i.count,o=Ce({},t,i.indices,{count:a,type:"SCALAR"}),f=Ce({},t,i.values,{count:a}),p=Nn(o,e),h=Nn(f,e);for(let d=0;d<o.count;d++)for(let x=0;x<s;x++)r[p[d]*s+x]=h[d*s+x];return r}var un;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(un||(un={}));class wt{constructor(e,n,s){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=n,this.options=s;const r=e.getRoot(),i=r.listBuffers().length,a=r.listTextures().length;this.bufferURIGenerator=new as(i>1,()=>s.basename||"buffer"),this.imageURIGenerator=new as(a>1,o=>_c(e,o)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,n){const s={magFilter:n.getMagFilter()||void 0,minFilter:n.getMinFilter()||void 0,wrapS:n.getWrapS(),wrapT:n.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return n.getTexCoord()!==0&&(o.texCoord=n.getTexCoord()),Object.keys(n.getExtras()).length>0&&(o.extras=n.getExtras()),this.textureInfoDefMap.set(n,o),o}createPropertyDef(e){const n={};return e.getName()&&(n.name=e.getName()),Object.keys(e.getExtras()).length>0&&(n.extras=e.getExtras()),n}createAccessorDef(e){const n=this.createPropertyDef(e);return n.type=e.getType(),n.componentType=e.getComponentType(),n.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(r=>r.getName()==="attributes"&&r.getAttributes().key==="POSITION"||r.getName()==="input")&&(n.max=e.getMax([]).map(Math.fround),n.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(n.normalized=e.getNormalized()),n}createImageData(e,n,s){if(this.options.format===We.GLB)this.imageBufferViews.push(n),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:n.byteLength});else{const r=Et.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.assignResourceURI(e.uri,n,!1)}}assignResourceURI(e,n,s){const r=this.jsonDoc.resources;if(!(e in r)){r[e]=n;return}if(n===r[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const i=`Resource URI "${e}" already assigned to different data.`;if(!s){this.logger.warn(i);return}throw new Error(i)}getAccessorUsage(e){const n=this._accessorUsageMap.get(e);if(n)return n;if(e.getSparse())return _e.SPARSE;for(const s of this._doc.getGraph().listParentEdges(e)){const{usage:r}=s.getAttributes();if(r)return r;s.getParent().propertyType!==V.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return _e.OTHER}addAccessorToUsageGroup(e,n){const s=this._accessorUsageMap.get(e);if(s&&s!==n)throw new Error(`Accessor with usage "${s}" cannot be reused as "${n}".`);return this._accessorUsageMap.set(e,n),this}}wt.BufferViewTarget=un;wt.BufferViewUsage=_e;wt.USAGE_TO_TARGET={[_e.ARRAY_BUFFER]:un.ARRAY_BUFFER,[_e.ELEMENT_ARRAY_BUFFER]:un.ELEMENT_ARRAY_BUFFER};class as{constructor(e,n){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=n}createURI(e,n){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${n}`}else return`${this.basename(e)}.${n}`}}function _c(t,e){const n=t.getGraph().listParentEdges(e).find(s=>s.getParent()!==t.getRoot());return n?n.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Mn}=wt,{UNSIGNED_INT:Fc,UNSIGNED_SHORT:jc,UNSIGNED_BYTE:Lc}=J.ComponentType,kc=new Set([V.ACCESSOR,V.BUFFER,V.MATERIAL,V.MESH]);class $c{static write(e,n){const s=e.getGraph(),r=e.getRoot(),i={asset:Ce({generator:`glTF-Transform ${Hs}`},r.getAsset()),extras:Ce({},r.getExtras())},a={json:i,resources:{}},o=new wt(e,a,n),f=n.logger||ke.DEFAULT_INSTANCE,p=new Set(n.extensions.map(u=>u.EXTENSION_NAME)),h=e.getRoot().listExtensionsUsed().filter(u=>p.has(u.extensionName)).sort((u,T)=>u.extensionName>T.extensionName?1:-1),d=e.getRoot().listExtensionsRequired().filter(u=>p.has(u.extensionName)).sort((u,T)=>u.extensionName>T.extensionName?1:-1);h.length<e.getRoot().listExtensionsUsed().length&&f.warn("Some extensions were not registered for I/O, and will not be written.");for(const u of h){const T=u.prewriteTypes.filter(m=>!kc.has(m));T.length&&f.warn(`Prewrite hooks for some types (${T.join()}), requested by extension ${u.extensionName}, are unsupported. Please file an issue or a PR.`);for(const m of u.writeDependencies)u.install(m,n.dependencies[m])}function x(u,T,m,w){const y=[];let E=0;for(const v of u){const b=o.createAccessorDef(v);b.bufferView=i.bufferViews.length;const N=v.getArray(),F=re.pad(re.toView(N));b.byteOffset=E,E+=F.byteLength,y.push(F),o.accessorIndexMap.set(v,i.accessors.length),i.accessors.push(b)}const c=re.concat(y),g={buffer:T,byteOffset:m,byteLength:c.byteLength};return w&&(g.target=w),i.bufferViews.push(g),{buffers:y,byteLength:E}}function C(u,T,m){const w=u[0].getCount();let y=0;for(const b of u){const N=o.createAccessorDef(b);N.bufferView=i.bufferViews.length,N.byteOffset=y;const F=b.getElementSize(),L=b.getComponentSize();y+=re.padNumber(F*L),o.accessorIndexMap.set(b,i.accessors.length),i.accessors.push(N)}const E=w*y,c=new ArrayBuffer(E),g=new DataView(c);for(let b=0;b<w;b++){let N=0;for(const F of u){const L=F.getElementSize(),D=F.getComponentSize(),P=F.getComponentType(),U=F.getArray();for(let R=0;R<L;R++){const A=b*y+N+R*D,z=U[b*L+R];switch(P){case J.ComponentType.FLOAT:g.setFloat32(A,z,!0);break;case J.ComponentType.BYTE:g.setInt8(A,z);break;case J.ComponentType.SHORT:g.setInt16(A,z,!0);break;case J.ComponentType.UNSIGNED_BYTE:g.setUint8(A,z);break;case J.ComponentType.UNSIGNED_SHORT:g.setUint16(A,z,!0);break;case J.ComponentType.UNSIGNED_INT:g.setUint32(A,z,!0);break;default:throw new Error("Unexpected component type: "+P)}}N+=re.padNumber(L*D)}}const v={buffer:T,byteOffset:m,byteLength:E,byteStride:y,target:wt.BufferViewTarget.ARRAY_BUFFER};return i.bufferViews.push(v),{byteLength:E,buffers:[new Uint8Array(c)]}}function j(u,T,m){const w=[];let y=0;const E=new Map;let c=-1/0,g=!1;for(const P of u){const U=o.createAccessorDef(P);i.accessors.push(U),o.accessorIndexMap.set(P,i.accessors.length-1);const R=[],A=[],z=[],G=new Array(P.getElementSize()).fill(0);for(let he=0,te=P.getCount();he<te;he++)if(P.getElement(he,z),!me.eq(z,G,0)){c=Math.max(he,c),R.push(he);for(let ie=0;ie<z.length;ie++)A.push(z[ie])}const W=R.length,ne={accessorDef:U,count:W};if(E.set(P,ne),W===0)continue;W>P.getCount()/2&&(g=!0);const ve=Gn[P.getComponentType()];ne.indices=R,ne.values=new ve(A)}if(!Number.isFinite(c))return{buffers:w,byteLength:y};g&&f.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const v=c<255?Uint8Array:c<65535?Uint16Array:Uint32Array,b=c<255?Lc:c<65535?jc:Fc,N={buffer:T,byteOffset:m+y,byteLength:0};for(const P of u){const U=E.get(P);if(U.count===0)continue;U.indicesByteOffset=N.byteLength;const R=re.pad(re.toView(new v(U.indices)));w.push(R),y+=R.byteLength,N.byteLength+=R.byteLength}i.bufferViews.push(N);const F=i.bufferViews.length-1,L={buffer:T,byteOffset:m+y,byteLength:0};for(const P of u){const U=E.get(P);if(U.count===0)continue;U.valuesByteOffset=L.byteLength;const R=re.pad(re.toView(U.values));w.push(R),y+=R.byteLength,L.byteLength+=R.byteLength}i.bufferViews.push(L);const D=i.bufferViews.length-1;for(const P of u){const U=E.get(P);U.count!==0&&(U.accessorDef.sparse={count:U.count,indices:{bufferView:F,byteOffset:U.indicesByteOffset,componentType:b},values:{bufferView:D,byteOffset:U.valuesByteOffset}})}return{buffers:w,byteLength:y}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=r.listTextures().map((u,T)=>{const m=o.createPropertyDef(u);u.getMimeType()&&(m.mimeType=u.getMimeType());const w=u.getImage();return w&&o.createImageData(m,w,u),o.imageIndexMap.set(u,T),m}),h.filter(u=>u.prewriteTypes.includes(V.ACCESSOR)).forEach(u=>u.prewrite(o,V.ACCESSOR)),r.listAccessors().forEach(u=>{const T=o.accessorUsageGroupedByParent,m=o.accessorParents;if(o.accessorIndexMap.has(u))return;const w=o.getAccessorUsage(u);if(o.addAccessorToUsageGroup(u,w),T.has(w)){const y=s.listParents(u).find(E=>E.propertyType!==V.ROOT);m.set(u,y)}}),h.filter(u=>u.prewriteTypes.includes(V.BUFFER)).forEach(u=>u.prewrite(o,V.BUFFER)),(r.listAccessors().length>0||o.otherBufferViews.size>0||r.listTextures().length>0&&n.format===We.GLB)&&r.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],r.listBuffers().forEach((u,T)=>{const m=o.createPropertyDef(u),w=o.accessorUsageGroupedByParent,y=u.listParents().filter(L=>L instanceof J),E=new Set(y.map(L=>o.accessorParents.get(L))),c=new Map(Array.from(E).map((L,D)=>[L,D])),g={};for(const L of y){var v;if(o.accessorIndexMap.has(L))continue;const D=o.getAccessorUsage(L);let P=D;if(w.has(D)){const U=o.accessorParents.get(L);P+=`:${c.get(U)}`}g[v=P]||(g[v]={usage:D,accessors:[]}),g[P].accessors.push(L)}const b=[],N=i.buffers.length;let F=0;for(const{usage:L,accessors:D}of Object.values(g))if(L===Mn.ARRAY_BUFFER&&n.vertexLayout===Dn.INTERLEAVED){const P=C(D,N,F);F+=P.byteLength;for(const U of P.buffers)b.push(U)}else if(L===Mn.ARRAY_BUFFER)for(const P of D){const U=C([P],N,F);F+=U.byteLength;for(const R of U.buffers)b.push(R)}else if(L===Mn.SPARSE){const P=j(D,N,F);F+=P.byteLength;for(const U of P.buffers)b.push(U)}else if(L===Mn.ELEMENT_ARRAY_BUFFER){const P=wt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,U=x(D,N,F,P);F+=U.byteLength;for(const R of U.buffers)b.push(R)}else{const P=x(D,N,F);F+=P.byteLength;for(const U of P.buffers)b.push(U)}if(o.imageBufferViews.length&&T===0){for(let L=0;L<o.imageBufferViews.length;L++)if(i.bufferViews[i.images[L].bufferView].byteOffset=F,F+=o.imageBufferViews[L].byteLength,b.push(o.imageBufferViews[L]),F%8){const D=8-F%8;F+=D,b.push(new Uint8Array(D))}}if(o.otherBufferViews.has(u))for(const L of o.otherBufferViews.get(u))i.bufferViews.push({buffer:N,byteOffset:F,byteLength:L.byteLength}),o.otherBufferViewsIndexMap.set(L,i.bufferViews.length-1),F+=L.byteLength,b.push(L);if(F){let L;n.format===We.GLB?L=$n:(L=o.bufferURIGenerator.createURI(u,"bin"),m.uri=L),m.byteLength=F,o.assignResourceURI(L,re.concat(b),!0)}i.buffers.push(m),o.bufferIndexMap.set(u,T)}),r.listAccessors().find(u=>!u.getBuffer())&&f.warn("Skipped writing one or more Accessors: no Buffer assigned."),h.filter(u=>u.prewriteTypes.includes(V.MATERIAL)).forEach(u=>u.prewrite(o,V.MATERIAL)),i.materials=r.listMaterials().map((u,T)=>{const m=o.createPropertyDef(u);if(u.getAlphaMode()!==Tt.AlphaMode.OPAQUE&&(m.alphaMode=u.getAlphaMode()),u.getAlphaMode()===Tt.AlphaMode.MASK&&(m.alphaCutoff=u.getAlphaCutoff()),u.getDoubleSided()&&(m.doubleSided=!0),m.pbrMetallicRoughness={},me.eq(u.getBaseColorFactor(),[1,1,1,1])||(m.pbrMetallicRoughness.baseColorFactor=u.getBaseColorFactor()),me.eq(u.getEmissiveFactor(),[0,0,0])||(m.emissiveFactor=u.getEmissiveFactor()),u.getRoughnessFactor()!==1&&(m.pbrMetallicRoughness.roughnessFactor=u.getRoughnessFactor()),u.getMetallicFactor()!==1&&(m.pbrMetallicRoughness.metallicFactor=u.getMetallicFactor()),u.getBaseColorTexture()){const w=u.getBaseColorTexture(),y=u.getBaseColorTextureInfo();m.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(w,y)}if(u.getEmissiveTexture()){const w=u.getEmissiveTexture(),y=u.getEmissiveTextureInfo();m.emissiveTexture=o.createTextureInfoDef(w,y)}if(u.getNormalTexture()){const w=u.getNormalTexture(),y=u.getNormalTextureInfo(),E=o.createTextureInfoDef(w,y);u.getNormalScale()!==1&&(E.scale=u.getNormalScale()),m.normalTexture=E}if(u.getOcclusionTexture()){const w=u.getOcclusionTexture(),y=u.getOcclusionTextureInfo(),E=o.createTextureInfoDef(w,y);u.getOcclusionStrength()!==1&&(E.strength=u.getOcclusionStrength()),m.occlusionTexture=E}if(u.getMetallicRoughnessTexture()){const w=u.getMetallicRoughnessTexture(),y=u.getMetallicRoughnessTextureInfo();m.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(w,y)}return o.materialIndexMap.set(u,T),m}),h.filter(u=>u.prewriteTypes.includes(V.MESH)).forEach(u=>u.prewrite(o,V.MESH)),i.meshes=r.listMeshes().map((u,T)=>{const m=o.createPropertyDef(u);let w=null;return m.primitives=u.listPrimitives().map(y=>{const E={attributes:{}};E.mode=y.getMode();const c=y.getMaterial();c&&(E.material=o.materialIndexMap.get(c)),Object.keys(y.getExtras()).length&&(E.extras=y.getExtras());const g=y.getIndices();g&&(E.indices=o.accessorIndexMap.get(g));for(const v of y.listSemantics())E.attributes[v]=o.accessorIndexMap.get(y.getAttribute(v));for(const v of y.listTargets()){const b={};for(const N of v.listSemantics())b[N]=o.accessorIndexMap.get(v.getAttribute(N));E.targets=E.targets||[],E.targets.push(b)}return y.listTargets().length&&!w&&(w=y.listTargets().map(v=>v.getName())),E}),u.getWeights().length&&(m.weights=u.getWeights()),w&&(m.extras=m.extras||{},m.extras.targetNames=w),o.meshIndexMap.set(u,T),m}),i.cameras=r.listCameras().map((u,T)=>{const m=o.createPropertyDef(u);if(m.type=u.getType(),m.type===Ot.Type.PERSPECTIVE){m.perspective={znear:u.getZNear(),zfar:u.getZFar(),yfov:u.getYFov()};const w=u.getAspectRatio();w!==null&&(m.perspective.aspectRatio=w)}else m.orthographic={znear:u.getZNear(),zfar:u.getZFar(),xmag:u.getXMag(),ymag:u.getYMag()};return o.cameraIndexMap.set(u,T),m}),i.nodes=r.listNodes().map((u,T)=>{const m=o.createPropertyDef(u);return me.eq(u.getTranslation(),[0,0,0])||(m.translation=u.getTranslation()),me.eq(u.getRotation(),[0,0,0,1])||(m.rotation=u.getRotation()),me.eq(u.getScale(),[1,1,1])||(m.scale=u.getScale()),u.getWeights().length&&(m.weights=u.getWeights()),o.nodeIndexMap.set(u,T),m}),i.skins=r.listSkins().map((u,T)=>{const m=o.createPropertyDef(u),w=u.getInverseBindMatrices();w&&(m.inverseBindMatrices=o.accessorIndexMap.get(w));const y=u.getSkeleton();return y&&(m.skeleton=o.nodeIndexMap.get(y)),m.joints=u.listJoints().map(E=>o.nodeIndexMap.get(E)),o.skinIndexMap.set(u,T),m}),r.listNodes().forEach((u,T)=>{const m=i.nodes[T],w=u.getMesh();w&&(m.mesh=o.meshIndexMap.get(w));const y=u.getCamera();y&&(m.camera=o.cameraIndexMap.get(y));const E=u.getSkin();E&&(m.skin=o.skinIndexMap.get(E)),u.listChildren().length>0&&(m.children=u.listChildren().map(c=>o.nodeIndexMap.get(c)))}),i.animations=r.listAnimations().map((u,T)=>{const m=o.createPropertyDef(u),w=new Map;return m.samplers=u.listSamplers().map((y,E)=>{const c=o.createPropertyDef(y);return c.input=o.accessorIndexMap.get(y.getInput()),c.output=o.accessorIndexMap.get(y.getOutput()),c.interpolation=y.getInterpolation(),w.set(y,E),c}),m.channels=u.listChannels().map(y=>{const E=o.createPropertyDef(y);return E.sampler=w.get(y.getSampler()),E.target={node:o.nodeIndexMap.get(y.getTargetNode()),path:y.getTargetPath()},E}),o.animationIndexMap.set(u,T),m}),i.scenes=r.listScenes().map((u,T)=>{const m=o.createPropertyDef(u);return m.nodes=u.listChildren().map(w=>o.nodeIndexMap.get(w)),o.sceneIndexMap.set(u,T),m});const S=r.getDefaultScene();return S&&(i.scene=r.listScenes().indexOf(S)),i.extensionsUsed=h.map(u=>u.extensionName),i.extensionsRequired=d.map(u=>u.extensionName),h.forEach(u=>u.write(o)),Dc(i),a}}function Dc(t){const e=[];for(const n in t){const s=t[n];(Array.isArray(s)&&s.length===0||s===null||s===""||s&&typeof s=="object"&&Object.keys(s).length===0)&&e.push(n)}for(const n of e)delete t[n]}var Bn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Bn||(Bn={}));class Uc{constructor(){this._logger=ke.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=Dn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const n of e)this._extensions.add(n),n.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const n=await this.readURI(e,"view");this.lastReadBytes=n.byteLength;const s=ls(n)?this._binaryToJSON(n):{json:JSON.parse(re.decodeText(n)),resources:{}};return await this._readResourcesExternal(s,this.dirname(e)),this._readResourcesInternal(s),s}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Pc.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const n=this._binaryToJSON(re.assertView(e));this._readResourcesInternal(n);const s=n.json;if(s.buffers&&s.buffers.some(r=>Bc(n,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(r=>zc(n,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return n}async readBinary(e){return this.readJSON(await this.binaryToJSON(re.assertView(e)))}async writeJSON(e,n={}){if(n.format===We.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return $c.write(e,{format:n.format||We.GLTF,basename:n.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:Ce({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:n,resources:s}=await this.writeJSON(e,{format:We.GLB}),r=new Uint32Array([1179937895,2,12]),i=JSON.stringify(n),a=re.pad(re.encodeText(i),32),o=re.toView(new Uint32Array([a.byteLength,1313821514])),f=re.concat([o,a]);r[r.length-1]+=f.byteLength;const p=Object.values(s)[0];if(!p||!p.byteLength)return re.concat([re.toView(r),f]);const h=re.pad(p,0),d=re.toView(new Uint32Array([h.byteLength,5130562])),x=re.concat([d,h]);return r[r.length-1]+=x.byteLength,re.concat([re.toView(r),f,x])}async _readResourcesExternal(e,n){var s=this;const r=e.json.images||[],i=e.json.buffers||[],a=[...r,...i].map(async function(o){const f=o.uri;if(!f||f.match(/data:/))return Promise.resolve();e.resources[f]=await s.readURI(s.resolve(n,f),"view"),s.lastReadBytes+=e.resources[f].byteLength});await Promise.all(a)}_readResourcesInternal(e){function n(i){if(i.uri){if(i.uri in e.resources){re.assertView(e.resources[i.uri]);return}if(i.uri.match(/data:/)){const a=`__${Ec()}.${St.extension(i.uri)}`;e.resources[a]=re.createBufferFromDataURI(i.uri),i.uri=a}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");n(i)}),(e.json.buffers||[]).forEach(n)}_copyJSON(e){const{images:n,buffers:s}=e.json;return e={json:Ce({},e.json),resources:Ce({},e.resources)},n&&(e.json.images=n.map(r=>Ce({},r))),s&&(e.json.buffers=s.map(r=>Ce({},r))),e}_binaryToJSON(e){if(!ls(e))throw new Error("Invalid glTF 2.0 binary.");const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==Bn.JSON)throw new Error("Missing required GLB JSON chunk.");const s=20,r=n[0],i=re.decodeText(re.toView(e,s,r)),a=JSON.parse(i),o=s+r;if(e.byteLength<=o)return{json:a,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+o,2);if(f[1]!==Bn.BIN)return{json:a,resources:{}};const p=f[0],h=re.toView(e,o+8,p);return{json:a,resources:{[$n]:h}}}}function Bc(t,e){return e.uri!==void 0&&!(e.uri in t.resources)}function zc(t,e){return e.uri!==void 0&&!(e.uri in t.resources)&&e.bufferView===void 0}function ls(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Vc extends Uc{constructor(e=null,n=Ue.DEFAULT_INIT){super(),this._fetch=void 0,this._fetchConfig=void 0,this._init=void 0,this._fetchEnabled=!1,this._fetch=e,this._fetchConfig=n,this._init=this.init()}async init(){return this._init?this._init:Promise.all([wr(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),wr(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])]).then(([e,n])=>{this._fs=e.promises,this._path=n})}setAllowNetwork(e){if(e&&!this._fetch)throw new Error("NodeIO requires a Fetch API implementation for HTTP requests.");return this._fetchEnabled=e,this}async readURI(e,n){if(await this.init(),Ue.isAbsoluteURL(e)){if(!this._fetchEnabled||!this._fetch)throw new Error("Network request blocked. Allow HTTP requests explicitly, if needed.");const s=await this._fetch(e,this._fetchConfig);switch(n){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}else switch(n){case"view":return this._fs.readFile(e);case"text":return this._fs.readFile(e,"utf8")}}resolve(e,n){return Ue.isAbsoluteURL(e)||Ue.isAbsoluteURL(n)?Ue.resolve(e,n):this._path.resolve(e,decodeURIComponent(n))}dirname(e){return Ue.isAbsoluteURL(e)?Ue.dirname(e):this._path.dirname(e)}async write(e,n){await this.init(),await(!!e.match(/\.glb$/)?this._writeGLB(e,n):this._writeGLTF(e,n))}async _writeGLTF(e,n){var s=this;this.lastWriteBytes=0;const{json:r,resources:i}=await this.writeJSON(n,{format:We.GLTF,basename:St.basename(e)}),{_fs:a,_path:o}=this,f=o.dirname(e),p=JSON.stringify(r,null,2);await a.writeFile(e,p),this.lastWriteBytes+=p.length;for(const h of Hc(Object.keys(i),10))await Promise.all(h.map(async function(d){if(Ue.isAbsoluteURL(d)){if(Ue.extension(d)==="bin")throw new Error(`Cannot write buffer to path "${d}".`);return}const x=o.join(f,decodeURIComponent(d));await a.mkdir(o.dirname(x),{recursive:!0}),await a.writeFile(x,i[d]),s.lastWriteBytes+=i[d].byteLength}))}async _writeGLB(e,n){const s=await this.writeBinary(n);await this._fs.writeFile(e,s),this.lastWriteBytes=s.byteLength}}function Hc(t,e){const n=[];for(let s=0,r=t.length;s<r;s+=e){const i=[];for(let a=0;a<e&&s+a<r;a++)i.push(t[s+a]);n.push(i)}return n}const Kc=[79/255,209/255,197/255,1];function Pn(t,e=1){let n=t.replace(/^#/,"");n.length===3?n=n.split("").map(o=>o+o).join(""):n.length===4&&(n=n.split("").map(o=>o+o).join(""));let s=0,r=0,i=0,a=e;if(n.length===6)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255;else if(n.length===8)s=parseInt(n.slice(0,2),16)/255,r=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255,a=parseInt(n.slice(6,8),16)/255;else throw new Error("Invalid hex color format");return[s,r,i,a]}function Gc(t,e,{positions:n,indices:s,colors:r}){const i=t.createPrimitive().setMode(hn.Mode.TRIANGLES).setMaterial(t.createMaterial().setDoubleSided(!0).setAlphaMode(e[3]<1?"BLEND":"OPAQUE").setMetallicFactor(0).setRoughnessFactor(.8).setBaseColorFactor(e)).setAttribute("POSITION",t.createAccessor().setType(J.Type.VEC3).setArray(n)).setIndices(t.createAccessor().setType(J.Type.SCALAR).setArray(s));return r&&i.setAttribute("COLOR_0",t.createAccessor().setType(J.Type.VEC3).setArray(r)),i}function Wc(t){const e=new Float32Array(t.vertices.length*3),n=new Uint32Array(t.faces.length*3),s=new Map;let r=0;const i=a=>{let o=s.get(a);if(o===void 0){const f=r*3,p=t.vertices[a];e[f]=p.x,e[f+1]=p.y,e[f+2]=p.z,o=r++,s.set(a,o)}return o};return t.faces.forEach((a,o)=>{const{vertices:f}=a;if(f.length<3)throw new Error("Face must have at least 3 vertices");const p=o*3;n[p]=i(f[0]),n[p+1]=i(f[1]),n[p+2]=i(f[2])}),{positions:e.slice(0,r*3),indices:n}}async function qc(t,e=!1){const n=[[.615686274509804,.796078431372549,.3176470588235294,1],[.9764705882352941,.8431372549019608,.17254901960784313,1]],s=e?[Pn("#322"),Pn("#222")]:[Pn("#efdfdf"),Pn("#fff")],r=t.colors.map(h=>{for(let d=0;d<n.length;++d)if(h.length===4&&Math.abs(h[0]-n[d][0])<1e-6&&Math.abs(h[1]-n[d][1])<1e-6&&Math.abs(h[2]-n[d][2])<1e-6&&Math.abs(h[3]-n[d][3])<1e-6)return s[d];return h}),i=new Ut;i.createBuffer();const a=i.createScene(),o=i.createMesh(),f=new Map;t.faces.forEach(h=>{let d=f.get(h.colorIndex);d||f.set(h.colorIndex,d=[]),d.push(h)});for(const[h,d]of f.entries()){const x=r[h];o.addPrimitive(Gc(i,x,Wc({vertices:t.vertices,faces:d})))}a.addChild(i.createNode().setMesh(o));const p=await new Vc().writeBinary(i);return new Blob([p],{type:"model/gltf-binary"})}const Yc=`
/* [Meta] */
title = "OpenSCAD Demo";
show_text = true;
debug = true;

/* [Plate Settings] */
// Plate size (mm)
plate_size = 40;          // [20:1:80]
// Plate thickness
thickness  = 6;           // [2:0.5:20]
// Corner rounding
fillet     = 3;           // [0:0.5:10]

/* [Holes] */
// Number of holes
hole_count   = 6;         // [0:1:12]
// Hole diameter
hole_d       = 4;         // [2:0.5:10]
// Hole pattern
hole_pattern = "circle";  // ["circle", "grid"]

/* [Quality] */
$fs = $preview ? 1   : 0.2;
$fa = $preview ? 15  : 5;


/* ---------- Helpers ---------- */

module label(txt) {
    if (show_text)
        color("pink")
            translate([0, -plate_size/2 - 8, thickness])
                linear_extrude(1)
                    text(txt, size=6, halign="center");
}


/* ---------- Geometry ---------- */

module holes_2d() {
    if (hole_pattern == "circle")
        for (i = [0 : hole_count - 1])
            rotate(360 / hole_count * i)
                translate([plate_size / 3, 0])
                    circle(d = hole_d);
    else
        for (x = [-1, 0, 1], y = [-1, 0, 1])
            translate([x * plate_size / 4, y * plate_size / 4])
                circle(d = hole_d);
}

module plate_2d() {
    difference() {
        offset(r = fillet)
            square(plate_size - 2 * fillet, center = true);
        holes_2d();
    }
}


/* ---------- Output ---------- */

color("steelblue")
difference() {
    linear_extrude(thickness)
        plate_2d();

    // Debug cutaway
    if (debug)
        translate([0, 0, thickness/2])
            cube([plate_size, plate_size/2, thickness+1], center=true);
}

label(title);

`;function cs(t){const e=t.split(`
`).map(h=>h.trim()).filter(h=>h.length>0&&!h.startsWith("#"));if(e.length===0)throw new Error("Empty OFF file");let n,s=0;if(e[0].match(/^OFF(\s|$)/))n=e[0].substring(3).trim(),s=1;else if(e[s]==="OFF"&&e.length>1)n=e[1],s=2;else throw new Error("Invalid OFF file: missing OFF header");const[r,i]=n.split(/\s+/).map(Number);if(isNaN(r)||isNaN(i))throw new Error("Invalid OFF file: invalid vertex or face counts");if(s+r+i>e.length)throw new Error("Invalid OFF file: not enough lines");const a=[];for(let h=0;h<r;h++){const d=e[s+h].split(/\s+/).map(Number);if(d.length<3||d.some(isNaN))throw new Error(`Invalid OFF file: invalid vertex at line ${s+h+1}`);a.push({x:d[0],y:d[1],z:d[2]})}s+=r;const o=[],f=new Map,p=[];for(let h=0;h<i;h++){const d=e[s+h].split(/\s+/).map(Number),x=d[0],C=d.slice(1,x+1),j=d.length>=x+4?d.slice(x+1,x+5).map(u=>u/255):Kc;if(C.length<3)throw new Error(`Invalid OFF file: face at line ${s+h+1} must have at least 3 vertices`);const M=j?j.join(","):"";let S=f.get(M);if(S==null){S=o.length;const[u,T,m,w]=j;o.push([u,T,m,w??1]),f.set(M,S)}if(C.length==3)p.push({vertices:C,colorIndex:S});else for(let u=1;u<C.length-1;u++)p.push({vertices:[C[0],C[u],C[u+1]],colorIndex:S})}return{vertices:a,faces:p,colors:o}}function Jc(t,e,n){const s=e.x-t.x,r=e.y-t.y,i=e.z-t.z,a=n.x-t.x,o=n.y-t.y,f=n.z-t.z;return{x:r*f-i*o,y:i*a-s*f,z:s*o-r*a}}async function Xc(t){let e=`solid polyhedron
`;for(const n of t.faces){const[s,r,i]=n.vertices,a=t.vertices[s],o=t.vertices[r],f=t.vertices[i],p=Jc(a,o,f);e+=`  facet normal ${p.x} ${p.y} ${p.z}
`,e+=`    outer loop
`,e+=`      vertex ${a.x} ${a.y} ${a.z}
`,e+=`      vertex ${o.x} ${o.y} ${o.z}
`,e+=`      vertex ${f.x} ${f.y} ${f.z}
`,e+=`    endloop
`,e+=`  endfacet
`}return e+=`endsolid polyhedron
`,new Blob([e],{type:"model/stl"})}const Zc="editor-page-container_EditorPage",Qc="sidebar_EditorPage",eu="main_EditorPage",tu="main-sub_EditorPage",nu="panel-editor_EditorPage",ru="panel-logs_EditorPage",su="model-viewer-container_EditorPage",iu="model-viewer_EditorPage",et={editorPageContainer:Zc,sidebar:Qc,main:eu,mainSub:tu,panelEditor:nu,panelLogs:ru,modelViewerContainer:su,modelViewer:iu};function vu({viewModelId:t}){const{modelId:e}=Oi();e&&(t=e);const[n,s]=Ci(),{user:r}=ds(),i=ji("readonly")!==null,[a,o]=l.useState(void 0),[f,p]=l.useState(void 0),h=t??"new",[d,x]=l.useState(void 0),[C,j]=l.useState(void 0),[M,S]=l.useState(void 0),[u,T]=l.useState(void 0),[m,w]=l.useState(void 0),[y,E]=l.useState(void 0),[c,g]=l.useState(!1),[v,b]=l.useState(!1),[N,F]=l.useState(!0),[L,D]=l.useState(!1),[P,U]=l.useState(void 0),[R,A]=l.useState(void 0),[z,G]=l.useState({}),[W,ne]=l.useState(!1),[ve,he]=l.useState(null),[te,ie]=l.useState(t!==void 0?0:1),Ie=l.useRef(null),ze=l.useRef(null),qe=l.useRef(!1),[Ye,at]=l.useState(0),Je=l.useRef(z);l.useEffect(()=>{Je.current=z},[z]);const Se=l.useCallback(()=>`/src/${h}/index.scad`,[h]),$e=l.useCallback(async $=>{try{const B=Se();if(h=="new")An(B,Yc,!1);else if(!gt(B)&&$!==void 0)An(B,$.source_code,!0);else if($!==void 0){const le=mn(B);await Li(le)!=$.source_code_hash&&D(!0)}}catch(B){console.error(B)}},[h,Se]),ye=l.useCallback(async()=>{T("Checking Syntax...");try{const $=Se(),B=mn($),be=await Wi({activePath:$,sources:[{path:$,content:B}]});be.parameterSet&&(ki("Parameter set:",be.parameterSet),U(be.parameterSet)),be.markers&&A(be.markers)}catch($){w($?.message||String($))}finally{T(void 0)}},[]),Ke=$=>async()=>{T($?"Previewing...":"Rendering..."),w(void 0),E(void 0);try{const B=Se(),le=mn(B),ee={scadPath:B,sources:[{path:B,content:le}],vars:Je.current,isPreview:$,mountArchives:!0,renderFormat:"off",streamsCallback:X=>{"stderr"in X&&E(de=>(de?de+`
`:"")+X.stderr),"stdout"in X&&E(de=>(de?de+`
`:"")+X.stdout)}},O=await qi(ee);C&&URL.revokeObjectURL(C),j(URL.createObjectURL(O.outFile));let H;try{const X=cs(await O.outFile.text());H=new File([await qc(X)],O.outFile.name.replace(".off",".glb"))}catch(X){w("Failed to convert OFF to GLB: "+X),T(void 0);return}d&&URL.revokeObjectURL(d),x(URL.createObjectURL(H))}catch(B){w(B?.message||String(B))}finally{T(void 0)}},we=l.useCallback(Ke(!0),[z]),Pe=l.useCallback(Ke(!1),[z]),Xe=Us(we,500),Ve=async()=>{if(!ze.current)return;const $=await ze.current.getWebpScreenshot();if(!$){w("Failed to capture screenshot for publish.");return}he($),ne(!0)},Ze=async()=>{if(!(!r||!ve||!f)){ne(!1),Ie.current?.show({severity:"info",summary:"Uploading...",life:5e3});try{const B=await(await fetch(ve)).blob(),le=new File([B],`${Date.now()}.webp`,{type:"image/webp"}),be=mn(Se());await _n.uploadModel(le,be,f),Ie.current?.clear(),Ie.current?.show({severity:"success",summary:"Published",detail:"Model published successfully!",life:3e3})}catch($){Ie.current?.clear(),Ie.current?.show({severity:"error",summary:"Publish Failed",detail:$.message||String($),life:4e3})}finally{ne(!1),he(null)}}},Oe=()=>{ne(!1),he(null)},lt=async()=>{if(a?.source_code){const $=Se();An($,a?.source_code,!0),at(B=>B+1),D(!1)}},ae=l.useCallback(async()=>{if(console.debug("Fetching model details...",t),t){const $=await _n.fetchModelById(t);return o($),p({id:$?.id,title:$?.title??"Untitled Model",description:$?.description??""}),$}else{p({id:void 0,title:"Untitled Model",description:""});return}},[]);l.useEffect(()=>(qe.current||(qe.current=!0,(async()=>{const $=await ae();await _i(!0),await $e($),await Promise.all([ye(),we()]),F(!1)})()),()=>{d&&URL.revokeObjectURL(d),C&&URL.revokeObjectURL(C),M&&URL.revokeObjectURL(M)}),[ye,ae,$e,we]);function k($,B){const le=document.createElement("a");le.href=$,le.download=B,document.body.appendChild(le),le.click(),document.body.removeChild(le)}const Y=l.useCallback(async()=>{try{if(M&&URL.revokeObjectURL(M),!C)throw new Error("No OFF file to convert");const $=await(await fetch(C)).text(),B=cs($),le=await Xc(B),be=Q()+".stl",ee=URL.createObjectURL(le);k(ee,be),setTimeout(()=>URL.revokeObjectURL(ee),1e3),S(void 0)}catch($){console.error($)}},[C]);l.useEffect(()=>{if(!P)return;let $;for(const B of P.parameters)if(z[B.name]===B.initial){const{[B.name]:le,...be}=z;$=be}$!==void 0&&G($)},[z,P]),l.useEffect(()=>{const $=B=>{B.key==="F4"?(B.preventDefault(),ye()):B.key==="F5"?(B.preventDefault(),we()):B.key==="F6"?(B.preventDefault(),Pe()):B.key==="F7"?(B.preventDefault(),Y()):B.key==="F8"&&(B.preventDefault(),Ve())};return window.addEventListener("keydown",$),()=>{window.removeEventListener("keydown",$)}},[C]);function Q(){return a?.title??f?.title??"Untitled Model"}async function fe($){a?.source_code?.trim()!==$.trim()?D(!0):D(!1),await Promise.all([ye(),n.autoPreview?we():Promise.resolve()])}const Te=!i&&(a===void 0||a?.owner_id===r?.id)&&f!==void 0;return _.jsxs(_.Fragment,{children:[_.jsxs("div",{className:et.editorPageContainer,style:{flexDirection:c?"column":void 0},children:[_.jsxs("div",{className:et.sidebar,children:[_.jsxs("div",{className:et.modelViewerContainer,children:[_.jsx("div",{className:et.modelViewer,children:d?_.jsx(fo,{ref:ze,lightMode:v,style:{width:"100%",height:"100%"},modelUri:d}):_.jsx(Dt,{text:"Waiting for model to render"})}),_.jsx(Sr,{model:[c?{label:"Smaller Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-minimize",command:()=>g(!1)}:{label:"Larger Preview",className:"editor-page-hide-on-small",icon:"pi pi-window-maximize",command:()=>g(!0)},v?{label:"Dark Mode",icon:"pi pi-moon",command:()=>b(!1)}:{label:"Light Mode",icon:"pi pi-sun",command:()=>b(!0)},{label:"Download",icon:"pi pi-download",items:[{label:"GLB",icon:"pi pi-download",disabled:!d,command:()=>{d&&k(d,Q()+".glb")}},{label:"OFF",icon:"pi pi-download",disabled:!C,command:()=>{C&&k(C,Q()+".off")}},{label:"STL (F7)",icon:"pi pi-download",disabled:!C,command:Y}]}]})]}),Te?_.jsx(mt,{children:_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"max-content 1fr",gap:12,alignItems:"center",marginBottom:8},children:[_.jsx("label",{htmlFor:"edit-title",style:{whiteSpace:"nowrap"},children:_.jsx("b",{children:"Title"})}),_.jsx(fs,{id:"edit-title",maxLength:100,value:f.title,onChange:$=>p(B=>({...B,title:$.target.value})),placeholder:"Enter model title"}),_.jsx("label",{htmlFor:"edit-description",style:{whiteSpace:"nowrap"},children:_.jsx("b",{children:"Description"})}),_.jsx(vr,{id:"edit-description",maxLength:2e3,value:f.description,onChange:$=>p(B=>({...B,description:$.target.value})),placeholder:"Enter model description",style:{resize:"vertical"}})]})}):a!==void 0?_.jsx(mt,{toggleable:!0,header:a.title,children:_.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[_.jsx("div",{dangerouslySetInnerHTML:{__html:vs(a.description)}}),_.jsxs("span",{children:["by ",_.jsx("a",{href:"#/user/"+a.username,children:a.username})," on"," ",a.created_at]}),_.jsx("span",{children:_.jsx(Bi,{model:a})})]})}):_.jsx(_.Fragment,{}),a?_.jsx(da,{modelId:a?.id,collapsed:!n.commentsPanelExpanded,onToggle:$=>s({commentsPanelExpanded:!$.value})}):""]}),_.jsxs("div",{className:et.main,children:[_.jsxs("div",{className:et.mainSub,children:[_.jsx(mt,{toggleable:!0,header:"Customizer",collapsed:!n.customizerPanelExpanded,onToggle:$=>s({customizerPanelExpanded:!$.value}),children:_.jsx(na,{parameterSet:P,parameterValues:z,onChange:($,B)=>{G(le=>({...le,[$]:B})),n.autoPreview&&Xe()}})}),_.jsxs(mt,{className:et.panelLogs,toggleable:!0,header:"Logs & Errors",collapsed:!n.logsPanelExpanded,onToggle:$=>s({logsPanelExpanded:!$.value}),children:[m&&_.jsx("pre",{style:{color:"var(--color-danger)"},children:m}),y&&_.jsx("pre",{children:y}),!m&&!y&&_.jsx("pre",{children:"No logs or errors yet."})]})]}),_.jsxs(mt,{className:et.panelEditor,children:[_.jsx(Sr,{style:{width:"100%"},model:[{label:"Preview (F5)",icon:"pi pi-play",command:we,disabled:u!==void 0},{label:"Render (F6)",icon:"pi pi-play",command:Pe,disabled:u!==void 0},{label:"Publish (F8)",icon:"pi pi-upload",command:Ve,disabled:u!==void 0||r?.id===void 0,visible:a===void 0||a?.owner_id===r?.id},{icon:n.autoPreview?"pi pi-check-square":"pi pi-stop",label:"Auto-Preview",disabled:!1,command:()=>{s({autoPreview:!n.autoPreview})}},{label:"Overwrite with remote source",icon:"pi pi-download color-danger",command:lt,disabled:u!==void 0,visible:L}],end:_.jsx("div",{style:{display:"flex",gap:8},children:u!==void 0&&_.jsxs(_.Fragment,{children:[_.jsx("div",{style:{flex:1,alignContent:"center"},children:u}),_.jsx(Mi,{style:{width:40,height:40},strokeWidth:"8"})]})})}),_.jsx(oc,{isInitializing:N,path:Se(),homeFileProp:Se(),hideTopBar:!0,markers:R,onSave:$=>fe($),reloadKey:Ye})]})]})]}),_.jsx(Vi,{header:"Publish Model",visible:W,onHide:Oe,footer:_.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[_.jsx(tn,{label:"Cancel",icon:"pi pi-times",onClick:Oe,className:"p-button-text"}),_.jsx(tn,{label:"Publish",icon:"pi pi-upload",onClick:Ze,autoFocus:!0})]}),closable:!1,modal:!0,children:f!==void 0&&_.jsx(zi,{model:{id:"",title:f.title,preview_url:ve??"",owner_id:r?.id||"",username:r?.user_metadata?.user_name||r?.user_metadata?.name||r?.email||"Unknown User",description:f.description,created_at:sr(new Date),updated_at:sr(new Date),likes:0,comments:0}})}),_.jsx(us,{ref:Ie,position:"top-right"})]})}export{vu as default};
